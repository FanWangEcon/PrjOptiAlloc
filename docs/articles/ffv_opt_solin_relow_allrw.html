<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Linear (CRS) Optimal Allocation Solution (line by line) • PrjOptiAlloc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Linear (CRS) Optimal Allocation Solution (line by line)">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PrjOptiAlloc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ffv_opt_dtgch_cbem4.html">DATA--Generate Data Cebu Four Category Test Regression Results</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solin_relow.html">LINEAR--Optimal Linear Allocation based On Relative Allocation to Lowest</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solin_relow_allfn.html">LINEAR--CRS (Linear) Optimal Allocation Solution (Function)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solin_relow_allrw.html">Linear (CRS) Optimal Allocation Solution (line by line)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Linear (CRS) Optimal Allocation Solution (line by line)</h1>
            
      
      
      <div class="hidden name"><code>ffv_opt_solin_relow_allrw.Rmd</code></div>

    </div>

    
    
<p>Back to <strong><a href="https://fanwangecon.github.io/">Fan</a></strong>’s Optimal Allocation Homepage <strong><a href="https://fanwangecon.github.io/PrjOptiAlloc/">Table of Content</a></strong></p>
<div id="objective" class="section level1">
<h1 class="hasAnchor">
<a href="#objective" class="anchor"></a>Objective</h1>
<p>The objective of this file is to solve the linear <span class="math inline">\(N_i\)</span> and <span class="math inline">\(H_i\)</span> problem without invoking any functions. This function first tested out the linear solution algorithm.</p>
<p>File name <em>ffv_opt_solin_relow_allrw</em>:</p>
<ul>
<li>
<em>opt</em>: optimal allocation project</li>
<li>
<em>solin</em>: linear production function</li>
<li>
<em>relow</em>: solution method relying on relative allocation against lowest (first) to receive subsidy</li>
<li>
<em>allrw</em>: all code line by line raw original file</li>
</ul>
<div id="input-and-output" class="section level2">
<h2 class="hasAnchor">
<a href="#input-and-output" class="anchor"></a>Input and Output</h2>
<p>There is a dataset with child attributes, nutritional inputs and outputs. Run regression to estimate some input output relationship first. Then generate required inputs for code.</p>
<ol style="list-style-type: decimal">
<li>Required Input</li>
</ol>
<ul>
<li>
<span class="citation">@param</span> df tibble data table including variables using svr names below each row is potentially an individual who will receive alternative allocations</li>
<li>
<span class="citation">@param</span> svr_A_i string name of the A_i variable, dot product of covariates and coefficients</li>
<li>
<span class="citation">@param</span> svr_alpha_i string name of the alpha_i variable, individual specific elasticity information</li>
<li>
<span class="citation">@param</span> svr_beta_i string name of the beta_i variable, relative preference weight for each child</li>
<li>
<span class="citation">@param</span> svr_N_i string name of the vector of existing inputs, based on which to compute aggregate resource</li>
<li>
<span class="citation">@param</span> fl_N_hat float total resource avaible for allocation, if not specific, sum by svr_N_i</li>
<li>
<span class="citation">@param</span> fl_rho float preference for equality for the planner</li>
<li>
<span class="citation">@return</span> a dataframe that expands the df inputs with additional results.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>The structure assumes some regression has already taken place to generate the i specific variables listed. and</li>
</ol>
<p>Doing this allows for lagged intereaction that are time specific in an arbitrary way.</p>
</div>
<div id="associated-functions" class="section level2">
<h2 class="hasAnchor">
<a href="#associated-functions" class="anchor"></a>Associated Functions</h2>
<p>There are three components to the function here, each component has four associated files. The first <em>R</em> file is a function that allows for this part of the overall solution structure to be invoked as a function. Then, there is an RMD file that has exactly the same lines of code, but perhaps with more descriptions and printing for that function, the vigenette for that function, since each function should have its own vignette. And to show what the function output looks like, the vignette saves the output of the function to a <em>rda</em> file in the <em>data</em> folder. That new data file now requires its own R file to describe the <em>rda</em>.</p>
<ol style="list-style-type: decimal">
<li>
<strong>Regression Results</strong>: linear and loglinear
<ul>
<li>R: <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffy_opt_dtgch_cbem4.html">Function</a>
<ul>
<li>Rmd: <a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_dtgch_cbem4.html">Function Line by Line Save</a>
</li>
</ul>
</li>
<li>rda: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/master/data/df_opt_dtgch_cbem4.rda">Data File Generated</a>
<ul>
<li>R: <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffd_opt_dtgch_cbem4.html">Data File Description</a>)<br>
</li>
</ul>
</li>
</ul>
</li>
<li>
<strong>Linear Optimal Allocations</strong>: for the <em>N_i</em> and <em>H_i</em> problem
<ul>
<li>R: <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffp_opt_solin_relow.html">Function</a>
<ul>
<li>Rmd: <a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_solin_relow.html">Function Line by Line Save</a>
</li>
</ul>
</li>
<li>rda: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/master/data/df_opt_dtgch_cbem4_rrlop.rda">Data File Generated</a>
<ul>
<li>R: <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffd_opt_dtgch_cbem4_rrlop.html">Data File Description</a>)<br>
</li>
</ul>
</li>
</ul>
</li>
<li>
<strong>Gini and Graphs</strong>: post-estimation results analysis
<ul>
<li>R: <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffy_opt_dtgch_cbem4.html">Function</a>
<ul>
<li>Rmd: <a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_dtgch_cbem4.html">Function Line by Line Save</a>
</li>
</ul>
</li>
<li>rda: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/master/data/df_opt_dtgch_cbem4.rda">Data File Generated</a>
<ul>
<li>R: <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffd_opt_dtgch_cbem4.html">Data File Description</a>)</li>
</ul>
</li>
</ul>
</li>
</ol>
</div>
</div>
<div id="load-packages-and-data" class="section level1">
<h1 class="hasAnchor">
<a href="#load-packages-and-data" class="anchor"></a>Load Packages and Data</h1>
<div id="load-dependencies" class="section level2">
<h2 class="hasAnchor">
<a href="#load-dependencies" class="anchor"></a>Load Dependencies</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list =</span> <span class="kw"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>(<span class="dt">all.names =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="dt">knitr.duplicate.label =</span> <span class="st">'allow'</span>)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyr)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(stringr)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(broom)</a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb2-6" title="6"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(REconTools)</a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(knitr)</a>
<a class="sourceLine" id="cb2-8" title="8"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(kableExtra)</a></code></pre></div>
</div>
<div id="load-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load Data</h2>
<p>Generate four categories by initial height and mother’s education levels combinations.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># Load Library</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="co"># Select Cebu Only</span></a>
<a class="sourceLine" id="cb3-4" title="4">df_hw_cebu_m24 &lt;-<span class="st"> </span>df_hgt_wgt <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(S.country <span class="op">==</span><span class="st"> 'Cebu'</span> <span class="op">&amp;</span><span class="st"> </span>svymthRound <span class="op">==</span><span class="st"> </span><span class="dv">24</span> <span class="op">&amp;</span><span class="st"> </span>prot <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>hgt <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>()</a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co"># Generate Discrete Version of momEdu</span></a>
<a class="sourceLine" id="cb3-7" title="7">df_hw_cebu_m24 &lt;-<span class="st"> </span>df_hw_cebu_m24 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">momEduRound =</span> <span class="kw"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(momEdu,</a>
<a class="sourceLine" id="cb3-9" title="9">                             <span class="dt">breaks=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">10</span>, <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb3-10" title="10">                             <span class="dt">labels=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"MEduLow"</span>,<span class="st">"MEduHigh"</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">hgt0med =</span> <span class="kw"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(hgt0,</a>
<a class="sourceLine" id="cb3-12" title="12">                             <span class="dt">breaks=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">50</span>, <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb3-13" title="13">                             <span class="dt">labels=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"h0low"</span>,<span class="st">"h0high"</span>)))</a>
<a class="sourceLine" id="cb3-14" title="14"></a>
<a class="sourceLine" id="cb3-15" title="15">df_hw_cebu_m24<span class="op">$</span>momEduRound =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(df_hw_cebu_m24<span class="op">$</span>momEduRound)</a>
<a class="sourceLine" id="cb3-16" title="16">df_hw_cebu_m24<span class="op">$</span>hgt0med =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(df_hw_cebu_m24<span class="op">$</span>hgt0med)</a>
<a class="sourceLine" id="cb3-17" title="17"></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="co"># Attach</span></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="kw"><a href="https://rdrr.io/r/base/attach.html">attach</a></span>(df_hw_cebu_m24)</a></code></pre></div>
</div>
</div>
<div id="regression-with-data-and-construct-input-arrays" class="section level1">
<h1 class="hasAnchor">
<a href="#regression-with-data-and-construct-input-arrays" class="anchor"></a>Regression with Data and Construct Input Arrays</h1>
<div id="linear-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#linear-regression" class="anchor"></a>Linear Regression</h2>
<p>Estimation <em>Production functions</em> or any other function. Below, Regression height outcomes on input interacted with the categories created before. This will generate category specific marginal effects.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Input Matrix</span></a>
<a class="sourceLine" id="cb4-2" title="2">mt_lincv &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(<span class="op">~</span><span class="st"> </span>hgt0 <span class="op">+</span><span class="st"> </span>wgt0)</a>
<a class="sourceLine" id="cb4-3" title="3">mt_linht &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(<span class="op">~</span><span class="st"> </span>sex<span class="op">:</span>hgt0med <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co"># Regress Height At Month 24 on Nutritional Inputs with controls</span></a>
<a class="sourceLine" id="cb4-6" title="6">rs_hgt_prot_lin =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(hgt <span class="op">~</span><span class="st"> </span>prot<span class="op">:</span>mt_linht <span class="op">+</span><span class="st"> </span>mt_lincv <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(rs_hgt_prot_lin))</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = hgt ~ prot:mt_linht + mt_lincv - 1)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.212  -2.339   0.088   2.437   9.805 
## 
## Coefficients:
##                                       Estimate Std. Error t value Pr(&gt;|t|)    
## mt_lincv(Intercept)                  5.638e+01  3.683e+00  15.307  &lt; 2e-16 ***
## mt_lincvhgt0                         3.774e-01  8.723e-02   4.326 1.66e-05 ***
## mt_lincvwgt0                         1.154e-03  3.705e-04   3.115  0.00189 ** 
## prot:mt_linhtsexFemale:hgt0medh0low  1.014e-02  1.058e-02   0.959  0.33783    
## prot:mt_linhtsexMale:hgt0medh0low    6.018e-02  9.625e-03   6.252 5.91e-10 ***
## prot:mt_linhtsexFemale:hgt0medh0high 3.228e-02  1.332e-02   2.423  0.01558 *  
## prot:mt_linhtsexMale:hgt0medh0high   6.619e-02  1.001e-02   6.612 6.05e-11 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.473 on 1036 degrees of freedom
## Multiple R-squared:  0.9981, Adjusted R-squared:  0.9981 
## F-statistic: 7.79e+04 on 7 and 1036 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">rs_hgt_prot_lin_tidy =<span class="st"> </span><span class="kw">tidy</span>(rs_hgt_prot_lin)</a></code></pre></div>
</div>
<div id="log-linear-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#log-linear-regression" class="anchor"></a>Log-Linear Regression</h2>
<p>Now log-linear regressions, where inptut coefficient differs by input groups.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># Input Matrix Generation</span></a>
<a class="sourceLine" id="cb7-2" title="2">mt_logcv &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(<span class="op">~</span><span class="st"> </span>hgt0 <span class="op">+</span><span class="st"> </span>wgt0)</a>
<a class="sourceLine" id="cb7-3" title="3">mt_loght &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(<span class="op">~</span><span class="st"> </span>sex<span class="op">:</span>hgt0med <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-4" title="4"></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co"># Log and log regression for month 24</span></a>
<a class="sourceLine" id="cb7-6" title="6">rs_hgt_prot_log =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(hgt) <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(prot)<span class="op">:</span>mt_loght <span class="op">+</span><span class="st"> </span>mt_logcv <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-7" title="7"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(rs_hgt_prot_log))</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log(hgt) ~ log(prot):mt_loght + mt_logcv - 1)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.223890 -0.030027  0.002461  0.031047  0.118097 
## 
## Coefficients:
##                                            Estimate Std. Error t value Pr(&gt;|t|)
## mt_logcv(Intercept)                       4.087e+00  5.342e-02  76.512  &lt; 2e-16
## mt_logcvhgt0                              4.305e-03  1.224e-03   3.516 0.000457
## mt_logcvwgt0                              1.465e-05  4.733e-06   3.096 0.002012
## log(prot):mt_loghtsexFemale:hgt0medh0low  6.687e-03  2.218e-03   3.014 0.002640
## log(prot):mt_loghtsexMale:hgt0medh0low    1.209e-02  2.176e-03   5.557 3.49e-08
## log(prot):mt_loghtsexFemale:hgt0medh0high 9.251e-03  2.441e-03   3.790 0.000159
## log(prot):mt_loghtsexMale:hgt0medh0high   1.394e-02  2.288e-03   6.094 1.55e-09
##                                              
## mt_logcv(Intercept)                       ***
## mt_logcvhgt0                              ***
## mt_logcvwgt0                              ** 
## log(prot):mt_loghtsexFemale:hgt0medh0low  ** 
## log(prot):mt_loghtsexMale:hgt0medh0low    ***
## log(prot):mt_loghtsexFemale:hgt0medh0high ***
## log(prot):mt_loghtsexMale:hgt0medh0high   ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.04436 on 1036 degrees of freedom
## Multiple R-squared:  0.9999, Adjusted R-squared:  0.9999 
## F-statistic: 1.448e+06 on 7 and 1036 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">rs_hgt_prot_log_tidy =<span class="st"> </span><span class="kw">tidy</span>(rs_hgt_prot_log)</a></code></pre></div>
</div>
<div id="construct-input-arrays-a_i-and-alpha_i" class="section level2">
<h2 class="hasAnchor">
<a href="#construct-input-arrays-a_i-and-alpha_i" class="anchor"></a>Construct Input Arrays <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span>
</h2>
<p>Multiply coefficient vector by covariate matrix to generate <em>A</em> vector that is child/individual specific.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># Generate A_i</span></a>
<a class="sourceLine" id="cb10-2" title="2">ar_Ai_lin &lt;-<span class="st"> </span>mt_lincv <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(rs_hgt_prot_lin_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="op">!</span><span class="kw">str_detect</span>(term, <span class="st">'prot'</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(estimate))</a>
<a class="sourceLine" id="cb10-3" title="3">ar_Ai_log &lt;-<span class="st"> </span>mt_logcv <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(rs_hgt_prot_log_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="op">!</span><span class="kw">str_detect</span>(term, <span class="st">'prot'</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(estimate))</a>
<a class="sourceLine" id="cb10-4" title="4"></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="co"># Generate alpha_i</span></a>
<a class="sourceLine" id="cb10-6" title="6">ar_alphai_lin &lt;-<span class="st"> </span>mt_linht <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(rs_hgt_prot_lin_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw">str_detect</span>(term, <span class="st">'prot'</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(estimate))</a>
<a class="sourceLine" id="cb10-7" title="7">ar_alphai_log &lt;-<span class="st"> </span>mt_loght <span class="op">%*%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(rs_hgt_prot_log_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw">str_detect</span>(term, <span class="st">'prot'</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(estimate))</a>
<a class="sourceLine" id="cb10-8" title="8"></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co"># Child Weight</span></a>
<a class="sourceLine" id="cb10-10" title="10">ar_beta &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ar_Ai_lin), <span class="dt">times=</span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ar_Ai_lin))</a>
<a class="sourceLine" id="cb10-11" title="11"></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co"># Initate Dataframe that will store all estimates and optimal allocation relevant information</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="co"># combine identifying key information along with estimation A, alpha results</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="co"># note that we only need indi.id as key</span></a>
<a class="sourceLine" id="cb10-15" title="15">mt_opti &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(ar_alphai_lin, ar_Ai_lin, ar_beta)</a>
<a class="sourceLine" id="cb10-16" title="16">ar_st_varnames &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'alpha'</span>, <span class="st">'A'</span>, <span class="st">'beta'</span>)</a>
<a class="sourceLine" id="cb10-17" title="17">df_esti_alpha_A_beta &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(mt_opti) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_all</span>(<span class="op">~</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(ar_st_varnames))</a></code></pre></div>
<pre><code>## Warning: `as_tibble.matrix()` requires a matrix with column names or a `.name_repair` argument. Using compatibility `.name_repair`.
## This warning is displayed once per session.</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">tb_key_alpha_A_beta &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(df_hw_cebu_m24, df_esti_alpha_A_beta) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="st">              </span><span class="kw">select</span>(<span class="kw">one_of</span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'S.country'</span>, <span class="st">'vil.id'</span>, <span class="st">'indi.id'</span>, <span class="st">'svymthRound'</span>, ar_st_varnames)))</a>
<a class="sourceLine" id="cb12-3" title="3"></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co"># Unique beta, A, and alpha groups</span></a>
<a class="sourceLine" id="cb12-5" title="5">tb_opti_unique &lt;-<span class="st"> </span>tb_key_alpha_A_beta <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(<span class="op">!!!</span><span class="kw">syms</span>(ar_st_varnames)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="st">                    </span><span class="kw">arrange</span>(<span class="op">!!!</span><span class="kw">syms</span>(ar_st_varnames)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="st">                    </span><span class="kw">summarise</span>(<span class="dt">n_obs_group=</span><span class="kw">n</span>())</a></code></pre></div>
</div>
</div>
<div id="optimal-linear-allocations" class="section level1">
<h1 class="hasAnchor">
<a href="#optimal-linear-allocations" class="anchor"></a>Optimal Linear Allocations</h1>
<div id="parameters-for-optimal-allocation" class="section level2">
<h2 class="hasAnchor">
<a href="#parameters-for-optimal-allocation" class="anchor"></a>Parameters for Optimal Allocation</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># Child Count</span></a>
<a class="sourceLine" id="cb13-2" title="2">df_hw_cebu_m24_full &lt;-<span class="st"> </span>df_hw_cebu_m24</a>
<a class="sourceLine" id="cb13-3" title="3">it_obs =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(df_hw_cebu_m24)[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb13-4" title="4"></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co"># Total Resource Count</span></a>
<a class="sourceLine" id="cb13-6" title="6">ar_prot_data =<span class="st"> </span>df_hw_cebu_m24<span class="op">$</span>prot</a>
<a class="sourceLine" id="cb13-7" title="7">fl_N_agg =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(ar_prot_data)</a>
<a class="sourceLine" id="cb13-8" title="8"></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co"># Vector of Planner Preference</span></a>
<a class="sourceLine" id="cb13-10" title="10">ar_rho &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">100</span>, <span class="fl">0.8</span>)</a>
<a class="sourceLine" id="cb13-11" title="11">ar_rho &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">50</span>, <span class="dv">-25</span>, <span class="dv">-10</span>)</a>
<a class="sourceLine" id="cb13-12" title="12">ar_rho &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">-5</span>, <span class="dv">-1</span>, <span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)</a>
<a class="sourceLine" id="cb13-13" title="13">ar_rho &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">200</span>, <span class="dv">-100</span>, <span class="dt">length.out=</span><span class="dv">5</span>), <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">100</span>, <span class="dv">-25</span>, <span class="dt">length.out=</span><span class="dv">5</span>), <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">25</span>, <span class="dv">-5</span>, <span class="dt">length.out=</span><span class="dv">5</span>), <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">-1</span>, <span class="dt">length.out=</span><span class="dv">5</span>), <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">1</span>, <span class="fl">-0.01</span>, <span class="dt">length.out=</span><span class="dv">5</span>), <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.01</span>, <span class="fl">0.25</span>, <span class="dt">length.out=</span><span class="dv">5</span>), <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.25</span>, <span class="fl">0.90</span>, <span class="dt">length.out=</span><span class="dv">5</span>))</a>
<a class="sourceLine" id="cb13-14" title="14">ar_rho &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(ar_rho)</a></code></pre></div>
</div>
<div id="optimal-linear-allocation-crs" class="section level2">
<h2 class="hasAnchor">
<a href="#optimal-linear-allocation-crs" class="anchor"></a>Optimal Linear Allocation (CRS)</h2>
<p>This also works with any CRS CES.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># Optimal Linear Equation</span></a>
<a class="sourceLine" id="cb14-2" title="2"></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="co"># accumulate allocation results</span></a>
<a class="sourceLine" id="cb14-4" title="4">tb_opti_alloc_all_rho &lt;-<span class="st"> </span>tb_key_alpha_A_beta</a>
<a class="sourceLine" id="cb14-5" title="5"></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="co"># A. First Loop over Planner Preference</span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="co"># Generate Rank Order</span></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="cf">for</span> (it_rho_ctr <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ar_rho))) {</a>
<a class="sourceLine" id="cb14-9" title="9">  rho =<span class="st"> </span>ar_rho[it_rho_ctr]</a>
<a class="sourceLine" id="cb14-10" title="10"></a>
<a class="sourceLine" id="cb14-11" title="11">  <span class="co"># B. Generate V4, Rank Index Value, rho specific</span></a>
<a class="sourceLine" id="cb14-12" title="12">  <span class="co"># tb_opti &lt;- tb_opti %&gt;% mutate(!!paste0('rv_', it_rho_ctr) := A/((alpha*beta))^(1/(1-rho)))</span></a>
<a class="sourceLine" id="cb14-13" title="13">  tb_opti &lt;-<span class="st"> </span>tb_key_alpha_A_beta <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">rank_val =</span> A<span class="op">/</span>((alpha<span class="op">*</span>beta))<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>rho)))</a>
<a class="sourceLine" id="cb14-14" title="14"></a>
<a class="sourceLine" id="cb14-15" title="15">  <span class="co"># c. Generate Rank Index</span></a>
<a class="sourceLine" id="cb14-16" title="16">  tb_opti &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(rank_val) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">rank_idx =</span> <span class="kw">row_number</span>())</a>
<a class="sourceLine" id="cb14-17" title="17"></a>
<a class="sourceLine" id="cb14-18" title="18">  <span class="co"># d. Populate lowest index alpha, beta, and A to all rows</span></a>
<a class="sourceLine" id="cb14-19" title="19">  tb_opti &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">lowest_rank_A =</span> A[rank_idx<span class="op">==</span><span class="dv">1</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-20" title="20"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">lowest_rank_alpha =</span> alpha[rank_idx<span class="op">==</span><span class="dv">1</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-21" title="21"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">lowest_rank_beta =</span> beta[rank_idx<span class="op">==</span><span class="dv">1</span>])</a>
<a class="sourceLine" id="cb14-22" title="22"></a>
<a class="sourceLine" id="cb14-23" title="23">  <span class="co"># e. relative slope and relative intercept with respect to lowest index</span></a>
<a class="sourceLine" id="cb14-24" title="24">  tb_opti &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-25" title="25"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">rela_slope_to_lowest =</span></a>
<a class="sourceLine" id="cb14-26" title="26">                         (((lowest_rank_alpha<span class="op">*</span>lowest_rank_beta)<span class="op">/</span>(alpha<span class="op">*</span>beta))<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>(rho<span class="dv">-1</span>))<span class="op">*</span>(lowest_rank_alpha<span class="op">/</span>alpha))</a>
<a class="sourceLine" id="cb14-27" title="27">                      ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-28" title="28"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">rela_intercept_to_lowest =</span></a>
<a class="sourceLine" id="cb14-29" title="29">                         ((((lowest_rank_alpha<span class="op">*</span>lowest_rank_beta)<span class="op">/</span>(alpha<span class="op">*</span>beta))<span class="op">^</span>(<span class="dv">1</span><span class="op">/</span>(rho<span class="dv">-1</span>))<span class="op">*</span>(lowest_rank_A<span class="op">/</span>alpha)) <span class="op">-</span><span class="st"> </span>(A<span class="op">/</span>alpha))</a>
<a class="sourceLine" id="cb14-30" title="30">                      )</a>
<a class="sourceLine" id="cb14-31" title="31"></a>
<a class="sourceLine" id="cb14-32" title="32">  <span class="co"># f. cumulative sums</span></a>
<a class="sourceLine" id="cb14-33" title="33">  tb_opti &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-34" title="34"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">rela_slope_to_lowest_cumsum =</span></a>
<a class="sourceLine" id="cb14-35" title="35">                         <span class="kw"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(rela_slope_to_lowest)</a>
<a class="sourceLine" id="cb14-36" title="36">                      ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-37" title="37"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">rela_intercept_to_lowest_cumsum =</span></a>
<a class="sourceLine" id="cb14-38" title="38">                         <span class="kw"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(rela_intercept_to_lowest)</a>
<a class="sourceLine" id="cb14-39" title="39">                      )</a>
<a class="sourceLine" id="cb14-40" title="40"></a>
<a class="sourceLine" id="cb14-41" title="41">  <span class="co"># g. inverting cumulative slopes and intercepts</span></a>
<a class="sourceLine" id="cb14-42" title="42">  tb_opti &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-43" title="43"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">rela_slope_to_lowest_cumsum_invert =</span></a>
<a class="sourceLine" id="cb14-44" title="44">                         (<span class="dv">1</span><span class="op">/</span>rela_slope_to_lowest_cumsum)</a>
<a class="sourceLine" id="cb14-45" title="45">                      ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-46" title="46"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">rela_intercept_to_lowest_cumsum_invert =</span></a>
<a class="sourceLine" id="cb14-47" title="47">                         ((<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>(rela_intercept_to_lowest_cumsum)<span class="op">/</span>(rela_slope_to_lowest_cumsum))</a>
<a class="sourceLine" id="cb14-48" title="48">                      )</a>
<a class="sourceLine" id="cb14-49" title="49"></a>
<a class="sourceLine" id="cb14-50" title="50">  <span class="co"># h. Relative x-intercept points</span></a>
<a class="sourceLine" id="cb14-51" title="51">  tb_opti &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-52" title="52"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">rela_x_intercept =</span></a>
<a class="sourceLine" id="cb14-53" title="53">                         (<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>(rela_intercept_to_lowest<span class="op">/</span>rela_slope_to_lowest)</a>
<a class="sourceLine" id="cb14-54" title="54">                      )</a>
<a class="sourceLine" id="cb14-55" title="55"></a>
<a class="sourceLine" id="cb14-56" title="56">  <span class="co"># i. Inverted relative x-intercepts</span></a>
<a class="sourceLine" id="cb14-57" title="57">  tb_opti &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-58" title="58"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">opti_lowest_spline_knots =</span></a>
<a class="sourceLine" id="cb14-59" title="59">                         (rela_intercept_to_lowest_cumsum <span class="op">+</span><span class="st"> </span>rela_slope_to_lowest_cumsum<span class="op">*</span>rela_x_intercept)</a>
<a class="sourceLine" id="cb14-60" title="60">                      )</a>
<a class="sourceLine" id="cb14-61" title="61"></a>
<a class="sourceLine" id="cb14-62" title="62">  <span class="co"># j. Sort by order of receiving transfers/subsidies</span></a>
<a class="sourceLine" id="cb14-63" title="63">  tb_opti &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(rela_x_intercept)</a>
<a class="sourceLine" id="cb14-64" title="64"></a>
<a class="sourceLine" id="cb14-65" title="65">  <span class="co"># k. Find position of subsidy</span></a>
<a class="sourceLine" id="cb14-66" title="66">  tb_opti &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(opti_lowest_spline_knots) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-67" title="67"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">tot_devi =</span> opti_lowest_spline_knots <span class="op">-</span><span class="st"> </span>fl_N_agg) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-68" title="68"><span class="st">                </span><span class="kw">arrange</span>((<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span><span class="kw">case_when</span>(tot_devi <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span>tot_devi)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-69" title="69"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">allocate_lowest =</span></a>
<a class="sourceLine" id="cb14-70" title="70">                         <span class="kw">case_when</span>(<span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span></a>
<a class="sourceLine" id="cb14-71" title="71"><span class="st">                                     </span>rela_intercept_to_lowest_cumsum_invert <span class="op">+</span></a>
<a class="sourceLine" id="cb14-72" title="72"><span class="st">                                     </span>rela_slope_to_lowest_cumsum_invert<span class="op">*</span>fl_N_agg)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-73" title="73"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">allocate_lowest =</span> allocate_lowest[<span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span>]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-74" title="74"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">opti_allocate =</span></a>
<a class="sourceLine" id="cb14-75" title="75">                         rela_intercept_to_lowest <span class="op">+</span></a>
<a class="sourceLine" id="cb14-76" title="76"><span class="st">                         </span>rela_slope_to_lowest<span class="op">*</span>allocate_lowest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-77" title="77"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">opti_allocate =</span></a>
<a class="sourceLine" id="cb14-78" title="78">                         <span class="kw">case_when</span>(opti_allocate <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span>opti_allocate, <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-79" title="79"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">opti_allocate_total =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(opti_allocate, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb14-80" title="80"></a>
<a class="sourceLine" id="cb14-81" title="81">  <span class="co"># l. Predictes Expected choice: A + alpha*opti_allocate</span></a>
<a class="sourceLine" id="cb14-82" title="82">  tb_opti &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">opti_exp_outcome =</span> A <span class="op">+</span><span class="st"> </span>alpha<span class="op">*</span>opti_allocate)  </a>
<a class="sourceLine" id="cb14-83" title="83"></a>
<a class="sourceLine" id="cb14-84" title="84">  <span class="co"># m. Keep for df collection individual key + optimal allocation</span></a>
<a class="sourceLine" id="cb14-85" title="85">  <span class="co"># _on stands for optimal nutritional choices</span></a>
<a class="sourceLine" id="cb14-86" title="86">  <span class="co"># _eh stands for expected height</span></a>
<a class="sourceLine" id="cb14-87" title="87">  tb_opti_main_results &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-88" title="88"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">one_of</span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'lowest_rank_alpha'</span>, <span class="st">'lowest_rank_beta'</span>)))</a>
<a class="sourceLine" id="cb14-89" title="89">  tb_opti_allocate_wth_key &lt;-<span class="st"> </span>tb_opti <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">one_of</span>(<span class="st">'indi.id'</span>,<span class="st">'opti_allocate'</span>, <span class="st">'opti_exp_outcome'</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-90" title="90"><span class="st">                                </span><span class="kw">rename</span>(<span class="op">!!</span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'rho_c'</span>, it_rho_ctr, <span class="st">'_on'</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(<span class="st">'opti_allocate'</span>),</a>
<a class="sourceLine" id="cb14-91" title="91">                                       <span class="op">!!</span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'rho_c'</span>, it_rho_ctr, <span class="st">'_eh'</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(<span class="st">'opti_exp_outcome'</span>))</a>
<a class="sourceLine" id="cb14-92" title="92"></a>
<a class="sourceLine" id="cb14-93" title="93">  <span class="co"># n. merge optimal allocaiton results from different planner preference</span></a>
<a class="sourceLine" id="cb14-94" title="94">  tb_opti_alloc_all_rho &lt;-<span class="st"> </span>tb_opti_alloc_all_rho <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(tb_opti_allocate_wth_key, <span class="dt">by=</span><span class="st">'indi.id'</span>)</a>
<a class="sourceLine" id="cb14-95" title="95"></a>
<a class="sourceLine" id="cb14-96" title="96">  <span class="co"># print subset</span></a>
<a class="sourceLine" id="cb14-97" title="97">  <span class="cf">if</span> (it_rho_ctr <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>it_rho_ctr <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ar_rho) <span class="op">|</span><span class="st"> </span>it_rho_ctr <span class="op">==</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ar_rho)<span class="op">/</span><span class="dv">2</span>)) {</a>
<a class="sourceLine" id="cb14-98" title="98">    <span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">''</span>)</a>
<a class="sourceLine" id="cb14-99" title="99">    <span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>)</a>
<a class="sourceLine" id="cb14-100" title="100">    <span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'xxx rho:'</span>, rho))</a>
<a class="sourceLine" id="cb14-101" title="101">    <span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>)</a>
<a class="sourceLine" id="cb14-102" title="102">    <span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="st">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>)</a>
<a class="sourceLine" id="cb14-103" title="103"></a>
<a class="sourceLine" id="cb14-104" title="104">    <span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(tb_opti_main_results))</a>
<a class="sourceLine" id="cb14-105" title="105">  }</a>
<a class="sourceLine" id="cb14-106" title="106">}</a></code></pre></div>
<pre><code>## [1] ""
## [1] "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
## [1] "xxx rho:-200"
## [1] "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
## [1] "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
##   S.country             vil.id         indi.id        svymthRound
##  Length:1043        Min.   : 1.00   Min.   :   2.0   Min.   :24  
##  Class :character   1st Qu.: 7.00   1st Qu.: 298.5   1st Qu.:24  
##  Mode  :character   Median :12.00   Median : 627.0   Median :24  
##                     Mean   :12.52   Mean   : 634.8   Mean   :24  
##                     3rd Qu.:17.00   3rd Qu.: 939.5   3rd Qu.:24  
##                     Max.   :33.00   Max.   :1349.0   Max.   :24  
##      alpha               A              beta              rank_val    
##  Min.   :0.01014   Min.   :73.70   Min.   :0.0009588   Min.   :77.36  
##  1st Qu.:0.01014   1st Qu.:77.73   1st Qu.:0.0009588   1st Qu.:81.92  
##  Median :0.06018   Median :78.45   Median :0.0009588   Median :82.69  
##  Mean   :0.04108   Mean   :78.46   Mean   :0.0009588   Mean   :82.63  
##  3rd Qu.:0.06018   3rd Qu.:79.15   3rd Qu.:0.0009588   3rd Qu.:83.34  
##  Max.   :0.06619   Max.   :84.61   Max.   :0.0009588   Max.   :89.09  
##     rank_idx      lowest_rank_A  rela_slope_to_lowest rela_intercept_to_lowest
##  Min.   :   1.0   Min.   :73.7   Min.   :0.9096       Min.   :-638.33         
##  1st Qu.: 261.5   1st Qu.:73.7   1st Qu.:1.0000       1st Qu.:-416.71         
##  Median : 522.0   Median :73.7   Median :1.0000       Median :-103.23         
##  Mean   : 522.0   Mean   :73.7   Mean   :2.7200       Mean   :-221.98         
##  3rd Qu.: 782.5   3rd Qu.:73.7   3rd Qu.:5.8796       3rd Qu.: -77.34         
##  Max.   :1043.0   Max.   :73.7   Max.   :5.8796       Max.   :   0.00         
##  rela_slope_to_lowest_cumsum rela_intercept_to_lowest_cumsum
##  Min.   :   1.0              Min.   :-231525                
##  1st Qu.: 729.9              1st Qu.:-178488                
##  Median :1502.8              Median :-105313                
##  Mean   :1499.0              Mean   :-110538                
##  3rd Qu.:2325.3              3rd Qu.: -44408                
##  Max.   :2837.0              Max.   :      0                
##  rela_slope_to_lowest_cumsum_invert rela_intercept_to_lowest_cumsum_invert
##  Min.   :0.0003525                  Min.   : 0.00                         
##  1st Qu.:0.0004300                  1st Qu.:60.84                         
##  Median :0.0006654                  Median :70.08                         
##  Mean   :0.0040250                  Mean   :67.06                         
##  3rd Qu.:0.0013700                  3rd Qu.:76.76                         
##  Max.   :1.0000000                  Max.   :81.61                         
##  rela_x_intercept opti_lowest_spline_knots    tot_devi      allocate_lowest
##  Min.   :  0.00   Min.   :     0           Min.   :-22823   Min.   :85.24  
##  1st Qu.: 72.17   1st Qu.:  8275           1st Qu.:-14548   1st Qu.:85.24  
##  Median : 84.37   Median : 21478           Median : -1345   Median :85.24  
##  Mean   : 83.42   Mean   : 29824           Mean   :  7002   Mean   :85.24  
##  3rd Qu.: 94.53   3rd Qu.: 41314           3rd Qu.: 18491   3rd Qu.:85.24  
##  Max.   :185.68   Max.   :295234           Max.   :272412   Max.   :85.24  
##  opti_allocate     opti_allocate_total opti_exp_outcome
##  Min.   :  0.000   Min.   :22823       Min.   :78.13   
##  1st Qu.:  0.000   1st Qu.:22823       1st Qu.:78.36   
##  Median :  1.289   Median :22823       Median :78.83   
##  Mean   : 21.882   Mean   :22823       Mean   :78.94   
##  3rd Qu.: 21.838   3rd Qu.:22823       3rd Qu.:79.15   
##  Max.   :371.159   Max.   :22823       Max.   :84.61   
## [1] ""
## [1] "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
## [1] "xxx rho:-3"
## [1] "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
## [1] "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
##   S.country             vil.id         indi.id        svymthRound
##  Length:1043        Min.   : 1.00   Min.   :   2.0   Min.   :24  
##  Class :character   1st Qu.: 7.00   1st Qu.: 298.5   1st Qu.:24  
##  Mode  :character   Median :12.00   Median : 627.0   Median :24  
##                     Mean   :12.52   Mean   : 634.8   Mean   :24  
##                     3rd Qu.:17.00   3rd Qu.: 939.5   3rd Qu.:24  
##                     Max.   :33.00   Max.   :1349.0   Max.   :24  
##      alpha               A              beta              rank_val     
##  Min.   :0.01014   Min.   :73.70   Min.   :0.0009588   Min.   : 845.6  
##  1st Qu.:0.01014   1st Qu.:77.73   1st Qu.:0.0009588   1st Qu.: 892.2  
##  Median :0.06018   Median :78.45   Median :0.0009588   Median : 906.5  
##  Mean   :0.04108   Mean   :78.46   Mean   :0.0009588   Mean   :1082.8  
##  3rd Qu.:0.06018   3rd Qu.:79.15   3rd Qu.:0.0009588   3rd Qu.:1383.7  
##  Max.   :0.06619   Max.   :84.61   Max.   :0.0009588   Max.   :1424.0  
##     rank_idx      lowest_rank_A  rela_slope_to_lowest rela_intercept_to_lowest
##  Min.   :   1.0   Min.   :73.7   Min.   :0.931        Min.   :-3183.95        
##  1st Qu.: 261.5   1st Qu.:73.7   1st Qu.:1.000        1st Qu.:-2962.33        
##  Median : 522.0   Median :73.7   Median :1.000        Median :  -85.91        
##  Mean   : 522.0   Mean   :73.7   Mean   :1.997        Mean   :-1106.86        
##  3rd Qu.: 782.5   3rd Qu.:73.7   3rd Qu.:3.801        3rd Qu.:  -65.38        
##  Max.   :1043.0   Max.   :73.7   Max.   :3.801        Max.   :    0.00        
##  rela_slope_to_lowest_cumsum rela_intercept_to_lowest_cumsum
##  Min.   :   1.0              Min.   :-1154457               
##  1st Qu.: 252.2              1st Qu.: -360111               
##  Median : 507.3              Median :  -33998               
##  Mean   : 705.8              Mean   : -226709               
##  3rd Qu.:1093.2              3rd Qu.:  -14454               
##  Max.   :2083.4              Max.   :       0               
##  rela_slope_to_lowest_cumsum_invert rela_intercept_to_lowest_cumsum_invert
##  Min.   :0.0004800                  Min.   :  0.00                        
##  1st Qu.:0.0009147                  1st Qu.: 57.32                        
##  Median :0.0019712                  Median : 67.02                        
##  Mean   :0.0071664                  Mean   :180.86                        
##  3rd Qu.:0.0039658                  3rd Qu.:329.40                        
##  Max.   :1.0000000                  Max.   :554.13                        
##  rela_x_intercept opti_lowest_spline_knots    tot_devi      allocate_lowest
##  Min.   :  0.00   Min.   :     0           Min.   :-22823   Min.   :111    
##  1st Qu.: 67.55   1st Qu.:  2579           1st Qu.:-20244   1st Qu.:111    
##  Median : 88.18   Median : 10738           Median :-12085   Median :111    
##  Mean   :343.58   Mean   :191130           Mean   :168308   Mean   :111    
##  3rd Qu.:779.36   3rd Qu.:491900           3rd Qu.:469077   3rd Qu.:111    
##  Max.   :837.66   Max.   :590710           Max.   :567888   Max.   :111    
##  opti_allocate    opti_allocate_total opti_exp_outcome
##  Min.   :  0.00   Min.   :22823       Min.   :74.37   
##  1st Qu.:  0.00   1st Qu.:22823       1st Qu.:78.35   
##  Median : 21.29   Median :22823       Median :80.38   
##  Mean   : 21.88   Mean   :22823       Mean   :79.83   
##  3rd Qu.: 41.90   3rd Qu.:22823       3rd Qu.:80.38   
##  Max.   :111.04   Max.   :22823       Max.   :84.61   
## [1] ""
## [1] "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
## [1] "xxx rho:0.9"
## [1] "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
## [1] "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
##   S.country             vil.id         indi.id        svymthRound
##  Length:1043        Min.   : 1.00   Min.   :   2.0   Min.   :24  
##  Class :character   1st Qu.: 7.00   1st Qu.: 298.5   1st Qu.:24  
##  Mode  :character   Median :12.00   Median : 627.0   Median :24  
##                     Mean   :12.52   Mean   : 634.8   Mean   :24  
##                     3rd Qu.:17.00   3rd Qu.: 939.5   3rd Qu.:24  
##                     Max.   :33.00   Max.   :1349.0   Max.   :24  
##      alpha               A              beta              rank_val        
##  Min.   :0.01014   Min.   :73.70   Min.   :0.0009588   Min.   :7.380e+43  
##  1st Qu.:0.01014   1st Qu.:77.73   1st Qu.:0.0009588   1st Qu.:1.876e+44  
##  Median :0.06018   Median :78.45   Median :0.0009588   Median :1.926e+44  
##  Mean   :0.04108   Mean   :78.46   Mean   :0.0009588   Mean   :3.415e+51  
##  3rd Qu.:0.06018   3rd Qu.:79.15   3rd Qu.:0.0009588   3rd Qu.:1.020e+52  
##  Max.   :0.06619   Max.   :84.61   Max.   :0.0009588   Max.   :1.049e+52  
##     rank_idx      lowest_rank_A   rela_slope_to_lowest rela_intercept_to_lowest
##  Min.   :   1.0   Min.   :78.22   Min.   :0.0000       Min.   :-7838.9         
##  1st Qu.: 261.5   1st Qu.:78.22   1st Qu.:0.0000       1st Qu.:-7617.3         
##  Median : 522.0   Median :78.22   Median :0.4243       Median : -807.4         
##  Mean   : 522.0   Mean   :78.22   Mean   :0.3547       Mean   :-3133.9         
##  3rd Qu.: 782.5   3rd Qu.:78.22   3rd Qu.:0.4243       3rd Qu.: -773.1         
##  Max.   :1043.0   Max.   :78.22   Max.   :1.0000       Max.   :    0.0         
##  rela_slope_to_lowest_cumsum rela_intercept_to_lowest_cumsum
##  Min.   :  1.0               Min.   :-3268692               
##  1st Qu.:245.7               1st Qu.:-1261733               
##  Median :356.2               Median : -232715               
##  Mean   :292.5               Mean   : -743262               
##  3rd Qu.:370.0               3rd Qu.:  -25972               
##  Max.   :370.0               Max.   :       0               
##  rela_slope_to_lowest_cumsum_invert rela_intercept_to_lowest_cumsum_invert
##  Min.   :0.002703                   Min.   :   0.0                        
##  1st Qu.:0.002703                   1st Qu.: 105.7                        
##  Median :0.002808                   Median : 653.3                        
##  Mean   :0.008086                   Mean   :2027.3                        
##  3rd Qu.:0.004071                   3rd Qu.:3410.2                        
##  Max.   :1.000000                   Max.   :8834.6                        
##  rela_x_intercept    opti_lowest_spline_knots    tot_devi         
##  Min.   :0.000e+00   Min.   :0.000e+00        Min.   :-2.282e+04  
##  1st Qu.:1.822e+03   1st Qu.:4.217e+05        1st Qu.: 3.989e+05  
##  Median :1.903e+03   Median :4.451e+05        Median : 4.223e+05  
##  Mean   :5.467e+10   Mean   :2.023e+13        Mean   : 2.023e+13  
##  3rd Qu.:1.633e+11   3rd Qu.:6.041e+13        3rd Qu.: 6.041e+13  
##  Max.   :1.680e+11   Max.   :6.217e+13        Max.   : 6.217e+13  
##  allocate_lowest opti_allocate    opti_allocate_total opti_exp_outcome
##  Min.   :119.1   Min.   :  0.00   Min.   :22823       Min.   :73.70   
##  1st Qu.:119.1   1st Qu.:  0.00   1st Qu.:22823       1st Qu.:77.73   
##  Median :119.1   Median :  0.00   Median :22823       Median :78.46   
##  Mean   :119.1   Mean   : 21.88   Mean   :22823       Mean   :79.91   
##  3rd Qu.:119.1   3rd Qu.:  0.00   3rd Qu.:22823       3rd Qu.:79.87   
##  Max.   :119.1   Max.   :119.06   Max.   :22823       Max.   :86.10</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># o. print results</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(tb_opti_alloc_all_rho))</a></code></pre></div>
<pre><code>##   S.country             vil.id         indi.id        svymthRound
##  Length:1043        Min.   : 1.00   Min.   :   2.0   Min.   :24  
##  Class :character   1st Qu.: 7.00   1st Qu.: 298.5   1st Qu.:24  
##  Mode  :character   Median :12.00   Median : 627.0   Median :24  
##                     Mean   :12.52   Mean   : 634.8   Mean   :24  
##                     3rd Qu.:17.00   3rd Qu.: 939.5   3rd Qu.:24  
##                     Max.   :33.00   Max.   :1349.0   Max.   :24  
##      alpha               A              beta             rho_c1_on      
##  Min.   :0.01014   Min.   :73.70   Min.   :0.0009588   Min.   :  0.000  
##  1st Qu.:0.01014   1st Qu.:77.73   1st Qu.:0.0009588   1st Qu.:  0.000  
##  Median :0.06018   Median :78.45   Median :0.0009588   Median :  1.289  
##  Mean   :0.04108   Mean   :78.46   Mean   :0.0009588   Mean   : 21.882  
##  3rd Qu.:0.06018   3rd Qu.:79.15   3rd Qu.:0.0009588   3rd Qu.: 21.838  
##  Max.   :0.06619   Max.   :84.61   Max.   :0.0009588   Max.   :371.159  
##    rho_c1_eh       rho_c2_on         rho_c2_eh       rho_c3_on      
##  Min.   :78.13   Min.   :  0.000   Min.   :78.11   Min.   :  0.000  
##  1st Qu.:78.36   1st Qu.:  0.000   1st Qu.:78.36   1st Qu.:  0.000  
##  Median :78.83   Median :  2.247   Median :78.91   Median :  3.604  
##  Mean   :78.94   Mean   : 21.882   Mean   :78.96   Mean   : 21.882  
##  3rd Qu.:79.15   3rd Qu.: 22.480   3rd Qu.:79.15   3rd Qu.: 23.625  
##  Max.   :84.61   Max.   :369.036   Max.   :84.61   Max.   :366.005  
##    rho_c3_eh       rho_c4_on         rho_c4_eh       rho_c5_on      
##  Min.   :78.08   Min.   :  0.000   Min.   :78.03   Min.   :  0.000  
##  1st Qu.:78.36   1st Qu.:  0.000   1st Qu.:78.36   1st Qu.:  0.000  
##  Median :79.01   Median :  5.173   Median :79.14   Median :  7.713  
##  Mean   :78.99   Mean   : 21.882   Mean   :79.04   Mean   : 21.882  
##  3rd Qu.:79.15   3rd Qu.: 24.753   3rd Qu.:79.20   3rd Qu.: 26.879  
##  Max.   :84.61   Max.   :361.458   Max.   :84.61   Max.   :354.063  
##    rho_c5_eh       rho_c6_on        rho_c6_eh       rho_c7_on     
##  Min.   :77.96   Min.   :  0.00   Min.   :77.86   Min.   :  0.00  
##  1st Qu.:78.36   1st Qu.:  0.00   1st Qu.:78.36   1st Qu.:  0.00  
##  Median :79.35   Median :  9.47   Median :79.57   Median : 11.60  
##  Mean   :79.10   Mean   : 21.88   Mean   :79.18   Mean   : 21.88  
##  3rd Qu.:79.42   3rd Qu.: 27.61   3rd Qu.:79.66   3rd Qu.: 30.74  
##  Max.   :84.61   Max.   :344.53   Max.   :84.61   Max.   :326.54  
##    rho_c7_eh       rho_c8_on        rho_c8_eh       rho_c9_on     
##  Min.   :77.68   Min.   :  0.00   Min.   :77.25   Min.   :  0.00  
##  1st Qu.:78.36   1st Qu.:  0.00   1st Qu.:78.36   1st Qu.:  0.00  
##  Median :79.89   Median : 15.29   Median :80.39   Median : 13.87  
##  Mean   :79.31   Mean   : 21.88   Mean   :79.53   Mean   : 21.88  
##  3rd Qu.:79.89   3rd Qu.: 34.90   3rd Qu.:80.39   3rd Qu.: 40.99  
##  Max.   :84.61   Max.   :284.15   Max.   :84.61   Max.   :121.45  
##    rho_c9_eh       rho_c10_on       rho_c10_eh      rho_c11_on    
##  Min.   :75.60   Min.   :  0.00   Min.   :74.41   Min.   :  0.00  
##  1st Qu.:78.36   1st Qu.:  0.00   1st Qu.:78.36   1st Qu.:  0.00  
##  Median :80.96   Median : 12.04   Median :80.99   Median : 13.15  
##  Mean   :79.79   Mean   : 21.88   Mean   :79.81   Mean   : 21.88  
##  3rd Qu.:80.96   3rd Qu.: 41.54   3rd Qu.:80.99   3rd Qu.: 41.19  
##  Max.   :84.61   Max.   :121.25   Max.   :84.61   Max.   :120.56  
##    rho_c11_eh      rho_c12_on       rho_c12_eh      rho_c13_on    
##  Min.   :74.37   Min.   :  0.00   Min.   :74.37   Min.   :  0.00  
##  1st Qu.:78.35   1st Qu.:  0.00   1st Qu.:78.35   1st Qu.:  0.00  
##  Median :80.95   Median : 15.17   Median :80.87   Median : 20.24  
##  Mean   :79.82   Mean   : 21.88   Mean   :79.82   Mean   : 21.88  
##  3rd Qu.:80.95   3rd Qu.: 41.46   3rd Qu.:80.87   3rd Qu.: 41.61  
##  Max.   :84.61   Max.   :119.13   Max.   :84.61   Max.   :115.30  
##    rho_c13_eh      rho_c14_on       rho_c14_eh      rho_c15_on    
##  Min.   :74.37   Min.   :  0.00   Min.   :74.37   Min.   :  0.00  
##  1st Qu.:78.35   1st Qu.:  0.00   1st Qu.:78.35   1st Qu.:  0.00  
##  Median :80.64   Median : 22.12   Median :80.53   Median : 21.29  
##  Mean   :79.83   Mean   : 21.88   Mean   :79.83   Mean   : 21.88  
##  3rd Qu.:80.64   3rd Qu.: 41.54   3rd Qu.:80.53   3rd Qu.: 41.90  
##  Max.   :84.61   Max.   :113.60   Max.   :84.61   Max.   :111.04  
##    rho_c15_eh      rho_c16_on       rho_c16_eh      rho_c17_on   
##  Min.   :74.37   Min.   :  0.00   Min.   :74.37   Min.   : 0.00  
##  1st Qu.:78.35   1st Qu.:  0.00   1st Qu.:78.35   1st Qu.: 0.00  
##  Median :80.38   Median : 21.41   Median :80.12   Median :13.93  
##  Mean   :79.83   Mean   : 21.88   Mean   :79.84   Mean   :21.88  
##  3rd Qu.:80.38   3rd Qu.: 42.07   3rd Qu.:80.12   3rd Qu.:41.17  
##  Max.   :84.61   Max.   :106.76   Max.   :84.61   Max.   :98.14  
##    rho_c17_eh      rho_c18_on      rho_c18_eh      rho_c19_on    
##  Min.   :74.37   Min.   : 0.00   Min.   :74.37   Min.   : 0.000  
##  1st Qu.:78.35   1st Qu.: 0.00   1st Qu.:78.35   1st Qu.: 0.000  
##  Median :79.60   Median :10.43   Median :79.38   Median : 5.523  
##  Mean   :79.86   Mean   :21.88   Mean   :79.86   Mean   :21.882  
##  3rd Qu.:79.87   3rd Qu.:40.28   3rd Qu.:79.87   3rd Qu.:37.688  
##  Max.   :84.61   Max.   :94.48   Max.   :84.61   Max.   :91.211  
##    rho_c19_eh      rho_c20_on       rho_c20_eh      rho_c21_on    
##  Min.   :74.37   Min.   :  0.00   Min.   :74.37   Min.   :  0.00  
##  1st Qu.:78.35   1st Qu.:  0.00   1st Qu.:78.35   1st Qu.:  0.00  
##  Median :79.09   Median :  0.00   Median :78.66   Median :  0.00  
##  Mean   :79.87   Mean   : 21.88   Mean   :79.89   Mean   : 21.88  
##  3rd Qu.:79.87   3rd Qu.: 32.66   3rd Qu.:79.87   3rd Qu.: 19.98  
##  Max.   :84.61   Max.   :100.22   Max.   :84.85   Max.   :111.57  
##    rho_c21_eh      rho_c22_on       rho_c22_eh      rho_c23_on    
##  Min.   :74.37   Min.   :  0.00   Min.   :74.37   Min.   :  0.00  
##  1st Qu.:77.90   1st Qu.:  0.00   1st Qu.:77.81   1st Qu.:  0.00  
##  Median :78.46   Median :  0.00   Median :78.46   Median :  0.00  
##  Mean   :79.90   Mean   : 21.88   Mean   :79.90   Mean   : 21.88  
##  3rd Qu.:79.87   3rd Qu.: 18.42   3rd Qu.:79.87   3rd Qu.: 12.89  
##  Max.   :85.60   Max.   :112.48   Max.   :85.66   Max.   :114.96  
##    rho_c23_eh      rho_c24_on        rho_c24_eh      rho_c25_on    
##  Min.   :74.37   Min.   :  0.000   Min.   :74.37   Min.   :  0.00  
##  1st Qu.:77.73   1st Qu.:  0.000   1st Qu.:77.73   1st Qu.:  0.00  
##  Median :78.46   Median :  0.000   Median :78.46   Median :  0.00  
##  Mean   :79.91   Mean   : 21.882   Mean   :79.91   Mean   : 21.88  
##  3rd Qu.:79.87   3rd Qu.:  5.622   3rd Qu.:79.87   3rd Qu.:  0.00  
##  Max.   :85.83   Max.   :116.787   Max.   :85.95   Max.   :118.02  
##    rho_c25_eh      rho_c26_on       rho_c26_eh      rho_c27_on    
##  Min.   :74.37   Min.   :  0.00   Min.   :74.37   Min.   :  0.00  
##  1st Qu.:77.73   1st Qu.:  0.00   1st Qu.:77.73   1st Qu.:  0.00  
##  Median :78.46   Median :  0.00   Median :78.46   Median :  0.00  
##  Mean   :79.91   Mean   : 21.88   Mean   :79.91   Mean   : 21.88  
##  3rd Qu.:79.87   3rd Qu.:  0.00   3rd Qu.:79.87   3rd Qu.:  0.00  
##  Max.   :86.03   Max.   :118.63   Max.   :86.07   Max.   :119.06  
##    rho_c27_eh      rho_c28_on       rho_c28_eh      rho_c29_on    
##  Min.   :73.70   Min.   :  0.00   Min.   :73.70   Min.   :  0.00  
##  1st Qu.:77.73   1st Qu.:  0.00   1st Qu.:77.73   1st Qu.:  0.00  
##  Median :78.46   Median :  0.00   Median :78.46   Median :  0.00  
##  Mean   :79.91   Mean   : 21.88   Mean   :79.91   Mean   : 21.88  
##  3rd Qu.:79.87   3rd Qu.:  0.00   3rd Qu.:79.87   3rd Qu.:  0.00  
##  Max.   :86.10   Max.   :119.06   Max.   :86.10   Max.   :119.06  
##    rho_c29_eh      rho_c30_on       rho_c30_eh   
##  Min.   :73.70   Min.   :  0.00   Min.   :73.70  
##  1st Qu.:77.73   1st Qu.:  0.00   1st Qu.:77.73  
##  Median :78.46   Median :  0.00   Median :78.46  
##  Mean   :79.91   Mean   : 21.88   Mean   :79.91  
##  3rd Qu.:79.87   3rd Qu.:  0.00   3rd Qu.:79.87  
##  Max.   :86.10   Max.   :119.06   Max.   :86.10</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(tb_opti_alloc_all_rho)</a></code></pre></div>
<pre><code>## Classes 'tbl_df', 'tbl' and 'data.frame':    1043 obs. of  67 variables:
##  $ S.country  : chr  "Cebu" "Cebu" "Cebu" "Cebu" ...
##  $ vil.id     : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ indi.id    : num  2 3 4 5 6 7 8 9 10 11 ...
##  $ svymthRound: num  24 24 24 24 24 24 24 24 24 24 ...
##  $ alpha      : num  0.0101 0.0323 0.0323 0.0662 0.0101 ...
##  $ A          : num  78.4 79.9 78.9 80.6 77.8 ...
##  $ beta       : num  0.000959 0.000959 0.000959 0.000959 0.000959 ...
##  $ rho_c1_on  : num  0 0 0 0 29.1 ...
##  $ rho_c1_eh  : num  78.4 79.9 78.9 80.6 78.1 ...
##  $ rho_c2_on  : num  0 0 0 0 26.9 ...
##  $ rho_c2_eh  : num  78.4 79.9 78.9 80.6 78.1 ...
##  $ rho_c3_on  : num  0 0 0 0 23.9 ...
##  $ rho_c3_eh  : num  78.4 79.9 78.9 80.6 78.1 ...
##  $ rho_c4_on  : num  0 0 0 0 19.4 ...
##  $ rho_c4_eh  : num  78.4 79.9 78.9 80.6 78 ...
##  $ rho_c5_on  : num  0 0 0 0 12 ...
##  $ rho_c5_eh  : num  78.4 79.9 78.9 80.6 78 ...
##  $ rho_c6_on  : num  0 0 2.29 0 2.43 ...
##  $ rho_c6_eh  : num  78.4 79.9 79 80.6 77.9 ...
##  $ rho_c7_on  : num  0 0 6.72 0 0 ...
##  $ rho_c7_eh  : num  78.4 79.9 79.1 80.6 77.8 ...
##  $ rho_c8_on  : num  0 0 11.8 0 0 ...
##  $ rho_c8_eh  : num  78.4 79.9 79.3 80.6 77.8 ...
##  $ rho_c9_on  : num  0 0 4.61 10.4 0 ...
##  $ rho_c9_eh  : num  78.4 79.9 79 81.3 77.8 ...
##  $ rho_c10_on : num  0 0 0 12 0 ...
##  $ rho_c10_eh : num  78.4 79.9 78.9 81.4 77.8 ...
##  $ rho_c11_on : num  0 0 0 13.2 0 ...
##  $ rho_c11_eh : num  78.4 79.9 78.9 81.4 77.8 ...
##  $ rho_c12_on : num  0 0 0 15.2 0 ...
##  $ rho_c12_eh : num  78.4 79.9 78.9 81.6 77.8 ...
##  $ rho_c13_on : num  0 0 0 20.6 0 ...
##  $ rho_c13_eh : num  78.4 79.9 78.9 81.9 77.8 ...
##  $ rho_c14_on : num  0 0 0 22.9 0 ...
##  $ rho_c14_eh : num  78.4 79.9 78.9 82.1 77.8 ...
##  $ rho_c15_on : num  0 0 0 26.5 0 ...
##  $ rho_c15_eh : num  78.4 79.9 78.9 82.3 77.8 ...
##  $ rho_c16_on : num  0 0 0 32.4 0 ...
##  $ rho_c16_eh : num  78.4 79.9 78.9 82.7 77.8 ...
##  $ rho_c17_on : num  0 0 0 44.1 0 ...
##  $ rho_c17_eh : num  78.4 79.9 78.9 83.5 77.8 ...
##  $ rho_c18_on : num  0 0 0 49.1 0 ...
##  $ rho_c18_eh : num  78.4 79.9 78.9 83.8 77.8 ...
##  $ rho_c19_on : num  0 0 0 55.8 0 ...
##  $ rho_c19_eh : num  78.4 79.9 78.9 84.3 77.8 ...
##  $ rho_c20_on : num  0 0 0 64.8 0 ...
##  $ rho_c20_eh : num  78.4 79.9 78.9 84.9 77.8 ...
##  $ rho_c21_on : num  0 0 0 76.1 0 ...
##  $ rho_c21_eh : num  78.4 79.9 78.9 85.6 77.8 ...
##  $ rho_c22_on : num  0 0 0 77 0 ...
##  $ rho_c22_eh : num  78.4 79.9 78.9 85.7 77.8 ...
##  $ rho_c23_on : num  0 0 0 79.5 0 ...
##  $ rho_c23_eh : num  78.4 79.9 78.9 85.8 77.8 ...
##  $ rho_c24_on : num  0 0 0 81.3 0 ...
##  $ rho_c24_eh : num  78.4 79.9 78.9 85.9 77.8 ...
##  $ rho_c25_on : num  0 0 0 82.6 0 ...
##  $ rho_c25_eh : num  78.4 79.9 78.9 86 77.8 ...
##  $ rho_c26_on : num  0 0 0 83.2 0 ...
##  $ rho_c26_eh : num  78.4 79.9 78.9 86.1 77.8 ...
##  $ rho_c27_on : num  0 0 0 83.6 0 ...
##  $ rho_c27_eh : num  78.4 79.9 78.9 86.1 77.8 ...
##  $ rho_c28_on : num  0 0 0 83.6 0 ...
##  $ rho_c28_eh : num  78.4 79.9 78.9 86.1 77.8 ...
##  $ rho_c29_on : num  0 0 0 83.6 0 ...
##  $ rho_c29_eh : num  78.4 79.9 78.9 86.1 77.8 ...
##  $ rho_c30_on : num  0 0 0 83.6 0 ...
##  $ rho_c30_eh : num  78.4 79.9 78.9 86.1 77.8 ...</code></pre>
</div>
</div>
<div id="linear-optimal-allocation-statistics-and-graphs" class="section level1">
<h1 class="hasAnchor">
<a href="#linear-optimal-allocation-statistics-and-graphs" class="anchor"></a>Linear optimal Allocation Statistics and Graphs</h1>
<div id="compute-gini-statistics-for-allocations-and-outcomes" class="section level2">
<h2 class="hasAnchor">
<a href="#compute-gini-statistics-for-allocations-and-outcomes" class="anchor"></a>Compute Gini Statistics for Allocations and Outcomes</h2>
<p>Compute Gini coefficient for each expected outcome and input vector, and store results in separate vectors for input allocation and expected outcomes, then combine.</p>
<p>See how <strong>apply</strong> works here: <a href="https://fanwangecon.github.io/R4Econ/support/function/fs_applysapplymutate.html">R use Apply, Sapply and dplyr Mutate to Evaluate one Function Across Rows of a Matrix</a> from <a href="https://fanwangecon.github.io/R4Econ">R4Econ</a>.</p>
<p>See how gini function works: <a href="https://fanwangecon.github.io/REconTools/reference/ff_dist_gini_vector_pos.html">ff_dist_gini_vector_pos</a> from <a href="https://fanwangecon.github.io/REconTools">REconTools</a>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="co"># Select out columns for _on = optimal nutrition</span></a>
<a class="sourceLine" id="cb20-2" title="2">mt_opti_alloc_all_rho &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span>(tb_opti_alloc_all_rho <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">'_on'</span>)))</a>
<a class="sourceLine" id="cb20-3" title="3">mt_expc_outcm_all_rho &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span>(tb_opti_alloc_all_rho <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">'_eh'</span>)))</a>
<a class="sourceLine" id="cb20-4" title="4"></a>
<a class="sourceLine" id="cb20-5" title="5"><span class="co"># Compute gini for each rho</span></a>
<a class="sourceLine" id="cb20-6" title="6">ar_opti_alloc_gini &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(mt_opti_alloc_all_rho), <span class="dv">1</span>, ff_dist_gini_vector_pos))</a>
<a class="sourceLine" id="cb20-7" title="7">ar_expc_outcm_gini &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(mt_expc_outcm_all_rho), <span class="dv">1</span>, ff_dist_gini_vector_pos))</a>
<a class="sourceLine" id="cb20-8" title="8"></a>
<a class="sourceLine" id="cb20-9" title="9"><span class="co"># Combine results</span></a>
<a class="sourceLine" id="cb20-10" title="10"><span class="co"># column names look like: rho_c1_on rho_c2_on rho_c3_on rho_c1_eh rho_c2_eh rho_c3_eh</span></a>
<a class="sourceLine" id="cb20-11" title="11">tb_gini_onerow_wide &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">as_tibble</span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(ar_opti_alloc_gini)), <span class="kw">as_tibble</span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(ar_expc_outcm_gini)))</a>
<a class="sourceLine" id="cb20-12" title="12">tb_gini_long &lt;-<span class="st"> </span>tb_gini_onerow_wide <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-13" title="13"><span class="st">  </span><span class="kw">pivot_longer</span>(</a>
<a class="sourceLine" id="cb20-14" title="14">    <span class="dt">cols =</span> <span class="kw">starts_with</span>(<span class="st">"rho"</span>),</a>
<a class="sourceLine" id="cb20-15" title="15">    <span class="dt">names_to =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"it_rho_ctr"</span>, <span class="st">"oneh"</span>),</a>
<a class="sourceLine" id="cb20-16" title="16">    <span class="dt">names_pattern =</span> <span class="st">"rho_c(.*)_(.*)"</span>,</a>
<a class="sourceLine" id="cb20-17" title="17">    <span class="dt">values_to =</span> <span class="st">"gini"</span></a>
<a class="sourceLine" id="cb20-18" title="18">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-19" title="19"><span class="st">  </span><span class="kw">pivot_wider</span>(</a>
<a class="sourceLine" id="cb20-20" title="20">    <span class="dt">id_cols =</span> it_rho_ctr,</a>
<a class="sourceLine" id="cb20-21" title="21">    <span class="dt">names_from =</span> oneh,</a>
<a class="sourceLine" id="cb20-22" title="22">    <span class="dt">values_from =</span> gini</a>
<a class="sourceLine" id="cb20-23" title="23">  )</a>
<a class="sourceLine" id="cb20-24" title="24">planner_elas &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="dv">1</span><span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>ar_rho)<span class="op">+</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb20-25" title="25">tb_gini_long &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(tb_gini_long, planner_elas)</a></code></pre></div>
<div id="gini-graphs" class="section level3">
<h3 class="hasAnchor">
<a href="#gini-graphs" class="anchor"></a>Gini Graphs</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">scatter &lt;-<span class="st"> </span>tb_gini_long <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="st">      </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>on, <span class="dt">y=</span>eh)) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-3" title="3"><span class="st">      </span><span class="kw">geom_point</span>(<span class="dt">size=</span>planner_elas) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">'Scatter Plot of Optimal Allocation and Expected Outcomes Gini'</span>,</a>
<a class="sourceLine" id="cb21-5" title="5">           <span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'GINI for Optimal Allocations'</span>),</a>
<a class="sourceLine" id="cb21-6" title="6">           <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'GINI for Exp Outcome given Optimal Allocations'</span>),</a>
<a class="sourceLine" id="cb21-7" title="7">           <span class="dt">caption =</span> <span class="st">'Optimal Allocations and Expected Outcomes, Cebu Height and Protein Example (Wang 2020)'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-8" title="8"><span class="st">      </span><span class="kw">theme_bw</span>()</a>
<a class="sourceLine" id="cb21-9" title="9"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(scatter)</a></code></pre></div>
<p><img src="ffv_opt_solin_relow_allrw_files/figure-html/Gini%20Allocation%20and%20Outcome%20Scatter%20Correlation-1.png" width="700"></p>
</div>
</div>
<div id="graphs-based-on-individual-allocations" class="section level2">
<h2 class="hasAnchor">
<a href="#graphs-based-on-individual-allocations" class="anchor"></a>Graphs Based on Individual Allocations</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="co"># p. graph scatter of opposing preference correlation</span></a>
<a class="sourceLine" id="cb22-2" title="2">svr_lowrho_ctr &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb22-3" title="3">svr_higrho_ctr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ar_rho)<span class="op">-</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb22-4" title="4">svr_lowrho &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'rho_c'</span>, svr_lowrho_ctr, <span class="st">'_on'</span>)</a>
<a class="sourceLine" id="cb22-5" title="5">svr_higrho &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'rho_c'</span>, svr_higrho_ctr, <span class="st">'_eh'</span>)</a>
<a class="sourceLine" id="cb22-6" title="6">tb_min_max_rho &lt;-<span class="st"> </span>tb_opti_alloc_all_rho <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">one_of</span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(svr_lowrho, svr_higrho)))</a>
<a class="sourceLine" id="cb22-7" title="7"></a>
<a class="sourceLine" id="cb22-8" title="8">scatter &lt;-<span class="st"> </span>tb_min_max_rho <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-9" title="9"><span class="st">      </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="op">!!</span><span class="kw">sym</span>(svr_lowrho), <span class="dt">y=</span><span class="op">!!</span><span class="kw">sym</span>(svr_higrho))) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-10" title="10"><span class="st">      </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-11" title="11"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">'Scatter Plot of Optimal Allocation Low and High Rho'</span>,</a>
<a class="sourceLine" id="cb22-12" title="12">           <span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Allocation High Rho = '</span>, ar_rho[svr_higrho_ctr], <span class="st">', More Efficient'</span>),</a>
<a class="sourceLine" id="cb22-13" title="13">           <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Allocation Low Rho = '</span>, ar_rho[svr_lowrho_ctr], <span class="st">', More Equal'</span>),</a>
<a class="sourceLine" id="cb22-14" title="14">           <span class="dt">caption =</span> <span class="st">'Optimal linear allocation results, given height reg on protein results. (Wang 2020)'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-15" title="15"><span class="st">      </span><span class="kw">theme_bw</span>()</a>
<a class="sourceLine" id="cb22-16" title="16"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(scatter)</a></code></pre></div>
<p><img src="ffv_opt_solin_relow_allrw_files/figure-html/Individal%20Allocation%20Plots-1.png" width="700"></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="co"># lineplot &lt;- tb_opti %&gt;%</span></a>
<a class="sourceLine" id="cb23-2" title="2"><span class="co">#     gather(variable, value, -month) %&gt;%</span></a>
<a class="sourceLine" id="cb23-3" title="3"><span class="co">#     ggplot(aes(x=month, y=value, colour=variable, linetype=variable)) +</span></a>
<a class="sourceLine" id="cb23-4" title="4"><span class="co">#         geom_line() +</span></a>
<a class="sourceLine" id="cb23-5" title="5"><span class="co">#         geom_point() +</span></a>
<a class="sourceLine" id="cb23-6" title="6"><span class="co">#         labs(title = 'Mean and SD of Temperature Acorss US Cities',</span></a>
<a class="sourceLine" id="cb23-7" title="7"><span class="co">#              x = 'Months',</span></a>
<a class="sourceLine" id="cb23-8" title="8"><span class="co">#              y = 'Temperature in Fahrenheit',</span></a>
<a class="sourceLine" id="cb23-9" title="9"><span class="co">#              caption = 'Temperature data 2017') +</span></a>
<a class="sourceLine" id="cb23-10" title="10"><span class="co">#         scale_x_continuous(labels = as.character(df_temp_mth_summ$month),</span></a>
<a class="sourceLine" id="cb23-11" title="11"><span class="co">#                            breaks = df_temp_mth_summ$month)</span></a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#objective">Objective</a><ul class="nav nav-pills nav-stacked">
<li><a href="#input-and-output">Input and Output</a></li>
      <li><a href="#associated-functions">Associated Functions</a></li>
      </ul>
</li>
      <li>
<a href="#load-packages-and-data">Load Packages and Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#load-dependencies">Load Dependencies</a></li>
      <li><a href="#load-data">Load Data</a></li>
      </ul>
</li>
      <li>
<a href="#regression-with-data-and-construct-input-arrays">Regression with Data and Construct Input Arrays</a><ul class="nav nav-pills nav-stacked">
<li><a href="#linear-regression">Linear Regression</a></li>
      <li><a href="#log-linear-regression">Log-Linear Regression</a></li>
      <li><a href="#construct-input-arrays-a_i-and-alpha_i">Construct Input Arrays <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span></a></li>
      </ul>
</li>
      <li>
<a href="#optimal-linear-allocations">Optimal Linear Allocations</a><ul class="nav nav-pills nav-stacked">
<li><a href="#parameters-for-optimal-allocation">Parameters for Optimal Allocation</a></li>
      <li><a href="#optimal-linear-allocation-crs">Optimal Linear Allocation (CRS)</a></li>
      </ul>
</li>
      <li>
<a href="#linear-optimal-allocation-statistics-and-graphs">Linear optimal Allocation Statistics and Graphs</a><ul class="nav nav-pills nav-stacked">
<li><a href="#compute-gini-statistics-for-allocations-and-outcomes">Compute Gini Statistics for Allocations and Outcomes</a></li>
      <li><a href="#graphs-based-on-individual-allocations">Graphs Based on Individual Allocations</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Fan Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
