<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DISCRETE--Discrete Provision Optimal Allocation Solution (Line by Line) • PrjOptiAlloc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="DISCRETE--Discrete Provision Optimal Allocation Solution (Line by Line)">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PrjOptiAlloc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ffv_opt_anlyz_rhgin.html">ANALYSIS--Optimal Allocations Planner Elasticity Vector and Ginis</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_dtgch_cbem4.html">DATA--Generate Data Cebu Four Category Test Regression Results</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sobin_rkone_allfc_training_logit.html">BINARY--NSW Training EMPLOYMENT as Outcome Optimal Allocation Solution (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sobin_rkone_allrw_car.html">BINARY--MPG and Shift Optimal Allocation Solution (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sobin_rkone_allrw_training_wage.html">BINARY--NSW Training WAGE Optimal Allocation Solution (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sobin_rkone_allrw_wgt.html">BINARY--Birth Weight and Doctors Visit Optimal Allocation Solution (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sodis_rkone_allrw_casch.html">DISCRETE--Discrete Provision Optimal Allocation Solution (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solin_relow.html">LINEAR--Optimal Linear Allocation based On Relative Allocation to Lowest</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solin_relow_allfn.html">LINEAR--CRS (Linear) Optimal Allocation Solution (Function)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solin_relow_allrw.html">LINEAR--CRS (Linear) Optimal Allocation Solution (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solog_bisec_allrw.html">LOG-LINEAR--DRS (Log-Linear) Optimal Allocation Implicit Bisection Solution (Line by Line)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>DISCRETE–Discrete Provision Optimal Allocation Solution (Line by Line)</h1>
            
      
      
      <div class="hidden name"><code>ffv_opt_sodis_rkone_allrw_casch.Rmd</code></div>

    </div>

    
    
<p>Back to <strong><a href="https://fanwangecon.github.io/">Fan</a></strong>’s Optimal Allocation Homepage <strong><a href="https://fanwangecon.github.io/PrjOptiAllo==c/">Table of Content</a></strong></p>
<div id="objective" class="section level1">
<h1 class="hasAnchor">
<a href="#objective" class="anchor"></a>Objective</h1>
<p>The california school dataset, the effect of teacher ratio on student scores.</p>
</div>
<div id="load-packages-and-data" class="section level1">
<h1 class="hasAnchor">
<a href="#load-packages-and-data" class="anchor"></a>Load Packages and Data</h1>
<div id="load-dependencies" class="section level2">
<h2 class="hasAnchor">
<a href="#load-dependencies" class="anchor"></a>Load Dependencies</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list =</span> <span class="kw"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>(<span class="dt">all.names =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="dt">knitr.duplicate.label =</span> <span class="st">'allow'</span>)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyr)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tibble)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(stringr)</a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(broom)</a>
<a class="sourceLine" id="cb2-6" title="6"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(REconTools)</a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(PrjOptiAlloc)</a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(knitr)</a>
<a class="sourceLine" id="cb2-12" title="12"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(kableExtra)</a></code></pre></div>
</div>
<div id="load-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load Data</h2>
<p>Generate four categories by initial height and mother’s education levels combinations.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># Load Data</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(df_opt_caschool)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co"># Summarize</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(df_opt_caschool)</a></code></pre></div>
<pre><code>## 'data.frame':    420 obs. of  18 variables:
##  $ X       : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ distcod : int  75119 61499 61549 61457 61523 62042 68536 63834 62331 67306 ...
##  $ county  : Factor w/ 45 levels "Alameda","Butte",..: 1 2 2 2 2 6 29 11 6 25 ...
##  $ district: Factor w/ 409 levels "Ackerman Elementary",..: 362 214 367 134 270 53 152 383 263 93 ...
##  $ grspan  : Factor w/ 2 levels "KK-06","KK-08": 2 2 2 2 2 2 2 2 2 1 ...
##  $ enrltot : int  195 240 1550 243 1335 137 195 888 379 2247 ...
##  $ teachers: num  10.9 11.1 82.9 14 71.5 ...
##  $ calwpct : num  0.51 15.42 55.03 36.48 33.11 ...
##  $ mealpct : num  2.04 47.92 76.32 77.05 78.43 ...
##  $ computer: int  67 101 169 85 171 25 28 66 35 0 ...
##  $ testscr : num  691 661 644 648 641 ...
##  $ compstu : num  0.344 0.421 0.109 0.35 0.128 ...
##  $ expnstu : num  6385 5099 5502 7102 5236 ...
##  $ str     : num  17.9 21.5 18.7 17.4 18.7 ...
##  $ avginc  : num  22.69 9.82 8.98 8.98 9.08 ...
##  $ elpct   : num  0 4.58 30 0 13.86 ...
##  $ readscr : num  692 660 636 652 642 ...
##  $ mathscr : num  690 662 651 644 640 ...</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(df_opt_caschool)</a></code></pre></div>
<pre><code>##        X            distcod              county   
##  Min.   :  1.0   Min.   :61382   Sonoma     : 29  
##  1st Qu.:105.8   1st Qu.:64308   Kern       : 27  
##  Median :210.5   Median :67761   Los Angeles: 27  
##  Mean   :210.5   Mean   :67473   Tulare     : 24  
##  3rd Qu.:315.2   3rd Qu.:70419   San Diego  : 21  
##  Max.   :420.0   Max.   :75440   Santa Clara: 20  
##                                  (Other)    :272  
##                       district     grspan       enrltot       
##  Lakeside Union Elementary:  3   KK-06: 61   Min.   :   81.0  
##  Mountain View Elementary :  3   KK-08:359   1st Qu.:  379.0  
##  Jefferson Elementary     :  2               Median :  950.5  
##  Liberty Elementary       :  2               Mean   : 2628.8  
##  Ocean View Elementary    :  2               3rd Qu.: 3008.0  
##  Pacific Union Elementary :  2               Max.   :27176.0  
##  (Other)                  :406                                
##     teachers          calwpct          mealpct          computer     
##  Min.   :   4.85   Min.   : 0.000   Min.   :  0.00   Min.   :   0.0  
##  1st Qu.:  19.66   1st Qu.: 4.395   1st Qu.: 23.28   1st Qu.:  46.0  
##  Median :  48.56   Median :10.520   Median : 41.75   Median : 117.5  
##  Mean   : 129.07   Mean   :13.246   Mean   : 44.71   Mean   : 303.4  
##  3rd Qu.: 146.35   3rd Qu.:18.981   3rd Qu.: 66.86   3rd Qu.: 375.2  
##  Max.   :1429.00   Max.   :78.994   Max.   :100.00   Max.   :3324.0  
##                                                                      
##     testscr         compstu           expnstu          str       
##  Min.   :605.5   Min.   :0.00000   Min.   :3926   Min.   :14.00  
##  1st Qu.:640.0   1st Qu.:0.09377   1st Qu.:4906   1st Qu.:18.58  
##  Median :654.5   Median :0.12546   Median :5215   Median :19.72  
##  Mean   :654.2   Mean   :0.13593   Mean   :5312   Mean   :19.64  
##  3rd Qu.:666.7   3rd Qu.:0.16447   3rd Qu.:5601   3rd Qu.:20.87  
##  Max.   :706.8   Max.   :0.42083   Max.   :7712   Max.   :25.80  
##                                                                  
##      avginc           elpct           readscr         mathscr     
##  Min.   : 5.335   Min.   : 0.000   Min.   :604.5   Min.   :605.4  
##  1st Qu.:10.639   1st Qu.: 1.941   1st Qu.:640.4   1st Qu.:639.4  
##  Median :13.728   Median : 8.778   Median :655.8   Median :652.5  
##  Mean   :15.317   Mean   :15.768   Mean   :655.0   Mean   :653.3  
##  3rd Qu.:17.629   3rd Qu.:22.970   3rd Qu.:668.7   3rd Qu.:665.9  
##  Max.   :55.328   Max.   :85.540   Max.   :704.0   Max.   :709.5  
## </code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">df_opt_caschool <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(county) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="st">  </span><span class="kw">summarise_if</span>(is.numeric, <span class="kw">funs</span>(<span class="dt">mean =</span> mean), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once per session.</code></pre>
<pre><code>## # A tibble: 45 x 16
##    county X_mean distcod_mean enrltot_mean teachers_mean calwpct_mean
##    &lt;fct&gt;   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;
##  1 Alame…     1        75119          195          10.9         0.510
##  2 Butte     36        61486.        1152.         60.5        36.3  
##  3 Calav…   233        61572          777          36.8        13.0  
##  4 Contr…   299.       61738.        2726.        138.          3.51 
##  5 El Do…   294.       61912.        1373.         69.5         6.73 
##  6 Fresno   111        62250.         504.         26.4        21.1  
##  7 Glenn    264.       62596          138.          6.58        7.11 
##  8 Humbo…   240.       62888.         380.         20.6        17.8  
##  9 Imper…   121.       63163.        1936          92.5        19.7  
## 10 Inyo     252        63255         1510          73.3        10.3  
## # … with 35 more rows, and 10 more variables: mealpct_mean &lt;dbl&gt;,
## #   computer_mean &lt;dbl&gt;, testscr_mean &lt;dbl&gt;, compstu_mean &lt;dbl&gt;,
## #   expnstu_mean &lt;dbl&gt;, str_mean &lt;dbl&gt;, avginc_mean &lt;dbl&gt;, elpct_mean &lt;dbl&gt;,
## #   readscr_mean &lt;dbl&gt;, mathscr_mean &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># Modifying and labeling etc.</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="co"># School characteristics are averaged across the district, don't know school count per district, implicitly assume the number of schools per district is the same.</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co"># Some districts have larger and others smaller sized schools, ignoring within district variations.</span></a>
<a class="sourceLine" id="cb10-4" title="4">df_opt_caschool &lt;-<span class="st"> </span>df_opt_caschool <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="st">                      </span><span class="kw">mutate</span>(<span class="dt">id =</span> X) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="st">                      </span><span class="kw">mutate</span>(<span class="dt">teachers =</span> <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(teachers),</a>
<a class="sourceLine" id="cb10-7" title="7">                             <span class="dt">enrltot =</span> <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(enrltot))</a>
<a class="sourceLine" id="cb10-8" title="8"></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co"># Generate Discrete Version of continuous variables</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co"># df_opt_birthwt &lt;- df_opt_birthwt %&gt;%</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="co">#     mutate(momwgtLowHigh = cut(lwt,</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co">#                                breaks=c(-Inf, 129, Inf),</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="co">#                                labels=c("LW","HW"))) %&gt;%</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="co">#     mutate(mombirthage = cut(age,</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co">#                                breaks=c(-Inf, 24, Inf),</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">#                                labels=c("young","older"))) %&gt;%</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">#     mutate(ftvm3 = cut(ftv,</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="co">#                                breaks=c(-Inf, 1, 2, Inf),</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="co">#                                labels=c("novisit","1visit","morevisit")))</span></a></code></pre></div>
</div>
</div>
<div id="regression-with-data-and-construct-input-arrays" class="section level1">
<h1 class="hasAnchor">
<a href="#regression-with-data-and-construct-input-arrays" class="anchor"></a>Regression with Data and Construct Input Arrays</h1>
<div id="tabulate" class="section level2">
<h2 class="hasAnchor">
<a href="#tabulate" class="anchor"></a>Tabulate</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># Tabulate groups, how many in each group, enough for group heterogeneity in effects?</span></a>
<a class="sourceLine" id="cb11-2" title="2">df_opt_caschool <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(county, grspan) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">freq =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> grspan, <span class="dt">values_from =</span> freq)</a></code></pre></div>
<pre><code>## # A tibble: 45 x 3
## # Groups:   county [45]
##    county       `KK-08` `KK-06`
##    &lt;fct&gt;          &lt;int&gt;   &lt;int&gt;
##  1 Alameda            1      NA
##  2 Butte              6      NA
##  3 Calaveras          1      NA
##  4 Contra Costa       7      NA
##  5 El Dorado         10      NA
##  6 Fresno            12      NA
##  7 Glenn              3      NA
##  8 Humboldt          14       3
##  9 Imperial           6      NA
## 10 Inyo               1      NA
## # … with 35 more rows</code></pre>
</div>
<div id="regression-testing" class="section level2">
<h2 class="hasAnchor">
<a href="#regression-testing" class="anchor"></a>Regression Testing</h2>
<p>The allocation policy is in terms of teachers. How many teachers to add. Given the current number of teachers in the school, suppose there is some capacity limit at each school, so the number of additional teachers at each school can not exceed 35 percent of the teachers that are already there.</p>
<p>Our estimation is based on regressing thest score on the student teacher ratio, from which we obtain a single estimate <span class="math inline">\(\alpha\)</span>.</p>
<p><span class="math display">\[
Y_i = A_i + \theta \cdot \frac{S_i}{T_i} + \epsilon
\]</span></p>
<p>What is the marginal effect of adding one more unit?</p>
<p>What is the effect of adding an additional teacher?</p>
<p>We need to translate the estimate <span class="math inline">\(\theta\)</span> here into our equation’s allocation scale</p>
<p><span class="math display">\[
Y_i \left(T_i\right) = A_i + \theta \cdot \frac{S_i}{T_i} + \epsilon\\
Y_i \left(T_i + 1\right) = A_i + \theta \cdot \frac{S_i}{T_i + 1} + \epsilon\\
EY_i \left(T_i + 1\right) - EY_i \left(T_i\right) = \theta \cdot S_i \cdot \left( \frac{1}{T_i + 1} - \frac{1}{T_i} \right)
\]</span></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/attach.html">attach</a></span>(df_opt_caschool)</a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co"># Math, English, and Overall and str = student teacher ratio</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(mathscr <span class="op">~</span><span class="st"> </span>str))</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mathscr ~ str)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -44.615 -13.374  -0.828  12.728  52.711 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 691.4174     9.3825  73.692  &lt; 2e-16 ***
## str          -1.9386     0.4755  -4.077 5.47e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 18.41 on 418 degrees of freedom
## Multiple R-squared:  0.03824,    Adjusted R-squared:  0.03594 
## F-statistic: 16.62 on 1 and 418 DF,  p-value: 5.467e-05</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(readscr <span class="op">~</span><span class="st"> </span>str))</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = readscr ~ str)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -50.839 -14.479   1.121  14.495  44.370 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 706.4485     9.9410  71.064  &lt; 2e-16 ***
## str          -2.6210     0.5038  -5.202 3.09e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 19.51 on 418 degrees of freedom
## Multiple R-squared:  0.06081,    Adjusted R-squared:  0.05856 
## F-statistic: 27.06 on 1 and 418 DF,  p-value: 3.091e-07</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(testscr <span class="op">~</span><span class="st"> </span>str))</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = testscr ~ str)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -47.727 -14.251   0.483  12.822  48.540 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 698.9330     9.4675  73.825  &lt; 2e-16 ***
## str          -2.2798     0.4798  -4.751 2.78e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 18.58 on 418 degrees of freedom
## Multiple R-squared:  0.05124,    Adjusted R-squared:  0.04897 
## F-statistic: 22.58 on 1 and 418 DF,  p-value: 2.783e-06</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># Regress test score on str with student and teacher counts</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(testscr <span class="op">~</span><span class="st"> </span>enrltot <span class="op">+</span><span class="st"> </span>teachers <span class="op">+</span><span class="st"> </span>str))</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = testscr ~ enrltot + teachers + str)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -48.726 -13.723   0.454  12.646  48.613 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 691.053506  11.009245  62.770  &lt; 2e-16 ***
## enrltot      -0.002793   0.003459  -0.808  0.41981    
## teachers      0.048168   0.071289   0.676  0.49962    
## str          -1.821241   0.563315  -3.233  0.00132 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 18.53 on 416 degrees of freedom
## Multiple R-squared:  0.06047,    Adjusted R-squared:  0.0537 
## F-statistic: 8.925 on 3 and 416 DF,  p-value: 9.632e-06</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="co"># Regress test score on str with covariates and county fe</span></a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(testscr <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(county) <span class="op">+</span><span class="st"> </span>calwpct <span class="op">+</span><span class="st"> </span>mealpct <span class="op">+</span><span class="st"> </span>computer</a>
<a class="sourceLine" id="cb21-3" title="3">                     <span class="op">+</span><span class="st"> </span>str <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = testscr ~ factor(county) + calwpct + mealpct + computer + 
##     str - 1)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -32.035  -4.981   0.188   5.137  23.819 
## 
## Coefficients:
##                                 Estimate Std. Error t value Pr(&gt;|t|)    
## factor(county)Alameda          7.072e+02  1.001e+01  70.621  &lt; 2e-16 ***
## factor(county)Butte            7.009e+02  6.696e+00 104.678  &lt; 2e-16 ***
## factor(county)Calaveras        6.980e+02  1.053e+01  66.301  &lt; 2e-16 ***
## factor(county)Contra Costa     6.980e+02  6.391e+00 109.215  &lt; 2e-16 ***
## factor(county)El Dorado        6.947e+02  6.152e+00 112.916  &lt; 2e-16 ***
## factor(county)Fresno           6.959e+02  6.102e+00 114.043  &lt; 2e-16 ***
## factor(county)Glenn            7.068e+02  7.953e+00  88.870  &lt; 2e-16 ***
## factor(county)Humboldt         6.991e+02  5.687e+00 122.930  &lt; 2e-16 ***
## factor(county)Imperial         6.960e+02  7.079e+00  98.314  &lt; 2e-16 ***
## factor(county)Inyo             6.987e+02  1.044e+01  66.892  &lt; 2e-16 ***
## factor(county)Kern             6.940e+02  6.010e+00 115.462  &lt; 2e-16 ***
## factor(county)Kings            6.972e+02  6.456e+00 107.997  &lt; 2e-16 ***
## factor(county)Lake             6.988e+02  8.372e+00  83.464  &lt; 2e-16 ***
## factor(county)Lassen           6.988e+02  7.163e+00  97.556  &lt; 2e-16 ***
## factor(county)Los Angeles      6.959e+02  6.328e+00 109.969  &lt; 2e-16 ***
## factor(county)Madera           6.994e+02  6.788e+00 103.030  &lt; 2e-16 ***
## factor(county)Marin            7.014e+02  5.893e+00 119.016  &lt; 2e-16 ***
## factor(county)Mendocino        6.918e+02  1.047e+01  66.085  &lt; 2e-16 ***
## factor(county)Merced           6.946e+02  6.380e+00 108.866  &lt; 2e-16 ***
## factor(county)Monterey         6.887e+02  6.811e+00 101.116  &lt; 2e-16 ***
## factor(county)Nevada           6.972e+02  6.024e+00 115.734  &lt; 2e-16 ***
## factor(county)Orange           6.981e+02  6.579e+00 106.109  &lt; 2e-16 ***
## factor(county)Placer           6.976e+02  6.325e+00 110.301  &lt; 2e-16 ***
## factor(county)Riverside        6.946e+02  7.444e+00  93.310  &lt; 2e-16 ***
## factor(county)Sacramento       6.900e+02  6.599e+00 104.565  &lt; 2e-16 ***
## factor(county)San Benito       6.821e+02  7.252e+00  94.066  &lt; 2e-16 ***
## factor(county)San Bernardino   6.935e+02  6.573e+00 105.507  &lt; 2e-16 ***
## factor(county)San Diego        7.010e+02  5.944e+00 117.924  &lt; 2e-16 ***
## factor(county)San Joaquin      6.852e+02  6.611e+00 103.656  &lt; 2e-16 ***
## factor(county)San Luis Obispo  6.982e+02  8.217e+00  84.980  &lt; 2e-16 ***
## factor(county)San Mateo        6.969e+02  5.594e+00 124.580  &lt; 2e-16 ***
## factor(county)Santa Barbara    7.014e+02  6.219e+00 112.776  &lt; 2e-16 ***
## factor(county)Santa Clara      6.990e+02  5.947e+00 117.544  &lt; 2e-16 ***
## factor(county)Santa Cruz       7.032e+02  6.407e+00 109.764  &lt; 2e-16 ***
## factor(county)Shasta           7.008e+02  6.059e+00 115.659  &lt; 2e-16 ***
## factor(county)Siskiyou         6.988e+02  5.461e+00 127.960  &lt; 2e-16 ***
## factor(county)Sonoma           6.967e+02  5.513e+00 126.365  &lt; 2e-16 ***
## factor(county)Stanislaus       6.933e+02  6.582e+00 105.325  &lt; 2e-16 ***
## factor(county)Sutter           6.853e+02  6.840e+00 100.200  &lt; 2e-16 ***
## factor(county)Tehama           7.018e+02  6.427e+00 109.189  &lt; 2e-16 ***
## factor(county)Trinity          7.259e+02  8.093e+00  89.691  &lt; 2e-16 ***
## factor(county)Tulare           6.969e+02  6.260e+00 111.321  &lt; 2e-16 ***
## factor(county)Tuolumne         6.970e+02  6.274e+00 111.095  &lt; 2e-16 ***
## factor(county)Ventura          6.955e+02  6.811e+00 102.113  &lt; 2e-16 ***
## factor(county)Yuba             7.121e+02  8.325e+00  85.532  &lt; 2e-16 ***
## calwpct                        1.591e-02  6.949e-02   0.229  0.81898    
## mealpct                       -5.909e-01  2.833e-02 -20.861  &lt; 2e-16 ***
## computer                      -1.145e-04  1.172e-03  -0.098  0.92227    
## str                           -8.483e-01  2.853e-01  -2.973  0.00314 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 8.621 on 371 degrees of freedom
## Multiple R-squared:  0.9998, Adjusted R-squared:  0.9998 
## F-statistic: 4.938e+04 on 49 and 371 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="discrete-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#discrete-regression" class="anchor"></a>Discrete Regression</h2>
<p>Need to convert regression results to increment effect.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="co"># Store Regression Results</span></a>
<a class="sourceLine" id="cb23-2" title="2">mt_model &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>( <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(county) <span class="op">+</span><span class="st"> </span>calwpct <span class="op">+</span><span class="st"> </span>mealpct <span class="op">+</span><span class="st"> </span>computer <span class="op">+</span><span class="st"> </span>str)</a>
<a class="sourceLine" id="cb23-3" title="3">rs_scr_on_str =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(testscr <span class="op">~</span><span class="st"> </span>mt_model <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb23-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(rs_scr_on_str))</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = testscr ~ mt_model - 1)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -32.035  -4.981   0.188   5.137  23.819 
## 
## Coefficients:
##                                         Estimate Std. Error t value Pr(&gt;|t|)
## mt_model(Intercept)                    7.072e+02  1.001e+01  70.621  &lt; 2e-16
## mt_modelfactor(county)Butte           -6.264e+00  9.485e+00  -0.660  0.50939
## mt_modelfactor(county)Calaveras       -9.138e+00  1.225e+01  -0.746  0.45613
## mt_modelfactor(county)Contra Costa    -9.152e+00  9.233e+00  -0.991  0.32225
## mt_modelfactor(county)El Dorado       -1.250e+01  9.061e+00  -1.380  0.16856
## mt_modelfactor(county)Fresno          -1.128e+01  9.099e+00  -1.240  0.21592
## mt_modelfactor(county)Glenn           -3.936e-01  1.006e+01  -0.039  0.96880
## mt_modelfactor(county)Humboldt        -8.075e+00  8.921e+00  -0.905  0.36601
## mt_modelfactor(county)Imperial        -1.122e+01  9.440e+00  -1.189  0.23538
## mt_modelfactor(county)Inyo            -8.526e+00  1.224e+01  -0.697  0.48635
## mt_modelfactor(county)Kern            -1.320e+01  8.886e+00  -1.485  0.13829
## mt_modelfactor(county)Kings           -9.977e+00  9.169e+00  -1.088  0.27728
## mt_modelfactor(county)Lake            -8.407e+00  1.077e+01  -0.780  0.43569
## mt_modelfactor(county)Lassen          -8.356e+00  9.511e+00  -0.879  0.38017
## mt_modelfactor(county)Los Angeles     -1.132e+01  8.897e+00  -1.272  0.20413
## mt_modelfactor(county)Madera          -7.765e+00  9.503e+00  -0.817  0.41440
## mt_modelfactor(county)Marin           -5.801e+00  9.147e+00  -0.634  0.52634
## mt_modelfactor(county)Mendocino       -1.541e+01  1.228e+01  -1.256  0.21009
## mt_modelfactor(county)Merced          -1.261e+01  9.129e+00  -1.381  0.16806
## mt_modelfactor(county)Monterey        -1.847e+01  9.319e+00  -1.982  0.04817
## mt_modelfactor(county)Nevada          -9.987e+00  9.103e+00  -1.097  0.27326
## mt_modelfactor(county)Orange          -9.043e+00  9.117e+00  -0.992  0.32189
## mt_modelfactor(county)Placer          -9.545e+00  9.040e+00  -1.056  0.29171
## mt_modelfactor(county)Riverside       -1.255e+01  9.754e+00  -1.286  0.19908
## mt_modelfactor(county)Sacramento      -1.714e+01  9.405e+00  -1.822  0.06920
## mt_modelfactor(county)San Benito      -2.506e+01  9.972e+00  -2.513  0.01240
## mt_modelfactor(county)San Bernardino  -1.372e+01  9.135e+00  -1.502  0.13404
## mt_modelfactor(county)San Diego       -6.220e+00  8.894e+00  -0.699  0.48477
## mt_modelfactor(county)San Joaquin     -2.194e+01  9.362e+00  -2.343  0.01964
## mt_modelfactor(county)San Luis Obispo -8.935e+00  1.058e+01  -0.844  0.39907
## mt_modelfactor(county)San Mateo       -1.024e+01  8.891e+00  -1.152  0.25003
## mt_modelfactor(county)Santa Barbara   -5.774e+00  9.046e+00  -0.638  0.52364
## mt_modelfactor(county)Santa Clara     -8.144e+00  8.896e+00  -0.915  0.36055
## mt_modelfactor(county)Santa Cruz      -3.951e+00  9.237e+00  -0.428  0.66911
## mt_modelfactor(county)Shasta          -6.421e+00  9.021e+00  -0.712  0.47707
## mt_modelfactor(county)Siskiyou        -8.420e+00  9.183e+00  -0.917  0.35979
## mt_modelfactor(county)Sonoma          -1.052e+01  8.786e+00  -1.198  0.23180
## mt_modelfactor(county)Stanislaus      -1.393e+01  9.262e+00  -1.504  0.13351
## mt_modelfactor(county)Sutter          -2.186e+01  9.360e+00  -2.335  0.02008
## mt_modelfactor(county)Tehama          -5.421e+00  9.218e+00  -0.588  0.55683
## mt_modelfactor(county)Trinity          1.869e+01  1.062e+01   1.760  0.07931
## mt_modelfactor(county)Tulare          -1.028e+01  8.937e+00  -1.151  0.25058
## mt_modelfactor(county)Tuolumne        -1.016e+01  9.355e+00  -1.086  0.27827
## mt_modelfactor(county)Ventura         -1.173e+01  9.222e+00  -1.272  0.20430
## mt_modelfactor(county)Yuba             4.911e+00  1.063e+01   0.462  0.64431
## mt_modelcalwpct                        1.591e-02  6.949e-02   0.229  0.81898
## mt_modelmealpct                       -5.909e-01  2.833e-02 -20.861  &lt; 2e-16
## mt_modelcomputer                      -1.145e-04  1.172e-03  -0.098  0.92227
## mt_modelstr                           -8.483e-01  2.853e-01  -2.973  0.00314
##                                          
## mt_model(Intercept)                   ***
## mt_modelfactor(county)Butte              
## mt_modelfactor(county)Calaveras          
## mt_modelfactor(county)Contra Costa       
## mt_modelfactor(county)El Dorado          
## mt_modelfactor(county)Fresno             
## mt_modelfactor(county)Glenn              
## mt_modelfactor(county)Humboldt           
## mt_modelfactor(county)Imperial           
## mt_modelfactor(county)Inyo               
## mt_modelfactor(county)Kern               
## mt_modelfactor(county)Kings              
## mt_modelfactor(county)Lake               
## mt_modelfactor(county)Lassen             
## mt_modelfactor(county)Los Angeles        
## mt_modelfactor(county)Madera             
## mt_modelfactor(county)Marin              
## mt_modelfactor(county)Mendocino          
## mt_modelfactor(county)Merced             
## mt_modelfactor(county)Monterey        *  
## mt_modelfactor(county)Nevada             
## mt_modelfactor(county)Orange             
## mt_modelfactor(county)Placer             
## mt_modelfactor(county)Riverside          
## mt_modelfactor(county)Sacramento      .  
## mt_modelfactor(county)San Benito      *  
## mt_modelfactor(county)San Bernardino     
## mt_modelfactor(county)San Diego          
## mt_modelfactor(county)San Joaquin     *  
## mt_modelfactor(county)San Luis Obispo    
## mt_modelfactor(county)San Mateo          
## mt_modelfactor(county)Santa Barbara      
## mt_modelfactor(county)Santa Clara        
## mt_modelfactor(county)Santa Cruz         
## mt_modelfactor(county)Shasta             
## mt_modelfactor(county)Siskiyou           
## mt_modelfactor(county)Sonoma             
## mt_modelfactor(county)Stanislaus         
## mt_modelfactor(county)Sutter          *  
## mt_modelfactor(county)Tehama             
## mt_modelfactor(county)Trinity         .  
## mt_modelfactor(county)Tulare             
## mt_modelfactor(county)Tuolumne           
## mt_modelfactor(county)Ventura            
## mt_modelfactor(county)Yuba               
## mt_modelcalwpct                          
## mt_modelmealpct                       ***
## mt_modelcomputer                         
## mt_modelstr                           ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 8.621 on 371 degrees of freedom
## Multiple R-squared:  0.9998, Adjusted R-squared:  0.9998 
## F-statistic: 4.938e+04 on 49 and 371 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">rs_scr_on_str_tidy =<span class="st"> </span><span class="kw">tidy</span>(rs_scr_on_str)</a>
<a class="sourceLine" id="cb25-2" title="2">rs_scr_on_str_tidy</a></code></pre></div>
<pre><code>## # A tibble: 49 x 5
##    term                               estimate std.error statistic   p.value
##    &lt;chr&gt;                                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 mt_model(Intercept)                 707.        10.0    70.6    3.29e-217
##  2 mt_modelfactor(county)Butte          -6.26       9.48   -0.660  5.09e-  1
##  3 mt_modelfactor(county)Calaveras      -9.14      12.2    -0.746  4.56e-  1
##  4 mt_modelfactor(county)Contra Costa   -9.15       9.23   -0.991  3.22e-  1
##  5 mt_modelfactor(county)El Dorado     -12.5        9.06   -1.38   1.69e-  1
##  6 mt_modelfactor(county)Fresno        -11.3        9.10   -1.24   2.16e-  1
##  7 mt_modelfactor(county)Glenn          -0.394     10.1    -0.0391 9.69e-  1
##  8 mt_modelfactor(county)Humboldt       -8.07       8.92   -0.905  3.66e-  1
##  9 mt_modelfactor(county)Imperial      -11.2        9.44   -1.19   2.35e-  1
## 10 mt_modelfactor(county)Inyo           -8.53      12.2    -0.697  4.86e-  1
## # … with 39 more rows</code></pre>
</div>
<div id="construct-input-arrays-a_i" class="section level2">
<h2 class="hasAnchor">
<a href="#construct-input-arrays-a_i" class="anchor"></a>Construct Input Arrays <span class="math inline">\(A_i\)</span>
</h2>
<p>Multiply coefficient vector by covariate matrix to generate <em>A</em> vector that is child/individual specific.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="co"># Estimates Table</span></a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(rs_scr_on_str_tidy, <span class="dv">6</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   term                               estimate std.error statistic   p.value
##   &lt;chr&gt;                                 &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 mt_model(Intercept)                  707.       10.0     70.6   3.29e-217
## 2 mt_modelfactor(county)Butte           -6.26      9.48    -0.660 5.09e-  1
## 3 mt_modelfactor(county)Calaveras       -9.14     12.2     -0.746 4.56e-  1
## 4 mt_modelfactor(county)Contra Costa    -9.15      9.23    -0.991 3.22e-  1
## 5 mt_modelfactor(county)El Dorado      -12.5       9.06    -1.38  1.69e-  1
## 6 mt_modelfactor(county)Fresno         -11.3       9.10    -1.24  2.16e-  1</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="co"># Covariates</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(mt_model, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>##   (Intercept) factor(county)Butte factor(county)Calaveras
## 1           1                   0                       0
## 2           1                   1                       0
## 3           1                   1                       0
## 4           1                   1                       0
## 5           1                   1                       0
##   factor(county)Contra Costa factor(county)El Dorado factor(county)Fresno
## 1                          0                       0                    0
## 2                          0                       0                    0
## 3                          0                       0                    0
## 4                          0                       0                    0
## 5                          0                       0                    0
##   factor(county)Glenn factor(county)Humboldt factor(county)Imperial
## 1                   0                      0                      0
## 2                   0                      0                      0
## 3                   0                      0                      0
## 4                   0                      0                      0
## 5                   0                      0                      0
##   factor(county)Inyo factor(county)Kern factor(county)Kings factor(county)Lake
## 1                  0                  0                   0                  0
## 2                  0                  0                   0                  0
## 3                  0                  0                   0                  0
## 4                  0                  0                   0                  0
## 5                  0                  0                   0                  0
##   factor(county)Lassen factor(county)Los Angeles factor(county)Madera
## 1                    0                         0                    0
## 2                    0                         0                    0
## 3                    0                         0                    0
## 4                    0                         0                    0
## 5                    0                         0                    0
##   factor(county)Marin factor(county)Mendocino factor(county)Merced
## 1                   0                       0                    0
## 2                   0                       0                    0
## 3                   0                       0                    0
## 4                   0                       0                    0
## 5                   0                       0                    0
##   factor(county)Monterey factor(county)Nevada factor(county)Orange
## 1                      0                    0                    0
## 2                      0                    0                    0
## 3                      0                    0                    0
## 4                      0                    0                    0
## 5                      0                    0                    0
##   factor(county)Placer factor(county)Riverside factor(county)Sacramento
## 1                    0                       0                        0
## 2                    0                       0                        0
## 3                    0                       0                        0
## 4                    0                       0                        0
## 5                    0                       0                        0
##   factor(county)San Benito factor(county)San Bernardino factor(county)San Diego
## 1                        0                            0                       0
## 2                        0                            0                       0
## 3                        0                            0                       0
## 4                        0                            0                       0
## 5                        0                            0                       0
##   factor(county)San Joaquin factor(county)San Luis Obispo
## 1                         0                             0
## 2                         0                             0
## 3                         0                             0
## 4                         0                             0
## 5                         0                             0
##   factor(county)San Mateo factor(county)Santa Barbara factor(county)Santa Clara
## 1                       0                           0                         0
## 2                       0                           0                         0
## 3                       0                           0                         0
## 4                       0                           0                         0
## 5                       0                           0                         0
##   factor(county)Santa Cruz factor(county)Shasta factor(county)Siskiyou
## 1                        0                    0                      0
## 2                        0                    0                      0
## 3                        0                    0                      0
## 4                        0                    0                      0
## 5                        0                    0                      0
##   factor(county)Sonoma factor(county)Stanislaus factor(county)Sutter
## 1                    0                        0                    0
## 2                    0                        0                    0
## 3                    0                        0                    0
## 4                    0                        0                    0
## 5                    0                        0                    0
##   factor(county)Tehama factor(county)Trinity factor(county)Tulare
## 1                    0                     0                    0
## 2                    0                     0                    0
## 3                    0                     0                    0
## 4                    0                     0                    0
## 5                    0                     0                    0
##   factor(county)Tuolumne factor(county)Ventura factor(county)Yuba calwpct
## 1                      0                     0                  0  0.5102
## 2                      0                     0                  0 15.4167
## 3                      0                     0                  0 55.0323
## 4                      0                     0                  0 36.4754
## 5                      0                     0                  0 33.1086
##   mealpct computer      str
## 1  2.0408       67 17.88991
## 2 47.9167      101 21.52466
## 3 76.3226      169 18.69723
## 4 77.0492       85 17.35714
## 5 78.4270      171 18.67133</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="co"># Covariates coefficients from regression (including constant)</span></a>
<a class="sourceLine" id="cb31-2" title="2">ar_fl_cova_esti &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(rs_scr_on_str_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="op">!</span><span class="kw">str_detect</span>(term, <span class="st">'str'</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(estimate))</a>
<a class="sourceLine" id="cb31-3" title="3">ar_fl_main_esti &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(rs_scr_on_str_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw">str_detect</span>(term, <span class="st">'str'</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(estimate))</a>
<a class="sourceLine" id="cb31-4" title="4"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(ar_fl_cova_esti, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>##        estimate
## [1,] 707.181424
## [2,]  -6.263997
## [3,]  -9.138178
## [4,]  -9.151551
## [5,] -12.499671</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(ar_fl_main_esti, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>##        estimate
## [1,] -0.8482993</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="co"># Select Matrix subcomponents</span></a>
<a class="sourceLine" id="cb35-2" title="2">mt_cova &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw">as_tibble</span>(mt_model) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">contains</span>(<span class="st">"str"</span>)))</a>
<a class="sourceLine" id="cb35-3" title="3"></a>
<a class="sourceLine" id="cb35-4" title="4"><span class="co"># Generate A_i, use mt_cova_wth_const</span></a>
<a class="sourceLine" id="cb35-5" title="5">ar_A_m &lt;-<span class="st"> </span>mt_cova <span class="op">%*%</span><span class="st"> </span>ar_fl_cova_esti</a>
<a class="sourceLine" id="cb35-6" title="6"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(ar_A_m, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>##      estimate
## [1,] 705.9760
## [2,] 672.8378
## [3,] 656.6757
## [4,] 655.9607
## [5,] 655.0831</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="co"># Generate alpha_i, in this problem, the alpha_i is generated differently.</span></a></code></pre></div>
</div>
<div id="individual-alpha_i" class="section level2">
<h2 class="hasAnchor">
<a href="#individual-alpha_i" class="anchor"></a>Individual alpha_i</h2>
<p>So this task is less trivial to do here. The procedure will be the following,</p>
<p><strong>Step 0</strong></p>
<p><em>mt_ori</em>: this is the original dataframe with all variables, each row is a different observation</p>
<p><strong>Step 1</strong></p>
<p><em>mt_a</em>: Five column matrix: col 1, district index, col 2, max number of additional teachers each district could acquire (which is determined by the number of existing teachers). There could be a maximum and minimum overall, 0 and say 100 additional teacers per district at most regardless. And each district gets up to potentially 25 percent or 30 percent additional teachers. Col 3, the number of current level of teachers in the district. Col 4, the number of current number of students. Col 5, the A_i without the addition of teacher student ratio.</p>
<p><strong>Step 2</strong></p>
<p><em>mt_b</em>: expand <em>mt_a</em>. Each row is a feasible additional teacher for a district, each there are now five variables, ID, previous level of teachers, and new level of teachers, and the existing level of students, and original A_i.</p>
<p><strong>Step 3</strong></p>
<p><em>mt_b</em>: add a alpha_i column, generate the marginal productivity value, and also generate actual updated A_i.</p>
<p><strong>Step 4</strong></p>
<p><em>mt_c</em>: merge together the matrix now has alpha_i with also the already existing A_i.</p>
<p><strong>Step 5</strong></p>
<p>Sort, and select top given total resource avaiable, The count the total allocation for each.</p>
<p>Back to dataframe mt_ori, incorporate into that, but do and shift for each rho.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="co"># Child Weight</span></a>
<a class="sourceLine" id="cb38-2" title="2">ar_beta_m &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ar_A_m), <span class="dt">times=</span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(ar_A_m))</a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#objective">Objective</a></li>
      <li>
<a href="#load-packages-and-data">Load Packages and Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#load-dependencies">Load Dependencies</a></li>
      <li><a href="#load-data">Load Data</a></li>
      </ul>
</li>
      <li>
<a href="#regression-with-data-and-construct-input-arrays">Regression with Data and Construct Input Arrays</a><ul class="nav nav-pills nav-stacked">
<li><a href="#tabulate">Tabulate</a></li>
      <li><a href="#regression-testing">Regression Testing</a></li>
      <li><a href="#discrete-regression">Discrete Regression</a></li>
      <li><a href="#construct-input-arrays-a_i">Construct Input Arrays <span class="math inline">\(A_i\)</span></a></li>
      <li><a href="#individual-alpha_i">Individual alpha_i</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Fan Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
