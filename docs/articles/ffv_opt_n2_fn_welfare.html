<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discrete Optimal Allocation for N=2 and Welfare Distance REV • Optimal Allocation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Discrete Optimal Allocation for N=2 and Welfare Distance REV">
<meta property="og:description" content="Compare welfare between all feasible discrete allocations and possible observed allocations when N=2.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Optimal Allocation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/PrjOptiAlloc.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue.pdf">Paper</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Sites
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://fanwangecon.github.io/REconTools/">R Tools for Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/R4Econ/">R Examples Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stat4Econ/">R Examples Introductory Statistics</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stata4Econ/">Stata Examples Regressions and Tables</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/M4Econ/">Matlab Examples Matrix and Graphs</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Math4Econ/">Matlab Introductory Math for Econ</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Tex4Econ/">Latex and Paper Generation Examples</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/pyfan/">Python Examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://fanwangecon.github.io/">Fan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fanwangecon/PrjOptiAlloc">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fanwangecon">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ffv_opt_n2_fn_welfare_files/header-attrs-2.4/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Discrete Optimal Allocation for N=2 and Welfare Distance REV</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/master/vignettes/ffv_opt_n2_fn_welfare.Rmd"><code>vignettes/ffv_opt_n2_fn_welfare.Rmd</code></a></small>
      <div class="hidden name"><code>ffv_opt_n2_fn_welfare.Rmd</code></div>

    </div>

    
    
<div id="input-and-output" class="section level2">
<h2 class="hasAnchor">
<a href="#input-and-output" class="anchor"></a>Input and Output</h2>
<div id="specify-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#specify-parameters" class="anchor"></a>Specify Parameters</h3>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="va">spt_img_save</span> <span class="op">&lt;-</span> <span class="st">'../_img/'</span>
<span class="va">spt_img_save_draft</span> <span class="op">&lt;-</span> <span class="st">'C:/Users/fan/Documents/Dropbox (UH-ECON)/repos/HgtOptiAlloDraft/_img/'</span>

<span class="co"># Draw data</span>
<span class="va">fl_beta_1</span> <span class="op">=</span> <span class="fl">0.5</span>
<span class="va">fl_beta_2</span> <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">fl_beta_1</span>
<span class="va">fl_w_dollar</span> <span class="op">=</span> <span class="fl">100</span>
<span class="va">it_w_units_avg</span> <span class="op">=</span> <span class="fl">5</span>

<span class="co"># Specify more parameters</span>
<span class="va">fl_dis_w</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">it_w_units_avg</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">fl_cts_w</span> <span class="op">&lt;-</span> <span class="va">fl_dis_w</span> <span class="co"># common price</span>
<span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span>
<span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.99</span>, <span class="op">-</span><span class="fl">0.01</span>, <span class="op">-</span><span class="fl">100</span><span class="op">)</span>
<span class="co"># ar_rho &lt;- c(0.99, -0.01, -6)</span>
<span class="co"># ar_rho &lt;- 1 - (10^(c(seq(-2,2, length.out=20))))</span></pre></div>
</div>
<div id="generate-a-and-alpha" class="section level3">
<h3 class="hasAnchor">
<a href="#generate-a-and-alpha" class="anchor"></a>Generate A and alpha</h3>
<p>These parameters persist and are used throughout the rest of the file for allocation allocations. Parameters are more or less shared by discrete and continuous parameters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">it_rand_seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="fl">7</span>, <span class="fl">1</span>, replace<span class="op">=</span><span class="cn">T</span><span class="op">)</span>

<span class="va">it_w_units_avg</span> <span class="op">=</span> <span class="fl">5</span>
<span class="va">it_rand_seed</span> <span class="op">&lt;-</span> <span class="fl">8135788</span>

<span class="co"># it_w_units_avg = 5</span>
<span class="co"># it_rand_seed &lt;- 1234</span>

<span class="co"># it_w_units_avg = 4</span>
<span class="co"># it_rand_seed &lt;- 449879812</span>

<span class="va">it_N</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">ls_out_n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/ffd_draw_n_alpha.html">ffd_draw_n_alpha</a></span><span class="op">(</span>fl_w_dollar<span class="op">=</span><span class="va">fl_w_dollar</span>,
                   it_w_units_avg<span class="op">=</span><span class="va">it_w_units_avg</span>,
                   it_N <span class="op">=</span> <span class="va">it_N</span>, it_rand_seed<span class="op">=</span><span class="va">it_rand_seed</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Translate to 2D budget indiff units</span>
<span class="co"># fl_e = endowment points</span>
<span class="va">fl_A_1</span> <span class="op">=</span> <span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ar_A_i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">fl_A_2</span> <span class="op">=</span> <span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ar_A_i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="co"># fl_alpha_1l = alpha_il</span>
<span class="co"># fl_eh_alloc_il = outcome at alloations</span>
<span class="va">ar_alpha_1l</span> <span class="op">=</span> <span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ls_ar_alpha_il</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">ar_levels</span>
<span class="va">ar_alpha_2l</span> <span class="op">=</span> <span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ls_ar_alpha_il</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">ar_levels</span>
<span class="va">ar_alpha_1l_zr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ls_ar_alpha_il</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">ar_levels</span><span class="op">)</span>
<span class="va">ar_alpha_2l_zr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ls_ar_alpha_il</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">ar_levels</span><span class="op">)</span>
<span class="va">ar_A_1l</span> <span class="op">&lt;-</span> <span class="va">fl_A_1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ar_alpha_1l_zr</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">ar_A_2l</span> <span class="op">&lt;-</span> <span class="va">fl_A_2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ar_alpha_2l_zr</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">it_D_1l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ar_alpha_1l</span><span class="op">)</span>
<span class="va">it_D_2l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ar_alpha_2l</span><span class="op">)</span>
<span class="co"># Max Discrete Choice After which budget outside of choice strike zone fully</span>
<span class="va">it_w_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ar_alpha_1l</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ar_alpha_2l</span><span class="op">)</span>
<span class="va">ar_w_solve_at_disc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">it_w_max</span><span class="op">)</span>

<span class="co"># print</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'it_rand_seed:'</span>,<span class="va">it_rand_seed</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## [1] "it_rand_seed:8135788"</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'fl_A_1:'</span>, <span class="va">fl_A_1</span>, <span class="st">',fl_A_2:'</span>, <span class="va">fl_A_2</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## [1] "fl_A_1:1.21673425481374,fl_A_2:0.958163167726895"</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'ar_alpha_1l:'</span>, <span class="va">ar_alpha_1l</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## [1] "ar_alpha_1l:1.10258826611402"  "ar_alpha_1l:0.998256934864124"
## [3] "ar_alpha_1l:0.974318847935741" "ar_alpha_1l:0.832411817148815"
## [5] "ar_alpha_1l:0.809088128226687" "ar_alpha_1l:0.783336005710612"</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'ar_alpha_2l:'</span>, <span class="va">ar_alpha_2l</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## [1] "ar_alpha_2l:0.862318390675336" "ar_alpha_2l:0.812810517766219"
## [3] "ar_alpha_2l:0.731285183772518" "ar_alpha_2l:0.680349434537137"
## [5] "ar_alpha_2l:0.579903139915456"</code></pre>
</div>
</div>
<div id="optimal-discrete-choices" class="section level2">
<h2 class="hasAnchor">
<a href="#optimal-discrete-choices" class="anchor"></a>Optimal Discrete Choices</h2>
<p>Given <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_{il}\)</span>, solve for optimal discrete allocation</p>
<p>Build up discrete input frame</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="co"># ID and max Discrete Allocation</span>
<span class="va">mt_i_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">it_D_1l</span>, <span class="va">it_D_2l</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mt_i_D</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'id_i'</span>, <span class="st">'D_max_i'</span><span class="op">)</span>
<span class="va">tb_i_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">mt_i_D</span><span class="op">)</span>
<span class="co"># A_i and alpha_il as matrix</span>
<span class="va">mt_A_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">it_D_1l</span><span class="op">)</span>, <span class="va">ar_alpha_1l</span>, <span class="va">ar_A_1l</span>, <span class="va">fl_beta_1</span><span class="op">)</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">it_D_2l</span><span class="op">)</span>, <span class="va">ar_alpha_2l</span>, <span class="va">ar_A_2l</span>, <span class="va">fl_beta_2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mt_A_alpha</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'id_i'</span>, <span class="st">'D_il'</span>, <span class="st">'alpha_il'</span>, <span class="st">'A_il'</span>, <span class="st">'beta_i'</span><span class="op">)</span>
<span class="co"># Combine to generate input_il matrix</span>
<span class="va">df_input_il</span> <span class="op">&lt;-</span> <span class="va">tb_i_D</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/uncount.html">uncount</a></span><span class="op">(</span><span class="va">D_max_i</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"id_il"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">tb_i_D</span>, by<span class="op">=</span><span class="st">'id_i'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id_i</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>D_il <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">mt_A_alpha</span><span class="op">)</span>, by<span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'id_i'</span><span class="op">=</span><span class="st">'id_i'</span>, <span class="st">'D_il'</span><span class="op">=</span><span class="st">'D_il'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>Solve for optimal choices.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">ls_dis_solu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span><span class="op">(</span><span class="va">ar_rho</span>,
                          <span class="va">fl_dis_w</span>,
                          <span class="va">df_input_il</span>,
                          bl_df_alloc_il <span class="op">=</span> <span class="cn">TRUE</span>,
                          bl_return_V <span class="op">=</span> <span class="cn">TRUE</span>,
                          bl_return_allQ_V <span class="op">=</span> <span class="cn">TRUE</span>,
                          bl_return_inner_V <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">df_queue_il_long_n2</span> <span class="op">&lt;-</span><span class="va">ls_dis_solu</span><span class="op">$</span><span class="va">df_queue_il_long</span>
<span class="va">df_queue_il_wide_n2</span> <span class="op">&lt;-</span> <span class="va">ls_dis_solu</span><span class="op">$</span><span class="va">df_queue_il_wide</span>
<span class="va">df_alloc_i_long_n2</span> <span class="op">&lt;-</span> <span class="va">ls_dis_solu</span><span class="op">$</span><span class="va">df_alloc_i_long</span>
<span class="va">df_rho_gini_n2</span> <span class="op">&lt;-</span> <span class="va">ls_dis_solu</span><span class="op">$</span><span class="va">df_rho_gini</span>
<span class="va">df_alloc_il_long_n2</span> <span class="op">&lt;-</span> <span class="va">ls_dis_solu</span><span class="op">$</span><span class="va">df_alloc_il_long</span></pre></div>
<p>Sort Value along Resource Expansion Path:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="va">df_queue_il_long_n2</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">Q_il</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">id_i</span>, <span class="va">id_il</span>, <span class="va">Q_il</span>, <span class="va">D_Wbin_il</span>, <span class="va">V_sum_l</span>, <span class="va">V_inner_Q_il</span>, <span class="va">V_star_Q_il</span><span class="op">)</span></pre></div>
<pre><code>## # A tibble: 33 x 8
##    rho_val  id_i id_il  Q_il D_Wbin_il  V_sum_l V_inner_Q_il V_star_Q_il
##      &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1    -100     2     7     1         1 4.79e-27     1.51e- 9        1.23
##  2    -100     1     1     2         1 1.45e-37     4.79e-27        1.83
##  3    -100     2     8     3         1 4.46e-43     1.45e-37        2.34
##  4    -100     1     2     4         1 4.14e-53     4.46e-43        2.65
##  5    -100     2     9     5         1 1.01e-53     5.15e-53        3.33
##  6    -100     1     3     6         1 2.72e-64     1.01e-53        3.39
##  7    -100     2    10     7         0 1.02e-61     1.02e-61        4.07
##  8    -100     2    11     8         0 1.55e-67     2.72e-64        4.32
##  9    -100     1     4     9         0 5.44e-72     1.55e-67        4.66
## 10    -100     1     5    10         0 2.34e-78     1.55e-67        4.66
## # ... with 23 more rows</code></pre>
</div>
<div id="the-rev-function-compare-aginst-some-alternative-allocation" class="section level2">
<h2 class="hasAnchor">
<a href="#the-rev-function-compare-aginst-some-alternative-allocation" class="anchor"></a>The Rev Function, compare aginst some Alternative Allocation</h2>
<div id="generate-all-outcome-combinations" class="section level3">
<h3 class="hasAnchor">
<a href="#generate-all-outcome-combinations" class="anchor"></a>Generate All Outcome Combinations</h3>
<p>Generate all outcome combinations, and expected outcome combinations for the two individuals at all combinations. If allocations are binary, then there are 4 possible combinations, but have to skip zero/zero.</p>
<p>First generate combination index frame:</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="co"># generate index frame</span>
<span class="va">df_feasible_allocate</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>id_1l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">it_D_1l</span><span class="op">)</span>,
                        id_2l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">it_D_2l</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">id_1l</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">id_2l</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"id_alloc"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>id_i <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>beta_i <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id_alloc</span>, <span class="va">id_i</span>, <span class="va">id_1l</span>, <span class="va">id_2l</span>, <span class="va">beta_i</span><span class="op">)</span>

<span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_i</span><span class="op">)</span>
<span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_1l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_1l</span><span class="op">)</span>
<span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_2l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_2l</span><span class="op">)</span>
<span class="co"># print</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_feasible_allocate</span>, <span class="fl">10</span><span class="op">)</span></pre></div>
<pre><code>## # A tibble: 10 x 5
##    id_alloc id_i  id_1l id_2l beta_i
##       &lt;int&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;  &lt;dbl&gt;
##  1        1 1     1     0        0.5
##  2        1 2     1     0        0.5
##  3        2 1     2     0        0.5
##  4        2 2     2     0        0.5
##  5        3 1     3     0        0.5
##  6        3 2     3     0        0.5
##  7        4 1     4     0        0.5
##  8        4 2     4     0        0.5
##  9        5 1     5     0        0.5
## 10        5 2     5     0        0.5</code></pre>
<p>Generate <span class="math inline">\(\alpha\)</span> matrix for the two individuals to prep for merging:</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="co"># For individual 1</span>
<span class="va">df_alpha_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">mt_A_alpha</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">alpha_il</span>, <span class="va">D_il</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>id_1l <span class="op">=</span> <span class="va">D_il</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id_i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>alpha_il_cum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">alpha_il</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">alpha_il</span><span class="op">)</span>
<span class="co"># For individual 2</span>
<span class="va">df_alpha_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">mt_A_alpha</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">alpha_il</span>, <span class="va">D_il</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>id_2l <span class="op">=</span> <span class="va">D_il</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id_i <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>alpha_il_cum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">alpha_il</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">alpha_il</span><span class="op">)</span>
<span class="co"># To factors</span>
<span class="va">df_alpha_1</span><span class="op">$</span><span class="va">id_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df_alpha_1</span><span class="op">$</span><span class="va">id_i</span><span class="op">)</span>
<span class="va">df_alpha_1</span><span class="op">$</span><span class="va">id_1l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df_alpha_1</span><span class="op">$</span><span class="va">id_1l</span><span class="op">)</span>
<span class="va">df_alpha_2</span><span class="op">$</span><span class="va">id_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df_alpha_2</span><span class="op">$</span><span class="va">id_i</span><span class="op">)</span>
<span class="va">df_alpha_2</span><span class="op">$</span><span class="va">id_2l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">df_alpha_2</span><span class="op">$</span><span class="va">id_2l</span><span class="op">)</span>

<span class="co"># Print</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">df_alpha_1</span><span class="op">)</span></pre></div>
<pre><code>## # A tibble: 6 x 3
##   id_1l id_i  alpha_il_cum
##   &lt;fct&gt; &lt;fct&gt;        &lt;dbl&gt;
## 1 1     1             1.10
## 2 2     1             2.10
## 3 3     1             3.08
## 4 4     1             3.91
## 5 5     1             4.72
## 6 6     1             5.5</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">df_alpha_2</span><span class="op">)</span></pre></div>
<pre><code>## # A tibble: 5 x 3
##   id_2l id_i  alpha_il_cum
##   &lt;fct&gt; &lt;fct&gt;        &lt;dbl&gt;
## 1 1     2            0.862
## 2 2     2            1.68 
## 3 3     2            2.41 
## 4 4     2            3.09 
## 5 5     2            3.67</code></pre>
<p>Merging result for <em>A_i_l0</em> and <em>alpha_o_i</em>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="va">df_input_ib_all</span> <span class="op">&lt;-</span> <span class="va">df_feasible_allocate</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df_alpha_1</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'id_i'</span><span class="op">=</span><span class="st">'id_i'</span>, <span class="st">'id_1l'</span><span class="op">=</span><span class="st">'id_1l'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df_alpha_2</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'id_i'</span><span class="op">=</span><span class="st">'id_i'</span>, <span class="st">'id_2l'</span><span class="op">=</span><span class="st">'id_2l'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>alpha_o_i <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">alpha_il_cum.x</span>,
                               <span class="va">id_i</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="va">alpha_il_cum.y</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">alpha_il_cum.x</span>, <span class="op">-</span><span class="va">alpha_il_cum.y</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>alpha_o_i <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">alpha_o_i</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span>,
                              <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">alpha_o_i</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>A_i_l0 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">fl_A_1</span>,
                            <span class="va">id_i</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="va">fl_A_2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id_alloc</span>, <span class="va">id_i</span>, <span class="va">id_1l</span>, <span class="va">id_2l</span>, <span class="va">A_i_l0</span>, <span class="va">alpha_o_i</span>, <span class="va">beta_i</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>w_agg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">id_1l</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">id_2l</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">df_input_ib_all</span><span class="op">)</span></pre></div>
<pre><code>## # A tibble: 82 x 8
##    id_alloc id_i  id_1l id_2l A_i_l0 alpha_o_i beta_i w_agg
##       &lt;int&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;  &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1        1 1     1     0      1.22       1.10    0.5     3
##  2        1 2     1     0      0.958      0       0.5     3
##  3        2 1     2     0      1.22       2.10    0.5     4
##  4        2 2     2     0      0.958      0       0.5     4
##  5        3 1     3     0      1.22       3.08    0.5     5
##  6        3 2     3     0      0.958      0       0.5     5
##  7        4 1     4     0      1.22       3.91    0.5     6
##  8        4 2     4     0      0.958      0       0.5     6
##  9        5 1     5     0      1.22       4.72    0.5     7
## 10        5 2     5     0      0.958      0       0.5     7
## # ... with 72 more rows</code></pre>
</div>
<div id="rev-test-for-one-observed-set-of-allocations-at-one-resource-point" class="section level3">
<h3 class="hasAnchor">
<a href="#rev-test-for-one-observed-set-of-allocations-at-one-resource-point" class="anchor"></a>REV Test for One Observed Set of Allocations at One Resource Point</h3>
<p>There are only two individuals, pick any feasible point, and compare against optimal allocations, at one aggregate resource point. The welfare function only takes one set of allocations, and the optimal allocation results contain welfare along optimal allocation queues for all individuals.</p>
<p>In the code below, I loop over each possible set of observed allocation from <em>df_input_ib_all</em> (2 rows at a time, each row an individual, 2 row is a set of allocations). Within each loop, resource equivalent variation is computed comparing the welfare at this “observed allocations” set to welfare along the optimal allocation queue, and finding out, along the resource expansion path (allocation queue), how much less resources are needed to achieve the same welfare as achieved by the “observed allocations”.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="co"># Optimal Allocation Results Along Queue with Value</span>
<span class="va">df_queue_il_long_with_V</span> <span class="op">&lt;-</span> <span class="va">df_queue_il_long_n2</span>

<span class="co"># Get information and statistics</span>
<span class="va">df_input_ib_agg_grp</span> <span class="op">&lt;-</span> <span class="va">df_input_ib_all</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">w_agg</span><span class="op">==</span><span class="fl">11</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">df_input_ib_agg_grp</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">id_alloc</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## [1] 27 33 39</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="va">df_input_ib</span> <span class="op">&lt;-</span> <span class="va">df_input_ib_all</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">id_alloc</span><span class="op">==</span><span class="fl">41</span><span class="op">)</span>
<span class="va">df_input_ib</span></pre></div>
<pre><code>## # A tibble: 2 x 8
##   id_alloc id_i  id_1l id_2l A_i_l0 alpha_o_i beta_i w_agg
##      &lt;int&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;  &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1       41 1     6     5      1.22       5.5     0.5    13
## 2       41 2     6     5      0.958      3.67    0.5    13</code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="va">it_w_agg</span> <span class="op">&lt;-</span> <span class="va">df_input_ib</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">w_agg</span><span class="op">)</span>

<span class="co"># Call REV function</span>
<span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span><span class="op">(</span>
  <span class="va">ar_rho</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,
  <span class="va">it_w_agg</span>,
  <span class="va">df_input_ib</span>,
  <span class="va">df_queue_il_long_with_V</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">rho_val</span> <span class="op">==</span> <span class="op">-</span><span class="fl">100</span><span class="op">)</span>,
<span class="op">)</span></pre></div>
<pre><code>## Warning in min(df_queue_il_with_V %&gt;% filter(!!sym(svr_V_star_Q_il) &gt;=
## fl_util_alter_alloc) %&gt;% : no non-missing arguments to min; returning Inf</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(rev)`</code></pre>
<pre><code>## # A tibble: 1 x 3
##     rho rho_val   REV
##   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1     1    -100     0</code></pre>
</div>
<div id="rev-for-all-possible-allocation-points-compared-to-what-is-optimal" class="section level3">
<h3 class="hasAnchor">
<a href="#rev-for-all-possible-allocation-points-compared-to-what-is-optimal" class="anchor"></a>REV for all Possible Allocation Points Compared to What is Optimal</h3>
<p>Compute REV all all feasible allocation combinations, using <a href="https://fanwangecon.github.io/R4Econ/function/dof/htmlpdfr/fs_funceval_groupwider.html">(MxP by N) to (MxQ by N+Z-1)</a>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit">
<span class="co"># Temp function</span>
<span class="va">ffi_opt_anlyz_sodis_rev_wrapper</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_input_ib_sub</span><span class="op">)</span><span class="op">{</span>
  <span class="va">it_w_agg</span> <span class="op">&lt;-</span> <span class="va">df_input_ib_sub</span> <span class="op">%&gt;%</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">w_agg</span><span class="op">)</span>
  <span class="va">df_rev</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span><span class="op">(</span>
    ar_rho<span class="op">=</span><span class="va">ar_rho</span>,
    it_w_agg<span class="op">=</span><span class="va">it_w_agg</span>,
    df_input_ib<span class="op">=</span><span class="va">df_input_ib_sub</span>,
    df_queue_il_long_with_V<span class="op">=</span><span class="va">df_queue_il_long_n2</span>,
  <span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">df_rev</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Function over Groups</span>
<span class="va">df_rev_allrho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op">(</span>
  <span class="va">df_input_ib_all</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id_alloc</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html">do</a></span><span class="op">(</span>df_rev <span class="op">=</span> <span class="fu">ffi_opt_anlyz_sodis_rev_wrapper</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"id_alloc_rho"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">df_input_ib_all</span> <span class="op">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id_alloc</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id_alloc</span>, <span class="va">id_1l</span>, <span class="va">id_2l</span>, <span class="va">w_agg</span><span class="op">)</span>,
            join<span class="op">=</span><span class="st">'id_alloc'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">w_agg</span>, <span class="va">rho</span>, <span class="va">id_1l</span>, <span class="va">id_2l</span><span class="op">)</span></pre></div>
<pre><code>## Joining, by = "id_alloc"</code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit">
<span class="co"># show results</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df_rev_allrho</span>, <span class="fl">50</span><span class="op">)</span></pre></div>
<pre><code>## # A tibble: 50 x 8
##    id_alloc_rho id_alloc   rho rho_val   REV id_1l id_2l w_agg
##           &lt;int&gt;    &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;
##  1           19        7     1    0.99 0.667 0     1         3
##  2            1        1     1    0.99 0.667 1     0         3
##  3           20        7     2   -0.01 0.667 0     1         3
##  4            2        1     2   -0.01 0.667 1     0         3
##  5           21        7     3 -100    0.667 0     1         3
##  6            3        1     3 -100    0.667 1     0         3
##  7           40       14     1    0.99 0.5   0     2         4
##  8           22        8     1    0.99 0.5   1     1         4
##  9            4        2     1    0.99 0.5   2     0         4
## 10           41       14     2   -0.01 0.5   0     2         4
## # ... with 40 more rows</code></pre>
</div>
<div id="rev-summary-statistics" class="section level3">
<h3 class="hasAnchor">
<a href="#rev-summary-statistics" class="anchor"></a>REV Summary Statistics</h3>
<p>REV grouped by Rho:</p>
<div class="sourceCode" id="cb34"><pre class="downlit">
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df_rev_allrho</span>
<span class="va">vars.group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'rho_val'</span><span class="op">)</span>
<span class="va">var.numeric</span> <span class="op">&lt;-</span> <span class="st">'REV'</span>
<span class="va">str.stats.group</span> <span class="op">&lt;-</span> <span class="st">'allperc'</span>
<span class="va">ar.perc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span><span class="op">)</span>
<span class="va">ls_summ_by_group</span> <span class="op">&lt;-</span> <span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_bygroup.html">ff_summ_bygroup</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">vars.group</span>, <span class="va">var.numeric</span>, <span class="va">str.stats.group</span>, <span class="va">ar.perc</span><span class="op">)</span></pre></div>
<pre><code>## Warning: `funs()` is deprecated as of dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="va">df_table_grp_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_table_grp_stats</span>
<span class="va">df_row_grp_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_row_grp_stats</span>
<span class="va">df_overall_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_overall_stats</span>
<span class="va">df_row_stats_all</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_row_stats_all</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">df_table_grp_stats</span><span class="op">)</span></pre></div>
<pre><code>## # A tibble: 3 x 20
##   rho.val  mean median    sd   IQR   mad   `1%`   `5%` `10%` `25%` `50%` `75%`
##     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 -100    0.458  0.4   0.247 0.394 0.264 0.0333 0.0909 0.200 0.273 0.4   0.667
## 2   -0.01 0.346  0.286 0.155 0.278 0.132 0.159  0.167  0.182 0.222 0.286 0.5  
## 3    0.99 0.297  0.25  0.132 0.133 0.101 0.117  0.154  0.167 0.200 0.25  0.333
## # ... with 8 more variables: `90%` &lt;dbl&gt;, `95%` &lt;dbl&gt;, `99%` &lt;dbl&gt;, min &lt;dbl&gt;,
## #   max &lt;dbl&gt;, first &lt;dbl&gt;, last &lt;dbl&gt;, n.distinct &lt;int&gt;</code></pre>
<p>REV grouped by Aggregate Resources:</p>
<div class="sourceCode" id="cb39"><pre class="downlit">
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df_rev_allrho</span>
<span class="va">vars.group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'w_agg'</span><span class="op">)</span>
<span class="va">var.numeric</span> <span class="op">&lt;-</span> <span class="st">'REV'</span>
<span class="va">str.stats.group</span> <span class="op">&lt;-</span> <span class="st">'allperc'</span>
<span class="va">ar.perc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span><span class="op">)</span>
<span class="va">ls_summ_by_group</span> <span class="op">&lt;-</span> <span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_bygroup.html">ff_summ_bygroup</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">vars.group</span>, <span class="va">var.numeric</span>, <span class="va">str.stats.group</span>, <span class="va">ar.perc</span><span class="op">)</span></pre></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit">
<span class="va">df_table_grp_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_table_grp_stats</span>
<span class="va">df_row_grp_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_row_grp_stats</span>
<span class="va">df_overall_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_overall_stats</span>
<span class="va">df_row_stats_all</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_row_stats_all</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">df_table_grp_stats</span><span class="op">)</span></pre></div>
<pre><code>## # A tibble: 11 x 20
##    w.agg  mean median     sd    IQR   mad    `1%`   `5%`  `10%`  `25%` `50%`
##    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1     3 0.667  0.667 0      0          0 0.667   0.667  0.667  0.667  0.667
##  2     4 0.556  0.5   0.110  0          0 0.5     0.5    0.5    0.5    0.5  
##  3     5 0.5    0.4   0.160  0.200      0 0.4     0.4    0.4    0.4    0.4  
##  4     6 0.422  0.333 0.188  0.167      0 0.19    0.283  0.333  0.333  0.333
##  5     7 0.413  0.286 0.195  0.25       0 0.286   0.286  0.286  0.286  0.286
##  6     8 0.347  0.25  0.180  0.125      0 0.146   0.231  0.25   0.25   0.25 
##  7     9 0.274  0.222 0.132  0.0556     0 0.127   0.189  0.222  0.222  0.222
##  8    10 0.233  0.200 0.0888 0          0 0.200   0.200  0.200  0.200  0.200
##  9    11 0.202  0.182 0.0758 0          0 0.0982  0.127  0.164  0.182  0.182
## 10    12 0.181  0.167 0.0819 0          0 0.0875  0.104  0.125  0.167  0.167
## 11    13 0.103  0.154 0.0888 0.0769     0 0.00308 0.0154 0.0308 0.0769 0.154
## # ... with 9 more variables: `75%` &lt;dbl&gt;, `90%` &lt;dbl&gt;, `95%` &lt;dbl&gt;,
## #   `99%` &lt;dbl&gt;, min &lt;dbl&gt;, max &lt;dbl&gt;, first &lt;dbl&gt;, last &lt;dbl&gt;,
## #   n.distinct &lt;int&gt;</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://fanwangecon.github.io">Fan Wang</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
