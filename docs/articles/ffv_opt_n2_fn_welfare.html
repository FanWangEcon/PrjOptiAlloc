<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discrete Optimal Allocation for N=2 and Welfare Distance REV • Optimal Allocation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Discrete Optimal Allocation for N=2 and Welfare Distance REV">
<meta property="og:description" content="Compare welfare between all feasible discrete allocations and possible observed allocations when N=2.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Optimal Allocation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Papers
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3839890" class="external-link">Optimal Allocations to Heterogeneous Agents with An Application to Stimulus Checks</a>
    </li>
    <li>
      <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3691091" class="external-link">Optimal Allocation of the COVID-19 Stimulus Checks</a>
    </li>
    <li>
      <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3547706" class="external-link">The Optimal Allocation of Resources among Heterogeneous Individuals</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Sites
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://fanwangecon.github.io/REconTools/" class="external-link">R Tools for Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/R4Econ/" class="external-link">R Examples Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stat4Econ/" class="external-link">R Examples Introductory Statistics</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stata4Econ/" class="external-link">Stata Examples Regressions and Tables</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/M4Econ/" class="external-link">Matlab Examples Matrix and Graphs</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Math4Econ/" class="external-link">Matlab Introductory Math for Econ</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Tex4Econ/" class="external-link">Latex and Paper Generation Examples</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/pyfan/" class="external-link">Python Examples</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fanwangecon/PrjOptiAlloc" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fanwangecon" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Discrete Optimal Allocation for N=2 and Welfare Distance REV</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/HEAD/vignettes/ffv_opt_n2_fn_welfare.Rmd" class="external-link"><code>vignettes/ffv_opt_n2_fn_welfare.Rmd</code></a></small>
      <div class="hidden name"><code>ffv_opt_n2_fn_welfare.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="input-and-output">Input and Output<a class="anchor" aria-label="anchor" href="#input-and-output"></a>
</h2>
<div class="section level3">
<h3 id="specify-parameters">Specify Parameters<a class="anchor" aria-label="anchor" href="#specify-parameters"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spt_img_save</span> <span class="op">&lt;-</span> <span class="st">'../_img/'</span>
<span class="co"># spt_img_save_draft &lt;- 'C:/Users/fan/Documents/Dropbox (UH-ECON)/repos/HgtOptiAlloDraft/_img/'</span>
<span class="va">spt_img_save_draft</span> <span class="op">&lt;-</span> <span class="st">'G:/repos/HgtOptiAlloDraft/_img/'</span>

<span class="co"># Draw data</span>
<span class="va">fl_beta_1</span> <span class="op">=</span> <span class="fl">0.5</span>
<span class="va">fl_beta_2</span> <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">fl_beta_1</span>
<span class="va">fl_w_dollar</span> <span class="op">=</span> <span class="fl">100</span>
<span class="va">it_w_units_avg</span> <span class="op">=</span> <span class="fl">5</span>

<span class="co"># Specify more parameters</span>
<span class="va">fl_dis_w</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">it_w_units_avg</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">fl_cts_w</span> <span class="op">&lt;-</span> <span class="va">fl_dis_w</span> <span class="co"># common price</span>
<span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span>
<span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.99</span>, <span class="op">-</span><span class="fl">0.01</span>, <span class="op">-</span><span class="fl">100</span><span class="op">)</span>
<span class="co"># ar_rho &lt;- c(0.99, -0.01, -6)</span>
<span class="co"># ar_rho &lt;- 1 - (10^(c(seq(-2,2, length.out=20))))</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generate-a-and-alpha">Generate A and alpha<a class="anchor" aria-label="anchor" href="#generate-a-and-alpha"></a>
</h3>
<p>These parameters persist and are used throughout the rest of the file for allocation allocations. Parameters are more or less shared by discrete and continuous parameters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">it_rand_seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="fl">7</span>, <span class="fl">1</span>, replace<span class="op">=</span><span class="cn">T</span><span class="op">)</span>

<span class="va">it_w_units_avg</span> <span class="op">=</span> <span class="fl">5</span>
<span class="va">it_rand_seed</span> <span class="op">&lt;-</span> <span class="fl">8135788</span>

<span class="co"># it_w_units_avg = 5</span>
<span class="co"># it_rand_seed &lt;- 1234</span>

<span class="co"># it_w_units_avg = 4</span>
<span class="co"># it_rand_seed &lt;- 449879812</span>

<span class="va">it_N</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">ls_out_n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/ffd_draw_n_alpha.html">ffd_draw_n_alpha</a></span><span class="op">(</span>fl_w_dollar<span class="op">=</span><span class="va">fl_w_dollar</span>,
                   it_w_units_avg<span class="op">=</span><span class="va">it_w_units_avg</span>,
                   it_N <span class="op">=</span> <span class="va">it_N</span>, it_rand_seed<span class="op">=</span><span class="va">it_rand_seed</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Translate to 2D budget indiff units</span>
<span class="co"># fl_e = endowment points</span>
<span class="va">fl_A_1</span> <span class="op">=</span> <span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ar_A_i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">fl_A_2</span> <span class="op">=</span> <span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ar_A_i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="co"># fl_alpha_1l = alpha_il</span>
<span class="co"># fl_eh_alloc_il = outcome at alloations</span>
<span class="va">ar_alpha_1l</span> <span class="op">=</span> <span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ls_ar_alpha_il</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">ar_levels</span>
<span class="va">ar_alpha_2l</span> <span class="op">=</span> <span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ls_ar_alpha_il</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">ar_levels</span>
<span class="va">ar_alpha_1l_zr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ls_ar_alpha_il</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">ar_levels</span><span class="op">)</span>
<span class="va">ar_alpha_2l_zr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ls_out_n2</span><span class="op">$</span><span class="va">ls_ar_alpha_il</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">ar_levels</span><span class="op">)</span>
<span class="va">ar_A_1l</span> <span class="op">&lt;-</span> <span class="va">fl_A_1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ar_alpha_1l_zr</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">ar_A_2l</span> <span class="op">&lt;-</span> <span class="va">fl_A_2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ar_alpha_2l_zr</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">it_D_1l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ar_alpha_1l</span><span class="op">)</span>
<span class="va">it_D_2l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ar_alpha_2l</span><span class="op">)</span>
<span class="co"># Max Discrete Choice After which budget outside of choice strike zone fully</span>
<span class="va">it_w_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ar_alpha_1l</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ar_alpha_2l</span><span class="op">)</span>
<span class="va">ar_w_solve_at_disc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">it_w_max</span><span class="op">)</span>

<span class="co"># print</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'it_rand_seed:'</span>,<span class="va">it_rand_seed</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "it_rand_seed:8135788"</span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'fl_A_1:'</span>, <span class="va">fl_A_1</span>, <span class="st">',fl_A_2:'</span>, <span class="va">fl_A_2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "fl_A_1:1.21673425481374,fl_A_2:0.958163167726895"</span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'ar_alpha_1l:'</span>, <span class="va">ar_alpha_1l</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "ar_alpha_1l:1.10258826611402"  "ar_alpha_1l:0.998256934864124"</span>
<span class="co">## [3] "ar_alpha_1l:0.974318847935741" "ar_alpha_1l:0.832411817148815"</span>
<span class="co">## [5] "ar_alpha_1l:0.809088128226687" "ar_alpha_1l:0.783336005710612"</span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'ar_alpha_2l:'</span>, <span class="va">ar_alpha_2l</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "ar_alpha_2l:0.862318390675336" "ar_alpha_2l:0.812810517766219"</span>
<span class="co">## [3] "ar_alpha_2l:0.731285183772518" "ar_alpha_2l:0.680349434537137"</span>
<span class="co">## [5] "ar_alpha_2l:0.579903139915456"</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="optimal-discrete-choices">Optimal Discrete Choices<a class="anchor" aria-label="anchor" href="#optimal-discrete-choices"></a>
</h2>
<p>Given <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_{il}\)</span>, solve for optimal discrete allocation</p>
<p>Build up discrete input frame</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ID and max Discrete Allocation</span>
<span class="va">mt_i_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">it_D_1l</span>, <span class="va">it_D_2l</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mt_i_D</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'id_i'</span>, <span class="st">'D_max_i'</span><span class="op">)</span>
<span class="va">tb_i_D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">mt_i_D</span><span class="op">)</span>
<span class="co"># A_i and alpha_il as matrix</span>
<span class="va">mt_A_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">it_D_1l</span><span class="op">)</span>, <span class="va">ar_alpha_1l</span>, <span class="va">ar_A_1l</span>, <span class="va">fl_beta_1</span><span class="op">)</span>,
                    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">it_D_2l</span><span class="op">)</span>, <span class="va">ar_alpha_2l</span>, <span class="va">ar_A_2l</span>, <span class="va">fl_beta_2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">mt_A_alpha</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'id_i'</span>, <span class="st">'D_il'</span>, <span class="st">'alpha_il'</span>, <span class="st">'A_il'</span>, <span class="st">'beta_i'</span><span class="op">)</span>
<span class="co"># Combine to generate input_il matrix</span>
<span class="va">df_input_il</span> <span class="op">&lt;-</span> <span class="va">tb_i_D</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/uncount.html" class="external-link">uncount</a></span><span class="op">(</span><span class="va">D_max_i</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rowid_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"id_il"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">tb_i_D</span>, by<span class="op">=</span><span class="st">'id_i'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id_i</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>D_il <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">mt_A_alpha</span><span class="op">)</span>, by<span class="op">=</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'id_i'</span><span class="op">=</span><span class="st">'id_i'</span>, <span class="st">'D_il'</span><span class="op">=</span><span class="st">'D_il'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Solve for optimal choices.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ls_dis_solu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span><span class="op">(</span><span class="va">ar_rho</span>,
                          <span class="va">fl_dis_w</span>,
                          <span class="va">df_input_il</span>,
                          bl_df_alloc_il <span class="op">=</span> <span class="cn">TRUE</span>,
                          bl_return_V <span class="op">=</span> <span class="cn">TRUE</span>,
                          bl_return_allQ_V <span class="op">=</span> <span class="cn">TRUE</span>,
                          bl_return_inner_V <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">df_queue_il_long_n2</span> <span class="op">&lt;-</span><span class="va">ls_dis_solu</span><span class="op">$</span><span class="va">df_queue_il_long</span>
<span class="va">df_queue_il_wide_n2</span> <span class="op">&lt;-</span> <span class="va">ls_dis_solu</span><span class="op">$</span><span class="va">df_queue_il_wide</span>
<span class="va">df_alloc_i_long_n2</span> <span class="op">&lt;-</span> <span class="va">ls_dis_solu</span><span class="op">$</span><span class="va">df_alloc_i_long</span>
<span class="va">df_rho_gini_n2</span> <span class="op">&lt;-</span> <span class="va">ls_dis_solu</span><span class="op">$</span><span class="va">df_rho_gini</span>
<span class="va">df_alloc_il_long_n2</span> <span class="op">&lt;-</span> <span class="va">ls_dis_solu</span><span class="op">$</span><span class="va">df_alloc_il_long</span></code></pre></div>
<p>Sort Value along Resource Expansion Path:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_queue_il_long_n2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">Q_il</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">rho_val</span>, <span class="va">id_i</span>, <span class="va">id_il</span>, <span class="va">Q_il</span>, <span class="va">D_Wbin_il</span>, <span class="va">V_sum_l</span>, <span class="va">V_inner_Q_il</span>, <span class="va">V_star_Q_il</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 33 x 8</span></span>
<span class="co">##    rho_val  id_i id_il  Q_il D_Wbin_il  V_sum_l V_inner_Q_il V_star_Q_il</span>
<span class="co">##      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>    -<span style="color: #BB0000;">100</span>     2     7     1         1 4.79<span style="color: #949494;">e</span><span style="color: #BB0000;">-27</span>     1.51<span style="color: #949494;">e</span><span style="color: #BB0000;">- 9</span>        1.23</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>    -<span style="color: #BB0000;">100</span>     1     1     2         1 1.45<span style="color: #949494;">e</span><span style="color: #BB0000;">-37</span>     4.79<span style="color: #949494;">e</span><span style="color: #BB0000;">-27</span>        1.83</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>    -<span style="color: #BB0000;">100</span>     2     8     3         1 4.46<span style="color: #949494;">e</span><span style="color: #BB0000;">-43</span>     1.45<span style="color: #949494;">e</span><span style="color: #BB0000;">-37</span>        2.34</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>    -<span style="color: #BB0000;">100</span>     1     2     4         1 4.14<span style="color: #949494;">e</span><span style="color: #BB0000;">-53</span>     4.46<span style="color: #949494;">e</span><span style="color: #BB0000;">-43</span>        2.65</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>    -<span style="color: #BB0000;">100</span>     2     9     5         1 1.01<span style="color: #949494;">e</span><span style="color: #BB0000;">-53</span>     5.15<span style="color: #949494;">e</span><span style="color: #BB0000;">-53</span>        3.33</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>    -<span style="color: #BB0000;">100</span>     1     3     6         1 2.72<span style="color: #949494;">e</span><span style="color: #BB0000;">-64</span>     1.01<span style="color: #949494;">e</span><span style="color: #BB0000;">-53</span>        3.39</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>    -<span style="color: #BB0000;">100</span>     2    10     7         0 1.02<span style="color: #949494;">e</span><span style="color: #BB0000;">-61</span>     1.02<span style="color: #949494;">e</span><span style="color: #BB0000;">-61</span>        4.07</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>    -<span style="color: #BB0000;">100</span>     2    11     8         0 1.55<span style="color: #949494;">e</span><span style="color: #BB0000;">-67</span>     2.72<span style="color: #949494;">e</span><span style="color: #BB0000;">-64</span>        4.32</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>    -<span style="color: #BB0000;">100</span>     1     4     9         0 5.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-72</span>     1.55<span style="color: #949494;">e</span><span style="color: #BB0000;">-67</span>        4.66</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>    -<span style="color: #BB0000;">100</span>     1     5    10         0 2.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-78</span>     1.55<span style="color: #949494;">e</span><span style="color: #BB0000;">-67</span>        4.66</span>
<span class="co">## <span style="color: #949494;"># ... with 23 more rows</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="the-rev-function-compare-aginst-some-alternative-allocation">The Rev Function, compare aginst some Alternative Allocation<a class="anchor" aria-label="anchor" href="#the-rev-function-compare-aginst-some-alternative-allocation"></a>
</h2>
<div class="section level3">
<h3 id="generate-all-outcome-combinations">Generate All Outcome Combinations<a class="anchor" aria-label="anchor" href="#generate-all-outcome-combinations"></a>
</h3>
<p>Generate all outcome combinations, and expected outcome combinations for the two individuals at all combinations. If allocations are binary, then there are 4 possible combinations, but have to skip zero/zero.</p>
<p>Remember that the choice set is a box: (1) when resources availabe is 1, can either give <span class="math inline">\((1,0)\)</span> or <span class="math inline">\((0,1)\)</span> to the two individuals. (2) Given individual upper bound say 3 at most for individual 1, and 3 at most for individual 2, if we have 6 units of resources, to exhaust budget, only allocation that uses all budget is <span class="math inline">\((3,3)\)</span>. (3) If the resources available is equal to 3 units, can choose <span class="math inline">\((0,3)\)</span>, <span class="math inline">\((1,2)\)</span>, <span class="math inline">\((2,1)\)</span>, <span class="math inline">\((3,0)\)</span>. The box is such that when we drop negative slopes through it, at the bottom left and top right, there are limited choices. Note the box’s bounds are the allocation bounds/constraints.</p>
<p>First generate combination index frame:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># generate index frame</span>
<span class="va">df_feasible_allocate</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>id_1l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">it_D_1l</span><span class="op">)</span>,
                        id_2l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">it_D_2l</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">id_1l</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">id_2l</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rowid_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"id_alloc"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html" class="external-link">expand_grid</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>id_i <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>beta_i <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_alloc</span>, <span class="va">id_i</span>, <span class="va">id_1l</span>, <span class="va">id_2l</span>, <span class="va">beta_i</span><span class="op">)</span>

<span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_i</span><span class="op">)</span>
<span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_1l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_1l</span><span class="op">)</span>
<span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_2l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_feasible_allocate</span><span class="op">$</span><span class="va">id_2l</span><span class="op">)</span>
<span class="co"># print</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_feasible_allocate</span>, <span class="fl">10</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 10 x 5</span></span>
<span class="co">##    id_alloc id_i  id_1l id_2l beta_i</span>
<span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>        1 1     1     0        0.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>        1 2     1     0        0.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>        2 1     2     0        0.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>        2 2     2     0        0.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>        3 1     3     0        0.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>        3 2     3     0        0.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>        4 1     4     0        0.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>        4 2     4     0        0.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>        5 1     5     0        0.5</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>        5 2     5     0        0.5</span></code></pre>
<p>Generate <span class="math inline">\(\alpha\)</span> matrix for the two individuals to prep for merging:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># For individual 1</span>
<span class="va">df_alpha_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">mt_A_alpha</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">alpha_il</span>, <span class="va">D_il</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>id_1l <span class="op">=</span> <span class="va">D_il</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id_i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alpha_il_cum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">alpha_il</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">alpha_il</span><span class="op">)</span>
<span class="co"># For individual 2</span>
<span class="va">df_alpha_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">mt_A_alpha</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">alpha_il</span>, <span class="va">D_il</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>id_2l <span class="op">=</span> <span class="va">D_il</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id_i <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alpha_il_cum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">alpha_il</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">alpha_il</span><span class="op">)</span>
<span class="co"># To factors</span>
<span class="va">df_alpha_1</span><span class="op">$</span><span class="va">id_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_alpha_1</span><span class="op">$</span><span class="va">id_i</span><span class="op">)</span>
<span class="va">df_alpha_1</span><span class="op">$</span><span class="va">id_1l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_alpha_1</span><span class="op">$</span><span class="va">id_1l</span><span class="op">)</span>
<span class="va">df_alpha_2</span><span class="op">$</span><span class="va">id_i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_alpha_2</span><span class="op">$</span><span class="va">id_i</span><span class="op">)</span>
<span class="va">df_alpha_2</span><span class="op">$</span><span class="va">id_2l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">df_alpha_2</span><span class="op">$</span><span class="va">id_2l</span><span class="op">)</span>

<span class="co"># Print</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_alpha_1</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 6 x 3</span></span>
<span class="co">##   id_1l id_i  alpha_il_cum</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> 1     1             1.10</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> 2     1             2.10</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> 3     1             3.08</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> 4     1             3.91</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> 5     1             4.72</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> 6     1             5.5</span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_alpha_2</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 5 x 3</span></span>
<span class="co">##   id_2l id_i  alpha_il_cum</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> 1     2            0.862</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> 2     2            1.68 </span>
<span class="co">## <span style="color: #BCBCBC;">3</span> 3     2            2.41 </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> 4     2            3.09 </span>
<span class="co">## <span style="color: #BCBCBC;">5</span> 5     2            3.67</span></code></pre>
<p>Merging result for <em>A_i_l0</em> and <em>alpha_o_i</em>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_input_ib_all</span> <span class="op">&lt;-</span> <span class="va">df_feasible_allocate</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_alpha_1</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'id_i'</span><span class="op">=</span><span class="st">'id_i'</span>, <span class="st">'id_1l'</span><span class="op">=</span><span class="st">'id_1l'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_alpha_2</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'id_i'</span><span class="op">=</span><span class="st">'id_i'</span>, <span class="st">'id_2l'</span><span class="op">=</span><span class="st">'id_2l'</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alpha_o_i <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">alpha_il_cum.x</span>,
                               <span class="va">id_i</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="va">alpha_il_cum.y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">alpha_il_cum.x</span>, <span class="op">-</span><span class="va">alpha_il_cum.y</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alpha_o_i <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">alpha_o_i</span><span class="op">)</span> <span class="op">~</span> <span class="fl">0</span>,
                              <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">alpha_o_i</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>A_i_l0 <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">fl_A_1</span>,
                            <span class="va">id_i</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="va">fl_A_2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_alloc</span>, <span class="va">id_i</span>, <span class="va">id_1l</span>, <span class="va">id_2l</span>, <span class="va">A_i_l0</span>, <span class="va">alpha_o_i</span>, <span class="va">beta_i</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>w_agg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">id_1l</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">id_2l</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_input_ib_all</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 82 x 8</span></span>
<span class="co">##    id_alloc id_i  id_1l id_2l A_i_l0 alpha_o_i beta_i w_agg</span>
<span class="co">##       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>        1 1     1     0      1.22       1.10    0.5     3</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>        1 2     1     0      0.958      0       0.5     3</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>        2 1     2     0      1.22       2.10    0.5     4</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>        2 2     2     0      0.958      0       0.5     4</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>        3 1     3     0      1.22       3.08    0.5     5</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>        3 2     3     0      0.958      0       0.5     5</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>        4 1     4     0      1.22       3.91    0.5     6</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>        4 2     4     0      0.958      0       0.5     6</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>        5 1     5     0      1.22       4.72    0.5     7</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>        5 2     5     0      0.958      0       0.5     7</span>
<span class="co">## <span style="color: #949494;"># ... with 72 more rows</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="rev-test-for-one-observed-set-of-allocations-at-one-resource-point">REV Test for One Observed Set of Allocations at One Resource Point<a class="anchor" aria-label="anchor" href="#rev-test-for-one-observed-set-of-allocations-at-one-resource-point"></a>
</h3>
<p>There are only two individuals, pick any feasible point, and compare against optimal allocations, at one aggregate resource point. The welfare function only takes one set of allocations, and the optimal allocation results contain welfare along optimal allocation queues for all individuals.</p>
<p>In the code below, I loop over each possible set of observed allocation from <em>df_input_ib_all</em> (2 rows at a time, each row an individual, 2 row is a set of allocations). Within each loop, resource equivalent variation is computed comparing the welfare at this “observed allocations” set to welfare along the optimal allocation queue, and finding out, along the resource expansion path (allocation queue), how much less resources are needed to achieve the same welfare as achieved by the “observed allocations”.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Optimal Allocation Results Along Queue with Value</span>
<span class="va">df_queue_il_long_with_V</span> <span class="op">&lt;-</span> <span class="va">df_queue_il_long_n2</span>

<span class="co"># Get information and statistics</span>
<span class="va">df_input_ib_agg_grp</span> <span class="op">&lt;-</span> <span class="va">df_input_ib_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">w_agg</span><span class="op">==</span><span class="fl">11</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">df_input_ib_agg_grp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">id_alloc</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 27 33 39</span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_input_ib</span> <span class="op">&lt;-</span> <span class="va">df_input_ib_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_alloc</span><span class="op">==</span><span class="fl">41</span><span class="op">)</span>
<span class="va">df_input_ib</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 2 x 8</span></span>
<span class="co">##   id_alloc id_i  id_1l id_2l A_i_l0 alpha_o_i beta_i w_agg</span>
<span class="co">##      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>       41 1     6     5      1.22       5.5     0.5    13</span>
<span class="co">## <span style="color: #BCBCBC;">2</span>       41 2     6     5      0.958      3.67    0.5    13</span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">it_w_agg</span> <span class="op">&lt;-</span> <span class="va">df_input_ib</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">w_agg</span><span class="op">)</span>

<span class="co"># Call REV function</span>
<span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span><span class="op">(</span>
  <span class="va">ar_rho</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,
  <span class="va">it_w_agg</span>,
  <span class="va">df_input_ib</span>,
  <span class="va">df_queue_il_long_with_V</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rho_val</span> <span class="op">==</span> <span class="op">-</span><span class="fl">100</span><span class="op">)</span>,
<span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in min(df_queue_il_with_V %&gt;% filter(!!sym(svr_V_star_Q_il) &gt;=</span>
<span class="co">## fl_util_alter_alloc) %&gt;% : no non-missing arguments to min; returning Inf</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(rev)`</span></code></pre>
<pre><code><span class="co">## Warning in min(df_queue_il_with_V %&gt;% filter(!!sym(svr_V_star_Q_il) &gt;=</span>
<span class="co">## fl_util_alter_alloc) %&gt;% : no non-missing arguments to min; returning Inf</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(fl_util_alter_alloc)`</span></code></pre>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1 x 4</span></span>
<span class="co">##     rho rho_val   REV AlterOutcome</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>     1    -<span style="color: #BB0000;">100</span>     0         4.66</span></code></pre>
</div>
<div class="section level3">
<h3 id="rev-for-all-possible-allocation-points-compared-to-what-is-optimal">REV for all Possible Allocation Points Compared to What is Optimal<a class="anchor" aria-label="anchor" href="#rev-for-all-possible-allocation-points-compared-to-what-is-optimal"></a>
</h3>
<p>Compute REV all all feasible allocation combinations, using <a href="https://fanwangecon.github.io/R4Econ/function/dof/htmlpdfr/fs_funceval_groupwider.html" class="external-link">(MxP by N) to (MxQ by N+Z-1)</a>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Temp function</span>
<span class="va">ffi_opt_anlyz_sodis_rev_wrapper</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df_input_ib_sub</span><span class="op">)</span><span class="op">{</span>
  <span class="va">it_w_agg</span> <span class="op">&lt;-</span> <span class="va">df_input_ib_sub</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">w_agg</span><span class="op">)</span>
  <span class="va">df_rev</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span><span class="op">(</span>
    ar_rho<span class="op">=</span><span class="va">ar_rho</span>,
    it_w_agg<span class="op">=</span><span class="va">it_w_agg</span>,
    df_input_ib<span class="op">=</span><span class="va">df_input_ib_sub</span>,
    df_queue_il_long_with_V<span class="op">=</span><span class="va">df_queue_il_long_n2</span>,
  <span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df_rev</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Function over Groups</span>
<span class="va">df_rev_allrho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span>
  <span class="va">df_input_ib_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id_alloc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/do.html" class="external-link">do</a></span><span class="op">(</span>df_rev <span class="op">=</span> <span class="fu">ffi_opt_anlyz_sodis_rev_wrapper</span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rowid_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"id_alloc_rho"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_input_ib_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id_alloc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_alloc</span>, <span class="va">id_1l</span>, <span class="va">id_2l</span>, <span class="va">w_agg</span><span class="op">)</span>,
            join<span class="op">=</span><span class="st">'id_alloc'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">w_agg</span>, <span class="va">rho</span>, <span class="va">id_1l</span>, <span class="va">id_2l</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Joining, by = "id_alloc"</span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># show results</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_rev_allrho</span>, <span class="fl">50</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 50 x 9</span></span>
<span class="co">##    id_alloc_rho id_alloc   rho rho_val   REV AlterOutcome id_1l id_2l w_agg</span>
<span class="co">##           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>           19        7     1    0.99 0.667        1.52  0     1         3</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>            1        1     1    0.99 0.667        1.64  1     0         3</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>           20        7     2   -<span style="color: #BB0000;">0.01</span> 0.667        1.49  0     1         3</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>            2        1     2   -<span style="color: #BB0000;">0.01</span> 0.667        1.49  1     0         3</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>           21        7     3 -<span style="color: #BB0000;">100</span>    0.667        1.23  0     1         3</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>            3        1     3 -<span style="color: #BB0000;">100</span>    0.667        0.965 1     0         3</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>           40       14     1    0.99 0.5          1.92  0     2         4</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>           22        8     1    0.99 0.5          2.07  1     1         4</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>            4        2     1    0.99 0.5          2.13  2     0         4</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>           41       14     2   -<span style="color: #BB0000;">0.01</span> 0.5          1.79  0     2         4</span>
<span class="co">## <span style="color: #949494;"># ... with 40 more rows</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="rev-summary-statistics">REV Summary Statistics<a class="anchor" aria-label="anchor" href="#rev-summary-statistics"></a>
</h3>
<p>REV grouped by Rho:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df_rev_allrho</span>
<span class="va">vars.group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'rho_val'</span><span class="op">)</span>
<span class="va">var.numeric</span> <span class="op">&lt;-</span> <span class="st">'REV'</span>
<span class="va">str.stats.group</span> <span class="op">&lt;-</span> <span class="st">'allperc'</span>
<span class="va">ar.perc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span><span class="op">)</span>
<span class="va">ls_summ_by_group</span> <span class="op">&lt;-</span> <span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_bygroup.html" class="external-link">ff_summ_bygroup</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">vars.group</span>, <span class="va">var.numeric</span>, <span class="va">str.stats.group</span>, <span class="va">ar.perc</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: `funs()` was deprecated in dplyr 0.8.0.</span>
<span class="co">## Please use a list of either functions or lambdas: </span>
<span class="co">## </span>
<span class="co">##   # Simple named list: </span>
<span class="co">##   list(mean = mean, median = median)</span>
<span class="co">## </span>
<span class="co">##   # Auto named with `tibble::lst()`: </span>
<span class="co">##   tibble::lst(mean, median)</span>
<span class="co">## </span>
<span class="co">##   # Using lambdas</span>
<span class="co">##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))</span>
<span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span>
<span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</span></span></code></pre>
<pre><code><span class="co">## Warning: attributes are not identical across measure variables;</span>
<span class="co">## they will be dropped</span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_table_grp_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_table_grp_stats</span>
<span class="va">df_row_grp_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_row_grp_stats</span>
<span class="va">df_overall_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_overall_stats</span>
<span class="va">df_row_stats_all</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_row_stats_all</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_table_grp_stats</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 3 x 20</span></span>
<span class="co">##   rho.val  mean median    sd   IQR   mad   `1%`   `5%` `10%` `25%` `50%` `75%`</span>
<span class="co">##     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> -<span style="color: #BB0000;">100</span>    0.458  0.4   0.247 0.394 0.264 0.033<span style="text-decoration: underline;">3</span> 0.090<span style="text-decoration: underline;">9</span> 0.2   0.273 0.4   0.667</span>
<span class="co">## <span style="color: #BCBCBC;">2</span>   -<span style="color: #BB0000;">0.01</span> 0.346  0.286 0.155 0.278 0.132 0.159  0.167  0.182 0.222 0.286 0.5  </span>
<span class="co">## <span style="color: #BCBCBC;">3</span>    0.99 0.297  0.25  0.132 0.133 0.101 0.117  0.154  0.167 0.2   0.25  0.333</span>
<span class="co">## <span style="color: #949494;"># ... with 8 more variables: 90% &lt;dbl&gt;, 95% &lt;dbl&gt;, 99% &lt;dbl&gt;, min &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   max &lt;dbl&gt;, first &lt;dbl&gt;, last &lt;dbl&gt;, n.distinct &lt;int&gt;</span></span></code></pre>
<p>REV grouped by Aggregate Resources:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df_rev_allrho</span>
<span class="va">vars.group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'w_agg'</span><span class="op">)</span>
<span class="va">var.numeric</span> <span class="op">&lt;-</span> <span class="st">'REV'</span>
<span class="va">str.stats.group</span> <span class="op">&lt;-</span> <span class="st">'allperc'</span>
<span class="va">ar.perc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span><span class="op">)</span>
<span class="va">ls_summ_by_group</span> <span class="op">&lt;-</span> <span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_bygroup.html" class="external-link">ff_summ_bygroup</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">vars.group</span>, <span class="va">var.numeric</span>, <span class="va">str.stats.group</span>, <span class="va">ar.perc</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: attributes are not identical across measure variables;</span>
<span class="co">## they will be dropped</span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_table_grp_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_table_grp_stats</span>
<span class="va">df_row_grp_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_row_grp_stats</span>
<span class="va">df_overall_stats</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_overall_stats</span>
<span class="va">df_row_stats_all</span> <span class="op">&lt;-</span> <span class="va">ls_summ_by_group</span><span class="op">$</span><span class="va">df_row_stats_all</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_table_grp_stats</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 11 x 20</span></span>
<span class="co">##    w.agg  mean median     sd    IQR   mad    `1%`   `5%`  `10%`  `25%` `50%`</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     3 0.667  0.667 0      0          0 0.667   0.667  0.667  0.667  0.667</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     4 0.556  0.5   0.110  0          0 0.5     0.5    0.5    0.5    0.5  </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     5 0.5    0.4   0.160  0.2        0 0.4     0.4    0.4    0.4    0.4  </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     6 0.422  0.333 0.188  0.167      0 0.19    0.283  0.333  0.333  0.333</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     7 0.413  0.286 0.195  0.25       0 0.286   0.286  0.286  0.286  0.286</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     8 0.347  0.25  0.180  0.125      0 0.146   0.231  0.25   0.25   0.25 </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     9 0.274  0.222 0.132  0.055<span style="text-decoration: underline;">6</span>     0 0.127   0.189  0.222  0.222  0.222</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>    10 0.233  0.2   0.088<span style="text-decoration: underline;">8</span> 0          0 0.2     0.2    0.2    0.2    0.2  </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>    11 0.202  0.182 0.075<span style="text-decoration: underline;">8</span> 0          0 0.098<span style="text-decoration: underline;">2</span>  0.127  0.164  0.182  0.182</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>    12 0.181  0.167 0.081<span style="text-decoration: underline;">9</span> 0          0 0.087<span style="text-decoration: underline;">5</span>  0.104  0.125  0.167  0.167</span>
<span class="co">## <span style="color: #BCBCBC;">11</span>    13 0.103  0.154 0.088<span style="text-decoration: underline;">8</span> 0.076<span style="text-decoration: underline;">9</span>     0 0.003<span style="text-decoration: underline;">08</span> 0.015<span style="text-decoration: underline;">4</span> 0.030<span style="text-decoration: underline;">8</span> 0.076<span style="text-decoration: underline;">9</span> 0.154</span>
<span class="co">## <span style="color: #949494;"># ... with 9 more variables: 75% &lt;dbl&gt;, 90% &lt;dbl&gt;, 95% &lt;dbl&gt;, 99% &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   min &lt;dbl&gt;, max &lt;dbl&gt;, first &lt;dbl&gt;, last &lt;dbl&gt;, n.distinct &lt;int&gt;</span></span></code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://fanwangecon.github.io" class="external-link">Fan Wang</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
