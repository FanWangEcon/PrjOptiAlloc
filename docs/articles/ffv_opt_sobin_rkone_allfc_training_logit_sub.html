<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logit Employment Binary Allocation Lalonde Training Example by Age Only • Optimal Allocation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Logit Employment Binary Allocation Lalonde Training Example by Age Only">
<meta property="og:description" content="Logit employment regression estimation of A and alpha from the Lalonde Training Dataset (722 Observations).
Solve for optimal binary allocation queues by Age only. 
Using only Age in employment predication and allocation determination. 
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Optimal Allocation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Papers
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3839890" class="external-link">Optimal Allocations to Heterogeneous Agents with An Application to Stimulus Checks</a>
    </li>
    <li>
      <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3691091" class="external-link">Optimal Allocation of the COVID-19 Stimulus Checks</a>
    </li>
    <li>
      <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3547706" class="external-link">The Optimal Allocation of Resources among Heterogeneous Individuals</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Sites
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://fanwangecon.github.io/REconTools/" class="external-link">R Tools for Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/R4Econ/" class="external-link">R Examples Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stat4Econ/" class="external-link">R Examples Introductory Statistics</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stata4Econ/" class="external-link">Stata Examples Regressions and Tables</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/M4Econ/" class="external-link">Matlab Examples Matrix and Graphs</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Math4Econ/" class="external-link">Matlab Introductory Math for Econ</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Tex4Econ/" class="external-link">Latex and Paper Generation Examples</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/pyfan/" class="external-link">Python Examples</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fanwangecon/PrjOptiAlloc" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fanwangecon" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Logit Employment Binary Allocation Lalonde Training Example by Age Only</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/HEAD/vignettes/ffv_opt_sobin_rkone_allfc_training_logit_sub.Rmd" class="external-link"><code>vignettes/ffv_opt_sobin_rkone_allfc_training_logit_sub.Rmd</code></a></small>
      <div class="hidden name"><code>ffv_opt_sobin_rkone_allfc_training_logit_sub.Rmd</code></div>

    </div>

    
    
<p>In <a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_sobin_rkone_allfc_training_logit.html">Logit Employment Binary Allocation Lalonde Training Example</a>, analyzed optimal allocation when all observables attributes of individuals are used for targeting. Subgroup allocation targeting here, based on one attribute.</p>
<div class="section level2">
<h2 id="set-up">Set Up<a class="anchor" aria-label="anchor" href="#set-up"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dev.off(dev.list()["RStudioGD"])</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span>all.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>knitr.duplicate.label <span class="op">=</span> <span class="st">'allow'</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org" class="external-link">forcats</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fanwangecon.github.io/REconTools/" class="external-link">REconTools</a></span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fanwangecon.github.io/PrjOptiAlloc/">PrjOptiAlloc</a></span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span>

<span class="va">bl_save_rda</span> <span class="op">=</span> <span class="cn">FALSE</span>
<span class="va">bl_save_img</span> <span class="op">=</span> <span class="cn">FALSE</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-data">Get Data<a class="anchor" aria-label="anchor" href="#get-data"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spt_img_save</span> <span class="op">&lt;-</span> <span class="st">'../_img/'</span>
<span class="va">spt_img_save_draft</span> <span class="op">&lt;-</span> <span class="st">'C:/Users/fan/Documents/Dropbox (UH-ECON)/repos/HgtOptiAlloDraft/_img/'</span></code></pre></div>
<p>The regression is the same as prior. Subgroup allocation is based on the idea of targeting only a subset of individuals, when we know the marginal effects and needs of all individuals.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">df_opt_lalonde_training</span><span class="op">)</span>

<span class="co"># Add a binary variable for if there are wage in year 1975</span>
<span class="va">dft</span> <span class="op">&lt;-</span> <span class="va">df_opt_lalonde_training</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>re75_zero <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">re75</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">1</span>, <span class="va">re75</span> <span class="op">!=</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="co"># dft stands for dataframe training</span>
<span class="va">dft</span> <span class="op">&lt;-</span> <span class="va">dft</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>emp78 <span class="op">=</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">re78</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">0</span>,
                              <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>emp75 <span class="op">=</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">re75</span> <span class="op">&lt;=</span> <span class="fl">0</span> <span class="op">~</span> <span class="fl">0</span>,
                              <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Generate combine black + hispanic status</span>
<span class="co"># 0 = white, 1 = black, 2 = hispanics</span>
<span class="va">dft</span> <span class="op">&lt;-</span> <span class="va">dft</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>race <span class="op">=</span>
             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">black</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fl">1</span>,
                       <span class="va">hisp</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="fl">2</span>,
                       <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="va">dft</span> <span class="op">&lt;-</span> <span class="va">dft</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_m2 <span class="op">=</span>
             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">23</span> <span class="op">~</span> <span class="fl">1</span>,
                       <span class="va">age</span> <span class="op">&gt;</span>  <span class="fl">23</span><span class="op">~</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_m3 <span class="op">=</span>
             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">20</span> <span class="op">~</span> <span class="fl">1</span>,
                       <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">20</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="fl">26</span> <span class="op">~</span> <span class="fl">2</span>,
                       <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">26</span> <span class="op">~</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="va">dft</span><span class="op">$</span><span class="va">trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dft</span><span class="op">$</span><span class="va">trt</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ntran"</span>, <span class="st">"train"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dft</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##        id            trt           age             educ           black       </span>
<span class="co">##  Min.   :   1.0   ntran:425   Min.   :17.00   Min.   : 3.00   Min.   :0.0000  </span>
<span class="co">##  1st Qu.: 181.2   train:297   1st Qu.:19.00   1st Qu.: 9.00   1st Qu.:1.0000  </span>
<span class="co">##  Median : 361.5               Median :23.00   Median :10.00   Median :1.0000  </span>
<span class="co">##  Mean   : 854.4               Mean   :24.52   Mean   :10.27   Mean   :0.8006  </span>
<span class="co">##  3rd Qu.:1458.5               3rd Qu.:27.00   3rd Qu.:11.00   3rd Qu.:1.0000  </span>
<span class="co">##  Max.   :4110.0               Max.   :55.00   Max.   :16.00   Max.   :1.0000  </span>
<span class="co">##                                                                               </span>
<span class="co">##       hisp             marr           nodeg             re74        </span>
<span class="co">##  Min.   :0.0000   Min.   :0.000   Min.   :0.0000   Min.   :    0.0  </span>
<span class="co">##  1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:1.0000   1st Qu.:    0.0  </span>
<span class="co">##  Median :0.0000   Median :0.000   Median :1.0000   Median :    0.0  </span>
<span class="co">##  Mean   :0.1053   Mean   :0.162   Mean   :0.7798   Mean   : 2102.3  </span>
<span class="co">##  3rd Qu.:0.0000   3rd Qu.:0.000   3rd Qu.:1.0000   3rd Qu.:  824.4  </span>
<span class="co">##  Max.   :1.0000   Max.   :1.000   Max.   :1.0000   Max.   :39570.7  </span>
<span class="co">##                                                    NA's   :277      </span>
<span class="co">##       re75              re78         re75_zero          emp78       </span>
<span class="co">##  Min.   :    0.0   Min.   :    0   Min.   :0.0000   Min.   :0.0000  </span>
<span class="co">##  1st Qu.:    0.0   1st Qu.:    0   1st Qu.:0.0000   1st Qu.:0.0000  </span>
<span class="co">##  Median :  936.3   Median : 3952   Median :0.0000   Median :1.0000  </span>
<span class="co">##  Mean   : 3042.9   Mean   : 5455   Mean   :0.4003   Mean   :0.7285  </span>
<span class="co">##  3rd Qu.: 3993.2   3rd Qu.: 8772   3rd Qu.:1.0000   3rd Qu.:1.0000  </span>
<span class="co">##  Max.   :37431.7   Max.   :60308   Max.   :1.0000   Max.   :1.0000  </span>
<span class="co">##                                                                     </span>
<span class="co">##      emp75             race           age_m2          age_m3     </span>
<span class="co">##  Min.   :0.0000   Min.   :0.000   Min.   :1.000   Min.   :1.000  </span>
<span class="co">##  1st Qu.:0.0000   1st Qu.:1.000   1st Qu.:1.000   1st Qu.:1.000  </span>
<span class="co">##  Median :1.0000   Median :1.000   Median :1.000   Median :2.000  </span>
<span class="co">##  Mean   :0.5997   Mean   :1.011   Mean   :1.486   Mean   :1.965  </span>
<span class="co">##  3rd Qu.:1.0000   3rd Qu.:1.000   3rd Qu.:2.000   3rd Qu.:3.000  </span>
<span class="co">##  Max.   :1.0000   Max.   :2.000   Max.   :2.000   Max.   :3.000  </span>
<span class="co">## </span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># X-variables to use on RHS</span>
<span class="va">ls_st_xs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'age'</span>, <span class="st">'educ'</span>,
              <span class="st">'black'</span>,<span class="st">'hisp'</span>,<span class="st">'marr'</span>, <span class="st">'nodeg'</span><span class="op">)</span>
<span class="va">svr_binary</span> <span class="op">&lt;-</span> <span class="st">'trt'</span>
<span class="va">svr_binary_lb0</span> <span class="op">&lt;-</span> <span class="st">'ntran'</span>
<span class="va">svr_binary_lb1</span> <span class="op">&lt;-</span> <span class="st">'train'</span>
<span class="va">svr_outcome</span> <span class="op">&lt;-</span> <span class="st">'emp78'</span>
<span class="va">sdt_name</span> <span class="op">&lt;-</span> <span class="st">'NSW Lalonde Training'</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="logit-regression">Logit Regression<a class="anchor" aria-label="anchor" href="#logit-regression"></a>
</h2>
<div class="section level3">
<h3 id="prediction-with-observed-binary-input">Prediction with Observed Binary Input<a class="anchor" aria-label="anchor" href="#prediction-with-observed-binary-input"></a>
</h3>
<p>Logit regression with a continuous variable and a binary variable. Predict outcome with observed continuous variable as well as observed binary input variable.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Regress No bivariate</span>
<span class="va">rs_logit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">svr_outcome</span>,
                                 <span class="st">"~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">ls_st_xs</span>, collapse<span class="op">=</span><span class="st">"+"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
                ,data <span class="op">=</span> <span class="va">dft</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rs_logit</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Call:</span>
<span class="co">## glm(formula = as.formula(paste(svr_outcome, "~", paste(ls_st_xs, </span>
<span class="co">##     collapse = "+"))), family = "binomial", data = dft)</span>
<span class="co">## </span>
<span class="co">## Deviance Residuals: </span>
<span class="co">##     Min       1Q   Median       3Q      Max  </span>
<span class="co">## -2.2075  -1.4253   0.7851   0.8571   1.1189  </span>
<span class="co">## </span>
<span class="co">## Coefficients:</span>
<span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)   </span>
<span class="co">## (Intercept)  2.90493    0.99594   2.917  0.00354 **</span>
<span class="co">## age         -0.01870    0.01295  -1.445  0.14855   </span>
<span class="co">## educ        -0.02754    0.06653  -0.414  0.67896   </span>
<span class="co">## black       -1.16273    0.38941  -2.986  0.00283 **</span>
<span class="co">## hisp        -0.12130    0.51185  -0.237  0.81267   </span>
<span class="co">## marr         0.30300    0.24551   1.234  0.21714   </span>
<span class="co">## nodeg       -0.29036    0.27833  -1.043  0.29684   </span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">## </span>
<span class="co">##     Null deviance: 844.33  on 721  degrees of freedom</span>
<span class="co">## Residual deviance: 818.46  on 715  degrees of freedom</span>
<span class="co">## AIC: 832.46</span>
<span class="co">## </span>
<span class="co">## Number of Fisher Scoring iterations: 4</span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dft</span><span class="op">$</span><span class="va">p_mpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rs_logit</span>, newdata <span class="op">=</span> <span class="va">dft</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="co"># Regress with bivariate</span>
<span class="co"># rs_logit_bi &lt;- glm(as.formula(paste(svr_outcome,</span>
<span class="co">#                                     "~ factor(", svr_binary,") + ",</span>
<span class="co">#                                     paste(ls_st_xs, collapse="+")))</span>
<span class="co">#                    , data = dft, family = "binomial")</span>
<span class="va">rs_logit_bi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">emp78</span> <span class="op">~</span>
                     <span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">age_m2</span><span class="op">)</span>
                   <span class="co"># + educ + I(educ^2) +</span>
                   <span class="co"># + educ + black + hisp + marr + nodeg</span>
                   <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span>
                   <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">age_m2</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">trt</span><span class="op">)</span>
                   , data <span class="op">=</span> <span class="va">dft</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rs_logit_bi</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Call:</span>
<span class="co">## glm(formula = emp78 ~ age + I(age^2) + factor(age_m2) + factor(trt) + </span>
<span class="co">##     factor(age_m2) * factor(trt), family = "binomial", data = dft)</span>
<span class="co">## </span>
<span class="co">## Deviance Residuals: </span>
<span class="co">##     Min       1Q   Median       3Q      Max  </span>
<span class="co">## -1.8735  -1.4565   0.7760   0.8054   0.9258  </span>
<span class="co">## </span>
<span class="co">## Coefficients:</span>
<span class="co">##                                   Estimate Std. Error z value Pr(&gt;|z|)  </span>
<span class="co">## (Intercept)                       2.198320   1.620518   1.357   0.1749  </span>
<span class="co">## age                              -0.089819   0.116067  -0.774   0.4390  </span>
<span class="co">## I(age^2)                          0.001409   0.001740   0.809   0.4183  </span>
<span class="co">## factor(age_m2)2                  -0.141184   0.372152  -0.379   0.7044  </span>
<span class="co">## factor(trt)train                  0.486634   0.257058   1.893   0.0583 .</span>
<span class="co">## factor(age_m2)2:factor(trt)train -0.153539   0.351666  -0.437   0.6624  </span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">## </span>
<span class="co">##     Null deviance: 844.33  on 721  degrees of freedom</span>
<span class="co">## Residual deviance: 833.53  on 716  degrees of freedom</span>
<span class="co">## AIC: 845.53</span>
<span class="co">## </span>
<span class="co">## Number of Fisher Scoring iterations: 4</span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Predcit Using Regresion Data</span>
<span class="va">dft</span><span class="op">$</span><span class="va">p_mpg_hp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rs_logit_bi</span>, newdata <span class="op">=</span> <span class="va">dft</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="co"># Predicted Probabilities am on mgp with or without hp binary</span>
<span class="va">scatter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dft</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">p_mpg_hp</span>, y<span class="op">=</span><span class="va">p_mpg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
      <span class="co"># geom_smooth(method=lm) + # Trend line</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="co"># 45 degree line</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Predicted Probabilities '</span>, <span class="va">svr_outcome</span>, <span class="st">' on '</span>, <span class="va">ls_st_xs</span>, <span class="st">' with or without hp binary'</span><span class="op">)</span>,
           x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'prediction with '</span>, <span class="va">ls_st_xs</span>, <span class="st">' and binary '</span>, <span class="va">svr_binary</span>, <span class="st">' indicator, 1 is high'</span><span class="op">)</span>,
           y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'prediction with only '</span>, <span class="va">ls_st_xs</span><span class="op">)</span>,
           caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sdt_name</span>, <span class="st">' simulated prediction'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scatter</span><span class="op">)</span></code></pre></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_sub_files/figure-html/logit%20with%20binary%20and%20continuous%20RHS-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="prediction-with-binary-set-to-0-and-1">Prediction with Binary set to 0 and 1<a class="anchor" aria-label="anchor" href="#prediction-with-binary-set-to-0-and-1"></a>
</h3>
<p>Now generate two predictions. One set where binary input is equal to 0, and another where the binary inputs are equal to 1. Ignore whether in data binary input is equal to 0 or 1. Use the same regression results as what was just derived.</p>
<p>Note that given the example here, the probability changes a lot when we</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Previous regression results</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rs_logit_bi</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Call:</span>
<span class="co">## glm(formula = emp78 ~ age + I(age^2) + factor(age_m2) + factor(trt) + </span>
<span class="co">##     factor(age_m2) * factor(trt), family = "binomial", data = dft)</span>
<span class="co">## </span>
<span class="co">## Deviance Residuals: </span>
<span class="co">##     Min       1Q   Median       3Q      Max  </span>
<span class="co">## -1.8735  -1.4565   0.7760   0.8054   0.9258  </span>
<span class="co">## </span>
<span class="co">## Coefficients:</span>
<span class="co">##                                   Estimate Std. Error z value Pr(&gt;|z|)  </span>
<span class="co">## (Intercept)                       2.198320   1.620518   1.357   0.1749  </span>
<span class="co">## age                              -0.089819   0.116067  -0.774   0.4390  </span>
<span class="co">## I(age^2)                          0.001409   0.001740   0.809   0.4183  </span>
<span class="co">## factor(age_m2)2                  -0.141184   0.372152  -0.379   0.7044  </span>
<span class="co">## factor(trt)train                  0.486634   0.257058   1.893   0.0583 .</span>
<span class="co">## factor(age_m2)2:factor(trt)train -0.153539   0.351666  -0.437   0.6624  </span>
<span class="co">## ---</span>
<span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">## </span>
<span class="co">## (Dispersion parameter for binomial family taken to be 1)</span>
<span class="co">## </span>
<span class="co">##     Null deviance: 844.33  on 721  degrees of freedom</span>
<span class="co">## Residual deviance: 833.53  on 716  degrees of freedom</span>
<span class="co">## AIC: 845.53</span>
<span class="co">## </span>
<span class="co">## Number of Fisher Scoring iterations: 4</span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Two different dataframes, mutate the binary regressor</span>
<span class="va">dft_bi0</span> <span class="op">&lt;-</span> <span class="va">dft</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html" class="external-link">sym</a></span><span class="op">(</span><span class="va">svr_binary</span><span class="op">)</span> <span class="op">:=</span> <span class="va">svr_binary_lb0</span><span class="op">)</span>
<span class="va">dft_bi1</span> <span class="op">&lt;-</span> <span class="va">dft</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html" class="external-link">sym</a></span><span class="op">(</span><span class="va">svr_binary</span><span class="op">)</span> <span class="op">:=</span> <span class="va">svr_binary_lb1</span><span class="op">)</span>

<span class="co"># Predcit Using Regresion Data</span>
<span class="va">dft</span><span class="op">$</span><span class="va">p_mpg_hp_bi0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rs_logit_bi</span>, newdata <span class="op">=</span> <span class="va">dft_bi0</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>
<span class="va">dft</span><span class="op">$</span><span class="va">p_mpg_hp_bi1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rs_logit_bi</span>, newdata <span class="op">=</span> <span class="va">dft_bi1</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span>

<span class="co"># Predicted Probabilities and Binary Input</span>
<span class="va">scatter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dft</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">p_mpg_hp_bi0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">p_mpg_hp</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">4</span>, shape<span class="op">=</span><span class="fl">4</span>, color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">p_mpg_hp_bi1</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span>, shape<span class="op">=</span><span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
      <span class="co"># geom_smooth(method=lm) + # Trend line</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="co"># 45 degree line</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Predicted Probabilities and Binary Input'</span>,
                          <span class="st">'\ncross(shape=4)/red is predict actual binary data'</span>,
                          <span class="st">'\nstar(shape=8)/black is predict set binary = 1 for all'</span><span class="op">)</span>,
           x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'prediction with '</span>, <span class="va">ls_st_xs</span>, <span class="st">' and binary '</span>, <span class="va">svr_binary</span>, <span class="st">' = 0 for all'</span><span class="op">)</span>,
           y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'prediction with '</span>, <span class="va">ls_st_xs</span>, <span class="st">' and binary '</span>, <span class="va">svr_binary</span>, <span class="st">' = 1'</span><span class="op">)</span>,
           caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">sdt_name</span>, <span class="st">' simulated prediction'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">scatter</span><span class="op">)</span></code></pre></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_sub_files/figure-html/logit%20prediction%200%20vs%201-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="generate-and-analyze-individual-a-and-alpha">Generate and Analyze Individual A and alpha<a class="anchor" aria-label="anchor" href="#generate-and-analyze-individual-a-and-alpha"></a>
</h2>
<div class="section level3">
<h3 id="prediction-with-binary-set-to-0-and-1-difference">Prediction with Binary set to 0 and 1 Difference<a class="anchor" aria-label="anchor" href="#prediction-with-binary-set-to-0-and-1-difference"></a>
</h3>
<p>What is the difference in probability between binary = 0 vs binary = 1. How does that relate to the probability of outcome of interest when binary = 0 for all.</p>
<p>In the binary logit case, the relationship will be hump–shaped by construction between <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span>. In the exponential wage cases, the relationship is convex upwards.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generate Gap Variable</span>
<span class="va">dft</span> <span class="op">&lt;-</span> <span class="va">dft</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>alpha_i <span class="op">=</span> <span class="va">p_mpg_hp_bi1</span> <span class="op">-</span> <span class="va">p_mpg_hp_bi0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>A_i <span class="op">=</span> <span class="va">p_mpg_hp_bi0</span><span class="op">)</span>

<span class="va">dft_graph</span> <span class="op">&lt;-</span> <span class="va">dft</span>
<span class="va">dft_graph</span><span class="op">$</span><span class="va">age_m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dft_graph</span><span class="op">$</span><span class="va">age_m2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Age &lt;= 23'</span>, <span class="st">'Age &gt; 23'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Titling</span>
<span class="va">title_line1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Each circle (cross) represents an individual &lt;= age 23 (&gt; age 23)"</span><span class="op">)</span>
<span class="va">title_line2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Heterogeneous expected outcome (employment probability) with and without training"</span><span class="op">)</span>
<span class="va">title_line3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Heterogeneity from logistic regression nonlinearity and heterogeneous age group effects"</span><span class="op">)</span>
<span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">'The joint distribution of'</span><span class="op">~</span><span class="va">A</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">~</span><span class="st">'and'</span><span class="op">~</span><span class="va">alpha</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">~</span><span class="st">','</span><span class="op">~</span><span class="st">'Logistic Regression, Lalonde (AER, 1986)'</span><span class="op">)</span>
<span class="va">caption</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Logistic regression predictions of the employment effects of a training RCT. Data from Lalonde (AER, 1986).'</span><span class="op">)</span>
<span class="co"># Labels</span>
<span class="va">st_x_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">A</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">~</span><span class="st">', '</span><span class="op">~</span><span class="va">Probability</span><span class="op">~</span><span class="va">of</span><span class="op">~</span><span class="va">Employment</span><span class="op">~</span><span class="va">without</span><span class="op">~</span><span class="va">Training</span><span class="op">~</span><span class="st">','</span><span class="op">~</span><span class="st">'P(train=0)'</span><span class="op">)</span>
<span class="va">st_y_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">~</span><span class="st">','</span><span class="op">~</span><span class="va">Marginal</span><span class="op">~</span><span class="va">Effects</span><span class="op">~</span><span class="va">of</span><span class="op">~</span><span class="va">Training</span><span class="op">~</span><span class="st">','</span><span class="op">~</span><span class="st">'P(train=1) - P(train=0)'</span><span class="op">)</span>

<span class="co"># Binary Marginal Effects and Prediction without Binary</span>
<span class="va">plt_A_alpha</span> <span class="op">&lt;-</span> <span class="va">dft_graph</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">A_i</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">alpha_i</span>,
                     color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">age_m2</span><span class="op">)</span>,
                     shape<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">age_m2</span><span class="op">)</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="co"># 45 degree line</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#69b3a2"</span>, <span class="st">"#404080"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">title_line1</span>,<span class="st">'\n'</span>, <span class="va">title_line2</span>, <span class="st">'\n'</span>, <span class="va">title_line3</span><span class="op">)</span>,
           x <span class="op">=</span> <span class="va">st_x_label</span>,
           y <span class="op">=</span> <span class="va">st_y_label</span>,
           caption <span class="op">=</span> <span class="va">caption</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">8</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =</span>
<span class="co">## "none")` instead.</span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Labeling</span>
<span class="va">plt_A_alpha</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">shape</span> <span class="op">&lt;-</span> <span class="st">"Age Subgroups"</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plt_A_alpha</span><span class="op">)</span></code></pre></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_sub_files/figure-html/logit%20prediction%20marginal%20vs%20base-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="va">bl_save_img</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">snm_cnts</span> <span class="op">&lt;-</span> <span class="st">'Lalonde_employ_A_alpha_age.png'</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">spt_img_save</span>, <span class="va">snm_cnts</span><span class="op">)</span>,
        width <span class="op">=</span> <span class="fl">135</span>, height <span class="op">=</span> <span class="fl">86</span>, units<span class="op">=</span><span class="st">'mm'</span>, res <span class="op">=</span> <span class="fl">300</span>, pointsize<span class="op">=</span><span class="fl">7</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plt_A_alpha</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">spt_img_save_draft</span>, <span class="va">snm_cnts</span><span class="op">)</span>,
        width <span class="op">=</span> <span class="fl">135</span>, height <span class="op">=</span> <span class="fl">86</span>, units<span class="op">=</span><span class="st">'mm'</span>, res <span class="op">=</span> <span class="fl">300</span>,
      pointsize<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plt_A_alpha</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="optimal-binary-allocation">Optimal Binary Allocation<a class="anchor" aria-label="anchor" href="#optimal-binary-allocation"></a>
</h2>
<div class="section level3">
<h3 id="preference-vector">Preference Vector<a class="anchor" aria-label="anchor" href="#preference-vector"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">beta_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dft</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">dft</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">ar_rho</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="op">-</span><span class="fl">0.001</span>,  <span class="fl">0.95</span><span class="op">)</span>
<span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span>, length.out<span class="op">=</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ar_rho</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="solve-for-optimal-allocaions-across-preference-parameters">Solve for Optimal Allocaions Across Preference Parameters<a class="anchor" aria-label="anchor" href="#solve-for-optimal-allocaions-across-preference-parameters"></a>
</h3>
<p>Invoke the binary optimal allocation function <em>ffp_opt_anlyz_rhgin_bin</em> that loops over rhos.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">svr_inpalc</span> <span class="op">&lt;-</span> <span class="st">'rank'</span>
<span class="va">dft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dft</span>, <span class="va">beta_i</span><span class="op">)</span>
<span class="va">svr_rho_val</span> <span class="op">&lt;-</span> <span class="st">'rho_val'</span>
<span class="va">ls_bin_solu_all_rhos</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_bin.html">ffp_opt_anlyz_rhgin_bin</a></span><span class="op">(</span><span class="va">dft</span>, svr_id_i <span class="op">=</span> <span class="st">'id'</span>,
                          svr_A_i <span class="op">=</span> <span class="st">'A_i'</span>, svr_alpha_i <span class="op">=</span> <span class="st">'alpha_i'</span>, svr_beta_i <span class="op">=</span> <span class="st">'beta_i'</span>,
                          ar_rho <span class="op">=</span> <span class="va">ar_rho</span>,
                          svr_rho <span class="op">=</span> <span class="st">'rho'</span>, svr_rho_val <span class="op">=</span> <span class="va">svr_rho_val</span>,
                          svr_inpalc <span class="op">=</span> <span class="va">svr_inpalc</span>,
                          svr_expout <span class="op">=</span> <span class="st">'opti_exp_outcome'</span>,
                          verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 'data.frame':    722 obs. of  54 variables:</span>
<span class="co">##  $ id          : int  1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">##  $ trt         : Factor w/ 2 levels "ntran","train": 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">##  $ age         : int  23 26 22 34 18 45 18 27 24 34 ...</span>
<span class="co">##  $ educ        : int  10 12 9 9 9 11 9 12 8 11 ...</span>
<span class="co">##  $ black       : int  1 0 1 1 1 1 1 1 0 1 ...</span>
<span class="co">##  $ hisp        : int  0 0 0 0 0 0 0 0 0 0 ...</span>
<span class="co">##  $ marr        : int  0 0 0 0 0 0 0 0 0 1 ...</span>
<span class="co">##  $ nodeg       : int  1 0 1 1 1 1 1 0 1 1 ...</span>
<span class="co">##  $ re74        : num  0 0 0 NA 0 0 0 NA 0 0 ...</span>
<span class="co">##  $ re75        : num  0 0 0 4368 0 ...</span>
<span class="co">##  $ re78        : num  0 12384 0 14051 10740 ...</span>
<span class="co">##  $ re75_zero   : num  1 1 1 0 1 1 1 0 1 1 ...</span>
<span class="co">##  $ emp78       : num  0 1 0 1 1 1 1 1 1 1 ...</span>
<span class="co">##  $ emp75       : num  0 0 0 1 0 0 0 1 0 0 ...</span>
<span class="co">##  $ race        : num  1 0 1 1 1 1 1 1 0 1 ...</span>
<span class="co">##  $ age_m2      : num  1 2 1 2 1 2 1 2 2 2 ...</span>
<span class="co">##  $ age_m3      : num  2 2 2 3 1 3 1 3 2 3 ...</span>
<span class="co">##  $ p_mpg       : num  0.678 0.89 0.688 0.638 0.704 ...</span>
<span class="co">##  $ p_mpg_hp    : num  0.706 0.662 0.712 0.653 0.738 ...</span>
<span class="co">##  $ p_mpg_hp_bi0: num  0.706 0.662 0.712 0.653 0.738 ...</span>
<span class="co">##  $ p_mpg_hp_bi1: num  0.796 0.732 0.801 0.724 0.821 ...</span>
<span class="co">##  $ alpha_i     : num  0.0901 0.0701 0.0889 0.0712 0.0828 ...</span>
<span class="co">##  $ A_i         : num  0.706 0.662 0.712 0.653 0.738 ...</span>
<span class="co">##  $ beta_i      : num  0.00139 0.00139 0.00139 0.00139 0.00139 ...</span>
<span class="co">##  $ rho_c1_rk   : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c2_rk   : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c3_rk   : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c4_rk   : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c5_rk   : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c6_rk   : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c7_rk   : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c8_rk   : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c9_rk   : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c10_rk  : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c11_rk  : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c12_rk  : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c13_rk  : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c14_rk  : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c15_rk  : int  1 553 42 423 245 711 245 503 656 423 ...</span>
<span class="co">##  $ rho_c16_rk  : int  1 553 42 371 252 711 252 451 656 371 ...</span>
<span class="co">##  $ rho_c17_rk  : int  1 426 42 233 468 711 468 376 604 233 ...</span>
<span class="co">##  $ rho_c18_rk  : int  1 305 42 135 573 711 573 255 529 135 ...</span>
<span class="co">##  $ rho_c19_rk  : int  132 223 265 52 580 711 580 173 408 52 ...</span>
<span class="co">##  $ rho_c20_rk  : int  285 182 365 52 584 659 584 132 326 52 ...</span>
<span class="co">##  $ rho_c21_rk  : int  329 182 375 52 587 521 587 132 285 52 ...</span>
<span class="co">##  $ rho_c22_rk  : int  334 182 377 52 590 463 590 132 285 52 ...</span>
<span class="co">##  $ rho_c23_rk  : int  336 182 381 52 590 423 590 132 285 52 ...</span>
<span class="co">##  $ rho_c24_rk  : int  340 182 384 52 591 381 591 132 285 52 ...</span>
<span class="co">##  $ rho_c25_rk  : int  340 182 384 52 591 381 591 132 285 52 ...</span>
<span class="co">##  $ rho_c26_rk  : int  343 182 384 52 591 340 591 132 285 52 ...</span>
<span class="co">##  $ rho_c27_rk  : int  343 182 384 52 591 340 591 132 285 52 ...</span>
<span class="co">##  $ rho_c28_rk  : int  343 182 384 52 591 340 591 132 285 52 ...</span>
<span class="co">##  $ rho_c29_rk  : int  343 182 384 52 591 340 591 132 285 52 ...</span>
<span class="co">##  $ rho_c30_rk  : int  343 182 384 52 591 340 591 132 285 52 ...</span></code></pre>
<pre><code><span class="co">## Joining, by = "id"</span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_all_rho</span> <span class="op">&lt;-</span> <span class="va">ls_bin_solu_all_rhos</span><span class="op">$</span><span class="va">df_all_rho</span>
<span class="va">df_all_rho_long</span> <span class="op">&lt;-</span> <span class="va">ls_bin_solu_all_rhos</span><span class="op">$</span><span class="va">df_all_rho_long</span>

<span class="co"># How many people have different ranks across rhos</span>
<span class="va">it_how_many_vary_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_all_rho</span><span class="op">$</span><span class="va">rank_max</span> <span class="op">-</span> <span class="va">df_all_rho</span><span class="op">$</span><span class="va">rank_min</span><span class="op">)</span>
<span class="va">it_how_many_vary_rank</span></code></pre></div>
<pre><code><span class="co">## [1] -255976</span></code></pre>
</div>
<div class="section level3">
<h3 id="change-in-rank-along-rho">Change in Rank along rho<a class="anchor" aria-label="anchor" href="#change-in-rank-along-rho"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get rank when wage rho = 1</span>
<span class="va">df_all_rho_rho_c1</span> <span class="op">&lt;-</span> <span class="va">df_all_rho</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">rho_c1_rk</span><span class="op">)</span>
<span class="co"># Merge</span>
<span class="va">df_all_rho_long</span> <span class="op">&lt;-</span> <span class="va">df_all_rho_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rho <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
                      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_all_rho_rho_c1</span>, by<span class="op">=</span><span class="st">'id'</span><span class="op">)</span>
<span class="co"># Select subset to graph</span>
<span class="va">df_rank_graph</span> <span class="op">&lt;-</span> <span class="va">df_all_rho_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|</span>  <span class="co"># utilitarian rank = 1</span>
                           <span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">11</span><span class="op">)</span> <span class="op">|</span>  <span class="co"># utilitarian rank = 101</span>
                           <span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span>  <span class="op">|</span>  <span class="co"># utilitarian rank = 201</span>
                           <span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">205</span><span class="op">)</span> <span class="op">|</span>  <span class="co"># utilitarian rank = 301</span>
                           <span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">42</span><span class="op">)</span><span class="op">|</span>  <span class="co"># utilitarian rank = 401</span>
                           <span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">8</span><span class="op">)</span> <span class="op">|</span>  <span class="co"># utilitarian rank = 501</span>
                           <span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">31</span><span class="op">)</span> <span class="op">|</span>  <span class="co"># utilitarian rank = 601</span>
                           <span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">134</span><span class="op">)</span>   <span class="co"># utilitarian rank = 701</span>
                           <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>one_minus_rho <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">!</span><span class="op">!</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html" class="external-link">sym</a></span><span class="op">(</span><span class="va">svr_rho_val</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rho_c1_rk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">rho_c1_rk</span><span class="op">)</span><span class="op">)</span>

<span class="va">df_rank_graph</span><span class="op">$</span><span class="va">rho_c1_rk</span></code></pre></div>
<pre><code><span class="co">##   [1] 1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1  </span>
<span class="co">##  [19] 1   1   1   1   1   1   1   1   1   1   1   1   245 245 245 245 245 245</span>
<span class="co">##  [37] 245 245 245 245 245 245 245 245 245 245 245 245 245 245 245 245 245 245</span>
<span class="co">##  [55] 245 245 245 245 245 245 503 503 503 503 503 503 503 503 503 503 503 503</span>
<span class="co">##  [73] 503 503 503 503 503 503 503 503 503 503 503 503 503 503 503 503 503 503</span>
<span class="co">##  [91] 124 124 124 124 124 124 124 124 124 124 124 124 124 124 124 124 124 124</span>
<span class="co">## [109] 124 124 124 124 124 124 124 124 124 124 124 124 595 595 595 595 595 595</span>
<span class="co">## [127] 595 595 595 595 595 595 595 595 595 595 595 595 595 595 595 595 595 595</span>
<span class="co">## [145] 595 595 595 595 595 595 401 401 401 401 401 401 401 401 401 401 401 401</span>
<span class="co">## [163] 401 401 401 401 401 401 401 401 401 401 401 401 401 401 401 401 401 401</span>
<span class="co">## [181] 700 700 700 700 700 700 700 700 700 700 700 700 700 700 700 700 700 700</span>
<span class="co">## [199] 700 700 700 700 700 700 700 700 700 700 700 700 320 320 320 320 320 320</span>
<span class="co">## [217] 320 320 320 320 320 320 320 320 320 320 320 320 320 320 320 320 320 320</span>
<span class="co">## [235] 320 320 320 320 320 320</span>
<span class="co">## Levels: 1 124 245 320 401 503 595 700</span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_rank_graph</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">df_rank_graph</span><span class="op">$</span><span class="va">rho_c1_rk</span>,
                           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Rank= 1  '</span>, <span class="co">#200</span>
                                      <span class="st">'Rank= 124'</span>, <span class="co">#110</span>
                                      <span class="st">'Rank= 245'</span>, <span class="co">#95</span>
                                      <span class="st">'Rank= 320'</span>, <span class="co">#217</span>
                                      <span class="st">'Rank= 411'</span>, <span class="co">#274</span>
                                      <span class="st">'Rank= 503'</span>, <span class="co">#101</span>
                                      <span class="st">'Rank= 595'</span>,
                                      <span class="st">'Rank= 700'</span>
                                       <span class="op">)</span><span class="op">)</span>

<span class="co"># x-labels</span>
<span class="va">x.labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'λ=0.99'</span>, <span class="st">'λ=0.90'</span>, <span class="st">'λ=0'</span>, <span class="st">'λ=-10'</span>, <span class="st">'λ=-100'</span><span class="op">)</span>
<span class="va">x.breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.10</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span>

<span class="co"># title line 2</span>
<span class="va">title_line1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Optimal allocation queue vary λ, allocate using only AGE"</span><span class="op">)</span>
<span class="va">title_line2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Colored lines = different individuals from the NSW training dataset"</span><span class="op">)</span>
<span class="va">title_line3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Track ranking changes for eight individuals ranked 1, 101, ..., 701 at λ=0.99"</span><span class="op">)</span>

<span class="co"># Graph Results--Draw</span>
<span class="va">line.plot</span> <span class="op">&lt;-</span> <span class="va">df_rank_graph</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">one_minus_rho</span>, y<span class="op">=</span><span class="op">!</span><span class="op">!</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html" class="external-link">sym</a></span><span class="op">(</span><span class="va">svr_inpalc</span><span class="op">)</span>,
             group<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>,
             colour<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html" class="external-link">fct_rev</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="co"># geom_line(aes(linetype =fct_rev(id)), size=0.75) +</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">title_line1</span>, <span class="st">'\n'</span>, <span class="va">title_line2</span>, <span class="st">'\n'</span>, <span class="va">title_line3</span><span class="op">)</span>,
       x <span class="op">=</span> <span class="st">'log10 Rescale of λ, Log10(λ)\nλ=1 Utilitarian (Maximize Average), λ=-infty Rawlsian (Maximize Mininum)'</span>,
       y <span class="op">=</span> <span class="st">'Optimal Allocation Queue Rank (1=highest)'</span>,
       caption <span class="op">=</span> <span class="st">'Based on logistic regression of the employment effects of a training RCT. Data from Lalonde (AER, 1986).'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>trans<span class="op">=</span><span class="st">'log10'</span>, labels <span class="op">=</span> <span class="va">x.labels</span>, breaks <span class="op">=</span> <span class="va">x.breaks</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size<span class="op">=</span><span class="fl">8</span><span class="op">)</span>

<span class="co"># Labeling</span>
<span class="va">line.plot</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">colour</span> <span class="op">&lt;-</span> <span class="st">"At λ=0.99, i's"</span>

<span class="co"># Print</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">line.plot</span><span class="op">)</span></code></pre></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_sub_files/figure-html/graph%20of%20rank%20change-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="va">bl_save_img</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">snm_cnts</span> <span class="op">&lt;-</span> <span class="st">'Lalonde_employ_rank_age.png'</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">spt_img_save</span>, <span class="va">snm_cnts</span><span class="op">)</span>,
        width <span class="op">=</span> <span class="fl">135</span>, height <span class="op">=</span> <span class="fl">86</span>, units<span class="op">=</span><span class="st">'mm'</span>, res <span class="op">=</span> <span class="fl">300</span>, pointsize<span class="op">=</span><span class="fl">7</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">line.plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">spt_img_save_draft</span>, <span class="va">snm_cnts</span><span class="op">)</span>,
        width <span class="op">=</span> <span class="fl">135</span>, height <span class="op">=</span> <span class="fl">86</span>, units<span class="op">=</span><span class="st">'mm'</span>, res <span class="op">=</span> <span class="fl">300</span>,
      pointsize<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">line.plot</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="save-results">Save Results<a class="anchor" aria-label="anchor" href="#save-results"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Change Variable names so that this can becombined with logit file later</span>
<span class="va">df_all_rho</span> <span class="op">&lt;-</span> <span class="va">df_all_rho</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html" class="external-link">rename_at</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"rho_"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html" class="external-link">funs</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">.</span>, <span class="st">"rk"</span>, <span class="st">"rk_empage"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: `funs()` was deprecated in dplyr 0.8.0.</span>
<span class="co">## Please use a list of either functions or lambdas: </span>
<span class="co">## </span>
<span class="co">##   # Simple named list: </span>
<span class="co">##   list(mean = mean, median = median)</span>
<span class="co">## </span>
<span class="co">##   # Auto named with `tibble::lst()`: </span>
<span class="co">##   tibble::lst(mean, median)</span>
<span class="co">## </span>
<span class="co">##   # Using lambdas</span>
<span class="co">##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))</span>
<span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span>
<span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_all_rho</span> <span class="op">&lt;-</span> <span class="va">df_all_rho</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>A_i_empage <span class="op">=</span> <span class="va">A_i</span>, alpha_i_empage <span class="op">=</span> <span class="va">alpha_i</span>, beta_i_empage <span class="op">=</span> <span class="va">beta_i</span>,
               rank_min_empage <span class="op">=</span> <span class="va">rank_min</span>, rank_max_empage <span class="op">=</span> <span class="va">rank_max</span>, avg_rank_empage <span class="op">=</span> <span class="va">avg_rank</span><span class="op">)</span>

<span class="co"># Save File</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">bl_save_rda</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">df_opt_lalonde_training_empage</span> <span class="op">&lt;-</span> <span class="va">df_all_rho</span>
  <span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html" class="external-link">use_data</a></span><span class="op">(</span><span class="va">df_opt_lalonde_training_empage</span>, <span class="va">df_opt_lalonde_training_empage</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="binary-marginal-effects-and-prediction-without-binary">Binary Marginal Effects and Prediction without Binary<a class="anchor" aria-label="anchor" href="#binary-marginal-effects-and-prediction-without-binary"></a>
</h3>
<p>What is the relationship between ranking,</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ggplot.A.alpha.x &lt;- function(svr_x, df,</span>
<span class="co">#                              svr_alpha = 'alpha_i', svr_A = "A_i"){</span>
<span class="co">#</span>
<span class="co">#   scatter &lt;- ggplot(df, aes(x=!!sym(svr_x))) +</span>
<span class="co">#         geom_point(aes(y=alpha_i), size=4, shape=4, color="red") +</span>
<span class="co">#         geom_point(aes(y=A_i), size=2, shape=8, color="blue") +</span>
<span class="co">#         geom_abline(intercept = 0, slope = 1) + # 45 degree line</span>
<span class="co">#         labs(title = paste0('A (blue) and alpha (red) vs x variables=', svr_x),</span>
<span class="co">#              x = svr_x,</span>
<span class="co">#              y = 'Probabilities',</span>
<span class="co">#              caption = paste0(sdt_name, ' simulated prediction')) +</span>
<span class="co">#         theme_bw()</span>
<span class="co">#</span>
<span class="co"># return(scatter)</span>
<span class="co"># }</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://fanwangecon.github.io" class="external-link">Fan Wang</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
