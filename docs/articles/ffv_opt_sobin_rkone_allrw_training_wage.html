<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Linear Wage Binary Allocation Lalonde Training Example • Optimal Allocation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Linear Wage Binary Allocation Lalonde Training Example">
<meta property="og:description" content="Linear wage regression estimation of A and alpha from the Lalonde Training Dataset (722 Observations). 
Solve for optimal binary allocation queues.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Optimal Allocation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/PrjOptiAlloc.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue.pdf">Paper</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue_Present.pdf">Slides</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Sites
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://fanwangecon.github.io/REconTools/">R Tools for Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/R4Econ/">R Examples Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stat4Econ/">R Examples Introductory Statistics</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stata4Econ/">Stata Examples Regressions and Tables</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/M4Econ/">Matlab Examples Matrix and Graphs</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Math4Econ/">Matlab Introductory Math for Econ</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Tex4Econ/">Latex and Paper Generation Examples</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/pyfan/">Python Examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://fanwangecon.github.io/">Fan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fanwangecon/PrjOptiAlloc">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fanwangecon">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ffv_opt_sobin_rkone_allrw_training_wage_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Linear Wage Binary Allocation Lalonde Training Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/master/vignettes/ffv_opt_sobin_rkone_allrw_training_wage.Rmd"><code>vignettes/ffv_opt_sobin_rkone_allrw_training_wage.Rmd</code></a></small>
      <div class="hidden name"><code>ffv_opt_sobin_rkone_allrw_training_wage.Rmd</code></div>

    </div>

    
    
<p>Linear wage regression estimation of A and alpha from the Lalonde Training Dataset (722 Observations). Solve for optimal binary allocation queues. Test binary allocation queue with Lalonde training dataset. There are 722 observations, 297 in the treatment group, 425 in the control group. Following Lalonde, regressions are in terms of wage levels (not log wage)</p>
<div id="load-dependencies" class="section level2">
<h2 class="hasAnchor">
<a href="#load-dependencies" class="anchor"></a>Load Dependencies</h2>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>(<span class="kw">all.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">knitr.duplicate.label</span> <span class="kw">=</span> <span class="st">'allow'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">forcats</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">broom</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">REconTools</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">PrjOptiAlloc</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">kableExtra</span>)

<span class="no">bl_save_rda</span> <span class="kw">=</span> <span class="fl">FALSE</span>
<span class="no">bl_save_img</span> <span class="kw">=</span> <span class="fl">FALSE</span></pre></body></html></div>
</div>
<div id="load-data-and-generate-new-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#load-data-and-generate-new-variables" class="anchor"></a>Load Data and Generate New Variables</h2>
<p>Generate four categories by initial height and mother’s education levels combinations.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Load Data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">df_opt_lalonde_training</span>)
<span class="no">dft</span> <span class="kw">&lt;-</span> <span class="no">df_opt_lalonde_training</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="no">X</span>) <span class="kw">%&gt;%</span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">X</span>) <span class="kw">%&gt;%</span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">everything</a></span>())
<span class="co"># Summarize</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">dft</span>)</pre></body></html></div>
<pre><code>## 'data.frame':    722 obs. of  11 variables:
##  $ id   : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ trt  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ age  : int  23 26 22 34 18 45 18 27 24 34 ...
##  $ educ : int  10 12 9 9 9 11 9 12 8 11 ...
##  $ black: int  1 0 1 1 1 1 1 1 0 1 ...
##  $ hisp : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ marr : int  0 0 0 0 0 0 0 0 0 1 ...
##  $ nodeg: int  1 0 1 1 1 1 1 0 1 1 ...
##  $ re74 : num  0 0 0 NA 0 0 0 NA 0 0 ...
##  $ re75 : num  0 0 0 4368 0 ...
##  $ re78 : num  0 12384 0 14051 10740 ...</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">dft</span>)</pre></body></html></div>
<pre><code>##        id              trt              age             educ      
##  Min.   :   1.0   Min.   :0.0000   Min.   :17.00   Min.   : 3.00  
##  1st Qu.: 181.2   1st Qu.:0.0000   1st Qu.:19.00   1st Qu.: 9.00  
##  Median : 361.5   Median :0.0000   Median :23.00   Median :10.00  
##  Mean   : 854.4   Mean   :0.4114   Mean   :24.52   Mean   :10.27  
##  3rd Qu.:1458.5   3rd Qu.:1.0000   3rd Qu.:27.00   3rd Qu.:11.00  
##  Max.   :4110.0   Max.   :1.0000   Max.   :55.00   Max.   :16.00  
##                                                                   
##      black             hisp             marr           nodeg       
##  Min.   :0.0000   Min.   :0.0000   Min.   :0.000   Min.   :0.0000  
##  1st Qu.:1.0000   1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:1.0000  
##  Median :1.0000   Median :0.0000   Median :0.000   Median :1.0000  
##  Mean   :0.8006   Mean   :0.1053   Mean   :0.162   Mean   :0.7798  
##  3rd Qu.:1.0000   3rd Qu.:0.0000   3rd Qu.:0.000   3rd Qu.:1.0000  
##  Max.   :1.0000   Max.   :1.0000   Max.   :1.000   Max.   :1.0000  
##                                                                    
##       re74              re75              re78      
##  Min.   :    0.0   Min.   :    0.0   Min.   :    0  
##  1st Qu.:    0.0   1st Qu.:    0.0   1st Qu.:    0  
##  Median :    0.0   Median :  936.3   Median : 3952  
##  Mean   : 2102.3   Mean   : 3042.9   Mean   : 5455  
##  3rd Qu.:  824.4   3rd Qu.: 3993.2   3rd Qu.: 8772  
##  Max.   :39570.7   Max.   :37431.7   Max.   :60308  
##  NA's   :277</code></pre>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Generate Employment 0 or 1 status Variable, and non-zero wages variable</span>
<span class="no">dft</span> <span class="kw">&lt;-</span> <span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">emp78</span> <span class="kw">=</span>
                      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">re78</span> <span class="kw">&lt;=</span> <span class="fl">0</span> ~ <span class="fl">0</span>,
                                <span class="fl">TRUE</span> ~ <span class="fl">1</span>)) <span class="kw">%&gt;%</span>
               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">emp75</span> <span class="kw">=</span>
                      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">re75</span> <span class="kw">&lt;=</span> <span class="fl">0</span> ~ <span class="fl">0</span>,
                                <span class="fl">TRUE</span> ~ <span class="fl">1</span>)) <span class="kw">%&gt;%</span>
               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">emp74</span> <span class="kw">=</span>
                      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">re74</span> <span class="kw">&lt;=</span> <span class="fl">0</span> ~ <span class="fl">0</span>,
                                <span class="fl">TRUE</span> ~ <span class="fl">1</span>))

<span class="co"># Generate combine black + hispanic status</span>
<span class="co"># 0 = white, 1 = black, 2 = hispanics</span>
<span class="no">dft</span> <span class="kw">&lt;-</span> <span class="no">dft</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">race</span> <span class="kw">=</span>
             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">black</span> <span class="kw">==</span> <span class="fl">1</span> ~ <span class="fl">1</span>,
                       <span class="no">hisp</span> <span class="kw">==</span> <span class="fl">1</span> ~ <span class="fl">2</span>,
                       <span class="fl">TRUE</span> ~ <span class="fl">0</span>))

<span class="no">dft</span> <span class="kw">&lt;-</span> <span class="no">dft</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">age_m2</span> <span class="kw">=</span>
             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">age</span> <span class="kw">&lt;=</span> <span class="fl">23</span> ~ <span class="fl">1</span>,
                       <span class="no">age</span> <span class="kw">&gt;</span>  <span class="fl">23</span>~ <span class="fl">2</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">age_m3</span> <span class="kw">=</span>
             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">age</span> <span class="kw">&lt;=</span> <span class="fl">20</span> ~ <span class="fl">1</span>,
                       <span class="no">age</span> <span class="kw">&gt;</span> <span class="fl">20</span> <span class="kw">&amp;</span> <span class="no">age</span> <span class="kw">&lt;=</span> <span class="fl">26</span> ~ <span class="fl">2</span>,
                       <span class="no">age</span> <span class="kw">&gt;</span> <span class="fl">26</span> ~ <span class="fl">3</span>))



<span class="co"># filter(re78 != 0) %&gt;%</span>
<span class="co"># mutate(re78_log = log(re78))</span>

<span class="co"># Exclude zeros</span>
<span class="co"># when this is on, both linear and log linear results exclude wage = 0</span>
<span class="co"># dft &lt;- dft %&gt;%</span>
<span class="co">#     filter(re78 &gt; 0)</span>

<span class="co"># Generate Discrete Version of continuous variables</span>
<span class="co"># dft &lt;- dft %&gt;%</span>
<span class="co">#     mutate(momwgtLowHigh = cut(lwt,</span>
<span class="co">#                                breaks=c(-Inf, 129, Inf),</span>
<span class="co">#                                labels=c("LW","HW"))) %&gt;%</span>
<span class="co">#     mutate(mombirthage = cut(age,</span>
<span class="co">#                                breaks=c(-Inf, 24, Inf),</span>
<span class="co">#                                labels=c("young","older")))</span></pre></body></html></div>
</div>
<div id="regression-with-data-and-construct-input-arrays" class="section level2">
<h2 class="hasAnchor">
<a href="#regression-with-data-and-construct-input-arrays" class="anchor"></a>Regression with Data and Construct Input Arrays</h2>
<div id="tabulate-and-summarize-averages" class="section level3">
<h3 class="hasAnchor">
<a href="#tabulate-and-summarize-averages" class="anchor"></a>Tabulate and Summarize Averages</h3>
<p>What is the average difference in wage between treatment and control, do they match what is reported in Lalonde (1986)?</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># Summarize average for all variables grouping by treatment status</span>
<span class="co"># re78 is significantly different</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">trt</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_if</a></span>(<span class="no">is.numeric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="no">mean</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)), <span class="kw">digits</span><span class="kw">=</span><span class="fl">3</span>)</pre></body></html></div>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once per session.</code></pre>
<pre><code>##                 [,1]     [,2]
## trt            0.000    1.000
## id_mean      213.000 1772.316
## age_mean      24.447   24.626
## educ_mean     10.188   10.380
## black_mean     0.800    0.801
## hisp_mean      0.113    0.094
## marr_mean      0.158    0.168
## nodeg_mean     0.814    0.731
## re74_mean   2107.027 2095.574
## re75_mean   3026.683 3066.098
## re78_mean   5090.048 5976.352
## emp78_mean     0.696    0.774
## emp75_mean     0.581    0.626
## emp74_mean     0.541    0.559
## race_mean      1.026    0.990
## age_m2_mean    1.489    1.481
## age_m3_mean    1.948    1.990</code></pre>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">marr</span>, <span class="no">age_m2</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_if</a></span>(<span class="no">is.numeric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="no">mean</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)), <span class="kw">digits</span><span class="kw">=</span><span class="fl">3</span>)</pre></body></html></div>
<pre><code>##                 [,1]     [,2]     [,3]     [,4]
## marr           0.000    0.000    1.000    1.000
## age_m2         1.000    2.000    1.000    2.000
## id_mean      840.140  823.626 1083.179  928.270
## trt_mean       0.411    0.405    0.464    0.416
## age_mean      19.569   29.485   20.929   30.124
## educ_mean     10.105   10.412   10.143   10.506
## black_mean     0.778    0.824    0.607    0.876
## hisp_mean      0.134    0.069    0.250    0.056
## nodeg_mean     0.845    0.698    0.821    0.753
## re74_mean   1991.445 1509.914 2758.832 3996.214
## re75_mean   2304.886 2950.030 5827.808 5284.371
## re78_mean   5219.173 5516.690 7153.395 5644.975
## emp78_mean     0.752    0.683    0.893    0.719
## emp75_mean     0.650    0.511    0.786    0.607
## emp74_mean     0.615    0.447    0.714    0.539
## race_mean      1.047    0.962    1.107    0.989
## age_m3_mean    1.309    2.630    1.607    2.652</code></pre>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co"># Summarize by finer sub groups: RACE</span>
<span class="co"># big increase for black, but not for other group</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">trt</span>, <span class="no">race</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_if</a></span>(<span class="no">is.numeric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="no">mean</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)), <span class="kw">digits</span><span class="kw">=</span><span class="fl">3</span>)</pre></body></html></div>
<pre><code>##                 [,1]     [,2]     [,3]     [,4]     [,5]     [,6]
## trt            0.000    0.000    0.000    1.000    1.000    1.000
## race           0.000    1.000    2.000    0.000    1.000    2.000
## id_mean      233.027  209.679  221.083 1700.129 1782.723 1763.786
## age_mean      23.351   24.812   22.708   25.677   24.853   21.536
## educ_mean     10.486   10.285    9.271   10.839   10.382    9.857
## black_mean     0.000    1.000    0.000    0.000    1.000    0.000
## hisp_mean      0.000    0.000    1.000    0.000    0.000    1.000
## marr_mean      0.135    0.162    0.146    0.161    0.168    0.179
## nodeg_mean     0.649    0.821    0.896    0.548    0.739    0.857
## re74_mean   3791.631 2086.477 1242.022 1305.037 2155.013 2546.219
## re75_mean   5373.717 2862.948 2377.296 4038.830 2785.916 4370.691
## re78_mean   7114.471 4654.996 6611.178 7034.041 5814.419 6181.772
## emp78_mean     0.838    0.659    0.854    0.935    0.739    0.893
## emp75_mean     0.757    0.565    0.562    0.677    0.597    0.821
## emp74_mean     0.676    0.521    0.583    0.548    0.534    0.786
## age_m2_mean    1.514    1.506    1.354    1.484    1.513    1.214
## age_m3_mean    1.946    1.988    1.667    2.065    2.021    1.643</code></pre>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co"># Summarize by finer sub groups: MARRIAGE</span>
<span class="co"># big increase for black, but not for other group</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">trt</span>, <span class="no">marr</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_if</a></span>(<span class="no">is.numeric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="no">mean</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)), <span class="kw">digits</span><span class="kw">=</span><span class="fl">3</span>)</pre></body></html></div>
<pre><code>##                 [,1]     [,2]     [,3]     [,4]
## trt            0.000    0.000    1.000    1.000
## marr           0.000    1.000    0.000    1.000
## id_mean      210.176  228.090 1735.688 1953.260
## age_mean      23.933   27.194   23.761   28.900
## educ_mean     10.131   10.493   10.393   10.320
## black_mean     0.796    0.821    0.802    0.800
## hisp_mean      0.115    0.104    0.093    0.100
## nodeg_mean     0.818    0.791    0.729    0.740
## re74_mean   1834.893 3603.759 1646.427 4020.488
## re75_mean   2465.121 6027.269 2756.966 4593.212
## re78_mean   5105.237 5008.892 5699.897 7342.041
## emp78_mean     0.701    0.672    0.753    0.880
## emp75_mean     0.573    0.627    0.615    0.680
## emp74_mean     0.534    0.582    0.555    0.580
## race_mean      1.025    1.030    0.988    1.000
## age_m2_mean    1.436    1.776    1.429    1.740
## age_m3_mean    1.866    2.388    1.903    2.420</code></pre>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co"># Summarize by finer sub groups: AGE GROUPS</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">trt</span>, <span class="no">age_m2</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_if</a></span>(<span class="no">is.numeric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="no">mean</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)), <span class="kw">digits</span><span class="kw">=</span><span class="fl">3</span>)</pre></body></html></div>
<pre><code>##                 [,1]     [,2]     [,3]     [,4]
## trt            0.000    0.000    1.000    1.000
## age_m2         1.000    2.000    1.000    2.000
## id_mean      241.908  182.841 1727.292 1820.804
## age_mean      19.539   29.567   19.857   29.762
## educ_mean      9.977   10.409   10.292   10.476
## black_mean     0.774    0.827    0.753    0.853
## hisp_mean      0.143    0.082    0.143    0.042
## marr_mean      0.069    0.250    0.084    0.259
## nodeg_mean     0.899    0.726    0.766    0.692
## re74_mean   2333.261 1900.754 1571.490 2486.164
## re75_mean   2313.545 3770.677 2933.215 3209.204
## re78_mean   5095.991 5083.849 5744.425 6226.119
## emp78_mean     0.728    0.663    0.812    0.734
## emp75_mean     0.618    0.543    0.721    0.524
## emp74_mean     0.590    0.490    0.669    0.441
## race_mean      1.060    0.990    1.039    0.937
## age_m3_mean    1.290    2.635    1.390    2.636</code></pre>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">trt</span>, <span class="no">age_m3</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_if</a></span>(<span class="no">is.numeric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="no">mean</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)), <span class="kw">digits</span><span class="kw">=</span><span class="fl">3</span>)</pre></body></html></div>
<pre><code>##                 [,1]     [,2]     [,3]     [,4]     [,5]     [,6]
## trt            0.000    0.000    0.000    1.000    1.000    1.000
## age_m3         1.000    2.000    3.000    1.000    2.000    3.000
## id_mean      261.675  180.475  190.462 1646.723 1918.705 1721.879
## age_mean      18.532   23.626   32.212   18.479   23.402   32.484
## educ_mean      9.877   10.209   10.530    9.851   10.902   10.286
## black_mean     0.740    0.835    0.833    0.777    0.777    0.857
## hisp_mean      0.175    0.072    0.083    0.160    0.071    0.055
## marr_mean      0.039    0.209    0.242    0.053    0.170    0.286
## nodeg_mean     0.922    0.806    0.697    0.883    0.607    0.725
## re74_mean    827.694 3297.704 2095.804 1466.314 2840.083 1794.839
## re75_mean   1564.343 3604.432 4124.358 2302.777 4136.499 2537.167
## re78_mean   4987.829 5320.403 4966.734 5498.803 5744.032 6755.577
## emp78_mean     0.760    0.676    0.644    0.777    0.795    0.747
## emp75_mean     0.617    0.547    0.576    0.734    0.634    0.505
## emp74_mean     0.584    0.532    0.500    0.670    0.598    0.396
## race_mean      1.091    0.978    1.000    1.096    0.920    0.967
## age_m2_mean    1.000    1.547    2.000    1.000    1.464    2.000</code></pre>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">trt</span>, <span class="no">marr</span>, <span class="no">age_m2</span>) <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_if</a></span>(<span class="no">is.numeric</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="kw">mean</span> <span class="kw">=</span> <span class="no">mean</span>), <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>)), <span class="kw">digits</span><span class="kw">=</span><span class="fl">3</span>)</pre></body></html></div>
<pre><code>##                 [,1]     [,2]     [,3]     [,4]     [,5]     [,6]     [,7]
## trt            0.000    0.000    0.000    0.000    1.000    1.000    1.000
## marr           0.000    0.000    1.000    1.000    0.000    0.000    1.000
## age_m2         1.000    2.000    1.000    2.000    1.000    2.000    1.000
## id_mean      243.302  167.282  223.133  229.519 1695.184 1789.566 2075.538
## age_mean      19.450   29.737   20.733   29.058   19.738   29.113   21.154
## educ_mean      9.965   10.346   10.133   10.596   10.305   10.509   10.154
## black_mean     0.782    0.814    0.667    0.865    0.773    0.840    0.538
## hisp_mean      0.139    0.083    0.200    0.077    0.128    0.047    0.308
## nodeg_mean     0.896    0.718    0.933    0.750    0.773    0.670    0.692
## re74_mean   2215.155 1386.863 5144.184 3383.698 1621.704 1669.249 1055.009
## re75_mean   2033.499 3024.016 6084.840 6010.662 2693.681 2841.146 5531.232
## re78_mean   5009.475 5229.235 6261.061 4647.690 5519.591 5939.737 8183.010
## emp78_mean     0.723    0.673    0.800    0.635    0.794    0.698    1.000
## emp75_mean     0.609    0.526    0.733    0.596    0.709    0.491    0.846
## emp74_mean     0.579    0.474    0.733    0.538    0.667    0.406    0.692
## race_mean      1.059    0.981    1.067    1.019    1.028    0.934    1.154
## age_m3_mean    1.267    2.641    1.600    2.615    1.369    2.613    1.615
##                 [,8]
## trt            1.000
## marr           1.000
## age_m2         2.000
## id_mean     1910.297
## age_mean      31.622
## educ_mean     10.378
## black_mean     0.892
## hisp_mean      0.027
## nodeg_mean     0.757
## re74_mean   4761.858
## re75_mean   4263.638
## re78_mean   7046.565
## emp78_mean     0.838
## emp75_mean     0.622
## emp74_mean     0.541
## race_mean      0.946
## age_m3_mean    2.703</code></pre>
</div>
<div id="tabulate" class="section level3">
<h3 class="hasAnchor">
<a href="#tabulate" class="anchor"></a>Tabulate</h3>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="co"># Tabulate groups, how many in each group, enough for group heterogeneity in effects?</span>
<span class="no">dft</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">trt</span>, <span class="no">marr</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="kw">freq</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>()) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span>(<span class="kw">names_from</span> <span class="kw">=</span> <span class="no">trt</span>, <span class="kw">values_from</span> <span class="kw">=</span> <span class="no">freq</span>)</pre></body></html></div>
<pre><code>## # A tibble: 2 x 3
##    marr   `0`   `1`
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     0   358   247
## 2     1    67    50</code></pre>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="co"># Tabulate groups, how many in each group, enough for group heterogeneity in effects?</span>
<span class="no">dft</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">trt</span>, <span class="no">age_m2</span>, <span class="no">marr</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="kw">freq</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>()) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span>(<span class="kw">names_from</span> <span class="kw">=</span> <span class="no">trt</span>, <span class="kw">values_from</span> <span class="kw">=</span> <span class="no">freq</span>)</pre></body></html></div>
<pre><code>## # A tibble: 4 x 4
## # Groups:   age_m2 [2]
##   age_m2  marr   `0`   `1`
##    &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1      1     0   202   141
## 2      1     1    15    13
## 3      2     0   156   106
## 4      2     1    52    37</code></pre>
</div>
<div id="regression-testing" class="section level3">
<h3 class="hasAnchor">
<a href="#regression-testing" class="anchor"></a>Regression Testing</h3>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="co"># As noted in Lalonde (1986), functional form assumptions do not matter much</span>
<span class="co"># Dummies, treatment effect average about 801 dollars</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">re78</span> ~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">age</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">educ</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">marr</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">nodeg</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">trt</span>) - <span class="fl">1</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">dft</span>))</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = re78 ~ factor(age) + factor(educ) + factor(race) + 
##     factor(marr) + factor(nodeg) + factor(trt) - 1, data = dft)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -14412  -4409  -1265   3139  54012 
## 
## Coefficients: (2 not defined because of singularities)
##                Estimate Std. Error t value Pr(&gt;|t|)  
## factor(age)17    2290.8     6400.4   0.358   0.7205  
## factor(age)18    2445.2     6380.0   0.383   0.7016  
## factor(age)19    3540.8     6384.6   0.555   0.5794  
## factor(age)20    3558.8     6389.4   0.557   0.5777  
## factor(age)21    4670.1     6412.9   0.728   0.4667  
## factor(age)22    2975.7     6262.4   0.475   0.6348  
## factor(age)23    2278.3     6416.7   0.355   0.7227  
## factor(age)24    2362.0     6417.2   0.368   0.7129  
## factor(age)25    2430.8     6395.4   0.380   0.7040  
## factor(age)26    4223.8     6419.2   0.658   0.5108  
## factor(age)27    2720.7     6413.6   0.424   0.6716  
## factor(age)28    4311.2     6428.8   0.671   0.5027  
## factor(age)29    2895.7     6475.4   0.447   0.6549  
## factor(age)30    2044.7     6593.6   0.310   0.7566  
## factor(age)31    3847.6     6471.3   0.595   0.5523  
## factor(age)32    4379.5     6762.9   0.648   0.5175  
## factor(age)33    3880.4     6645.4   0.584   0.5595  
## factor(age)34    2741.6     6613.4   0.415   0.6786  
## factor(age)35    2397.2     6770.4   0.354   0.7234  
## factor(age)36    4081.3     6758.7   0.604   0.5461  
## factor(age)37    1315.2     7296.6   0.180   0.8570  
## factor(age)38    1610.3     6740.8   0.239   0.8113  
## factor(age)39    -545.5     6937.2  -0.079   0.9374  
## factor(age)40   14642.9     7741.1   1.892   0.0590 .
## factor(age)41   -1436.5     6972.1  -0.206   0.8368  
## factor(age)42    3079.3     6992.4   0.440   0.6598  
## factor(age)43    1562.5     7719.2   0.202   0.8397  
## factor(age)44    3459.6     7062.6   0.490   0.6244  
## factor(age)45    6597.1     7347.2   0.898   0.3696  
## factor(age)46   -1436.8     7354.4  -0.195   0.8452  
## factor(age)48    5423.7     9353.1   0.580   0.5622  
## factor(age)49   12421.9     8898.2   1.396   0.1632  
## factor(age)50    2091.2     7718.9   0.271   0.7865  
## factor(age)54    6628.8     8864.7   0.748   0.4549  
## factor(age)55    7456.5     6243.0   1.194   0.2328  
## factor(educ)4    1939.6     6912.8   0.281   0.7791  
## factor(educ)5    2173.8     6919.6   0.314   0.7535  
## factor(educ)6     496.9     6723.6   0.074   0.9411  
## factor(educ)7    3107.2     6476.6   0.480   0.6316  
## factor(educ)8    2867.3     6322.4   0.454   0.6503  
## factor(educ)9    3836.5     6298.3   0.609   0.5426  
## factor(educ)10   3028.1     6288.2   0.482   0.6303  
## factor(educ)11   2796.4     6283.5   0.445   0.6564  
## factor(educ)12   3351.0     6291.2   0.533   0.5945  
## factor(educ)13   4125.2     6420.0   0.643   0.5207  
## factor(educ)14  11173.8     6586.6   1.696   0.0903 .
## factor(educ)15   9616.1     7679.7   1.252   0.2110  
## factor(educ)16       NA         NA      NA       NA  
## factor(race)1   -1612.7      822.1  -1.962   0.0502 .
## factor(race)2     -95.0     1082.8  -0.088   0.9301  
## factor(marr)1     626.9      670.8   0.935   0.3504  
## factor(nodeg)1       NA         NA      NA       NA  
## factor(trt)1      801.0      488.2   1.641   0.1013  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6189 on 671 degrees of freedom
## Multiple R-squared:  0.4826, Adjusted R-squared:  0.4433 
## F-statistic: 12.27 on 51 and 671 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="co"># cts Controls and treatment effects about 761 dollars</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">re78</span> ~  <span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">age</span>^<span class="fl">2</span>) +
                   <span class="no">educ</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">educ</span>^<span class="fl">2</span>) +
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">marr</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">nodeg</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">trt</span>) - <span class="fl">1</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">dft</span>))</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = re78 ~ age + I(age^2) + educ + I(educ^2) + +factor(race) + 
##     factor(marr) + factor(nodeg) + factor(trt) - 1, data = dft)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##  -9154  -4677  -1556   3246  54687 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)  
## age              -29.1127   213.9845  -0.136   0.8918  
## I(age^2)           0.6658     3.5882   0.186   0.8529  
## educ           -1150.6075  1021.2110  -1.127   0.2602  
## I(educ^2)         76.1351    56.0966   1.357   0.1751  
## factor(race)0  10204.2957  5360.7995   1.904   0.0574 .
## factor(race)1   8421.7101  5328.1587   1.581   0.1144  
## factor(race)2  10059.7028  5298.4854   1.899   0.0580 .
## factor(marr)1    579.8210   650.3352   0.892   0.3729  
## factor(nodeg)1   175.0729   913.5232   0.192   0.8481  
## factor(trt)1     761.4122   472.5196   1.611   0.1075  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6206 on 712 degrees of freedom
## Multiple R-squared:  0.448,  Adjusted R-squared:  0.4402 
## F-statistic: 57.78 on 10 and 712 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="co"># Treatment interactions by marriage status, 476 unmarried, vs 2216 for married</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">re78</span> ~  <span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">age</span>^<span class="fl">2</span>) +
                   <span class="no">educ</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">educ</span>^<span class="fl">2</span>) +
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">marr</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">nodeg</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">marr</span>):<span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">trt</span>) - <span class="fl">1</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">dft</span>))</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = re78 ~ age + I(age^2) + educ + I(educ^2) + +factor(race) + 
##     factor(marr) + factor(nodeg) + factor(marr):factor(trt) - 
##     1, data = dft)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##  -9999  -4554  -1552   3132  54838 
## 
## Coefficients:
##                              Estimate Std. Error t value Pr(&gt;|t|)  
## age                          -14.6509   214.1161  -0.068   0.9455  
## I(age^2)                       0.3773     3.5922   0.105   0.9164  
## educ                       -1124.9544  1020.7625  -1.102   0.2708  
## I(educ^2)                     75.1305    56.0673   1.340   0.1807  
## factor(race)0               9986.4688  5359.9102   1.863   0.0628 .
## factor(race)1               8214.9578  5327.0673   1.542   0.1235  
## factor(race)2               9845.8189  5297.5758   1.859   0.0635 .
## factor(marr)1               -156.2047   844.1521  -0.185   0.8532  
## factor(nodeg)1               176.8634   912.9685   0.194   0.8464  
## factor(marr)0:factor(trt)1   476.6372   516.1797   0.923   0.3561  
## factor(marr)1:factor(trt)1  2216.3634  1164.8513   1.903   0.0575 .
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6202 on 711 degrees of freedom
## Multiple R-squared:  0.4494, Adjusted R-squared:  0.4409 
## F-statistic: 52.76 on 11 and 711 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="co"># Treatment interactions by marriage status, 453 vs 1070 each age group</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">re78</span> ~  <span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">age</span>^<span class="fl">2</span>) + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">age_m2</span>) +
                   <span class="no">educ</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">educ</span>^<span class="fl">2</span>) +
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">marr</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">nodeg</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">age_m2</span>):<span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">trt</span>) - <span class="fl">1</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">dft</span>))</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = re78 ~ age + I(age^2) + factor(age_m2) + educ + 
##     I(educ^2) + +factor(race) + factor(marr) + factor(nodeg) + 
##     factor(age_m2):factor(trt) - 1, data = dft)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##  -9281  -4664  -1521   3260  54557 
## 
## Coefficients:
##                                Estimate Std. Error t value Pr(&gt;|t|)  
## age                             73.5664   317.3603   0.232    0.817  
## I(age^2)                        -0.7038     4.7486  -0.148    0.882  
## factor(age_m2)1               8890.8921  6129.7194   1.450    0.147  
## factor(age_m2)2               8237.1456  6661.6040   1.237    0.217  
## educ                         -1137.5178  1025.7038  -1.109    0.268  
## I(educ^2)                       75.1320    56.3181   1.334    0.183  
## factor(race)1                -1782.6432   804.4433  -2.216    0.027 *
## factor(race)2                 -130.3132  1055.7904  -0.123    0.902  
## factor(marr)1                  590.5769   651.5151   0.906    0.365  
## factor(nodeg)1                 139.6452   916.7444   0.152    0.879  
## factor(age_m2)1:factor(trt)1   453.7963   659.7260   0.688    0.492  
## factor(age_m2)2:factor(trt)1  1070.8127   677.9949   1.579    0.115  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6212 on 710 degrees of freedom
## Multiple R-squared:  0.4484, Adjusted R-squared:  0.4391 
## F-statistic:  48.1 on 12 and 710 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="co"># Treatment interactions by marriage status, greater effect for older married + younger married</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">re78</span> ~  <span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">age</span>^<span class="fl">2</span>) + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">age_m2</span>) +
                   <span class="no">educ</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">educ</span>^<span class="fl">2</span>) +
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">marr</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">nodeg</span>)
                  + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">marr</span>):<span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">age_m2</span>):<span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">trt</span>) - <span class="fl">1</span>,
                  <span class="kw">data</span> <span class="kw">=</span> <span class="no">dft</span>))</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = re78 ~ age + I(age^2) + factor(age_m2) + educ + 
##     I(educ^2) + +factor(race) + factor(marr) + factor(nodeg) + 
##     factor(marr):factor(age_m2):factor(trt) - 1, data = dft)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##  -9725  -4576  -1573   3089  54691 
## 
## Coefficients: (3 not defined because of singularities)
##                                              Estimate Std. Error t value
## age                                           37.3770   319.8439   0.117
## I(age^2)                                      -0.2698     4.7852  -0.056
## factor(age_m2)1                            10519.8273  6563.8924   1.603
## factor(age_m2)2                             9557.6915  6655.2092   1.436
## educ                                       -1107.2556  1026.5070  -1.079
## I(educ^2)                                     74.1506    56.3551   1.316
## factor(race)1                              -1732.3553   806.1276  -2.149
## factor(race)2                               -143.3612  1056.8346  -0.136
## factor(marr)1                               1217.5255  1196.2563   1.018
## factor(nodeg)1                               164.2353   918.1533   0.179
## factor(age_m2)1:factor(marr)0:factor(trt)0 -1378.9391  2164.2994  -0.637
## factor(age_m2)2:factor(marr)0:factor(trt)0  -640.4138   785.5838  -0.815
## factor(age_m2)1:factor(marr)1:factor(trt)0 -1595.6462  2363.5262  -0.675
## factor(age_m2)2:factor(marr)1:factor(trt)0 -2339.1547  1346.3197  -1.737
## factor(age_m2)1:factor(marr)0:factor(trt)1 -1029.3096  2177.4284  -0.473
## factor(age_m2)2:factor(marr)0:factor(trt)1         NA         NA      NA
## factor(age_m2)1:factor(marr)1:factor(trt)1         NA         NA      NA
## factor(age_m2)2:factor(marr)1:factor(trt)1         NA         NA      NA
##                                            Pr(&gt;|t|)  
## age                                          0.9070  
## I(age^2)                                     0.9551  
## factor(age_m2)1                              0.1095  
## factor(age_m2)2                              0.1514  
## educ                                         0.2811  
## I(educ^2)                                    0.1887  
## factor(race)1                                0.0320 *
## factor(race)2                                0.8921  
## factor(marr)1                                0.3091  
## factor(nodeg)1                               0.8581  
## factor(age_m2)1:factor(marr)0:factor(trt)0   0.5242  
## factor(age_m2)2:factor(marr)0:factor(trt)0   0.4152  
## factor(age_m2)1:factor(marr)1:factor(trt)0   0.4998  
## factor(age_m2)2:factor(marr)1:factor(trt)0   0.0827 .
## factor(age_m2)1:factor(marr)0:factor(trt)1   0.6366  
## factor(age_m2)2:factor(marr)0:factor(trt)1       NA  
## factor(age_m2)1:factor(marr)1:factor(trt)1       NA  
## factor(age_m2)2:factor(marr)1:factor(trt)1       NA  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6215 on 707 degrees of freedom
## Multiple R-squared:  0.4502, Adjusted R-squared:  0.4386 
## F-statistic:  38.6 on 15 and 707 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="regress-wage-on-training-status" class="section level3">
<h3 class="hasAnchor">
<a href="#regress-wage-on-training-status" class="anchor"></a>Regress Wage on Training Status</h3>
<div id="linear-binary-problem" class="section level4">
<h4 class="hasAnchor">
<a href="#linear-binary-problem" class="anchor"></a>Linear Binary Problem</h4>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="co"># Store Regression Results</span>
<span class="no">mt_model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>( ~ <span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">age</span>^<span class="fl">2</span>) + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">age_m2</span>) +
                            <span class="no">educ</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">educ</span>^<span class="fl">2</span>) +
                          + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>)
                          + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">marr</span>)
                          + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">nodeg</span>)
                          + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">age_m2</span>):<span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">trt</span>),
                          <span class="kw">data</span> <span class="kw">=</span> <span class="no">dft</span>)
<span class="no">rs_wage_on_trt</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">re78</span> ~ <span class="no">mt_model</span> - <span class="fl">1</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">dft</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">rs_wage_on_trt</span>))</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = re78 ~ mt_model - 1, data = dft)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##  -9281  -4664  -1521   3260  54557 
## 
## Coefficients:
##                                        Estimate Std. Error t value Pr(&gt;|t|)  
## mt_model(Intercept)                   8890.8921  6129.7194   1.450    0.147  
## mt_modelage                             73.5664   317.3603   0.232    0.817  
## mt_modelI(age^2)                        -0.7038     4.7486  -0.148    0.882  
## mt_modelfactor(age_m2)2               -653.7465  1032.5521  -0.633    0.527  
## mt_modeleduc                         -1137.5178  1025.7038  -1.109    0.268  
## mt_modelI(educ^2)                       75.1320    56.3181   1.334    0.183  
## mt_modelfactor(race)1                -1782.6432   804.4433  -2.216    0.027 *
## mt_modelfactor(race)2                 -130.3132  1055.7904  -0.123    0.902  
## mt_modelfactor(marr)1                  590.5769   651.5151   0.906    0.365  
## mt_modelfactor(nodeg)1                 139.6452   916.7444   0.152    0.879  
## mt_modelfactor(age_m2)1:factor(trt)1   453.7963   659.7260   0.688    0.492  
## mt_modelfactor(age_m2)2:factor(trt)1  1070.8127   677.9949   1.579    0.115  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6212 on 710 degrees of freedom
## Multiple R-squared:  0.4484, Adjusted R-squared:  0.4391 
## F-statistic:  48.1 on 12 and 710 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="no">rs_wage_on_trt_tidy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/broom/man/reexports.html">tidy</a></span>(<span class="no">rs_wage_on_trt</span>)
<span class="no">rs_wage_on_trt_tidy</span></pre></body></html></div>
<pre><code>## # A tibble: 12 x 5
##    term                                  estimate std.error statistic p.value
##    &lt;chr&gt;                                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1 mt_model(Intercept)                   8891.      6130.       1.45   0.147 
##  2 mt_modelage                             73.6      317.       0.232  0.817 
##  3 mt_modelI(age^2)                        -0.704      4.75    -0.148  0.882 
##  4 mt_modelfactor(age_m2)2               -654.      1033.      -0.633  0.527 
##  5 mt_modeleduc                         -1138.      1026.      -1.11   0.268 
##  6 mt_modelI(educ^2)                       75.1       56.3      1.33   0.183 
##  7 mt_modelfactor(race)1                -1783.       804.      -2.22   0.0270
##  8 mt_modelfactor(race)2                 -130.      1056.      -0.123  0.902 
##  9 mt_modelfactor(marr)1                  591.       652.       0.906  0.365 
## 10 mt_modelfactor(nodeg)1                 140.       917.       0.152  0.879 
## 11 mt_modelfactor(age_m2)1:factor(trt)1   454.       660.       0.688  0.492 
## 12 mt_modelfactor(age_m2)2:factor(trt)1  1071.       678.       1.58   0.115</code></pre>
</div>
</div>
<div id="construct-input-arrays-a_i-and-alpha_i" class="section level3">
<h3 class="hasAnchor">
<a href="#construct-input-arrays-a_i-and-alpha_i" class="anchor"></a>Construct Input Arrays <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span>
</h3>
<div id="linear-binary-regression" class="section level4">
<h4 class="hasAnchor">
<a href="#linear-binary-regression" class="anchor"></a>Linear Binary Regression</h4>
<p>Multiply coefficient vector by covariate matrix to generate <em>A</em> vector that is child/individual specific.</p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="co"># Estimates Table</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">rs_wage_on_trt_tidy</span>, <span class="fl">6</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 5
##   term                     estimate std.error statistic p.value
##   &lt;chr&gt;                       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 mt_model(Intercept)      8891.      6130.       1.45    0.147
## 2 mt_modelage                73.6      317.       0.232   0.817
## 3 mt_modelI(age^2)           -0.704      4.75    -0.148   0.882
## 4 mt_modelfactor(age_m2)2  -654.      1033.      -0.633   0.527
## 5 mt_modeleduc            -1138.      1026.      -1.11    0.268
## 6 mt_modelI(educ^2)          75.1       56.3      1.33    0.183</code></pre>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="co"># Covariates</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">mt_model</span>, <span class="fl">5</span>)</pre></body></html></div>
<pre><code>##   (Intercept) age I(age^2) factor(age_m2)2 educ I(educ^2) factor(race)1
## 1           1  23      529               0   10       100             1
## 2           1  26      676               1   12       144             0
## 3           1  22      484               0    9        81             1
## 4           1  34     1156               1    9        81             1
## 5           1  18      324               0    9        81             1
##   factor(race)2 factor(marr)1 factor(nodeg)1 factor(age_m2)1:factor(trt)1
## 1             0             0              1                            0
## 2             0             0              0                            0
## 3             0             0              1                            0
## 4             0             0              1                            0
## 5             0             0              1                            0
##   factor(age_m2)2:factor(trt)1
## 1                            0
## 2                            0
## 3                            0
## 4                            0
## 5                            0</code></pre>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="co"># Covariates coefficients from regression (including constant)</span>
<span class="no">ar_fl_cova_esti</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">rs_wage_on_trt_tidy</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(!<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span>(<span class="no">term</span>, <span class="st">'trt'</span>)) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">estimate</span>))
<span class="no">ar_fl_main_esti</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">rs_wage_on_trt_tidy</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span>(<span class="no">term</span>, <span class="st">'trt'</span>)) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">estimate</span>))
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ar_fl_cova_esti</span>, <span class="fl">5</span>)</pre></body></html></div>
<pre><code>##           estimate
## [1,]  8890.8920639
## [2,]    73.5663594
## [3,]    -0.7038167
## [4,]  -653.7464536
## [5,] -1137.5178067</code></pre>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ar_fl_main_esti</span>, <span class="fl">5</span>)</pre></body></html></div>
<pre><code>##       estimate
## [1,]  453.7963
## [2,] 1070.8127</code></pre>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="co"># Select Matrix subcomponents</span>
<span class="no">mt_cova</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="no">mt_model</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"trt"</span>)))
<span class="no">mt_intr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">marr</span>) - <span class="fl">1</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">dft</span>)

<span class="co"># Generate A_i, use mt_cova_wth_const</span>
<span class="no">ar_A_m</span> <span class="kw">&lt;-</span> <span class="no">mt_cova</span> <span class="kw">%*%</span> <span class="no">ar_fl_cova_esti</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ar_A_m</span>, <span class="fl">5</span>)</pre></body></html></div>
<pre><code>##      estimate
## [1,] 4705.623
## [2,] 6842.885
## [3,] 4373.738
## [4,] 4129.823
## [5,] 4192.084</code></pre>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="co"># Generate alpha_i</span>
<span class="no">ar_alpha_m</span> <span class="kw">&lt;-</span> <span class="no">mt_intr</span> <span class="kw">%*%</span> <span class="no">ar_fl_main_esti</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ar_alpha_m</span>, <span class="fl">5</span>)</pre></body></html></div>
<pre><code>##   estimate
## 1 453.7963
## 2 453.7963
## 3 453.7963
## 4 453.7963
## 5 453.7963</code></pre>
</div>
</div>
<div id="individual-weight" class="section level3">
<h3 class="hasAnchor">
<a href="#individual-weight" class="anchor"></a>Individual Weight</h3>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="co"># Child Weight</span>
<span class="no">ar_beta_m</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>/<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">ar_A_m</span>), <span class="kw">times</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">ar_A_m</span>))</pre></body></html></div>
</div>
<div id="matrix-with-required-inputs-for-allocation" class="section level3">
<h3 class="hasAnchor">
<a href="#matrix-with-required-inputs-for-allocation" class="anchor"></a>Matrix with Required Inputs for Allocation</h3>
<div id="linear-binary-matrix" class="section level4">
<h4 class="hasAnchor">
<a href="#linear-binary-matrix" class="anchor"></a>Linear Binary Matrix</h4>
<div class="sourceCode" id="cb54"><html><body><pre class="r"><span class="co"># Initate Dataframe that will store all estimates and optimal allocation relevant information</span>
<span class="co"># combine identifying key information along with estimation A, alpha results</span>
<span class="co"># note that we only need indi.id as key</span>
<span class="no">mt_opti</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">ar_alpha_m</span>, <span class="no">ar_A_m</span>, <span class="no">ar_beta_m</span>)
<span class="no">ar_st_varnames</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'alpha'</span>, <span class="st">'A'</span>, <span class="st">'beta'</span>)
<span class="no">df_esti_alpha_A_beta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="no">mt_opti</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">rename_all</a></span>(~<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">ar_st_varnames</span>))</pre></body></html></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb56"><html><body><pre class="r"><span class="no">tb_key_alpha_A_beta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="no">dft</span>, <span class="no">df_esti_alpha_A_beta</span>) <span class="kw">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">one_of</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'id'</span>, <span class="st">'trt'</span>, <span class="st">'age'</span>, <span class="st">'educ'</span>, <span class="st">'race'</span>, <span class="st">'marr'</span>, <span class="st">'nodeg'</span>, <span class="st">'re78'</span>,
                              <span class="no">ar_st_varnames</span>)))

<span class="co"># Rescale A and alpha to deal more easily with large powers</span>
<span class="no">tb_key_alpha_A_beta</span> <span class="kw">&lt;-</span> <span class="no">tb_key_alpha_A_beta</span> <span class="kw">%&gt;%</span>
                          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">alpha</span> <span class="kw">=</span> <span class="no">alpha</span>/<span class="fl">1000</span>, <span class="kw">A</span> <span class="kw">=</span> <span class="no">A</span>/<span class="fl">1000</span>)

<span class="co"># Need to only include the smokers here</span>
<span class="co"># tb_key_alpha_A_beta &lt;- tb_key_alpha_A_beta %&gt;% filter(trt == 0)</span>

<span class="co"># Unique beta, A, and alpha check</span>
<span class="no">tb_opti_unique</span> <span class="kw">&lt;-</span> <span class="no">tb_key_alpha_A_beta</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(!!!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval.html">syms</a></span>(<span class="no">ar_st_varnames</span>)) <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(!!!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval.html">syms</a></span>(<span class="no">ar_st_varnames</span>)) <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="kw">n_obs_group</span><span class="kw">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/n.html">n</a></span>())

<span class="co"># Show cars</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">tb_key_alpha_A_beta</span>, <span class="fl">32</span>)</pre></body></html></div>
<pre><code>##    id trt age educ race marr nodeg      re78     alpha        A        beta
## 1   1   0  23   10    1    0     1     0.000 0.4537963 4.705623 0.001385042
## 2   2   0  26   12    0    0     0 12383.680 0.4537963 6.842885 0.001385042
## 3   3   0  22    9    1    0     1     0.000 0.4537963 4.373738 0.001385042
## 4   4   0  34    9    1    0     1 14051.160 0.4537963 4.129823 0.001385042
## 5   5   0  18    9    1    0     1 10740.080 0.4537963 4.192084 0.001385042
## 6   6   0  45   11    1    0     1 11796.470 0.4537963 5.057681 0.001385042
## 7   7   0  18    9    1    0     1  9227.052 0.4537963 4.192084 0.001385042
## 8   8   0  27   12    1    0     0  3552.268 0.4537963 5.096506 0.001385042
## 9   9   0  24    8    0    0     1 10569.270 0.4537963 5.445291 0.001385042
## 10 10   0  34   11    1    1     1  6040.335 1.0708127 5.450645 0.001385042
## 11 11   0  20   13    1    0     0  9199.563 0.4537963 6.207626 0.001385042
## 12 12   0  24    4    2    0     1  3880.833 0.4537963 6.258713 0.001385042
## 13 13   0  36   10    1    0     1     0.000 0.4537963 4.468412 0.001385042
## 14 14   0  21   10    1    0     1     0.000 0.4537963 4.620426 0.001385042
## 15 15   0  28   12    1    1     0 10067.430 1.0708127 5.721940 0.001385042
## 16 16   0  21   14    1    0     0  5775.062 0.4537963 7.143382 0.001385042
## 17 17   0  28    9    1    0     1     0.000 0.4537963 3.950245 0.001385042
## 18 18   0  21   11    1    1     1  8976.826 1.0708127 5.651258 0.001385042
## 19 19   0  27    7    1    1     1     0.000 1.0708127 4.376777 0.001385042
## 20 20   0  18   12    0    0     0  2502.526 0.4537963 7.155844 0.001385042
## 21 21   0  19   11    0    0     1     0.000 0.4537963 6.752496 0.001385042
## 22 22   0  30   13    1    0     0     0.000 0.4537963 5.937635 0.001385042
## 23 23   0  26   11    2    0     1     0.000 0.4537963 6.261699 0.001385042
## 24 24   0  20    8    1    0     1     0.000 0.4537963 4.146000 0.001385042
## 25 25   0  31    4    0    0     1     0.000 0.4537963 6.633021 0.001385042
## 26 26   0  18   12    1    0     0 14444.710 0.4537963 5.373201 0.001385042
## 27 27   0  34   12    1    0     0  2113.722 0.4537963 5.310941 0.001385042
## 28 28   0  24   10    1    0     1  7618.639 0.4537963 4.092364 0.001385042
## 29 29   0  22    8    2    0     1  9920.945 0.4537963 5.886342 0.001385042
## 30 30   0  28    8    1    0     1  4623.188 0.4537963 3.810519 0.001385042
## 31 31   0  25   11    1    0     1  4196.375 0.4537963 4.571697 0.001385042
## 32 32   0  39    9    1    0     1     0.000 0.4537963 4.240762 0.001385042</code></pre>
</div>
</div>
</div>
<div id="optimal-linear-allocations" class="section level2">
<h2 class="hasAnchor">
<a href="#optimal-linear-allocations" class="anchor"></a>Optimal Linear Allocations</h2>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="no">svr_inpalc</span> <span class="kw">&lt;-</span> <span class="st">'opti_alloc_queue'</span>

<span class="co"># Child Count</span>
<span class="no">it_obs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">tb_opti_unique</span>)[<span class="fl">1</span>]

<span class="co"># Vector of Planner Preference</span>
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">100</span>, <span class="fl">0.8</span>)
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">50</span>, -<span class="fl">25</span>, -<span class="fl">10</span>)
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">100</span>, -<span class="fl">5</span>, -<span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)
<span class="co"># ar_rho &lt;- c(seq(-200, -100, length.out=5), seq(-100, -25, length.out=5), seq(-25, -5, length.out=5), seq(-5, -1, length.out=5), seq(-1, -0.01, length.out=5), seq(0.01, 0.25, length.out=5), seq(0.25, 0.90, length.out=5))</span>
<span class="co"># ar_rho &lt;- c(-100, -5, -1, 0.1, 0.6, 0.99)</span>
<span class="co"># ar_rho &lt;- c(-20, -1, 0.05, 0.9)</span>
<span class="co"># ar_rho &lt;- c(-50, -40, -30, -20, -15, -10, -7.5, -5,-3,-2,-1)</span>
<span class="co"># ar_rho = c(-100, -0.001,  0.95)</span>
<span class="no">ar_rho</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">100</span>, -<span class="fl">0.001</span>,  <span class="fl">0.95</span>)
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">200</span>, -<span class="fl">100</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">5</span>), <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">100</span>, -<span class="fl">25</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">5</span>), <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">25</span>, -<span class="fl">5</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">5</span>), <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">5</span>, -<span class="fl">1</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">5</span>), <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">1</span>, -<span class="fl">0.01</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">5</span>), <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.01</span>, <span class="fl">0.25</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">5</span>), <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0.25</span>, <span class="fl">0.90</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">5</span>))
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - (<span class="fl">10</span>^(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">2</span>,<span class="fl">2</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">30</span>))))
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">ar_rho</span>)

<span class="no">svr_rho_val</span> <span class="kw">&lt;-</span> <span class="st">'rho_val'</span>
<span class="no">ls_bin_solu_all_rhos</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_bin.html">ffp_opt_anlyz_rhgin_bin</a></span>(<span class="no">tb_key_alpha_A_beta</span>,
                          <span class="kw">svr_id_i</span> <span class="kw">=</span> <span class="st">'id'</span>,
                          <span class="kw">svr_A_i</span> <span class="kw">=</span> <span class="st">'A'</span>, <span class="kw">svr_alpha_i</span> <span class="kw">=</span> <span class="st">'alpha'</span>, <span class="kw">svr_beta_i</span> <span class="kw">=</span> <span class="st">'beta'</span>,
                          <span class="kw">ar_rho</span> <span class="kw">=</span> <span class="no">ar_rho</span>,
                          <span class="kw">svr_rho</span> <span class="kw">=</span> <span class="st">'rho'</span>, <span class="kw">svr_rho_val</span> <span class="kw">=</span> <span class="no">svr_rho_val</span>,
                          <span class="kw">svr_inpalc</span> <span class="kw">=</span> <span class="no">svr_inpalc</span>,
                          <span class="kw">svr_expout</span> <span class="kw">=</span> <span class="st">'opti_exp_outcome'</span>)</pre></body></html></div>
<pre><code>## Joining, by = "id"</code></pre>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="no">df_all_rho</span> <span class="kw">&lt;-</span> <span class="no">ls_bin_solu_all_rhos</span>$<span class="no">df_all_rho</span>
<span class="no">df_all_rho_long</span> <span class="kw">&lt;-</span> <span class="no">ls_bin_solu_all_rhos</span>$<span class="no">df_all_rho_long</span>

<span class="co"># How many people have different ranks across rhos</span>
<span class="no">it_how_many_vary_rank</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">df_all_rho</span>$<span class="no">rank_max</span> - <span class="no">df_all_rho</span>$<span class="no">rank_min</span>)
<span class="no">it_how_many_vary_rank</span></pre></body></html></div>
<pre><code>## [1] -98120</code></pre>
<div id="save-results" class="section level3">
<h3 class="hasAnchor">
<a href="#save-results" class="anchor"></a>Save Results</h3>
<div class="sourceCode" id="cb62"><html><body><pre class="r"><span class="co"># Change Variable names so that this can becombined with logit file later</span>
<span class="no">df_all_rho</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">rename_at</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"rho_"</span>)), <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span>(<span class="no">.</span>, <span class="st">"rk"</span>, <span class="st">"rk_wage"</span>)))
<span class="no">df_all_rho</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="kw">A_i_wage</span> <span class="kw">=</span> <span class="no">A</span>, <span class="kw">alpha_i_wage</span> <span class="kw">=</span> <span class="no">alpha</span>, <span class="kw">beta_i_wage</span> <span class="kw">=</span> <span class="no">beta</span>,
                                    <span class="kw">rank_min_wage</span> <span class="kw">=</span> <span class="no">rank_min</span>, <span class="kw">rank_max_wage</span> <span class="kw">=</span> <span class="no">rank_max</span>, <span class="kw">avg_rank_wage</span> <span class="kw">=</span> <span class="no">avg_rank</span>)

<span class="co"># Save File</span>
<span class="kw">if</span> (<span class="no">bl_save_rda</span>) {
  <span class="no">df_opt_lalonde_training_wage</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho</span>
  <span class="kw pkg">usethis</span><span class="kw ns">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span>(<span class="no">df_opt_lalonde_training_wage</span>, <span class="no">df_opt_lalonde_training_wage</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
}</pre></body></html></div>
</div>
<div id="change-in-rank-along-rho" class="section level3">
<h3 class="hasAnchor">
<a href="#change-in-rank-along-rho" class="anchor"></a>Change in Rank along rho</h3>
<div class="sourceCode" id="cb63"><html><body><pre class="r"><span class="co"># get rank when wage rho = 1</span>
<span class="no">df_all_rho_rho_c1</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>, <span class="no">rho_c1_rk_wage</span>)

<span class="co"># Merge</span>
<span class="no">df_all_rho_long</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho_long</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rho</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">rho</span>)) <span class="kw">%&gt;%</span>
                      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(<span class="no">df_all_rho_rho_c1</span>, <span class="kw">by</span><span class="kw">=</span><span class="st">'id'</span>)

<span class="co"># Select subset to graph</span>
<span class="no">df_rank_graph</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho_long</span> <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">id</span>)) <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>((<span class="no">id</span> <span class="kw">==</span> <span class="fl">200</span>) <span class="kw">|</span>  <span class="co"># utilitarian rank = 1</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">110</span>) <span class="kw">|</span>  <span class="co"># utilitarian rank = 101</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">95</span>)  <span class="kw">|</span>  <span class="co"># utilitarian rank = 201</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">217</span>) <span class="kw">|</span>  <span class="co"># utilitarian rank = 301</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">2741</span>)<span class="kw">|</span>  <span class="co"># utilitarian rank = 401</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">101</span>) <span class="kw">|</span>  <span class="co"># utilitarian rank = 501</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">131</span>) <span class="kw">|</span>  <span class="co"># utilitarian rank = 601</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">3610</span>)   <span class="co"># utilitarian rank = 701</span>
                             ) <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">one_minus_rho</span> <span class="kw">=</span> <span class="fl">1</span> - !!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval.html">sym</a></span>(<span class="no">svr_rho_val</span>)) <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rho_c1_rk_wage</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">rho_c1_rk_wage</span>))

<span class="no">df_rank_graph</span>$<span class="no">rho_c1_rk_wage</span></pre></body></html></div>
<pre><code>##   [1] 198 198 198 198 198 198 198 198 198 198 198 198 198 198 198 198 198 198
##  [19] 198 198 198 198 198 198 198 198 198 198 198 198 500 500 500 500 500 500
##  [37] 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500
##  [55] 500 500 500 500 500 500 101 101 101 101 101 101 101 101 101 101 101 101
##  [73] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
##  [91] 599 599 599 599 599 599 599 599 599 599 599 599 599 599 599 599 599 599
## [109] 599 599 599 599 599 599 599 599 599 599 599 599 1   1   1   1   1   1  
## [127] 1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1  
## [145] 1   1   1   1   1   1   301 301 301 301 301 301 301 301 301 301 301 301
## [163] 301 301 301 301 301 301 301 301 301 301 301 301 301 301 301 301 301 301
## [181] 701 701 701 701 701 701 701 701 701 701 701 701 701 701 701 701 701 701
## [199] 701 701 701 701 701 701 701 701 701 701 701 701 407 407 407 407 407 407
## [217] 407 407 407 407 407 407 407 407 407 407 407 407 407 407 407 407 407 407
## [235] 407 407 407 407 407 407
## Levels: 1 101 198 301 407 500 599 701</code></pre>
<div class="sourceCode" id="cb65"><html><body><pre class="r"><span class="no">df_rank_graph</span>$<span class="no">id</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">df_rank_graph</span>$<span class="no">rho_c1_rk_wage</span>,
                           <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Rank= 1 when &lt;U+03BB&gt;=0.99'</span>, <span class="co">#200</span>
                                      <span class="st">'Rank= 101 when &lt;U+03BB&gt;=0.99'</span>, <span class="co">#110</span>
                                      <span class="st">'Rank= 201 when &lt;U+03BB&gt;=0.99'</span>, <span class="co">#95</span>
                                      <span class="st">'Rank= 301 when &lt;U+03BB&gt;=0.99'</span>, <span class="co">#217</span>
                                      <span class="st">'Rank= 401 when &lt;U+03BB&gt;=0.99'</span>, <span class="co">#274</span>
                                      <span class="st">'Rank= 501 when &lt;U+03BB&gt;=0.99'</span>, <span class="co">#101</span>
                                      <span class="st">'Rank= 601 when &lt;U+03BB&gt;=0.99'</span>, <span class="co">#131</span>
                                      <span class="st">'Rank= 701 when &lt;U+03BB&gt;=0.99'</span> <span class="co">#3610</span>
                                       ))

<span class="co"># x-labels</span>
<span class="no">x.labels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'&lt;U+03BB&gt;=0.99'</span>, <span class="st">'&lt;U+03BB&gt;=0.90'</span>, <span class="st">'&lt;U+03BB&gt;=0'</span>, <span class="st">'&lt;U+03BB&gt;=-10'</span>, <span class="st">'&lt;U+03BB&gt;=-100'</span>)
<span class="no">x.breaks</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.01</span>, <span class="fl">0.10</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">100</span>)

<span class="co"># title line 2</span>
<span class="no">title_line1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"LINEAR WAGE: Optimal Tageting Queue, NSW Lalonde (AER, 1986)"</span>)
<span class="no">title_line2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"How Do Allocation Rankings (Targeting Queue) Shift with &lt;U+03BB&gt;?"</span>)

<span class="co"># Graph Results--Draw</span>
<span class="no">line.plot</span> <span class="kw">&lt;-</span> <span class="no">df_rank_graph</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">one_minus_rho</span>, <span class="kw">y</span><span class="kw">=</span>!!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval.html">sym</a></span>(<span class="no">svr_inpalc</span>),
             <span class="kw">group</span><span class="kw">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span>(<span class="no">id</span>),
             <span class="kw">colour</span><span class="kw">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span>(<span class="no">id</span>),
             <span class="kw">size</span><span class="kw">=</span><span class="fl">2</span>)) +
  <span class="co"># geom_line(aes(linetype =fct_rev(id)), size=0.75) +</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">0.75</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="kw">xintercept</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>), <span class="kw">linetype</span><span class="kw">=</span><span class="st">"dotted"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">title_line1</span>, <span class="st">'\n'</span>, <span class="no">title_line2</span>),
       <span class="kw">x</span> <span class="kw">=</span> <span class="st">'log10 Rescale of &lt;U+03BB&gt;, Log10(&lt;U+03BB&gt;)\n&lt;U+03BB&gt;=1 Utilitarian, &lt;U+03BB&gt;=-infty Rawlsian'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Optimal Targeting Queue Rank (1=highest)'</span>,
       <span class="kw">caption</span> <span class="kw">=</span> <span class="st">'Training RCT with 297 treated, 425 untreated. Optimal Binary Targeting Queue.'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">trans</span><span class="kw">=</span><span class="st">'log10'</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="no">x.labels</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="no">x.breaks</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">line.plot</span>)</pre></body></html></div>
<p><img src="ffv_opt_sobin_rkone_allrw_training_wage_files/figure-html/graph%20of%20rank%20change-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="bump-plot-for-optimal-binary-allocations" class="section level3">
<h3 class="hasAnchor">
<a href="#bump-plot-for-optimal-binary-allocations" class="anchor"></a>Bump Plot for Optimal Binary Allocations</h3>
<div class="sourceCode" id="cb66"><html><body><pre class="r"># tb_opti_alloc_all_rho_long %&gt;%
#   ggplot(aes(x = rho, y = rank, group = id)) +
#     geom_line(aes(color = race, alpha = 1), size = 2) +
#     geom_point(aes(color = race, alpha = 1), size = 4) +
#     scale_x_discrete(expand = c(0.85,0))+
#     scale_y_reverse(breaks = 1:nrow(tb_opti_alloc_all_rho_long))+
#     theme(legend.position = "none") +
#     labs(x = "Equality vs Efficiency",
#          y = "Rank",
#          title = "Binary Allocation Rank, which untrained to receive training first") +
#     ffy_opt_ghthm_dk() +
#     geom_text(data =tb_opti_alloc_all_rho,aes(y=rho_c1_rk,x=0.6,label=id),hjust="right")</pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://fanwangecon.github.io">Fan Wang</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
