<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to The Optimal Allocation Problem • Optimal Allocation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to The Optimal Allocation Problem">
<meta property="og:description" content="Get started with Project Optimal Allocation.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Optimal Allocation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/PrjOptiAlloc.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue.pdf">Paper</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue_Present.pdf">Slides</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Sites
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://fanwangecon.github.io/REconTools/">R Tools for Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/R4Econ/">R Examples Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stat4Econ/">R Examples Introductory Statistics</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stata4Econ/">Stata Examples Regressions and Tables</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/M4Econ/">Matlab Examples Matrix and Graphs</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Math4Econ/">Matlab Introductory Math for Econ</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Tex4Econ/">Latex and Paper Generation Examples</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/pyfan/">Python Examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://fanwangecon.github.io/">Fan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fanwangecon/PrjOptiAlloc">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fanwangecon">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="PrjOptiAlloc_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to The Optimal Allocation Problem</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/master/vignettes/PrjOptiAlloc.Rmd"><code>vignettes/PrjOptiAlloc.Rmd</code></a></small>
      <div class="hidden name"><code>PrjOptiAlloc.Rmd</code></div>

    </div>

    
    
<div id="premise" class="section level2">
<h2 class="hasAnchor">
<a href="#premise" class="anchor"></a>Premise</h2>
<p>Suppose there is an intervention scale-up for a nutritional intervention. Prior, an RCT showed that a nutritional intervention where children were provided with <a href="https://doi.org/10.1016/j.ehb.2016.03.002">bottles of proteins</a> effectively increased height.</p>
<p>Suppose an organization, such as the <a href="https://www.wfpusa.org/">World Food Program</a> (WFP), is interested in distributing food aid to reduce stunting. <a href="http://www.fao.org/state-of-food-security-nutrition">150 million</a> children under five years of age are stunted, but resources are limited. Given prior research, how should the WFP best allocate its limited resources?</p>
</div>
<div id="planner-preferences" class="section level2">
<h2 class="hasAnchor">
<a href="#planner-preferences" class="anchor"></a>Planner Preferences</h2>
<p>What is optimal might depend on the preferences of the planner? I use <em>CES preference aggregation</em> to allow for inequality aversions as well as bias:</p>
<ol style="list-style-type: decimal">
<li>What is the WFP’s <em>Inequality Aversion</em>?
<ul>
<li>Trying to increase average height? (or reduce average stunting probability)</li>
<li>Trying to increase height for those who are suffering from stunting the most?</li>
<li>Or trying to improve both average outcomes and outcomes for the worst?</li>
</ul>
</li>
<li>Does the WFP have a current <em>bias</em>?
<ul>
<li>The WFP might be for the next year, focused on improving outcomes for girls: bias for girls over boys.</li>
<li>The WFP might be focused on improving conditions in a set of countries for the next year: bias for individuals from these countries.</li>
</ul>
</li>
<li>What is the <em>expected outcome</em> of interest?
<ul>
<li>Is height increase the objective?</li>
<li>Is increasing height above the stunting threshold the objective?</li>
<li>Are improving both wasting (low weight) and stunting jointly the objective?</li>
</ul>
</li>
</ol>
</div>
<div id="heterogeneities-among-candidate-recipients" class="section level2">
<h2 class="hasAnchor">
<a href="#heterogeneities-among-candidate-recipients" class="anchor"></a>Heterogeneities Among Candidate Recipients</h2>
<p>What is optimal might depend on prior estimates and observables on children? Needs and effectiveness are based on estimates and observables:</p>
<ol style="list-style-type: decimal">
<li>
<em>Needs</em>: From admin and survey data, and using existing estimates, what is the expected level of height at two years of age for a child given the child’s height at birth and parental information.</li>
<li>
<em>Effectiveness</em>: Given prior estimates, and child observables, what is the expected effect of an additional bottle of nutritional supplement on this child’s expected height at two years of age?</li>
<li>
<em>Bounds</em>: What are the upper and lower bounds on how many bottles of protein shakes, or how many grams of protein intakes a child could take at the most or must take at the minimum?</li>
</ol>
</div>
<div id="from-estimation-to-allocation" class="section level2">
<h2 class="hasAnchor">
<a href="#from-estimation-to-allocation" class="anchor"></a>From Estimation to Allocation</h2>
<p>We estimate some causal relationship between individual-specific allocable input <em>V</em> and some outcome of interest <em>EH</em>. Finding causal estimates in reduced form or structural context is the main objective of most empirical papers. Generally, most research ends with finding what inputs/factors/policies matter and how much they matter.</p>
<p>What are the allocative implications of the causal estimates and observables? One way to think about this is that we might want to randomize in order to estimate causal effects, but given our estimates, how should we allocate among heterogeneous individuals the finite resources that we found to be beneficial.</p>
<p>The key tradeoff here is between <em>needs</em> and <em>effectiveness</em>. What is the expected outcome without allocation (needs), and what are the expected effects of allocations <em>effectiveness</em>. These might be heterogeneous among individuals and might not coincide. The optimal allocation problem is computationally very intensive if we are to consider all possible combinations of allocations.</p>
</div>
<div id="optimal-allocation-queues" class="section level2">
<h2 class="hasAnchor">
<a href="#optimal-allocation-queues" class="anchor"></a>Optimal Allocation Queues</h2>
<p>The key concept that makes the solutions possible is the <em>Optimal Allocation Queue</em>. In both discrete and bounded-continuous (linear) cases, we can analytically solve for the optimal ranking in which individuals should begin and stop to receive allocations. These rankings, crucially, are invariant to resources when the marginal effects of allocations are nonincreasing. Nonincreasing marginal effects lead to resource (income) expansion paths that do not bend backward.</p>
<p>One might think the allocation queue concept is not relevant for the continuous problems, because there, we need to figure out how much to provide to each individual, not just who should receive first or second. But it turns out that for the bounded-continuous problem, the solution is to first analytically find who should be the first individual to receive allocations. Then, there is an analytical function that maps total resources available to how much this first recipient should optimally receive as total resource availability increases. This function, it turns out, is a linear spline (when marginal returns are linear), and each successive knot of the spline is where the next individual in the optimal targeting queue begins to receive allocations.</p>
<p>For the bounded-continuous problems, in the paper, I only discuss the linear case with constant-returns. When returns are decreasing, there are no analytical solutions. I do provide the solution to the log-linear problem using bisection in this vignette: <a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_solog_bisec_allrw.html">Loglinear Optimal Allocation Implicit Bisection Solution</a></p>
<!--
## 2.3 Brute-Force vs Analytical Solutions

While the brute-force computational problem is infeasible to solve, the analytical solutions are instantaneous to implement even as the number of candidate recipient of allocations increase to large $N$.

How to optimally allocate across individuals is a computationally difficult question to answer because if we want to allocate to $N$ individuals given $W$ units of resource, the choice set grows factorially with each additional individual, and the state space of the problem grows exponentially with each additional individual. How much the planner can allocate to each individual will be a function of the attributes of all other candidate recipients of allocations.

Trying to solve this problem using brute-force comparison of all possible allocations is computational infeasible even with very small $N$. For example, if we have 700 individuals and 200 training spots, the number of possible combinations is $\frac{700!}{(700=200)!200!}$. This number can not be calculated by normal programs, it is significantly large than $10^{308}$, which is the maximum number allowed by double precision.

# 3. Accessible Welfare Analysis

## 3.1 Allocation and Misallocation

With analytical results on what is optimal, we can also compute an interesting welfare measure, which the paper calls REV (resource equivalent variation).

Suppose there are 10 bottles of protein, and 5 kids. If we randomly allocate, 5 kids will get the proteins. There are $\frac{10!}{5!5!}=252$ combinations of allocations. The random allocation is one of these 252 allocations. The optimal allocation is also one of these 252 allocations. The chance that the random allocation is optimal is 1 out of 252.

But how far away is the random allocation away from the optimal? How much resource is wasted by not allocating more optimally?

## 3.2 Resource Equivalent Variation

To address this, we can use expenditure minimization. We can evaluate the utility of the planner given planner preferences at the observed allocations. Then we can solve for how much less resources is needed to achieve the same level of planner utility if we were allocating optimally? This is an analytical object because it is a function of the analytical optimal targeting queue.

For the example here, we had 5 bottles, perhaps the planner have the same utility (given the equality of efficiency objective it has) if only 2 bottles were offered to the top 2 ranked individuals on the targeting queue. REV in this case would be $\frac{5-2}{5}=0.6$. 60 percent of the resource, we can say, is misallocated.

The exciting thing here is that welfare calculation traditionally has been mainly a tool/concept that macro-economists use. The dominant concept is CEV (consumption equivalent variation). REV is applying in some sense a similar idea, but now to wide swaths of reduced form empirical estimation results. As a simple post estimation command, empirical researchers can evaluate the welfare implications of the observables they see given they estimates they find.

## 3.3 From the Utilitarian to the Rawlsian

For the more equality focused planner, the top two ranked could be the two kids who were be expected to be the shortest without the nutrition. For the more efficiency minded planner, the top two ranked could be the two kids for whom additional nutrient have the greatest marginal effects. As we shift along the  preference spectrum from the Utilitarian to the Rawlsian, the rankings of each of the 10 individuals on the optimal targeting queue shift.






Prior Estimates

A NGO program manager needs to determine how to allocate finite resources among a population in need.
Perhaps some will not receive any aid, other will receive positive amounts. Perhaps all will receive positive amounts but still differ in magnitude.

Based on observables and prior empirical causal studies,  -->
<!--

Administrative and other data are gathered for candidate recipients of allocations in many villages for the intervention scale-up. The question is, which child should receive the nutritional

The results developed here are meant for studying allocation problems after empirical causal analysis has been completed.  -->
<!-- ## Premise


Organizations like the WFP have finite resources, and there are potentially many candidate recipients of resources. How should the WFP allocate its limited resources among children?

What is optimal is determined by several factors.

### What Does the Planner Want?

In terms of the **Planner**:

1. What is the WFP's **Inequality Aversion**?
    + Trying to increase average height? (or reduce average stunting probability)
    + Trying to increase height for those who are suffering from stunting the most?
    + Or Trying to improve both average outcomes and outcomes for the worst?
2. Does the WFP have a current **bias**?
    + The WFP might be for the next year, focused on improving outcomes for girls, that is a bias for girls over boys
    + The WFP might be focused on improving conditions in a set of countries for the next year, that is bias for individuals from these countries.
3. What is the **expected outcome** of interest?
    + Is height increase the objective?
    + Is increasing height above stunting threshold the objective?
    + Are improving both wasting (low weight) and stunting jointly the objective?

### How Do Candidate Recipients Differ?

There could be 50,000 children who are between age 0 and 2 in a particular area. All of these children (and their households) could be candidate recipients of allocations. From administrative data, or a survey conducted by the WFP, we have some information available possibly about these candidate recipients.

For each child candidate recipient of allocation, given prior empirical estimates and the child's observables:

1. What is the expected level of height at two years of age for a child  -->
<!--
### What Matters

Suppose we learn from an empirical [paper](https://doi.org/10.1016/j.ehb.2016.03.002) based on a nutritional intervention that protein rather than non-protein components of calorie impacts height and weight in early childhood. As an empirical paper that studies causal linkages, we learn from this paper *what matters*, *how much it matters*, and possibly *how effects differ among children with different observables*.

Program managers at organizations like the [World Food Program](https://www.wfpusa.org/) might find these results useful: given their limited resources, they might be able to focus more on protein components of calorie rather than non-protein components of total calorie in their aid programs.

Similarly, we could find from a set of [school production function estimation](https://doi.org/10.1016/B978-0-12-815391-8.00013-6) exercises that certain inputs are more effective than others. Given these knowledge, school administrators might be able to spend their limited resources more effectively.

### Allocating What Matters

This paper/project assumes that we have learned from prior empirical work: *what matters*, *how much it matters*, and possibly *how effects differ among children with different observables*.

This paper asks, given  -->
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://fanwangecon.github.io">Fan Wang</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
