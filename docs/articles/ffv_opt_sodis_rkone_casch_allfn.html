<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Function Test Discrete Allocation with Linear Regression • Optimal Allocation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Function Test Discrete Allocation with Linear Regression">
<meta property="og:description" content="Test binary optimal allocation solution function from package.
Use the California student test score dataset, same as line by line.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Optimal Allocation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Papers
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3839890" class="external-link">Optimal Allocations to Heterogeneous Agents with An Application to Stimulus Checks</a>
    </li>
    <li>
      <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3691091" class="external-link">Optimal Allocation of the COVID-19 Stimulus Checks</a>
    </li>
    <li>
      <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3547706" class="external-link">The Optimal Allocation of Resources among Heterogeneous Individuals</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Sites
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://fanwangecon.github.io/REconTools/" class="external-link">R Tools for Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/R4Econ/" class="external-link">R Examples Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stat4Econ/" class="external-link">R Examples Introductory Statistics</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stata4Econ/" class="external-link">Stata Examples Regressions and Tables</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/M4Econ/" class="external-link">Matlab Examples Matrix and Graphs</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Math4Econ/" class="external-link">Matlab Introductory Math for Econ</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Tex4Econ/" class="external-link">Latex and Paper Generation Examples</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/pyfan/" class="external-link">Python Examples</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fanwangecon/PrjOptiAlloc" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fanwangecon" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Function Test Discrete Allocation with Linear Regression</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/HEAD/vignettes/ffv_opt_sodis_rkone_casch_allfn.Rmd" class="external-link"><code>vignettes/ffv_opt_sodis_rkone_casch_allfn.Rmd</code></a></small>
      <div class="hidden name"><code>ffv_opt_sodis_rkone_casch_allfn.Rmd</code></div>

    </div>

    
    
<p>Test discrete optimal allocation solution line by line without function. Use the California student test score dataset. Regress student English and Math test scores on Student-Teacher-Ratio.</p>
<p>This function produces the same results as <a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_sodis_rkone_casch_allrw.html">DISCRETE–Discrete Optimal Allocation California Teacher Student Ratio (Line by Line)</a>. The differences are:</p>
<ol style="list-style-type: decimal">
<li>the program here uses the dataframes created by the line by line file as Inputs</li>
<li>the program here uses functions that are identical to the line by line function, but are saved in the R folder.</li>
</ol>
<p>This file, by invoking functions, is much shorter than the line by line program.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span>all.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>knitr.duplicate.label <span class="op">=</span> <span class="st">'allow'</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fanwangecon.github.io/REconTools/" class="external-link">REconTools</a></span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fanwangecon.github.io/PrjOptiAlloc/">PrjOptiAlloc</a></span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="hand-input-data-example">Hand Input Data Example<a class="anchor" aria-label="anchor" href="#hand-input-data-example"></a>
</h2>
<p>Set Preference Array:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span>, length.out<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ar_rho</span><span class="op">)</span>
<span class="va">it_w_agg</span> <span class="op">&lt;-</span> <span class="fl">5</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">id_i</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>
<span class="va">id_il</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span>
<span class="va">D_max_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span>
<span class="va">D_il</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>

<span class="va">A_il_i1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>
<span class="va">A_il_i2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.7</span>,<span class="fl">2.2</span>,<span class="fl">1.5</span>,<span class="fl">1.1</span><span class="op">)</span>
<span class="va">A_il_i3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.9</span>,<span class="fl">1.8</span>,<span class="fl">1.1</span>,<span class="fl">0.1</span><span class="op">)</span>
<span class="va">A_il</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">A_il_i1</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">A_il_i2</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">A_il_i3</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="va">alpha_il</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="op">-</span><span class="va">A_il_i1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="op">-</span><span class="va">A_il_i2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="op">-</span><span class="va">A_il_i3</span><span class="op">)</span><span class="op">)</span>
<span class="va">beta_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>

<span class="va">df_handinput_input_il</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">id_i</span>, <span class="va">id_il</span>, <span class="va">D_max_i</span>, <span class="va">D_il</span>, <span class="va">A_il</span>, <span class="va">alpha_il</span>, <span class="va">beta_i</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_handinput_input_il</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 9 x 7</span></span>
<span class="co">##    id_i id_il D_max_i  D_il  A_il alpha_il beta_i</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>     1     1       3     1   3      1      0.333</span>
<span class="co">## <span style="color: #BCBCBC;">2</span>     1     2       3     2   2      1      0.333</span>
<span class="co">## <span style="color: #BCBCBC;">3</span>     1     3       3     3   1      1      0.333</span>
<span class="co">## <span style="color: #BCBCBC;">4</span>     2     4       3     1   2.2    0.5    0.333</span>
<span class="co">## <span style="color: #BCBCBC;">5</span>     2     5       3     2   1.5    0.7    0.333</span>
<span class="co">## <span style="color: #BCBCBC;">6</span>     2     6       3     3   1.1    0.4    0.333</span>
<span class="co">## <span style="color: #BCBCBC;">7</span>     3     7       3     1   1.8    0.100  0.333</span>
<span class="co">## <span style="color: #BCBCBC;">8</span>     3     8       3     2   1.1    0.7    0.333</span>
<span class="co">## <span style="color: #BCBCBC;">9</span>     3     9       3     3   0.1    1      0.333</span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ls_df_queue_hand</span> <span class="op">&lt;-</span> <span class="fu">PrjOptiAlloc</span><span class="fu">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span><span class="op">(</span><span class="va">ar_rho</span>, <span class="va">it_w_agg</span>,
                                            bl_df_alloc_il <span class="op">=</span> <span class="cn">TRUE</span>,
                                            bl_return_V <span class="op">=</span> <span class="cn">TRUE</span>,
                                            bl_return_allQ_V <span class="op">=</span> <span class="cn">TRUE</span>,
                                            bl_return_inner_V <span class="op">=</span> <span class="cn">TRUE</span>,
                                            df_input_il <span class="op">=</span> <span class="va">df_handinput_input_il</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Joining, by = "id_il"</span></code></pre>
<pre><code><span class="co">## Adding missing grouping variables: `id_i`</span></code></pre>
<pre><code><span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,</span>
<span class="co">## max-inequality/min-gini=0.5</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,</span>
<span class="co">## max-inequality/min-gini=0.5</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,</span>
<span class="co">## max-inequality/min-gini=0.5</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,</span>
<span class="co">## max-inequality/min-gini=0.5</span></code></pre>
<pre><code><span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has</span>
<span class="co">## only n=3, max-inequality/min-gini=0.5</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has</span>
<span class="co">## only n=3, max-inequality/min-gini=0.5</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has</span>
<span class="co">## only n=3, max-inequality/min-gini=0.5</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has</span>
<span class="co">## only n=3, max-inequality/min-gini=0.5</span></code></pre>
<pre><code><span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(rev)`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(alloc_i_upto_Q)`</span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_queue_il_long</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue_hand</span><span class="op">$</span><span class="va">df_queue_il_long</span>
<span class="va">df_queue_il_wide</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue_hand</span><span class="op">$</span><span class="va">df_queue_il_wide</span>
<span class="va">df_alloc_i_long</span>  <span class="op">&lt;-</span> <span class="va">ls_df_queue_hand</span><span class="op">$</span><span class="va">df_alloc_i_long</span>
<span class="va">df_rho_gini</span>  <span class="op">&lt;-</span> <span class="va">ls_df_queue_hand</span><span class="op">$</span><span class="va">df_rho_gini</span>
<span class="va">df_alloc_il_long</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue_hand</span><span class="op">$</span><span class="va">df_alloc_il_long</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_queue_il_long</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 36 x 11</span></span>
<span class="co">##      rho rho_val  id_i id_il D_max_i  D_il  Q_il D_Wbin_il  V_sum_l V_inner_Q_il</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1   0.99      1     1       3     1     4         1 1.31<span style="color: #949494;">e</span>+ 0     2.41<span style="color: #949494;">e</span>+ 0</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     2   0.785     1     1       3     1     4         1 9.89<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>     1.97<span style="color: #949494;">e</span>+ 0</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3  -<span style="color: #BB0000;">3.64</span>      1     1       3     1     9         0 2.14<span style="color: #949494;">e</span><span style="color: #BB0000;">- 3</span>     4.33<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 -<span style="color: #BB0000;">99</span>         1     1       3     1     9         0 8.30<span style="color: #949494;">e</span><span style="color: #BB0000;">-61</span>     8.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-29</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     1   0.99      1     2       3     2     3         1 9.89<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>     2.08<span style="color: #949494;">e</span>+ 0</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     2   0.785     1     2       3     2     3         1 7.89<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>     1.77<span style="color: #949494;">e</span>+ 0</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     3  -<span style="color: #BB0000;">3.64</span>      1     2       3     2     6         0 6.10<span style="color: #949494;">e</span><span style="color: #BB0000;">- 3</span>     6.42<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     4 -<span style="color: #BB0000;">99</span>         1     2       3     2     7         0 1.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-48</span>     8.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-29</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     1   0.99      1     3       3     3     2         1 6.62<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>     1.76<span style="color: #949494;">e</span>+ 0</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     2   0.785     1     3       3     3     2         1 5.74<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>     1.55<span style="color: #949494;">e</span>+ 0</span>
<span class="co">## <span style="color: #949494;"># ... with 26 more rows, and 1 more variable: V_star_Q_il &lt;dbl&gt;</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_queue_il_wide</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 9 x 14</span></span>
<span class="co">##   id_il  A_il alpha_il beta_i rank_min rank_max avg_rank  id_i D_max_i  D_il</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>     1   3      1      0.333        9        4     6.5      1       3     1</span>
<span class="co">## <span style="color: #BCBCBC;">2</span>     2   2      1      0.333        7        3     4.75     1       3     2</span>
<span class="co">## <span style="color: #BCBCBC;">3</span>     3   1      1      0.333        2        2     2        1       3     3</span>
<span class="co">## <span style="color: #BCBCBC;">4</span>     4   2.2    0.5    0.333        8        7     7.25     2       3     1</span>
<span class="co">## <span style="color: #BCBCBC;">5</span>     5   1.5    0.7    0.333        6        5     5.5      2       3     2</span>
<span class="co">## <span style="color: #BCBCBC;">6</span>     6   1.1    0.4    0.333        8        4     6        2       3     3</span>
<span class="co">## <span style="color: #BCBCBC;">7</span>     7   1.8    0.100  0.333        9        6     8        3       3     1</span>
<span class="co">## <span style="color: #BCBCBC;">8</span>     8   1.1    0.7    0.333        5        3     4        3       3     2</span>
<span class="co">## <span style="color: #BCBCBC;">9</span>     9   0.1    1      0.333        1        1     1        3       3     3</span>
<span class="co">## <span style="color: #949494;"># ... with 4 more variables: rho_c1_rk &lt;int&gt;, rho_c2_rk &lt;int&gt;, rho_c3_rk &lt;int&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   rho_c4_rk &lt;int&gt;</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_alloc_i_long</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 12 x 7</span></span>
<span class="co">## <span style="color: #949494;"># Groups:   id_i [3]</span></span>
<span class="co">##      rho rho_val  id_i D_max_i D_star_i F_star_i EH_star_i</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1   0.99      1       3        3    1           2  </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     2   0.785     1       3        3    1           2  </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3  -<span style="color: #BB0000;">3.64</span>      1       3        1    0.333       4  </span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 -<span style="color: #BB0000;">99</span>         1       3        1    0.333       4  </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     1   0.99      2       3        0    0           2.2</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     2   0.785     2       3        0    0           2.2</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     3  -<span style="color: #BB0000;">3.64</span>      2       3        2    0.667       2.2</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     4 -<span style="color: #BB0000;">99</span>         2       3        2    0.667       2.2</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     1   0.99      3       3        2    0.667       1.8</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     2   0.785     3       3        2    0.667       1.8</span>
<span class="co">## <span style="color: #BCBCBC;">11</span>     3  -<span style="color: #BB0000;">3.64</span>      3       3        2    0.667       1.8</span>
<span class="co">## <span style="color: #BCBCBC;">12</span>     4 -<span style="color: #BB0000;">99</span>         3       3        2    0.667       1.8</span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_rho_gini</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 12 x 9</span></span>
<span class="co">##      rho rho_val gini_D_star gini_EH_star atkinson_EH_star sd_D_star sd_EH_star</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1   0.99          0.3       0.033<span style="text-decoration: underline;">3</span>        0.000<span style="text-decoration: underline;">033</span>4     1.53        0.2 </span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     2   0.785         0.3       0.033<span style="text-decoration: underline;">3</span>        0.000<span style="text-decoration: underline;">033</span>4     1.53        0.2 </span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3  -<span style="color: #BB0000;">3.64</span>          0.1       0.137         0.000<span style="text-decoration: underline;">033</span>4     0.577       1.17</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 -<span style="color: #BB0000;">99</span>             0.1       0.137         0.000<span style="text-decoration: underline;">720</span>      0.577       1.17</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     5   0.99          0.3       0.033<span style="text-decoration: underline;">3</span>        0.000<span style="text-decoration: underline;">720</span>      1.53        0.2 </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     6   0.785         0.3       0.033<span style="text-decoration: underline;">3</span>        0.000<span style="text-decoration: underline;">720</span>      1.53        0.2 </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     7  -<span style="color: #BB0000;">3.64</span>          0.1       0.137         0.189         0.577       1.17</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     8 -<span style="color: #BB0000;">99</span>             0.1       0.137         0.189         0.577       1.17</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     9   0.99          0.3       0.033<span style="text-decoration: underline;">3</span>        0.189         1.53        0.2 </span>
<span class="co">## <span style="color: #BCBCBC;">10</span>    10   0.785         0.3       0.033<span style="text-decoration: underline;">3</span>        0.317         1.53        0.2 </span>
<span class="co">## <span style="color: #BCBCBC;">11</span>    11  -<span style="color: #BB0000;">3.64</span>          0.1       0.137         0.317         0.577       1.17</span>
<span class="co">## <span style="color: #BCBCBC;">12</span>    12 -<span style="color: #BB0000;">99</span>             0.1       0.137         0.317         0.577       1.17</span>
<span class="co">## <span style="color: #949494;"># ... with 2 more variables: mean_EH_star &lt;dbl&gt;, min_EH_star &lt;dbl&gt;</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_alloc_il_long</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 36 x 5</span></span>
<span class="co">##      rho  Q_il sid_1 sid_2 sid_3</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1     1     0     0     1</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     1     2     1     0     1</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     1     3     2     0     1</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     1     4     3     0     1</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     1     5     3     0     2</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     1     6     3     1     2</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     1     7     3     2     2</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     1     8     3     3     2</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     1     9     3     3     3</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     2     1     0     0     1</span>
<span class="co">## <span style="color: #949494;"># ... with 26 more rows</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="load-pre-generated-data">Load Pre-Generated Data<a class="anchor" aria-label="anchor" href="#load-pre-generated-data"></a>
</h2>
<p>These are data thata were generated in the <a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_sodis_rkone_casch_allrw.html">DISCRETE–Discrete Optimal Allocation California Teacher Student Ratio (Line by Line)</a> function.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load Data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">df_opt_caschool_prep_i</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_il</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_ib</span><span class="op">)</span>

<span class="co"># Show Variables</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">df_opt_caschool_prep_i</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 'data.frame':    420 obs. of  15 variables:</span>
<span class="co">##  $ id_i    : int  1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">##  $ D_max_i : num  11 11 83 14 72 6 10 42 19 108 ...</span>
<span class="co">##  $ D_o_i   : num  2 2 17 3 14 1 2 8 4 22 ...</span>
<span class="co">##  $ Omega_i : num  706 673 657 656 656 ...</span>
<span class="co">##  $ theta_i : num  -0.87 -0.87 -0.87 -0.87 -0.87 ...</span>
<span class="co">##  $ beta_i  : num  0.00238 0.00238 0.00238 0.00238 0.00238 ...</span>
<span class="co">##  $ enrltot : num  195 240 1550 243 1335 ...</span>
<span class="co">##  $ teachers: num  11 11 83 14 72 6 10 42 19 108 ...</span>
<span class="co">##  $ stravg  : num  17.7 21.8 18.7 17.4 18.5 ...</span>
<span class="co">##  $ distcod : int  75119 61499 61549 61457 61523 62042 68536 63834 62331 67306 ...</span>
<span class="co">##  $ county  : Factor w/ 45 levels "Alameda","Butte",..: 1 2 2 2 2 6 29 11 6 25 ...</span>
<span class="co">##  $ district: Factor w/ 409 levels "Ackerman Elementary",..: 362 214 367 134 270 53 152 383 263 93 ...</span>
<span class="co">##  $ grspan  : Factor w/ 2 levels "KK-06","KK-08": 2 2 2 2 2 2 2 2 2 1 ...</span>
<span class="co">##  $ avginc  : num  22.69 9.82 8.98 8.98 9.08 ...</span>
<span class="co">##  $ testscr : num  691 661 644 648 641 ...</span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_il</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## tibble [54,204 x 7] (S3: tbl_df/tbl/data.frame)</span>
<span class="co">##  $ id_i    : int [1:54204] 1 1 1 1 1 1 1 1 1 1 ...</span>
<span class="co">##  $ id_il   : int [1:54204] 1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">##  $ D_max_i : num [1:54204] 11 11 11 11 11 11 11 11 11 11 ...</span>
<span class="co">##  $ D_il    : int [1:54204] 1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">##  $ A_il    : num [1:54204] 691 692 693 694 695 ...</span>
<span class="co">##  $ alpha_il: num [1:54204] 1.285 1.087 0.932 0.808 0.707 ...</span>
<span class="co">##  $ beta_i  : num [1:54204] 0.00238 0.00238 0.00238 0.00238 0.00238 ...</span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_ib</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 'data.frame':    420 obs. of  4 variables:</span>
<span class="co">##  $ id_i     : int  1 2 3 4 5 6 7 8 9 10 ...</span>
<span class="co">##  $ A_i_l0   : num  691 654 641 641 639 ...</span>
<span class="co">##  $ alpha_o_i: num  2.37 2.92 2.76 2.66 2.63 ...</span>
<span class="co">##  $ beta_i   : num  0.00238 0.00238 0.00238 0.00238 0.00238 ...</span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Modifying Beta Value</span>
<span class="co"># When individuals have the same weights, beta values do not matter</span>
<span class="va">df_opt_caschool_input_il</span> <span class="op">&lt;-</span> <span class="va">df_opt_caschool_input_il</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>beta_i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">df_opt_caschool_input_ib</span> <span class="op">&lt;-</span> <span class="va">df_opt_caschool_input_ib</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>beta_i <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="solve-all-districts-discrete-optimal-allocation-across-planner-preferences">Solve All Districts Discrete Optimal Allocation Across Planner Preferences<a class="anchor" aria-label="anchor" href="#solve-all-districts-discrete-optimal-allocation-across-planner-preferences"></a>
</h2>
<div class="section level3">
<h3 id="specify-policy-parameters">Specify Policy Parameters<a class="anchor" aria-label="anchor" href="#specify-policy-parameters"></a>
</h3>
<p>Note that <em>input_il</em> function already is based on <em>fl_fi_max</em>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 100 percent teacher at most per school, discretize floor as needed</span>
<span class="co"># This is not a parameter that matters here, already a part of the input_il function</span>
<span class="va">fl_fi_max</span> <span class="op">=</span> <span class="fl">1.00</span>
<span class="co"># 20 percent total additional of all teachers</span>
<span class="va">fl_fa_max</span> <span class="op">=</span> <span class="fl">0.20</span>
<span class="co"># What is the number of teachers we can increase by</span>
<span class="va">fl_teacher_increase_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_opt_caschool_prep_i</span><span class="op">$</span><span class="va">teachers</span><span class="op">)</span><span class="op">*</span><span class="va">fl_fa_max</span>
<span class="va">fl_teacher_increase_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">fl_teacher_increase_number</span><span class="op">)</span>

<span class="co"># Rho values to consider</span>
<span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span>, length.out<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ar_rho</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="optimal-queue-and-allocations">Optimal Queue and Allocations<a class="anchor" aria-label="anchor" href="#optimal-queue-and-allocations"></a>
</h2>
<p>Use the discrete allocation function across preference <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis.html</a> function. This computes optimal allocation for multiple planner inequality aversion <span class="math inline">\(\lambda\)</span> parameters at the same time. Note that in the function <span class="math inline">\(\lambda=\rho\)</span>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Optimal Allocation</span>
<span class="va">ls_df_queue</span> <span class="op">&lt;-</span> <span class="fu">PrjOptiAlloc</span><span class="fu">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span><span class="op">(</span><span class="va">ar_rho</span>,
                                       <span class="va">fl_teacher_increase_number</span>,
                                       bl_df_alloc_il <span class="op">=</span> <span class="cn">TRUE</span>,
                                       df_input_il <span class="op">=</span> <span class="va">df_opt_caschool_input_il</span>,
                                       svr_rho <span class="op">=</span> <span class="st">'rho'</span>,
                                       svr_id_i <span class="op">=</span> <span class="st">'id_i'</span>, svr_id_il <span class="op">=</span> <span class="st">'id_il'</span>,
                                       svr_D_max_i <span class="op">=</span> <span class="st">'D_max_i'</span>, svr_D_il <span class="op">=</span> <span class="st">'D_il'</span>,
                                       svr_D_star_i <span class="op">=</span> <span class="st">'D_star_i'</span>, svr_F_star_i <span class="op">=</span> <span class="st">'F_star_i'</span>,
                                       svr_inpalc <span class="op">=</span> <span class="st">'Q_il'</span>, svr_D_Wbin_il <span class="op">=</span> <span class="st">'D_Wbin_il'</span>,
                                       svr_A_il <span class="op">=</span> <span class="st">'A_il'</span>, svr_alpha_il <span class="op">=</span> <span class="st">'alpha_il'</span>, svr_beta_i <span class="op">=</span> <span class="st">'beta_i'</span>,
                                       svr_expout <span class="op">=</span> <span class="st">'opti_exp_outcome'</span>,
                                       st_idcol_prefix <span class="op">=</span> <span class="st">'sid_'</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Joining, by = "id_il"</span></code></pre>
<pre><code><span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(rev)`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(alloc_i_upto_Q)`</span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_queue_il_long</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_queue_il_long</span>
<span class="va">df_queue_il_wide</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_queue_il_wide</span>
<span class="va">df_alloc_i_long</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_alloc_i_long</span>
<span class="va">df_rho_gini</span>  <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_rho_gini</span>
<span class="va">df_alloc_il_long</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_alloc_il_long</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_queue_il_long</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 10 x 9</span></span>
<span class="co">##      rho rho_val  id_i id_il D_max_i  D_il  Q_il D_Wbin_il V_star_Q_il</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1   0.99      1     1      11     1   138         1     <span style="text-decoration: underline;">292</span>290.</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     2   0.785     1     1      11     1   140         1    1<span style="text-decoration: underline;">444</span>269.</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3  -<span style="color: #BB0000;">3.64</span>      1     1      11     1   244         1        125.</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 -<span style="color: #BB0000;">99</span>         1     1      11     1 <span style="text-decoration: underline;">36</span>657         0         <span style="color: #BB0000;">NA</span> </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     1   0.99      1     2      11     2   209         1     <span style="text-decoration: underline;">292</span>379.</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     2   0.785     1     2      11     2   212         1    1<span style="text-decoration: underline;">444</span>712.</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     3  -<span style="color: #BB0000;">3.64</span>      1     2      11     2   372         1        125.</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     4 -<span style="color: #BB0000;">99</span>         1     2      11     2 <span style="text-decoration: underline;">39</span>093         0         <span style="color: #BB0000;">NA</span> </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     1   0.99      1     3      11     3   297         1     <span style="text-decoration: underline;">292</span>474.</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     2   0.785     1     3      11     3   305         1    1<span style="text-decoration: underline;">445</span>198.</span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print(str(df_queue_il_long))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_queue_il_wide</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 10 x 14</span></span>
<span class="co">##    id_il  A_il alpha_il beta_i rank_min rank_max avg_rank  id_i D_max_i  D_il</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1  691.    1.29       1    <span style="text-decoration: underline;">36</span>657      138    <span style="text-decoration: underline;">9</span>295.     1      11     1</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     2  692.    1.09       1    <span style="text-decoration: underline;">39</span>093      209    <span style="text-decoration: underline;">9</span>972.     1      11     2</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3  693.    0.932      1    <span style="text-decoration: underline;">41</span>307      297   <span style="text-decoration: underline;">10</span>604      1      11     3</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     4  694.    0.808      1    <span style="text-decoration: underline;">43</span>280      404   <span style="text-decoration: underline;">11</span>190.     1      11     4</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     5  695.    0.707      1    <span style="text-decoration: underline;">45</span>090      522   <span style="text-decoration: underline;">11</span>750.     1      11     5</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     6  696.    0.624      1    <span style="text-decoration: underline;">46</span>600      658   <span style="text-decoration: underline;">12</span>248.     1      11     6</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     7  696.    0.554      1    <span style="text-decoration: underline;">47</span>875      813   <span style="text-decoration: underline;">12</span>704.     1      11     7</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     8  697.    0.496      1    <span style="text-decoration: underline;">48</span>958      978   <span style="text-decoration: underline;">13</span>115      1      11     8</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     9  697.    0.446      1    <span style="text-decoration: underline;">49</span>841     <span style="text-decoration: underline;">1</span>165   <span style="text-decoration: underline;">13</span>495      1      11     9</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>    10  698.    0.404      1    <span style="text-decoration: underline;">50</span>512     <span style="text-decoration: underline;">1</span>357   <span style="text-decoration: underline;">13</span>826.     1      11    10</span>
<span class="co">## <span style="color: #949494;"># ... with 4 more variables: rho_c1_rk &lt;int&gt;, rho_c2_rk &lt;int&gt;, rho_c3_rk &lt;int&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   rho_c4_rk &lt;int&gt;</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print(str(df_queue_il_wide))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_alloc_i_long</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 10 x 7</span></span>
<span class="co">## <span style="color: #949494;"># Groups:   id_i [3]</span></span>
<span class="co">##      rho rho_val  id_i D_max_i D_star_i F_star_i EH_star_i</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1   0.99      1      11       11    1          699.</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     2   0.785     1      11       11    1          699.</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3  -<span style="color: #BB0000;">3.64</span>      1      11       11    1          699.</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 -<span style="color: #BB0000;">99</span>         1      11        0    0          691.</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     1   0.99      2      11       11    1          664.</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     2   0.785     2      11       11    1          664.</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     3  -<span style="color: #BB0000;">3.64</span>      2      11       11    1          664.</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     4 -<span style="color: #BB0000;">99</span>         2      11        6    0.545      661.</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     1   0.99      3      83       54    0.651      647.</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     2   0.785     3      83       54    0.651      647.</span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print(str(df_queue_il_wide))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_rho_gini</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,680 x 9</span></span>
<span class="co">##      rho rho_val gini_D_star gini_EH_star atkinson_EH_star sd_D_star sd_EH_star</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1   0.99        0.445       0.015<span style="text-decoration: underline;">4</span>       0.000<span style="text-decoration: underline;">003</span>62      20.1       17.8</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     2   0.785       0.445       0.015<span style="text-decoration: underline;">4</span>       0.000<span style="text-decoration: underline;">003</span>62      20.2       17.8</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3  -<span style="color: #BB0000;">3.64</span>        0.445       0.015<span style="text-decoration: underline;">1</span>       0.000<span style="text-decoration: underline;">003</span>62      20.3       17.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 -<span style="color: #BB0000;">99</span>           0.821       0.012<span style="text-decoration: underline;">5</span>       0.000<span style="text-decoration: underline;">003</span>62      60.8       14.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     5   0.99        0.445       0.015<span style="text-decoration: underline;">4</span>       0.000<span style="text-decoration: underline;">003</span>62      20.1       17.8</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     6   0.785       0.445       0.015<span style="text-decoration: underline;">4</span>       0.000<span style="text-decoration: underline;">003</span>62      20.2       17.8</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     7  -<span style="color: #BB0000;">3.64</span>        0.445       0.015<span style="text-decoration: underline;">1</span>       0.000<span style="text-decoration: underline;">003</span>62      20.3       17.5</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     8 -<span style="color: #BB0000;">99</span>           0.821       0.012<span style="text-decoration: underline;">5</span>       0.000<span style="text-decoration: underline;">003</span>62      60.8       14.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     9   0.99        0.445       0.015<span style="text-decoration: underline;">4</span>       0.000<span style="text-decoration: underline;">003</span>62      20.1       17.8</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>    10   0.785       0.445       0.015<span style="text-decoration: underline;">4</span>       0.000<span style="text-decoration: underline;">003</span>62      20.2       17.8</span>
<span class="co">## <span style="color: #949494;"># ... with 1,670 more rows, and 2 more variables: mean_EH_star &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   min_EH_star &lt;dbl&gt;</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># print(str(df_alloc_i_long))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_alloc_il_long</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 10 x 422</span></span>
<span class="co">##      rho  Q_il sid_1 sid_2 sid_3 sid_4 sid_5 sid_6 sid_7 sid_8 sid_9 sid_10</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1     1     0     0     0     0     0     0     0     0     0      0</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     1     2     0     0     0     0     0     0     0     0     0      0</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     1     3     0     0     0     0     0     0     0     0     0      0</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     1     4     0     0     0     0     0     0     0     0     0      0</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     1     5     0     0     0     0     0     0     0     0     0      0</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     1     6     0     0     0     0     0     0     0     0     0      0</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     1     7     0     0     0     0     0     0     0     0     0      0</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     1     8     0     0     0     0     0     1     0     0     0      0</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     1     9     0     0     0     0     0     1     0     0     0      0</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     1    10     0     0     0     0     0     1     0     0     0      0</span>
<span class="co">## <span style="color: #949494;"># ... with 410 more variables: sid_11 &lt;dbl&gt;, sid_12 &lt;dbl&gt;, sid_13 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   sid_14 &lt;dbl&gt;, sid_15 &lt;dbl&gt;, sid_16 &lt;dbl&gt;, sid_17 &lt;dbl&gt;, sid_18 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   sid_19 &lt;dbl&gt;, sid_20 &lt;dbl&gt;, sid_21 &lt;dbl&gt;, sid_22 &lt;dbl&gt;, sid_23 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   sid_24 &lt;dbl&gt;, sid_25 &lt;dbl&gt;, sid_26 &lt;dbl&gt;, sid_27 &lt;dbl&gt;, sid_28 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   sid_29 &lt;dbl&gt;, sid_30 &lt;dbl&gt;, sid_31 &lt;dbl&gt;, sid_32 &lt;dbl&gt;, sid_33 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   sid_34 &lt;dbl&gt;, sid_35 &lt;dbl&gt;, sid_36 &lt;dbl&gt;, sid_37 &lt;dbl&gt;, sid_38 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   sid_39 &lt;dbl&gt;, sid_40 &lt;dbl&gt;, sid_41 &lt;dbl&gt;, sid_42 &lt;dbl&gt;, sid_43 &lt;dbl&gt;, ...</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="rev-compute">REV Compute<a class="anchor" aria-label="anchor" href="#rev-compute"></a>
</h2>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tb_rho_rev</span> <span class="op">&lt;-</span>
  <span class="fu">PrjOptiAlloc</span><span class="fu">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span><span class="op">(</span><span class="va">ar_rho</span>,
                          <span class="va">fl_teacher_increase_number</span>,
                          df_input_ib <span class="op">=</span> <span class="va">df_opt_caschool_input_ib</span>,
                          df_queue_il_long_with_V <span class="op">=</span> <span class="va">df_queue_il_long</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(rev)`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(fl_util_alter_alloc)`</span></code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tb_rho_rev</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 4 x 4</span></span>
<span class="co">##     rho rho_val   REV AlterOutcome</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>     1   0.99  0.836      <span style="text-decoration: underline;">293</span>297.</span>
<span class="co">## <span style="color: #BCBCBC;">2</span>     2   0.785 0.836     1<span style="text-decoration: underline;">449</span>231.</span>
<span class="co">## <span style="color: #BCBCBC;">3</span>     3  -<span style="color: #BB0000;">3.64</span>  0.831         125.</span>
<span class="co">## <span style="color: #BCBCBC;">4</span>     4 -<span style="color: #BB0000;">99</span>     0.949         601.</span></code></pre>
</div>
<div class="section level2">
<h2 id="optimal-allocation-among-subset-of-districts">Optimal Allocation Among Subset of Districts<a class="anchor" aria-label="anchor" href="#optimal-allocation-among-subset-of-districts"></a>
</h2>
<div class="section level3">
<h3 id="select-a-small-subset-of-districts">Select a Small Subset of Districts<a class="anchor" aria-label="anchor" href="#select-a-small-subset-of-districts"></a>
</h3>
<p>To generate some graphs and more easily readable results, rather than using all school districts, select some random subset of school districts from the existing data frames.</p>
<ol style="list-style-type: decimal">
<li>Select a random subset of district IDs</li>
<li>New input df that only includes these IDs.</li>
</ol>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># select four school districts</span>
<span class="co"># cas = california schools</span>
<span class="va">it_O</span> <span class="op">&lt;-</span> <span class="fl">4</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">df_cas_prep_sub_i</span> <span class="op">&lt;-</span> <span class="va">df_opt_caschool_prep_i</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">teachers</span> <span class="op">&lt;=</span> <span class="fl">100</span> <span class="op">&amp;</span> <span class="va">teachers</span> <span class="op">&gt;=</span> <span class="fl">50</span><span class="op">)</span>
<span class="va">df_cas_prep_sub_i</span> <span class="op">&lt;-</span> <span class="va">df_cas_prep_sub_i</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df_cas_prep_sub_i</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">it_O</span>, replace<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">ar_cas_id_selected</span> <span class="op">&lt;-</span> <span class="va">df_cas_prep_sub_i</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">id_i</span><span class="op">)</span>

<span class="co"># Select from il and ib only ids that are randomly selected</span>
<span class="va">df_cas_input_sub_il</span> <span class="op">&lt;-</span> <span class="va">df_opt_caschool_input_il</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ar_cas_id_selected</span><span class="op">)</span>
<span class="va">df_cas_input_sub_ib</span> <span class="op">&lt;-</span> <span class="va">df_opt_caschool_input_ib</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ar_cas_id_selected</span><span class="op">)</span>

<span class="co"># Print</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_cas_prep_sub_i</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##    id_i D_max_i D_o_i  Omega_i    theta_i      beta_i enrltot teachers   stravg</span>
<span class="co">## 4    32     100    20 636.0332 -0.8699505 0.002380952    2102      100 21.02000</span>
<span class="co">## 39  327      51    10 686.9896 -0.8699505 0.002380952     900       51 17.64706</span>
<span class="co">## 1     3      83    17 657.0958 -0.8699505 0.002380952    1550       83 18.67470</span>
<span class="co">## 34  286      65    13 671.6432 -0.8699505 0.002380952    1252       65 19.26154</span>
<span class="co">##    distcod    county                    district grspan   avginc testscr</span>
<span class="co">## 4    75440  Monterey             Soledad Unified  KK-08 12.40900  624.95</span>
<span class="co">## 39   68007 San Diego          Cardiff Elementary  KK-06 21.96700  668.65</span>
<span class="co">## 1    61549     Butte Thermalito Union Elementary  KK-08  8.97800  643.60</span>
<span class="co">## 34   71035    Sonoma           Wright Elementary  KK-06 12.58425  663.85</span></code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_cas_input_sub_ib</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##   id_i   A_i_l0 alpha_o_i beta_i</span>
<span class="co">## 1    3 640.8497  2.761831      1</span>
<span class="co">## 2   32 617.7468  3.047727      1</span>
<span class="co">## 3  286 654.8866  2.792764      1</span>
<span class="co">## 4  327 671.6376  2.516732      1</span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_cas_input_sub_il</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 299 x 7</span></span>
<span class="co">##     id_i id_il D_max_i  D_il  A_il alpha_il beta_i</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     3    23      83     1  641.    0.193      1</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     3    24      83     2  641.    0.189      1</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3    25      83     3  641.    0.184      1</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     3    26      83     4  641.    0.180      1</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     3    27      83     5  642.    0.176      1</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     3    28      83     6  642.    0.172      1</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     3    29      83     7  642.    0.168      1</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     3    30      83     8  642.    0.165      1</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     3    31      83     9  642.    0.161      1</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     3    32      83    10  642.    0.158      1</span>
<span class="co">## <span style="color: #949494;"># ... with 289 more rows</span></span></code></pre>
<p>Now we also have a new total number of teacher increase, no longer based on all districts. The policy here is to potentially increase each school district by <em>fl_fi_max</em>, already coded into the <em>input_il</em> file, so that can not change. The total number of available new teachers is <em>fl_fa_max</em> times the existing number of teachers in the selected districts overall</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fl_fa_max</span> <span class="op">=</span> <span class="fl">0.20</span>
<span class="co"># What is the number of teachers we can increase by</span>
<span class="va">fl_teacher_increase_sub_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_cas_prep_sub_i</span><span class="op">$</span><span class="va">teachers</span><span class="op">)</span><span class="op">*</span><span class="va">fl_fa_max</span>
<span class="va">fl_teacher_increase_sub_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">fl_teacher_increase_sub_number</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="optimal-queue-allocations-and-rev">Optimal Queue, Allocations and REV<a class="anchor" aria-label="anchor" href="#optimal-queue-allocations-and-rev"></a>
</h3>
<p>Use the discrete allocation function across preference <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis.html</a> function. This computes optimal allocation for multiple planner inequality aversion <span class="math inline">\(\lambda\)</span> parameters at the same time. Note that in the function <span class="math inline">\(\lambda=\rho\)</span>.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Rho values to consider</span>
<span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>,<span class="fl">2</span>, length.out<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">ar_rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">ar_rho</span><span class="op">)</span>

<span class="co"># Optimal Allocation</span>
<span class="va">ls_df_sub_queue</span> <span class="op">&lt;-</span> <span class="fu">PrjOptiAlloc</span><span class="fu">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span><span class="op">(</span><span class="va">ar_rho</span>, <span class="va">fl_teacher_increase_sub_number</span>,
                                           df_input_il <span class="op">=</span> <span class="va">df_cas_input_sub_il</span>,
                                           bl_df_alloc_il <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Joining, by = "id_il"</span></code></pre>
<pre><code><span class="co">## Adding missing grouping variables: `id_i`</span></code></pre>
<pre><code><span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,</span>
<span class="co">## max-inequality/min-gini=0.6</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,</span>
<span class="co">## max-inequality/min-gini=0.6</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,</span>
<span class="co">## max-inequality/min-gini=0.6</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,</span>
<span class="co">## max-inequality/min-gini=0.6</span></code></pre>
<pre><code><span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has</span>
<span class="co">## only n=4, max-inequality/min-gini=0.6</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has</span>
<span class="co">## only n=4, max-inequality/min-gini=0.6</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has</span>
<span class="co">## only n=4, max-inequality/min-gini=0.6</span>

<span class="co">## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has</span>
<span class="co">## only n=4, max-inequality/min-gini=0.6</span></code></pre>
<pre><code><span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(rev)`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(alloc_i_upto_Q)`</span></code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_queue_il_sub_long</span> <span class="op">&lt;-</span> <span class="va">ls_df_sub_queue</span><span class="op">$</span><span class="va">df_queue_il_long</span>
<span class="va">df_queue_il_sub_wide</span> <span class="op">&lt;-</span> <span class="va">ls_df_sub_queue</span><span class="op">$</span><span class="va">df_queue_il_wide</span>
<span class="va">df_alloc_i_long</span> <span class="op">&lt;-</span> <span class="va">ls_df_sub_queue</span><span class="op">$</span><span class="va">df_alloc_i_long</span>
<span class="va">df_rho_gini</span> <span class="op">&lt;-</span> <span class="va">ls_df_sub_queue</span><span class="op">$</span><span class="va">df_rho_gini</span>
<span class="va">df_alloc_il_long</span> <span class="op">&lt;-</span> <span class="va">ls_df_sub_queue</span><span class="op">$</span><span class="va">df_alloc_il_long</span>

<span class="co"># REV</span>
<span class="va">ar_util_rev_loop_func</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span><span class="op">(</span><span class="va">ar_rho</span>,<span class="va">fl_teacher_increase_sub_number</span>,
                                                 df_input_ib <span class="op">=</span> <span class="va">df_cas_input_sub_ib</span>,
                                                 df_queue_il_long_with_V <span class="op">=</span> <span class="va">df_queue_il_sub_long</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in min(df_queue_il_with_V %&gt;% filter(!!sym(svr_V_star_Q_il) &gt;=</span>
<span class="co">## fl_util_alter_alloc) %&gt;% : no non-missing arguments to min; returning Inf</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(rev)`</span></code></pre>
<pre><code><span class="co">## Warning in min(df_queue_il_with_V %&gt;% filter(!!sym(svr_V_star_Q_il) &gt;=</span>
<span class="co">## fl_util_alter_alloc) %&gt;% : no non-missing arguments to min; returning Inf</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(fl_util_alter_alloc)`</span></code></pre>
<p>Show Results</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_queue_il_sub_long</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,196 x 9</span></span>
<span class="co">##      rho rho_val  id_i id_il D_max_i  D_il  Q_il D_Wbin_il V_star_Q_il</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1   0.99      3    23      83     1    24         1       <span style="text-decoration: underline;">2</span>627.</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     2   0.785     3    23      83     1    23         1       <span style="text-decoration: underline;">3</span>790.</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3  -<span style="color: #BB0000;">3.64</span>      3    23      83     1    19         1        441.</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 -<span style="color: #BB0000;">99</span>         3    23      83     1   101         0         <span style="color: #BB0000;">NA</span> </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     1   0.99      3    24      83     2    26         1       <span style="text-decoration: underline;">2</span>628.</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     2   0.785     3    24      83     2    26         1       <span style="text-decoration: underline;">3</span>791.</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     3  -<span style="color: #BB0000;">3.64</span>      3    24      83     2    22         1        441.</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     4 -<span style="color: #BB0000;">99</span>         3    24      83     2   102         0         <span style="color: #BB0000;">NA</span> </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     1   0.99      3    25      83     3    29         1       <span style="text-decoration: underline;">2</span>628.</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     2   0.785     3    25      83     3    29         1       <span style="text-decoration: underline;">3</span>792.</span>
<span class="co">## <span style="color: #949494;"># ... with 1,186 more rows</span></span></code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_alloc_i_long</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 16 x 7</span></span>
<span class="co">## <span style="color: #949494;"># Groups:   id_i [4]</span></span>
<span class="co">##      rho rho_val  id_i D_max_i D_star_i F_star_i EH_star_i</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1   0.99      3      83       11    0.133      643.</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     2   0.785     3      83       11    0.133      643.</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3  -<span style="color: #BB0000;">3.64</span>      3      83       12    0.145      643.</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 -<span style="color: #BB0000;">99</span>         3      83        0    0          641.</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     1   0.99     32     100        9    0.09       619.</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     2   0.785    32     100        9    0.09       619.</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     3  -<span style="color: #BB0000;">3.64</span>     32     100       19    0.19       621.</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     4 -<span style="color: #BB0000;">99</span>        32     100       59    0.59       625.</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     1   0.99    286      65       19    0.292      659.</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     2   0.785   286      65       19    0.292      659.</span>
<span class="co">## <span style="color: #BCBCBC;">11</span>     3  -<span style="color: #BB0000;">3.64</span>    286      65       15    0.231      658.</span>
<span class="co">## <span style="color: #BCBCBC;">12</span>     4 -<span style="color: #BB0000;">99</span>       286      65        0    0          655.</span>
<span class="co">## <span style="color: #BCBCBC;">13</span>     1   0.99    327      51       20    0.392      676.</span>
<span class="co">## <span style="color: #BCBCBC;">14</span>     2   0.785   327      51       20    0.392      676.</span>
<span class="co">## <span style="color: #BCBCBC;">15</span>     3  -<span style="color: #BB0000;">3.64</span>    327      51       13    0.255      675.</span>
<span class="co">## <span style="color: #BCBCBC;">16</span>     4 -<span style="color: #BB0000;">99</span>       327      51        0    0          672.</span></code></pre>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_rho_gini</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 16 x 9</span></span>
<span class="co">##      rho rho_val gini_D_star gini_EH_star atkinson_EH_star sd_D_star sd_EH_star</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1   0.99       0.139        0.014<span style="text-decoration: underline;">3</span>       0.000<span style="text-decoration: underline;">005</span>19      5.56       24.1</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     2   0.785      0.139        0.014<span style="text-decoration: underline;">3</span>       0.000<span style="text-decoration: underline;">005</span>19      5.56       24.1</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     3  -<span style="color: #BB0000;">3.64</span>       0.078<span style="text-decoration: underline;">0</span>       0.013<span style="text-decoration: underline;">7</span>       0.000<span style="text-decoration: underline;">005</span>19      3.10       23.0</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     4 -<span style="color: #BB0000;">99</span>          0.6          0.012<span style="text-decoration: underline;">0</span>       0.000<span style="text-decoration: underline;">005</span>19     29.5        20.1</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     5   0.99       0.139        0.014<span style="text-decoration: underline;">3</span>       0.000<span style="text-decoration: underline;">112</span>        5.56       24.1</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     6   0.785      0.139        0.014<span style="text-decoration: underline;">3</span>       0.000<span style="text-decoration: underline;">112</span>        5.56       24.1</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     7  -<span style="color: #BB0000;">3.64</span>       0.078<span style="text-decoration: underline;">0</span>       0.013<span style="text-decoration: underline;">7</span>       0.000<span style="text-decoration: underline;">112</span>        3.10       23.0</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     8 -<span style="color: #BB0000;">99</span>          0.6          0.012<span style="text-decoration: underline;">0</span>       0.000<span style="text-decoration: underline;">112</span>       29.5        20.1</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     9   0.99       0.139        0.014<span style="text-decoration: underline;">3</span>       0.002<span style="text-decoration: underline;">20</span>         5.56       24.1</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>    10   0.785      0.139        0.014<span style="text-decoration: underline;">3</span>       0.002<span style="text-decoration: underline;">20</span>         5.56       24.1</span>
<span class="co">## <span style="color: #BCBCBC;">11</span>    11  -<span style="color: #BB0000;">3.64</span>       0.078<span style="text-decoration: underline;">0</span>       0.013<span style="text-decoration: underline;">7</span>       0.002<span style="text-decoration: underline;">20</span>         3.10       23.0</span>
<span class="co">## <span style="color: #BCBCBC;">12</span>    12 -<span style="color: #BB0000;">99</span>          0.6          0.012<span style="text-decoration: underline;">0</span>       0.002<span style="text-decoration: underline;">20</span>        29.5        20.1</span>
<span class="co">## <span style="color: #BCBCBC;">13</span>    13   0.99       0.139        0.014<span style="text-decoration: underline;">3</span>       0.023<span style="text-decoration: underline;">4</span>          5.56       24.1</span>
<span class="co">## <span style="color: #BCBCBC;">14</span>    14   0.785      0.139        0.014<span style="text-decoration: underline;">3</span>       0.023<span style="text-decoration: underline;">4</span>          5.56       24.1</span>
<span class="co">## <span style="color: #BCBCBC;">15</span>    15  -<span style="color: #BB0000;">3.64</span>       0.078<span style="text-decoration: underline;">0</span>       0.013<span style="text-decoration: underline;">7</span>       0.023<span style="text-decoration: underline;">4</span>          3.10       23.0</span>
<span class="co">## <span style="color: #BCBCBC;">16</span>    16 -<span style="color: #BB0000;">99</span>          0.6          0.012<span style="text-decoration: underline;">0</span>       0.023<span style="text-decoration: underline;">4</span>         29.5        20.1</span>
<span class="co">## <span style="color: #949494;"># ... with 2 more variables: mean_EH_star &lt;dbl&gt;, min_EH_star &lt;dbl&gt;</span></span></code></pre>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df_alloc_il_long</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,196 x 6</span></span>
<span class="co">##      rho  Q_il sid_3 sid_32 sid_286 sid_327</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1     1     0      0       0       1</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     1     2     0      0       0       2</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     1     3     0      0       0       3</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     1     4     0      0       0       4</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     1     5     0      0       0       5</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     1     6     0      0       1       5</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     1     7     0      0       2       5</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     1     8     0      0       2       6</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     1     9     0      0       3       6</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     1    10     0      0       3       7</span>
<span class="co">## <span style="color: #949494;"># ... with 1,186 more rows</span></span></code></pre>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ar_util_rev_loop_func</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 4 x 4</span></span>
<span class="co">##     rho rho_val    REV AlterOutcome</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>     1   0.99  0.033<span style="text-decoration: underline;">9</span>        <span style="text-decoration: underline;">2</span>633.</span>
<span class="co">## <span style="color: #BCBCBC;">2</span>     2   0.785 0.033<span style="text-decoration: underline;">9</span>        <span style="text-decoration: underline;">3</span>799.</span>
<span class="co">## <span style="color: #BCBCBC;">3</span>     3  -<span style="color: #BB0000;">3.64</span>  0              443.</span>
<span class="co">## <span style="color: #BCBCBC;">4</span>     4 -<span style="color: #BB0000;">99</span>     0.644          621.</span></code></pre>
<!-- ### Additional Statistics

1. Predicted Expected Outcomes for each i given allocations
2. Utility at each Queue rank point
3. Gini Statistics based on allocations

### Results Analysis

Core graphical/tabular illustration of results across Many Individuals

1. Mean and standard deviation of outcome, across $\lambda$, along with actual mean and standard deviation
2. Gini of Allocations and Outcomes, across $\lambda$, along with observed of intended Gini of Allocation or Outcomes
3. REV in percentages as well as in units of resources lost, across $\lambda$
4. Tabular results already exists for this. Rank Data/chart:
    - columns are $\lambda$ points
    - colors identify individuals, each color appears multiple times due to multiple allocations for each individual
    - show ranking changes as preference changes
    - highligh only subset (1) of individuals
    - Climbing chart? x axis is rank, y axis allocation for individual, but not sure why this would be useful. Perhaps useful for tabular outputs. Maybe only very small chart

How should illustrative graph be shown with only 2 individuals? -->
</div>
</div>
<div class="section level2">
<h2 id="differential-mass-optimal-allocation">Differential Mass Optimal Allocation<a class="anchor" aria-label="anchor" href="#differential-mass-optimal-allocation"></a>
</h2>
<p>Consider the population of schools is measure one, there are <span class="math inline">\(N\)</span> distinct types of schools, and the mass of each unique type is different, but they sum up to 1. If each school can have 5 additional teachers, than the mass of teachers is measure 5.</p>
<p>Use the number of students per school as its mass, and introduce a new vector for the allocation function that is this mass. This is to illustrate ideas. The mass should not be the number of students, but the number of schools of the same type.</p>
<p>Note that under discrete allocation, there were 10840 available teachers to be allocated. But in the problem below, the idea is:</p>
<ol style="list-style-type: decimal">
<li>suppose there is some system that currently allocates teachers by school attributes</li>
<li>we know the number of teachers allocated to each type of school</li>
<li>we know the proportion of each type of school in the school population.</li>
<li>given a population measure of 1 as the sum of all schools, if on average 4 teachers are allocated to each school, the total of teachers allocated is measure 4. In discrete terms, that just means, if there are in total 1000 different schools (not different unique type, just different schools), and on average each school gets 4 teachers, we are allocating 4000 teachers.</li>
</ol>
<p>Several things to note:</p>
<ol style="list-style-type: decimal">
<li>Get the total measure of resources used by the alternative allocation, this is not summing up just the mass of all individuals, which sums to one, but sums the measure of resources allocated given individual mass, and how much is allocated to each individual</li>
<li>Allocation queue: sort by allocation queue, and cumulative sum over individual mass, repeatedly over each incremental allocation for each individual</li>
<li>Welfare calculation: the welfare/utility is not by cumulative mass, but by probability mass for each type, this does not vary depending on how much is allocated. Allocation changes alpha and A, not the mass in utility.</li>
</ol>
<div class="section level3">
<h3 id="analyze-previous-level-allocation-with-measure-units">Analyze Previous Level Allocation with Measure Units<a class="anchor" aria-label="anchor" href="#analyze-previous-level-allocation-with-measure-units"></a>
</h3>
<p>Analyze previous allocation not based on measure, do this only for one planner:</p>
<ol style="list-style-type: decimal">
<li>sort by queue</li>
<li>cumulative sum the mass variable: mass_cumu_queue, cumulative mass (resource allocated) by this queue point.</li>
</ol>
<p>Note that this is to be done inside the allocation function, after queue has been found, cumulative sum mass along the queue, and set cut-off at the total measure of resources available.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Cumulative Mass</span>
<span class="va">df_queue_il_long_mass_cumu</span> <span class="op">&lt;-</span> <span class="va">df_queue_il_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rho_val</span> <span class="op">==</span> <span class="va">ar_rho</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">rho</span>, <span class="op">-</span><span class="va">rho_val</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_opt_caschool_prep_i</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mass <span class="op">=</span> <span class="va">enrltot</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">enrltot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_i</span>, <span class="va">mass</span><span class="op">)</span>, by<span class="op">=</span><span class="st">'id_i'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Q_il</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mass_cumu_queue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span>
<span class="co"># View Around the Teacher Available Cut-off mass</span>
<span class="va">df_queue_il_long_mass_cumu</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Q_il</span> <span class="op">&gt;=</span> <span class="va">fl_teacher_increase_number</span> <span class="op">-</span> <span class="fl">5</span> 
          <span class="op">&amp;</span> <span class="va">Q_il</span> <span class="op">&lt;=</span> <span class="va">fl_teacher_increase_number</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 11 x 9</span></span>
<span class="co">##     id_i id_il D_max_i  D_il  Q_il D_Wbin_il V_star_Q_il    mass mass_cumu_queue</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>    97 <span style="text-decoration: underline;">16</span>260      95    55 <span style="text-decoration: underline;">10</span>835         1     <span style="text-decoration: underline;">294</span>663. 0.001<span style="text-decoration: underline;">67</span>            14.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>   339 <span style="text-decoration: underline;">47</span>438     135    43 <span style="text-decoration: underline;">10</span>836         1     <span style="text-decoration: underline;">294</span>663. 0.002<span style="text-decoration: underline;">35</span>            14.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>   406 <span style="text-decoration: underline;">52</span>898     132    37 <span style="text-decoration: underline;">10</span>837         1     <span style="text-decoration: underline;">294</span>663. 0.002<span style="text-decoration: underline;">12</span>            14.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>   282 <span style="text-decoration: underline;">40</span>715      89    59 <span style="text-decoration: underline;">10</span>838         1     <span style="text-decoration: underline;">294</span>663. 0.001<span style="text-decoration: underline;">62</span>            14.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>    72 <span style="text-decoration: underline;">13</span>654     141    50 <span style="text-decoration: underline;">10</span>839         1     <span style="text-decoration: underline;">294</span>663. 0.002<span style="text-decoration: underline;">71</span>            14.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>   412 <span style="text-decoration: underline;">53</span>590      87    40 <span style="text-decoration: underline;">10</span>840         1     <span style="text-decoration: underline;">294</span>663. 0.001<span style="text-decoration: underline;">19</span>            14.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>    45  <span style="text-decoration: underline;">5</span>664     221     7 <span style="text-decoration: underline;">10</span>841         0         <span style="color: #BB0000;">NA</span>  0.003<span style="text-decoration: underline;">86</span>            14.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>   411 <span style="text-decoration: underline;">53</span>444     139    33 <span style="text-decoration: underline;">10</span>842         0         <span style="color: #BB0000;">NA</span>  0.002<span style="text-decoration: underline;">19</span>            14.4</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>   351 <span style="text-decoration: underline;">49</span>277     127    49 <span style="text-decoration: underline;">10</span>843         0         <span style="color: #BB0000;">NA</span>  0.002<span style="text-decoration: underline;">30</span>            14.4</span>
<span class="co">## <span style="color: #BCBCBC;">10</span>   404 <span style="text-decoration: underline;">52</span>726     112    42 <span style="text-decoration: underline;">10</span>844         0         <span style="color: #BB0000;">NA</span>  0.001<span style="text-decoration: underline;">76</span>            14.4</span>
<span class="co">## <span style="color: #BCBCBC;">11</span>   373 <span style="text-decoration: underline;">50</span>222      80    59 <span style="text-decoration: underline;">10</span>845         0         <span style="color: #BB0000;">NA</span>  0.001<span style="text-decoration: underline;">43</span>            14.4</span></code></pre>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Summarize</span>
<span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html" class="external-link">ff_summ_percentiles</a></span><span class="op">(</span><span class="va">df_queue_il_long_mass_cumu</span>, bl_statsasrows<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: `funs()` was deprecated in dplyr 0.8.0.</span>
<span class="co">## Please use a list of either functions or lambdas: </span>
<span class="co">## </span>
<span class="co">##   # Simple named list: </span>
<span class="co">##   list(mean = mean, median = median)</span>
<span class="co">## </span>
<span class="co">##   # Auto named with `tibble::lst()`: </span>
<span class="co">##   tibble::lst(mean, median)</span>
<span class="co">## </span>
<span class="co">##   # Using lambdas</span>
<span class="co">##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))</span>
<span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span>
<span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</span></span></code></pre>
<pre><code><span class="co">## Warning: `as.tibble()` was deprecated in tibble 2.0.0.</span>
<span class="co">## Please use `as_tibble()` instead.</span>
<span class="co">## The signature and semantics have changed, see `?as_tibble`.</span>
<span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span>
<span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</span></span></code></pre>
<pre><code><span class="co">## Warning: attributes are not identical across measure variables;</span>
<span class="co">## they will be dropped</span></code></pre>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 9 x 19</span></span>
<span class="co">##   var          n unique NAobs ZEROobs      mean      sd      cv     min      p01</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> D.il     <span style="text-decoration: underline;">54</span>204   <span style="text-decoration: underline;">1</span>429     0       0   2.02<span style="color: #949494;">e</span>+2 2.25<span style="color: #949494;">e</span>+2 1.11    1   <span style="color: #949494;">e</span>+0  2   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> D.max.i  <span style="text-decoration: underline;">54</span>204    203     0       0   4.02<span style="color: #949494;">e</span>+2 3.33<span style="color: #949494;">e</span>+2 0.829   5   <span style="color: #949494;">e</span>+0  1.2 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> D.Wbin.~ <span style="text-decoration: underline;">54</span>204      2     0   <span style="text-decoration: underline;">43</span>364   2.00<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 4.00<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 2.00    0   <span style="color: #949494;"> </span>    0   <span style="color: #949494;"> </span>  </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> id.i     <span style="text-decoration: underline;">54</span>204    420     0       0   1.83<span style="color: #949494;">e</span>+2 1.16<span style="color: #949494;">e</span>+2 0.635   1   <span style="color: #949494;">e</span>+0  1.6 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> id.il    <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   2.71<span style="color: #949494;">e</span>+4 1.56<span style="color: #949494;">e</span>+4 0.577   1   <span style="color: #949494;">e</span>+0  5.43<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> mass     <span style="text-decoration: underline;">54</span>204    391     0       0   7.51<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 6.21<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 0.827   7.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  2.02<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span>
<span class="co">## <span style="color: #BCBCBC;">7</span> mass.cu~ <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   1.22<span style="color: #949494;">e</span>+2 1.14<span style="color: #949494;">e</span>+2 0.931   1.17<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>  1.07<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span></span>
<span class="co">## <span style="color: #BCBCBC;">8</span> Q.il     <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   2.71<span style="color: #949494;">e</span>+4 1.56<span style="color: #949494;">e</span>+4 0.577   1   <span style="color: #949494;">e</span>+0  5.43<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">9</span> V.star.~ <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">10</span>841 <span style="text-decoration: underline;">43</span>364      <span style="color: #BB0000;">NA</span>   2.94<span style="color: #949494;">e</span>+5 6.07<span style="color: #949494;">e</span>+2 0.002<span style="text-decoration: underline;">06</span> 2.92<span style="color: #949494;">e</span>+5  2.92<span style="color: #949494;">e</span>+5</span>
<span class="co">## <span style="color: #949494;"># ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="generate-the-mass-variable">Generate The mass Variable<a class="anchor" aria-label="anchor" href="#generate-the-mass-variable"></a>
</h3>
<p>The mass variable is not contained in <em>df_opt_caschool_prep_i</em>, but is contained in <em>df_opt_caschool_prep_i</em>, merge together to get that number of students as mass. This variable does not need to sum to one. Reweighting to sum to one should not change results.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Summarize</span>
<span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html" class="external-link">ff_summ_percentiles</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_il</span>, bl_statsasrows<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: attributes are not identical across measure variables;</span>
<span class="co">## they will be dropped</span></code></pre>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 7 x 19</span></span>
<span class="co">##   var          n unique NAobs ZEROobs       mean       sd     cv     min     p01</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> A.il     <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   656.      1.69<span style="color: #949494;">e</span>+1 0.025<span style="text-decoration: underline;">8</span> 6.13<span style="color: #949494;">e</span>+2 6.24<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> alpha.il <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">53</span>590     0       0     0.066<span style="text-decoration: underline;">2</span>  1.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 2.17   2.90<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 4.14<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span></span>
<span class="co">## <span style="color: #BCBCBC;">3</span> beta.i   <span style="text-decoration: underline;">54</span>204      1     0       0     1       0   <span style="color: #949494;"> </span>   0      1   <span style="color: #949494;">e</span>+0 1   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> D.il     <span style="text-decoration: underline;">54</span>204   <span style="text-decoration: underline;">1</span>429     0       0   202.      2.25<span style="color: #949494;">e</span>+2 1.11   1   <span style="color: #949494;">e</span>+0 2   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> D.max.i  <span style="text-decoration: underline;">54</span>204    203     0       0   402.      3.33<span style="color: #949494;">e</span>+2 0.829  5   <span style="color: #949494;">e</span>+0 1.2 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> id.i     <span style="text-decoration: underline;">54</span>204    420     0       0   183.      1.16<span style="color: #949494;">e</span>+2 0.635  1   <span style="color: #949494;">e</span>+0 1.6 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">7</span> id.il    <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0 <span style="text-decoration: underline;">27</span>102.      1.56<span style="color: #949494;">e</span>+4 0.577  1   <span style="color: #949494;">e</span>+0 5.43<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #949494;"># ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</span></span></code></pre>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html" class="external-link">ff_summ_percentiles</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_ib</span>, bl_statsasrows<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: attributes are not identical across measure variables;</span>
<span class="co">## they will be dropped</span></code></pre>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 4 x 19</span></span>
<span class="co">##   var          n unique NAobs ZEROobs   mean      sd     cv    min    p01    p05</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> A.i.l0     420    420     0       0 654.    17.2   0.026<span style="text-decoration: underline;">4</span> 613.   618.   624.  </span>
<span class="co">## <span style="color: #BCBCBC;">2</span> alpha.o~   420    410     0       0   2.84   0.327 0.115    1.81   1.95   2.27</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> beta.i     420      1     0       0   1      0     0        1      1      1   </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> id.i       420    420     0       0 210.   121.    0.577    1      5.19  22.0 </span>
<span class="co">## <span style="color: #949494;"># ... with 8 more variables: p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;, p75 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</span></span></code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mass of Students for IL file </span>
<span class="va">df_opt_caschool_input_mass_il</span> <span class="op">&lt;-</span> <span class="va">df_opt_caschool_input_il</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_opt_caschool_prep_i</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mass_i <span class="op">=</span> <span class="va">enrltot</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">enrltot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_i</span>, <span class="va">mass_i</span><span class="op">)</span>
            , by<span class="op">=</span><span class="st">'id_i'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Mass of Students for IL file </span>
<span class="co"># IB file done with the Assumption that fl_fa_max additional teachers per school</span>
<span class="co"># Since mass per teacher/school same, total mass per school for ib allocation </span>
<span class="co"># is determined by mass_i still. Do not nuum to multiply mass by the number of teachers</span>
<span class="co"># assigned. </span>
<span class="va">df_opt_caschool_input_mass_ib</span> <span class="op">&lt;-</span> <span class="va">df_opt_caschool_input_ib</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_opt_caschool_prep_i</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mass_i <span class="op">=</span> <span class="va">enrltot</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">enrltot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cumu_sum_group_i <span class="op">=</span> <span class="va">mass_i</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">teachers</span><span class="op">*</span><span class="va">fl_fa_max</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_i</span>, <span class="va">mass_i</span>, <span class="va">cumu_sum_group_i</span>, <span class="va">teachers</span><span class="op">)</span>
            , by<span class="op">=</span><span class="st">'id_i'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Total mass</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_mass_il</span><span class="op">$</span><span class="va">mass_i</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 407.3127</span></code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_mass_ib</span><span class="op">$</span><span class="va">cumu_sum_group_i</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 81.46857</span></code></pre>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Alternative Allocation and Mass for Alternative Allocations</span>
<span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html" class="external-link">ff_summ_percentiles</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_mass_il</span>, bl_statsasrows<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: attributes are not identical across measure variables;</span>
<span class="co">## they will be dropped</span></code></pre>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 8 x 19</span></span>
<span class="co">##   var          n unique NAobs ZEROobs        mean      sd     cv     min     p01</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> A.il     <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   656.      1.69<span style="color: #949494;">e</span>+1 0.025<span style="text-decoration: underline;">8</span> 6.13<span style="color: #949494;">e</span>+2 6.24<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> alpha.il <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">53</span>590     0       0     0.066<span style="text-decoration: underline;">2</span>  1.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 2.17   2.90<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 4.14<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span></span>
<span class="co">## <span style="color: #BCBCBC;">3</span> beta.i   <span style="text-decoration: underline;">54</span>204      1     0       0     1       0   <span style="color: #949494;"> </span>   0      1   <span style="color: #949494;">e</span>+0 1   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> D.il     <span style="text-decoration: underline;">54</span>204   <span style="text-decoration: underline;">1</span>429     0       0   202.      2.25<span style="color: #949494;">e</span>+2 1.11   1   <span style="color: #949494;">e</span>+0 2   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> D.max.i  <span style="text-decoration: underline;">54</span>204    203     0       0   402.      3.33<span style="color: #949494;">e</span>+2 0.829  5   <span style="color: #949494;">e</span>+0 1.2 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> id.i     <span style="text-decoration: underline;">54</span>204    420     0       0   183.      1.16<span style="color: #949494;">e</span>+2 0.635  1   <span style="color: #949494;">e</span>+0 1.6 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">7</span> id.il    <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0 <span style="text-decoration: underline;">27</span>102.      1.56<span style="color: #949494;">e</span>+4 0.577  1   <span style="color: #949494;">e</span>+0 5.43<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">8</span> mass.i   <span style="text-decoration: underline;">54</span>204    391     0       0     0.007<span style="text-decoration: underline;">51</span> 6.21<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 0.827  7.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span> 2.02<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span>
<span class="co">## <span style="color: #949494;"># ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</span></span></code></pre>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html" class="external-link">ff_summ_percentiles</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_mass_ib</span>, bl_statsasrows<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: attributes are not identical across measure variables;</span>
<span class="co">## they will be dropped</span></code></pre>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 7 x 19</span></span>
<span class="co">##   var           n unique NAobs ZEROobs     mean      sd     cv      min      p01</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> A.i.l0      420    420     0       0  6.54<span style="color: #949494;">e</span>+2 1.72<span style="color: #949494;">e</span>+1 0.026<span style="text-decoration: underline;">4</span>  6.13<span style="color: #949494;">e</span>+2  6.18<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> alpha.o.i   420    410     0       0  2.84<span style="color: #949494;">e</span>+0 3.27<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 0.115   1.81<span style="color: #949494;">e</span>+0  1.95<span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> beta.i      420      1     0       0  1   <span style="color: #949494;">e</span>+0 0   <span style="color: #949494;"> </span>   0       1   <span style="color: #949494;">e</span>+0  1   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> cumu.sum~   420    398     0       0  1.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 6.28<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 3.24    7.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  9.33<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span>
<span class="co">## <span style="color: #BCBCBC;">5</span> id.i        420    420     0       0  2.10<span style="color: #949494;">e</span>+2 1.21<span style="color: #949494;">e</span>+2 0.577   1   <span style="color: #949494;">e</span>+0  5.19<span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> mass.i      420    391     0       0  2.38<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 3.54<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 1.49    7.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  9.33<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span>
<span class="co">## <span style="color: #BCBCBC;">7</span> teachers    420    203     0       0  1.29<span style="color: #949494;">e</span>+2 1.88<span style="color: #949494;">e</span>+2 1.46    5   <span style="color: #949494;">e</span>+0  5   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #949494;"># ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</span></span></code></pre>
<p>Within Group Cumulative Mass Sum with Allocations:</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Within Group Cumulative Sum of Mass</span>
<span class="co"># For the Value Calculation, the A and alpha are updated to be given allocation up to that point</span>
<span class="co"># that means the mass calculation is not mass at a particular unit of allocation, but mass</span>
<span class="co"># for that individual group/type, up to the point. This is a within group cumulative sum, </span>
<span class="co"># Note that so for welfare and for allocation queue, in the welfare case, we need cumulative within</span>
<span class="co"># individual group mass, and in the allocation queue, need point mass</span>

<span class="va">df_opt_caschool_input_mass_il</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id_i</span>, <span class="va">D_il</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id_i</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">D_il</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cumu_sum_group_i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">mass_i</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id_i</span>, <span class="va">D_il</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 54,204 x 9</span></span>
<span class="co">##     id_i id_il D_max_i  D_il  A_il alpha_il beta_i   mass_i cumu_sum_group_i</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>     1     1      11     1  691.    1.29       1 0.000<span style="text-decoration: underline;">177</span>         0.000<span style="text-decoration: underline;">177</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>     1     2      11     2  692.    1.09       1 0.000<span style="text-decoration: underline;">177</span>         0.000<span style="text-decoration: underline;">353</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>     1     3      11     3  693.    0.932      1 0.000<span style="text-decoration: underline;">177</span>         0.000<span style="text-decoration: underline;">530</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>     1     4      11     4  694.    0.808      1 0.000<span style="text-decoration: underline;">177</span>         0.000<span style="text-decoration: underline;">706</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>     1     5      11     5  695.    0.707      1 0.000<span style="text-decoration: underline;">177</span>         0.000<span style="text-decoration: underline;">883</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>     1     6      11     6  696.    0.624      1 0.000<span style="text-decoration: underline;">177</span>         0.001<span style="text-decoration: underline;">06</span> </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>     1     7      11     7  696.    0.554      1 0.000<span style="text-decoration: underline;">177</span>         0.001<span style="text-decoration: underline;">24</span> </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>     1     8      11     8  697.    0.496      1 0.000<span style="text-decoration: underline;">177</span>         0.001<span style="text-decoration: underline;">41</span> </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>     1     9      11     9  697.    0.446      1 0.000<span style="text-decoration: underline;">177</span>         0.001<span style="text-decoration: underline;">59</span> </span>
<span class="co">## <span style="color: #BCBCBC;">10</span>     1    10      11    10  698.    0.404      1 0.000<span style="text-decoration: underline;">177</span>         0.001<span style="text-decoration: underline;">77</span> </span>
<span class="co">## <span style="color: #949494;"># ... with 54,194 more rows</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="select-subset-of-individuals-for-allocaitons">Select Subset of Individuals For Allocaitons<a class="anchor" aria-label="anchor" href="#select-subset-of-individuals-for-allocaitons"></a>
</h3>
<p>If want to analyze more closely what is happening in a subset of cases, use the subsetting option:</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">it_O</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="va">df_cas_prep_sub_i</span> <span class="op">&lt;-</span> <span class="va">df_opt_caschool_prep_i</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">teachers</span> <span class="op">&lt;=</span> <span class="fl">100</span> <span class="op">&amp;</span> <span class="va">teachers</span> <span class="op">&gt;=</span> <span class="fl">50</span><span class="op">)</span>
<span class="va">df_cas_prep_sub_i</span> <span class="op">&lt;-</span> <span class="va">df_cas_prep_sub_i</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df_cas_prep_sub_i</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">it_O</span>, replace<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,<span class="op">]</span>
<span class="va">ar_cas_id_selected</span> <span class="op">&lt;-</span> <span class="va">df_cas_prep_sub_i</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">id_i</span><span class="op">)</span>

<span class="co"># Select from il and ib only ids that are randomly selected</span>
<span class="va">bl_subsetting</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
<span class="kw">if</span> <span class="op">(</span><span class="va">bl_subsetting</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">df_opt_caschool_input_mass_il</span> <span class="op">&lt;-</span> <span class="va">df_opt_caschool_input_mass_il</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ar_cas_id_selected</span><span class="op">)</span>
  <span class="va">df_opt_caschool_input_mass_ib</span> <span class="op">&lt;-</span> <span class="va">df_opt_caschool_input_mass_ib</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id_i</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ar_cas_id_selected</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Summarize</span>
<span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html" class="external-link">ff_summ_percentiles</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_mass_il</span>, bl_statsasrows<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: attributes are not identical across measure variables;</span>
<span class="co">## they will be dropped</span></code></pre>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 8 x 19</span></span>
<span class="co">##   var          n unique NAobs ZEROobs        mean      sd     cv     min     p01</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> A.il     <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   656.      1.69<span style="color: #949494;">e</span>+1 0.025<span style="text-decoration: underline;">8</span> 6.13<span style="color: #949494;">e</span>+2 6.24<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> alpha.il <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">53</span>590     0       0     0.066<span style="text-decoration: underline;">2</span>  1.44<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 2.17   2.90<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 4.14<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span></span>
<span class="co">## <span style="color: #BCBCBC;">3</span> beta.i   <span style="text-decoration: underline;">54</span>204      1     0       0     1       0   <span style="color: #949494;"> </span>   0      1   <span style="color: #949494;">e</span>+0 1   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> D.il     <span style="text-decoration: underline;">54</span>204   <span style="text-decoration: underline;">1</span>429     0       0   202.      2.25<span style="color: #949494;">e</span>+2 1.11   1   <span style="color: #949494;">e</span>+0 2   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> D.max.i  <span style="text-decoration: underline;">54</span>204    203     0       0   402.      3.33<span style="color: #949494;">e</span>+2 0.829  5   <span style="color: #949494;">e</span>+0 1.2 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> id.i     <span style="text-decoration: underline;">54</span>204    420     0       0   183.      1.16<span style="color: #949494;">e</span>+2 0.635  1   <span style="color: #949494;">e</span>+0 1.6 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">7</span> id.il    <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0 <span style="text-decoration: underline;">27</span>102.      1.56<span style="color: #949494;">e</span>+4 0.577  1   <span style="color: #949494;">e</span>+0 5.43<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">8</span> mass.i   <span style="text-decoration: underline;">54</span>204    391     0       0     0.007<span style="text-decoration: underline;">51</span> 6.21<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 0.827  7.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span> 2.02<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span>
<span class="co">## <span style="color: #949494;"># ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</span></span></code></pre>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html" class="external-link">ff_summ_percentiles</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_mass_ib</span>, bl_statsasrows<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: attributes are not identical across measure variables;</span>
<span class="co">## they will be dropped</span></code></pre>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 7 x 19</span></span>
<span class="co">##   var           n unique NAobs ZEROobs     mean      sd     cv      min      p01</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> A.i.l0      420    420     0       0  6.54<span style="color: #949494;">e</span>+2 1.72<span style="color: #949494;">e</span>+1 0.026<span style="text-decoration: underline;">4</span>  6.13<span style="color: #949494;">e</span>+2  6.18<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> alpha.o.i   420    410     0       0  2.84<span style="color: #949494;">e</span>+0 3.27<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 0.115   1.81<span style="color: #949494;">e</span>+0  1.95<span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> beta.i      420      1     0       0  1   <span style="color: #949494;">e</span>+0 0   <span style="color: #949494;"> </span>   0       1   <span style="color: #949494;">e</span>+0  1   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> cumu.sum~   420    398     0       0  1.94<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 6.28<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 3.24    7.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  9.33<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span>
<span class="co">## <span style="color: #BCBCBC;">5</span> id.i        420    420     0       0  2.10<span style="color: #949494;">e</span>+2 1.21<span style="color: #949494;">e</span>+2 0.577   1   <span style="color: #949494;">e</span>+0  5.19<span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> mass.i      420    391     0       0  2.38<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 3.54<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 1.49    7.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  9.33<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span></span>
<span class="co">## <span style="color: #BCBCBC;">7</span> teachers    420    203     0       0  1.29<span style="color: #949494;">e</span>+2 1.88<span style="color: #949494;">e</span>+2 1.46    5   <span style="color: #949494;">e</span>+0  5   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #949494;"># ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="optimal-allocations">Optimal Allocations<a class="anchor" aria-label="anchor" href="#optimal-allocations"></a>
</h3>
<div class="section level4">
<h4 id="optimal-allocation-with-number-of-teachers-as-before">Optimal Allocation with Number of Teachers as before<a class="anchor" aria-label="anchor" href="#optimal-allocation-with-number-of-teachers-as-before"></a>
</h4>
<p>Copying the code from prior, use <em>fl_teacher_increase_sub_number</em> and <em>df_opt_caschool_input_mass_il</em> without the mass column <em>mass_i</em> specified.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Measure of Available Teachers</span>
<span class="va">fl_teacher_increase_sub_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_mass_ib</span><span class="op">$</span><span class="va">teachers</span><span class="op">)</span><span class="op">*</span><span class="va">fl_fa_max</span>
<span class="va">fl_teacher_increase_sub_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">fl_teacher_increase_sub_number</span><span class="op">)</span>
<span class="co"># Allocate Based on the Measure of Available Teachers</span>
<span class="va">ls_df_queue</span> <span class="op">&lt;-</span> <span class="fu">PrjOptiAlloc</span><span class="fu">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span><span class="op">(</span>
  <span class="va">ar_rho</span>,
  <span class="va">fl_teacher_increase_sub_number</span>,
  bl_df_alloc_il <span class="op">=</span> <span class="cn">TRUE</span>,
  df_input_il <span class="op">=</span> <span class="va">df_opt_caschool_input_mass_il</span>,
  svr_rho <span class="op">=</span> <span class="st">'rho'</span>,
  svr_id_i <span class="op">=</span> <span class="st">'id_i'</span>, svr_id_il <span class="op">=</span> <span class="st">'id_il'</span>,
  svr_D_max_i <span class="op">=</span> <span class="st">'D_max_i'</span>, svr_D_il <span class="op">=</span> <span class="st">'D_il'</span>,
  svr_D_star_i <span class="op">=</span> <span class="st">'D_star_i'</span>, svr_F_star_i <span class="op">=</span> <span class="st">'F_star_i'</span>,
  svr_inpalc <span class="op">=</span> <span class="st">'Q_il'</span>, svr_D_Wbin_il <span class="op">=</span> <span class="st">'D_Wbin_il'</span>,
  svr_A_il <span class="op">=</span> <span class="st">'A_il'</span>, svr_alpha_il <span class="op">=</span> <span class="st">'alpha_il'</span>, 
  svr_beta_i <span class="op">=</span> <span class="st">'beta_i'</span>,
  svr_expout <span class="op">=</span> <span class="st">'opti_exp_outcome'</span>,
  st_idcol_prefix <span class="op">=</span> <span class="st">'sid_'</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Joining, by = "id_il"</span></code></pre>
<pre><code><span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(rev)`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(alloc_i_upto_Q)`</span></code></pre>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_queue_il_long_count</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_queue_il_long</span>
<span class="va">df_queue_il_wide_count</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_queue_il_wide</span>
<span class="va">df_alloc_i_long_count</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_alloc_i_long</span>
<span class="va">df_rho_gini_count</span>  <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_rho_gini</span>
<span class="va">df_alloc_il_long_count</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_alloc_il_long</span></code></pre></div>
<div class="section level5">
<h5 id="analyze-measure-at-count-allocation">Analyze Measure at Count Allocation<a class="anchor" aria-label="anchor" href="#analyze-measure-at-count-allocation"></a>
</h5>
<p>Analyze results using the total measure threshold from the measure allocation</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Cumulative Mass</span>
<span class="va">df_queue_il_long_mass_cntcumu</span> <span class="op">&lt;-</span> <span class="va">df_queue_il_long_count</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rho_val</span> <span class="op">==</span> <span class="va">ar_rho</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">rho</span>, <span class="op">-</span><span class="va">rho_val</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df_opt_caschool_prep_i</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mass_i <span class="op">=</span> <span class="va">enrltot</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">enrltot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id_i</span>, <span class="va">mass_i</span><span class="op">)</span>, by<span class="op">=</span><span class="st">'id_i'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Q_il</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mass_cumu_il <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">mass_i</span><span class="op">)</span><span class="op">)</span>
<span class="co"># View Around the Teacher Available Cut-off mass</span>
<span class="va">df_queue_il_long_mass_cntcumu</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Q_il</span> <span class="op">&gt;=</span> <span class="va">fl_teacher_increase_sub_number</span> <span class="op">-</span> <span class="fl">4</span>
          <span class="op">&amp;</span> <span class="va">Q_il</span> <span class="op">&lt;=</span> <span class="va">fl_teacher_increase_sub_number</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 9 x 9</span></span>
<span class="co">##    id_i id_il D_max_i  D_il  Q_il D_Wbin_il V_star_Q_il  mass_i mass_cumu_il</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>   339 <span style="text-decoration: underline;">47</span>438     135    43 <span style="text-decoration: underline;">10</span>836         1     <span style="text-decoration: underline;">294</span>663. 0.002<span style="text-decoration: underline;">35</span>         14.4</span>
<span class="co">## <span style="color: #BCBCBC;">2</span>   406 <span style="text-decoration: underline;">52</span>898     132    37 <span style="text-decoration: underline;">10</span>837         1     <span style="text-decoration: underline;">294</span>663. 0.002<span style="text-decoration: underline;">12</span>         14.4</span>
<span class="co">## <span style="color: #BCBCBC;">3</span>   282 <span style="text-decoration: underline;">40</span>715      89    59 <span style="text-decoration: underline;">10</span>838         1     <span style="text-decoration: underline;">294</span>663. 0.001<span style="text-decoration: underline;">62</span>         14.4</span>
<span class="co">## <span style="color: #BCBCBC;">4</span>    72 <span style="text-decoration: underline;">13</span>654     141    50 <span style="text-decoration: underline;">10</span>839         1     <span style="text-decoration: underline;">294</span>663. 0.002<span style="text-decoration: underline;">71</span>         14.4</span>
<span class="co">## <span style="color: #BCBCBC;">5</span>   412 <span style="text-decoration: underline;">53</span>590      87    40 <span style="text-decoration: underline;">10</span>840         1     <span style="text-decoration: underline;">294</span>663. 0.001<span style="text-decoration: underline;">19</span>         14.4</span>
<span class="co">## <span style="color: #BCBCBC;">6</span>    45  <span style="text-decoration: underline;">5</span>664     221     7 <span style="text-decoration: underline;">10</span>841         0         <span style="color: #BB0000;">NA</span>  0.003<span style="text-decoration: underline;">86</span>         14.4</span>
<span class="co">## <span style="color: #BCBCBC;">7</span>   411 <span style="text-decoration: underline;">53</span>444     139    33 <span style="text-decoration: underline;">10</span>842         0         <span style="color: #BB0000;">NA</span>  0.002<span style="text-decoration: underline;">19</span>         14.4</span>
<span class="co">## <span style="color: #BCBCBC;">8</span>   351 <span style="text-decoration: underline;">49</span>277     127    49 <span style="text-decoration: underline;">10</span>843         0         <span style="color: #BB0000;">NA</span>  0.002<span style="text-decoration: underline;">30</span>         14.4</span>
<span class="co">## <span style="color: #BCBCBC;">9</span>   404 <span style="text-decoration: underline;">52</span>726     112    42 <span style="text-decoration: underline;">10</span>844         0         <span style="color: #BB0000;">NA</span>  0.001<span style="text-decoration: underline;">76</span>         14.4</span></code></pre>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Summarize</span>
<span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html" class="external-link">ff_summ_percentiles</a></span><span class="op">(</span><span class="va">df_queue_il_long_mass_cntcumu</span>, bl_statsasrows<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: attributes are not identical across measure variables;</span>
<span class="co">## they will be dropped</span></code></pre>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 9 x 19</span></span>
<span class="co">##   var         n unique NAobs ZEROobs      mean       sd      cv     min      p01</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> D.il    <span style="text-decoration: underline;">54</span>204   <span style="text-decoration: underline;">1</span>429     0       0   2.02<span style="color: #949494;">e</span>+2  2.25<span style="color: #949494;">e</span>+2 1.11    1   <span style="color: #949494;">e</span>+0  2   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> D.max.i <span style="text-decoration: underline;">54</span>204    203     0       0   4.02<span style="color: #949494;">e</span>+2  3.33<span style="color: #949494;">e</span>+2 0.829   5   <span style="color: #949494;">e</span>+0  1.2 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> D.Wbin~ <span style="text-decoration: underline;">54</span>204      2     0   <span style="text-decoration: underline;">43</span>364   2.00<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span>  4.00<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 2.00    0   <span style="color: #949494;"> </span>    0   <span style="color: #949494;"> </span>  </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> id.i    <span style="text-decoration: underline;">54</span>204    420     0       0   1.83<span style="color: #949494;">e</span>+2  1.16<span style="color: #949494;">e</span>+2 0.635   1   <span style="color: #949494;">e</span>+0  1.6 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> id.il   <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   2.71<span style="color: #949494;">e</span>+4  1.56<span style="color: #949494;">e</span>+4 0.577   1   <span style="color: #949494;">e</span>+0  5.43<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> mass.c~ <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   1.22<span style="color: #949494;">e</span>+2  1.14<span style="color: #949494;">e</span>+2 0.931   1.17<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>  1.07<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span></span>
<span class="co">## <span style="color: #BCBCBC;">7</span> mass.i  <span style="text-decoration: underline;">54</span>204    391     0       0   7.51<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span>  6.21<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 0.827   7.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  2.02<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span>
<span class="co">## <span style="color: #BCBCBC;">8</span> Q.il    <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   2.71<span style="color: #949494;">e</span>+4  1.56<span style="color: #949494;">e</span>+4 0.577   1   <span style="color: #949494;">e</span>+0  5.43<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">9</span> V.star~ <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">10</span>841 <span style="text-decoration: underline;">43</span>364      <span style="color: #BB0000;">NA</span>   2.94<span style="color: #949494;">e</span>+5  6.07<span style="color: #949494;">e</span>+2 0.002<span style="text-decoration: underline;">06</span> 2.92<span style="color: #949494;">e</span>+5  2.92<span style="color: #949494;">e</span>+5</span>
<span class="co">## <span style="color: #949494;"># ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="optimal-allocation-with-mass">Optimal Allocation with Mass<a class="anchor" aria-label="anchor" href="#optimal-allocation-with-mass"></a>
</h4>
<p>Same as before, but now include the mass column:</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Measure of Available Teachers</span>
<span class="va">fl_measure_teacher_increase_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_opt_caschool_input_mass_ib</span><span class="op">$</span><span class="va">cumu_sum_group_i</span><span class="op">)</span>
<span class="co"># Allocate Based on the Measure of Available Teachers</span>
<span class="va">ls_df_queue</span> <span class="op">&lt;-</span> <span class="fu">PrjOptiAlloc</span><span class="fu">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span><span class="op">(</span>
  <span class="va">ar_rho</span>,
  <span class="va">fl_measure_teacher_increase_number</span>,
  bl_df_alloc_il <span class="op">=</span> <span class="cn">TRUE</span>,
  df_input_il <span class="op">=</span> <span class="va">df_opt_caschool_input_mass_il</span>,
  svr_rho <span class="op">=</span> <span class="st">'rho'</span>,
  svr_id_i <span class="op">=</span> <span class="st">'id_i'</span>, svr_id_il <span class="op">=</span> <span class="st">'id_il'</span>,
  svr_D_max_i <span class="op">=</span> <span class="st">'D_max_i'</span>, svr_D_il <span class="op">=</span> <span class="st">'D_il'</span>,
  svr_D_star_i <span class="op">=</span> <span class="st">'D_star_i'</span>, svr_F_star_i <span class="op">=</span> <span class="st">'F_star_i'</span>,
  svr_inpalc <span class="op">=</span> <span class="st">'Q_il'</span>, svr_D_Wbin_il <span class="op">=</span> <span class="st">'D_Wbin_il'</span>,
  svr_A_il <span class="op">=</span> <span class="st">'A_il'</span>, svr_alpha_il <span class="op">=</span> <span class="st">'alpha_il'</span>, 
  svr_beta_i <span class="op">=</span> <span class="st">'beta_i'</span>,
  svr_measure_i <span class="op">=</span> <span class="st">'mass_i'</span>,
  svr_expout <span class="op">=</span> <span class="st">'opti_exp_outcome'</span>,
  st_idcol_prefix <span class="op">=</span> <span class="st">'sid_'</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Joining, by = "id_il"</span></code></pre>
<pre><code><span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span>
<span class="co">## Adding missing grouping variables: `id_i`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(rev)`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(alloc_i_upto_Q)`</span></code></pre>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_queue_il_long_mass</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_queue_il_long</span>
<span class="va">df_queue_il_wide_mass</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_queue_il_wide</span>
<span class="va">df_alloc_i_long_mass</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_alloc_i_long</span>
<span class="va">df_rho_gini_mass</span>  <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_rho_gini</span>
<span class="va">df_alloc_il_long_mass</span> <span class="op">&lt;-</span> <span class="va">ls_df_queue</span><span class="op">$</span><span class="va">df_alloc_il_long</span></code></pre></div>
<div class="section level5">
<h5 id="analyze-measure-at-mass-allocation">Analyze Measure at Mass Allocation<a class="anchor" aria-label="anchor" href="#analyze-measure-at-mass-allocation"></a>
</h5>
<p>Analyze the Allocation Results based on measure:</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_queue_il_long_mass</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">rho_val</span> <span class="op">==</span> <span class="va">ar_rho</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">rho</span>, <span class="op">-</span><span class="va">rho_val</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Q_il</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mass_cumu_il</span> <span class="op">&gt;=</span> <span class="va">fl_measure_teacher_increase_number</span> <span class="op">-</span> <span class="fl">0.01</span>
          <span class="op">&amp;</span> <span class="va">mass_cumu_il</span> <span class="op">&lt;=</span> <span class="va">fl_measure_teacher_increase_number</span> <span class="op">+</span> <span class="fl">0.01</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 3 x 8</span></span>
<span class="co">##    id_i id_il D_max_i  D_il  Q_il D_Wbin_il mass_cumu_il V_star_Q_il</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>   264 <span style="text-decoration: underline;">38</span>122     550    33 <span style="text-decoration: underline;">25</span>779         1         81.5        654.</span>
<span class="co">## <span style="color: #BCBCBC;">2</span>   220 <span style="text-decoration: underline;">32</span>688     408    79 <span style="text-decoration: underline;">25</span>780         0         81.5         <span style="color: #BB0000;">NA</span> </span>
<span class="co">## <span style="color: #BCBCBC;">3</span>   105 <span style="text-decoration: underline;">17</span>069     228   154 <span style="text-decoration: underline;">25</span>781         0         81.5         <span style="color: #BB0000;">NA</span></span></code></pre>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Summarize</span>
<span class="fu">REconTools</span><span class="fu">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html" class="external-link">ff_summ_percentiles</a></span><span class="op">(</span><span class="va">df_queue_il_long_mass_cumu</span>, bl_statsasrows<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: attributes are not identical across measure variables;</span>
<span class="co">## they will be dropped</span></code></pre>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 9 x 19</span></span>
<span class="co">##   var          n unique NAobs ZEROobs      mean      sd      cv     min      p01</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> D.il     <span style="text-decoration: underline;">54</span>204   <span style="text-decoration: underline;">1</span>429     0       0   2.02<span style="color: #949494;">e</span>+2 2.25<span style="color: #949494;">e</span>+2 1.11    1   <span style="color: #949494;">e</span>+0  2   <span style="color: #949494;">e</span>+0</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> D.max.i  <span style="text-decoration: underline;">54</span>204    203     0       0   4.02<span style="color: #949494;">e</span>+2 3.33<span style="color: #949494;">e</span>+2 0.829   5   <span style="color: #949494;">e</span>+0  1.2 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> D.Wbin.~ <span style="text-decoration: underline;">54</span>204      2     0   <span style="text-decoration: underline;">43</span>364   2.00<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 4.00<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span> 2.00    0   <span style="color: #949494;"> </span>    0   <span style="color: #949494;"> </span>  </span>
<span class="co">## <span style="color: #BCBCBC;">4</span> id.i     <span style="text-decoration: underline;">54</span>204    420     0       0   1.83<span style="color: #949494;">e</span>+2 1.16<span style="color: #949494;">e</span>+2 0.635   1   <span style="color: #949494;">e</span>+0  1.6 <span style="color: #949494;">e</span>+1</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> id.il    <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   2.71<span style="color: #949494;">e</span>+4 1.56<span style="color: #949494;">e</span>+4 0.577   1   <span style="color: #949494;">e</span>+0  5.43<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">6</span> mass     <span style="text-decoration: underline;">54</span>204    391     0       0   7.51<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 6.21<span style="color: #949494;">e</span><span style="color: #BB0000;">-3</span> 0.827   7.34<span style="color: #949494;">e</span><span style="color: #BB0000;">-5</span>  2.02<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span>
<span class="co">## <span style="color: #BCBCBC;">7</span> mass.cu~ <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   1.22<span style="color: #949494;">e</span>+2 1.14<span style="color: #949494;">e</span>+2 0.931   1.17<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span>  1.07<span style="color: #949494;">e</span><span style="color: #BB0000;">-1</span></span>
<span class="co">## <span style="color: #BCBCBC;">8</span> Q.il     <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">54</span>204     0       0   2.71<span style="color: #949494;">e</span>+4 1.56<span style="color: #949494;">e</span>+4 0.577   1   <span style="color: #949494;">e</span>+0  5.43<span style="color: #949494;">e</span>+2</span>
<span class="co">## <span style="color: #BCBCBC;">9</span> V.star.~ <span style="text-decoration: underline;">54</span>204  <span style="text-decoration: underline;">10</span>841 <span style="text-decoration: underline;">43</span>364      <span style="color: #BB0000;">NA</span>   2.94<span style="color: #949494;">e</span>+5 6.07<span style="color: #949494;">e</span>+2 0.002<span style="text-decoration: underline;">06</span> 2.92<span style="color: #949494;">e</span>+5  2.92<span style="color: #949494;">e</span>+5</span>
<span class="co">## <span style="color: #949494;"># ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="compare-measure-and-count-allocation-results">Compare Measure and Count Allocation Results<a class="anchor" aria-label="anchor" href="#compare-measure-and-count-allocation-results"></a>
</h4>
<p>Under the Utilitarian <em>filter(rho_val == ar_rho[1])</em>:</p>
<p>Based on count, there were 30 teacher spots to allocate, and we move up to queue position 30 for allocation. Based on relative measure/weight, because the schools with more teacher spots assigned under alternative allocation also had higher weight, so we end up with a measure such that the 10 + 20 teachers assigned to each type of school, when looked at on the queue, sorted by queue position, and cumulatively summed with the weight of school school type, ends up giving us enough to go to the 38th queue position. So ignoring the weight of the schools, we would have allocated incorrectly, because we thought there were only 30 slots to be allocated, but given weights, there are actually up to the 38th spot on the queue.</p>
<p>Under <em>filter(rho_val == ar_rho[2], [3], [4])</em>:</p>
<p>Under alternative planners, importantly, the queue is different, hence cumulative weight up the queue is different, so the number of “spots” that could be allocated is different. There are 37, 31, 24 spots that are allocated under increasing Rawlsian preferences. This reflects the fact that under more Rawlsian preferences, the districts more more students are ranked higher on the queue, and they take up more mass. At the extreme, given N=2, all the mass from the smaller mass type go to the larger mass type, so the queue goes up to how many spots the larger school districts were assigned uniformly, and additional spot for the larger school if the school smallers’ additional teachers are equally assigned to larger schools given relative mass of smaller and larger schools.</p>
</div>
</div>
<div class="section level3">
<h3 id="rev-compute-1">REV Compute<a class="anchor" aria-label="anchor" href="#rev-compute-1"></a>
</h3>
<div class="section level4">
<h4 id="rev-compute-with-count">REV Compute with Count<a class="anchor" aria-label="anchor" href="#rev-compute-with-count"></a>
</h4>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tb_rho_rev_count</span> <span class="op">&lt;-</span>
  <span class="fu">PrjOptiAlloc</span><span class="fu">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span><span class="op">(</span><span class="va">ar_rho</span>,
                          <span class="va">fl_teacher_increase_sub_number</span>,
                          df_input_ib <span class="op">=</span> <span class="va">df_opt_caschool_input_mass_ib</span>,
                          df_queue_il_long_with_V <span class="op">=</span> <span class="va">df_queue_il_long_count</span>,
                          svr_beta_i <span class="op">=</span> <span class="st">'beta_i'</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(rev)`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(fl_util_alter_alloc)`</span></code></pre>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tb_rho_rev_count</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 4 x 4</span></span>
<span class="co">##     rho rho_val   REV AlterOutcome</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>     1   0.99  0.836      <span style="text-decoration: underline;">293</span>297.</span>
<span class="co">## <span style="color: #BCBCBC;">2</span>     2   0.785 0.836     1<span style="text-decoration: underline;">449</span>231.</span>
<span class="co">## <span style="color: #BCBCBC;">3</span>     3  -<span style="color: #BB0000;">3.64</span>  0.831         125.</span>
<span class="co">## <span style="color: #BCBCBC;">4</span>     4 -<span style="color: #BB0000;">99</span>     0.949         601.</span></code></pre>
</div>
<div class="section level4">
<h4 id="rev-compute-with-mass">REV Compute with Mass<a class="anchor" aria-label="anchor" href="#rev-compute-with-mass"></a>
</h4>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tb_rho_rev_mass</span> <span class="op">&lt;-</span>
  <span class="fu">PrjOptiAlloc</span><span class="fu">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span><span class="op">(</span><span class="va">ar_rho</span>,
                          <span class="va">fl_measure_teacher_increase_number</span>,
                          df_input_ib <span class="op">=</span> <span class="va">df_opt_caschool_input_mass_ib</span>,
                          df_queue_il_long_with_V <span class="op">=</span> <span class="va">df_queue_il_long_mass</span>,
                          svr_beta_i <span class="op">=</span> <span class="st">'beta_i'</span>, svr_measure_i <span class="op">=</span> <span class="st">'mass_i'</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(rev)`</span></code></pre>
<pre><code><span class="co">## Warning: `cols` is now required when using unnest().</span>
<span class="co">## Please use `cols = c(fl_util_alter_alloc)`</span></code></pre>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">tb_rho_rev_mass</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 4 x 4</span></span>
<span class="co">##     rho rho_val   REV AlterOutcome</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span>     1   0.99  0.607         653.</span>
<span class="co">## <span style="color: #BCBCBC;">2</span>     2   0.785 0.606         653.</span>
<span class="co">## <span style="color: #BCBCBC;">3</span>     3  -<span style="color: #BB0000;">3.64</span>  0.583         652.</span>
<span class="co">## <span style="color: #BCBCBC;">4</span>     4 -<span style="color: #BB0000;">99</span>     0.911         638.</span></code></pre>
</div>
<div class="section level4">
<h4 id="rev-results-analysis">REV results Analysis<a class="anchor" aria-label="anchor" href="#rev-results-analysis"></a>
</h4>
<p>Since we are comparing against uniform allocation, the REV difference is the smallest when we consider close to cobb-douglas preferences. The Utilitarian as well as the Rawlsian planner are both interested in allocating in an unequal way. The Utilitarian wants to allocate more to for higher alpha, the Rawlsian wants to allocate more to lower A. The Cobb Douglas planner seeks a balance between the two alternatives.</p>
<p>Depending on the Alternative allocation, the REV results might be decreasing, increasing, or have different patterns.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://fanwangecon.github.io" class="external-link">Fan Wang</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
