<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Function Test Discrete Allocation with Linear Regression • Optimal Allocation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Function Test Discrete Allocation with Linear Regression">
<meta property="og:description" content="Test binary optimal allocation solution function from package.
Use the California student test score dataset, same as line by line.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Optimal Allocation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/PrjOptiAlloc.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue.pdf">Paper</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue_Present.pdf">Slides</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Sites
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://fanwangecon.github.io/REconTools/">R Tools for Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/R4Econ/">R Examples Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stat4Econ/">R Examples Introductory Statistics</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stata4Econ/">Stata Examples Regressions and Tables</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/M4Econ/">Matlab Examples Matrix and Graphs</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Math4Econ/">Matlab Introductory Math for Econ</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Tex4Econ/">Latex and Paper Generation Examples</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/pyfan/">Python Examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://fanwangecon.github.io/">Fan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fanwangecon/PrjOptiAlloc">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fanwangecon">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ffv_opt_sodis_rkone_casch_allfn_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Function Test Discrete Allocation with Linear Regression</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/master/vignettes/ffv_opt_sodis_rkone_casch_allfn.Rmd"><code>vignettes/ffv_opt_sodis_rkone_casch_allfn.Rmd</code></a></small>
      <div class="hidden name"><code>ffv_opt_sodis_rkone_casch_allfn.Rmd</code></div>

    </div>

    
    
<p>Test discrete optimal allocation solution line by line without function. Use the California student test score dataset. Regress student English and Math test scores on Student-Teacher-Ratio.</p>
<p>This function produces the same results as <a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_sodis_rkone_casch_allrw.html">DISCRETE–Discrete Optimal Allocation California Teacher Student Ratio (Line by Line)</a>. The differences are:</p>
<ol style="list-style-type: decimal">
<li>the program here uses the dataframes created by the line by line file as Inputs</li>
<li>the program here uses functions that are identical to the line by line function, but are saved in the R folder.</li>
</ol>
<p>This file, by invoking functions, is much shorter than the line by line program.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>(<span class="kw">all.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">knitr.duplicate.label</span> <span class="kw">=</span> <span class="st">'allow'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">broom</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">REconTools</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">PrjOptiAlloc</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">kableExtra</span>)</pre></body></html></div>
<div id="hand-input-data-example" class="section level2">
<h2 class="hasAnchor">
<a href="#hand-input-data-example" class="anchor"></a>Hand Input Data Example</h2>
<p>Set Preference Array:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - (<span class="fl">10</span>^(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">2</span>,<span class="fl">2</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">4</span>))))
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">ar_rho</span>)
<span class="no">it_w_agg</span> <span class="kw">&lt;-</span> <span class="fl">5</span></pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">id_i</span>    <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>)
<span class="no">id_il</span>   <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>)
<span class="no">D_max_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>)
<span class="no">D_il</span>    <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>)

<span class="no">A_il_i1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span>)
<span class="no">A_il_i2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2.7</span>,<span class="fl">2.2</span>,<span class="fl">1.5</span>,<span class="fl">1.1</span>)
<span class="no">A_il_i3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.9</span>,<span class="fl">1.8</span>,<span class="fl">1.1</span>,<span class="fl">0.1</span>)
<span class="no">A_il</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">A_il_i1</span>[<span class="fl">2</span>:<span class="fl">4</span>], <span class="no">A_il_i2</span>[<span class="fl">2</span>:<span class="fl">4</span>], <span class="no">A_il_i3</span>[<span class="fl">2</span>:<span class="fl">4</span>])
<span class="no">alpha_il</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(-<span class="no">A_il_i1</span>), <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(-<span class="no">A_il_i2</span>), <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(-<span class="no">A_il_i3</span>))
<span class="no">beta_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>)

<span class="no">df_handinput_input_il</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">id_i</span>, <span class="no">id_il</span>, <span class="no">D_max_i</span>, <span class="no">D_il</span>, <span class="no">A_il</span>, <span class="no">alpha_il</span>, <span class="no">beta_i</span>))

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_handinput_input_il</span>)</pre></body></html></div>
<pre><code>## # A tibble: 9 x 7
##    id_i id_il D_max_i  D_il  A_il alpha_il beta_i
##   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1     1     1       3     1   3      1      0.333
## 2     1     2       3     2   2      1      0.333
## 3     1     3       3     3   1      1      0.333
## 4     2     4       3     1   2.2    0.5    0.333
## 5     2     5       3     2   1.5    0.7    0.333
## 6     2     6       3     3   1.1    0.400  0.333
## 7     3     7       3     1   1.8    0.100  0.333
## 8     3     8       3     2   1.1    0.7    0.333
## 9     3     9       3     3   0.1    1      0.333</code></pre>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">ls_df_queue_hand</span> <span class="kw">&lt;-</span> <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span>(<span class="no">ar_rho</span>, <span class="no">it_w_agg</span>,
                                            <span class="kw">bl_df_alloc_il</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                            <span class="kw">bl_return_V</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                            <span class="kw">bl_return_allQ_V</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                            <span class="kw">bl_return_inner_V</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                            <span class="kw">df_input_il</span> <span class="kw">=</span> <span class="no">df_handinput_input_il</span>)</pre></body></html></div>
<pre><code>## Joining, by = "id_il"</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,
## max-inequality/min-gini=0.5

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,
## max-inequality/min-gini=0.5

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,
## max-inequality/min-gini=0.5

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,
## max-inequality/min-gini=0.5</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning in ff_dist_gini_vector_pos(.[[svr_EH_star_i]]): Data vector has only
## n=3, max-inequality/min-gini=0.5</code></pre>
<pre><code>## Warning in ff_dist_gini_vector_pos(.[[svr_EH_star_i]]): Data vector has only
## n=3, max-inequality/min-gini=0.5

## Warning in ff_dist_gini_vector_pos(.[[svr_EH_star_i]]): Data vector has only
## n=3, max-inequality/min-gini=0.5

## Warning in ff_dist_gini_vector_pos(.[[svr_EH_star_i]]): Data vector has only
## n=3, max-inequality/min-gini=0.5</code></pre>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(rev)`</code></pre>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(alloc_i_upto_Q)`</code></pre>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">df_queue_il_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue_hand</span>$<span class="no">df_queue_il_long</span>
<span class="no">df_queue_il_wide</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue_hand</span>$<span class="no">df_queue_il_wide</span>
<span class="no">df_alloc_i_long</span>  <span class="kw">&lt;-</span> <span class="no">ls_df_queue_hand</span>$<span class="no">df_alloc_i_long</span>
<span class="no">df_rho_gini</span>  <span class="kw">&lt;-</span> <span class="no">ls_df_queue_hand</span>$<span class="no">df_rho_gini</span>
<span class="no">df_alloc_il_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue_hand</span>$<span class="no">df_alloc_il_long</span></pre></body></html></div>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_queue_il_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 36 x 11
##      rho rho_val  id_i id_il D_max_i  D_il  Q_il D_Wbin_il  V_sum_l V_inner_Q_il
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;
##  1     1   0.99      1     1       3     1     4         1 1.31e+ 0     2.41e+ 0
##  2     2   0.785     1     1       3     1     4         1 9.89e- 1     1.97e+ 0
##  3     3  -3.64      1     1       3     1     9         0 2.14e- 3     4.33e- 2
##  4     4 -99         1     1       3     1     9         0 8.30e-61     8.44e-29
##  5     1   0.99      1     2       3     2     3         1 9.89e- 1     2.08e+ 0
##  6     2   0.785     1     2       3     2     3         1 7.89e- 1     1.77e+ 0
##  7     3  -3.64      1     2       3     2     6         0 6.10e- 3     6.42e- 2
##  8     4 -99         1     2       3     2     7         0 1.94e-48     8.44e-29
##  9     1   0.99      1     3       3     3     2         1 6.62e- 1     1.76e+ 0
## 10     2   0.785     1     3       3     3     2         1 5.74e- 1     1.55e+ 0
## # ... with 26 more rows, and 1 more variable: V_star_Q_il &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_queue_il_wide</span>)</pre></body></html></div>
<pre><code>## # A tibble: 9 x 14
##   id_il  A_il alpha_il beta_i rank_min rank_max avg_rank  id_i D_max_i  D_il
##   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1     1   3      1      0.333        9        4     6.5      1       3     1
## 2     2   2      1      0.333        7        3     4.75     1       3     2
## 3     3   1      1      0.333        2        2     2        1       3     3
## 4     4   2.2    0.5    0.333        8        7     7.25     2       3     1
## 5     5   1.5    0.7    0.333        6        5     5.5      2       3     2
## 6     6   1.1    0.400  0.333        8        4     6        2       3     3
## 7     7   1.8    0.100  0.333        9        6     8        3       3     1
## 8     8   1.1    0.7    0.333        5        3     4        3       3     2
## 9     9   0.1    1      0.333        1        1     1        3       3     3
## # ... with 4 more variables: rho_c1_rk &lt;int&gt;, rho_c2_rk &lt;int&gt;, rho_c3_rk &lt;int&gt;,
## #   rho_c4_rk &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_alloc_i_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 12 x 7
## # Groups:   id_i [3]
##      rho rho_val  id_i D_max_i D_star_i F_star_i EH_star_i
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1     1   0.99      1       3        3    1           2  
##  2     2   0.785     1       3        3    1           2  
##  3     3  -3.64      1       3        1    0.333       4  
##  4     4 -99         1       3        1    0.333       4  
##  5     1   0.99      2       3        0    0           2.2
##  6     2   0.785     2       3        0    0           2.2
##  7     3  -3.64      2       3        2    0.667       2.2
##  8     4 -99         2       3        2    0.667       2.2
##  9     1   0.99      3       3        2    0.667       1.8
## 10     2   0.785     3       3        2    0.667       1.8
## 11     3  -3.64      3       3        2    0.667       1.8
## 12     4 -99         3       3        2    0.667       1.8</code></pre>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_rho_gini</span>)</pre></body></html></div>
<pre><code>## # A tibble: 4 x 4
##     rho rho_val gini_D_star gini_EH_star
##   &lt;int&gt;   &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
## 1     1   0.99        0.300       0.0333
## 2     2   0.785       0.300       0.0333
## 3     3  -3.64        0.100       0.137 
## 4     4 -99           0.100       0.137</code></pre>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_alloc_il_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 36 x 5
##      rho  Q_il sid_1 sid_2 sid_3
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1     0     0     1
##  2     1     2     1     0     1
##  3     1     3     2     0     1
##  4     1     4     3     0     1
##  5     1     5     3     0     2
##  6     1     6     3     1     2
##  7     1     7     3     2     2
##  8     1     8     3     3     2
##  9     1     9     3     3     3
## 10     2     1     0     0     1
## # ... with 26 more rows</code></pre>
</div>
<div id="load-pre-generated-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-pre-generated-data" class="anchor"></a>Load Pre-Generated Data</h2>
<p>These are data thata were generated in the <a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_sodis_rkone_casch_allrw.html">DISCRETE–Discrete Optimal Allocation California Teacher Student Ratio (Line by Line)</a> function.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="co"># Load Data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">df_opt_caschool_prep_i</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">df_opt_caschool_input_il</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">df_opt_caschool_input_ib</span>)

<span class="co"># Show Variables</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_opt_caschool_prep_i</span>)</pre></body></html></div>
<pre><code>## 'data.frame':    420 obs. of  15 variables:
##  $ id_i    : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ D_max_i : num  1 1 8 1 7 0 1 4 1 10 ...
##  $ D_o_i   : num  0 0 2 0 1 0 0 1 0 2 ...
##  $ Omega_i : num  706 673 657 656 656 ...
##  $ theta_i : num  -0.87 -0.87 -0.87 -0.87 -0.87 ...
##  $ beta_i  : num  0.00238 0.00238 0.00238 0.00238 0.00238 ...
##  $ enrltot : num  195 240 1550 243 1335 ...
##  $ teachers: num  11 11 83 14 72 6 10 42 19 108 ...
##  $ stravg  : num  17.7 21.8 18.7 17.4 18.5 ...
##  $ distcod : int  75119 61499 61549 61457 61523 62042 68536 63834 62331 67306 ...
##  $ county  : Factor w/ 45 levels "Alameda","Butte",..: 1 2 2 2 2 6 29 11 6 25 ...
##  $ district: Factor w/ 409 levels "Ackerman Elementary",..: 362 214 367 134 270 53 152 383 263 93 ...
##  $ grspan  : Factor w/ 2 levels "KK-06","KK-08": 2 2 2 2 2 2 2 2 2 1 ...
##  $ avginc  : num  22.69 9.82 8.98 8.98 9.08 ...
##  $ testscr : num  691 661 644 648 641 ...</code></pre>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_opt_caschool_input_il</span>)</pre></body></html></div>
<pre><code>## tibble [5,224 x 7] (S3: tbl_df/tbl/data.frame)
##  $ id_i    : int [1:5224] 1 2 3 3 3 3 3 3 3 3 ...
##  $ id_il   : int [1:5224] 1 2 3 4 5 6 7 8 9 10 ...
##  $ D_max_i : num [1:5224] 1 1 8 8 8 8 8 8 8 8 ...
##  $ D_il    : int [1:5224] 1 1 1 2 3 4 5 6 7 8 ...
##  $ A_il    : num [1:5224] 691 654 641 641 641 ...
##  $ alpha_il: num [1:5224] 1.285 1.582 0.193 0.189 0.184 ...
##  $ beta_i  : num [1:5224] 0.00238 0.00238 0.00238 0.00238 0.00238 ...</code></pre>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_opt_caschool_input_ib</span>)</pre></body></html></div>
<pre><code>## 'data.frame':    420 obs. of  4 variables:
##  $ id_i     : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ A_i_l0   : num  691 654 641 641 639 ...
##  $ alpha_o_i: num  0 0 0.382 0 0.221 ...
##  $ beta_i   : num  0.00238 0.00238 0.00238 0.00238 0.00238 ...</code></pre>
</div>
<div id="solve-all-districts-discrete-optimal-allocation-across-planner-preferences" class="section level2">
<h2 class="hasAnchor">
<a href="#solve-all-districts-discrete-optimal-allocation-across-planner-preferences" class="anchor"></a>Solve All Districts Discrete Optimal Allocation Across Planner Preferences</h2>
<div id="specify-policy-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#specify-policy-parameters" class="anchor"></a>Specify Policy Parameters</h3>
<p>Note that <em>input_il</em> function already is based on <em>fl_fi_max</em>.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="co"># 100 percent teacher at most per school, discretize floor as needed</span>
<span class="co"># This is not a parameter that matters here, already a part of the input_il function</span>
<span class="no">fl_fi_max</span> <span class="kw">=</span> <span class="fl">1.00</span>
<span class="co"># 20 percent total additional of all teachers</span>
<span class="no">fl_fa_max</span> <span class="kw">=</span> <span class="fl">0.20</span>
<span class="co"># What is the number of teachers we can increase by</span>
<span class="no">fl_teacher_increase_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">df_opt_caschool_prep_i</span>$<span class="no">teachers</span>)*<span class="no">fl_fa_max</span>
<span class="no">fl_teacher_increase_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="no">fl_teacher_increase_number</span>)

<span class="co"># Rho values to consider</span>
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - (<span class="fl">10</span>^(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">2</span>,<span class="fl">2</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">4</span>))))
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">ar_rho</span>)</pre></body></html></div>
</div>
</div>
<div id="optimal-queue-and-allocations" class="section level2">
<h2 class="hasAnchor">
<a href="#optimal-queue-and-allocations" class="anchor"></a>Optimal Queue and Allocations</h2>
<p>Use the discrete allocation function across preference <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis.html</a> function. This computes optimal allocation for multiple planner inequality aversion <span class="math inline">\(\lambda\)</span> parameters at the same time. Note that in the function <span class="math inline">\(\lambda=\rho\)</span>.</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">ls_df_queue</span> <span class="kw">&lt;-</span> <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span>(<span class="no">ar_rho</span>,
                                       <span class="no">fl_teacher_increase_number</span>,
                                       <span class="kw">bl_df_alloc_il</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                       <span class="kw">df_input_il</span> <span class="kw">=</span> <span class="no">df_opt_caschool_input_il</span>,
                                       <span class="kw">svr_rho</span> <span class="kw">=</span> <span class="st">'rho'</span>,
                                       <span class="kw">svr_id_i</span> <span class="kw">=</span> <span class="st">'id_i'</span>, <span class="kw">svr_id_il</span> <span class="kw">=</span> <span class="st">'id_il'</span>,
                                       <span class="kw">svr_D_max_i</span> <span class="kw">=</span> <span class="st">'D_max_i'</span>, <span class="kw">svr_D_il</span> <span class="kw">=</span> <span class="st">'D_il'</span>,
                                       <span class="kw">svr_D_star_i</span> <span class="kw">=</span> <span class="st">'D_star_i'</span>, <span class="kw">svr_F_star_i</span> <span class="kw">=</span> <span class="st">'F_star_i'</span>,
                                       <span class="kw">svr_inpalc</span> <span class="kw">=</span> <span class="st">'Q_il'</span>, <span class="kw">svr_D_Wbin_il</span> <span class="kw">=</span> <span class="st">'D_Wbin_il'</span>,
                                       <span class="kw">svr_A_il</span> <span class="kw">=</span> <span class="st">'A_il'</span>, <span class="kw">svr_alpha_il</span> <span class="kw">=</span> <span class="st">'alpha_il'</span>, <span class="kw">svr_beta_i</span> <span class="kw">=</span> <span class="st">'beta_i'</span>,
                                       <span class="kw">svr_expout</span> <span class="kw">=</span> <span class="st">'opti_exp_outcome'</span>,
                                       <span class="kw">st_idcol_prefix</span> <span class="kw">=</span> <span class="st">'sid_'</span>)</pre></body></html></div>
<pre><code>## Joining, by = "id_il"</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(rev)`</code></pre>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(alloc_i_upto_Q)`</code></pre>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">df_queue_il_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_queue_il_long</span>
<span class="no">df_queue_il_wide</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_queue_il_wide</span>
<span class="no">df_alloc_i_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_alloc_i_long</span>
<span class="no">df_rho_gini</span>  <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_rho_gini</span>
<span class="no">df_alloc_il_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_alloc_il_long</span></pre></body></html></div>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_queue_il_long</span>, <span class="fl">10</span>))</pre></body></html></div>
<pre><code>## # A tibble: 10 x 9
##      rho rho_val  id_i id_il D_max_i  D_il  Q_il D_Wbin_il V_star_Q_il
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
##  1     1   0.99      1     1       1     1    17         1        583.
##  2     2   0.785     1     1       1     1    18         1        566.
##  3     3  -3.64      1     1       1     1    43         1        673.
##  4     4 -99         1     1       1     1  4615         1        638.
##  5     1   0.99      2     2       1     1     5         1        583.
##  6     2   0.785     2     2       1     1     5         1        566.
##  7     3  -3.64      2     2       1     1     7         1        673.
##  8     4 -99         2     2       1     1   749         1        637.
##  9     1   0.99      3     3       8     1   558         1        583.
## 10     2   0.785     3     3       8     1   555         1        566.</code></pre>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="co"># print(str(df_queue_il_long))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_queue_il_wide</span>, <span class="fl">10</span>))</pre></body></html></div>
<pre><code>## # A tibble: 10 x 14
##    id_il  A_il alpha_il  beta_i rank_min rank_max avg_rank  id_i D_max_i  D_il
##    &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt;
##  1     1  691.    1.29  0.00238     4615       17    1173.     1       1     1
##  2     2  654.    1.58  0.00238      749        5     192.     2       1     1
##  3     3  641.    0.193 0.00238      700      507     580      3       8     1
##  4     4  641.    0.189 0.00238      736      527     602.     3       8     2
##  5     5  641.    0.184 0.00238      769      546     624      3       8     3
##  6     6  641.    0.180 0.00238      804      566     648.     3       8     4
##  7     7  642.    0.176 0.00238      834      586     669.     3       8     5
##  8     8  642.    0.172 0.00238      865      607     694.     3       8     6
##  9     9  642.    0.168 0.00238      893      631     718.     3       8     7
## 10    10  642.    0.165 0.00238      921      654     742.     3       8     8
## # ... with 4 more variables: rho_c1_rk &lt;int&gt;, rho_c2_rk &lt;int&gt;, rho_c3_rk &lt;int&gt;,
## #   rho_c4_rk &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="co"># print(str(df_queue_il_wide))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_alloc_i_long</span>, <span class="fl">10</span>))</pre></body></html></div>
<pre><code>## # A tibble: 10 x 7
## # Groups:   id_i [3]
##      rho rho_val  id_i D_max_i D_star_i F_star_i EH_star_i
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1     1   0.99      1       1        1        1      692.
##  2     2   0.785     1       1        1        1      692.
##  3     3  -3.64      1       1        1        1      692.
##  4     4 -99         1       1        1        1      692.
##  5     1   0.99      2       1        1        1      656.
##  6     2   0.785     2       1        1        1      656.
##  7     3  -3.64      2       1        1        1      656.
##  8     4 -99         2       1        1        1      656.
##  9     1   0.99      3       8        8        1      642.
## 10     2   0.785     3       8        8        1      642.</code></pre>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="co"># print(str(df_queue_il_wide))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_rho_gini</span>)</pre></body></html></div>
<pre><code>## # A tibble: 4 x 4
##     rho rho_val gini_D_star gini_EH_star
##   &lt;int&gt;   &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
## 1     1   0.99        0.610       0.0151
## 2     2   0.785       0.610       0.0151
## 3     3  -3.64        0.610       0.0151
## 4     4 -99           0.610       0.0151</code></pre>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="co"># print(str(df_alloc_i_long))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_alloc_il_long</span>, <span class="fl">10</span>))</pre></body></html></div>
<pre><code>## # A tibble: 10 x 377
##      rho  Q_il sid_1 sid_2 sid_3 sid_4 sid_5 sid_7 sid_8 sid_9 sid_10 sid_11
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1     1     1     0     0     0     0     0     0     0     0      0      0
##  2     1     2     0     0     0     0     0     0     0     0      0      0
##  3     1     3     0     0     0     0     0     0     0     0      0      0
##  4     1     4     0     0     0     0     0     0     0     0      0      0
##  5     1     5     0     1     0     0     0     0     0     0      0      0
##  6     1     6     0     1     0     0     0     0     0     0      0      0
##  7     1     7     0     1     0     0     0     0     0     0      0      0
##  8     1     8     0     1     0     0     0     1     0     0      0      0
##  9     1     9     0     1     0     0     0     1     0     0      0      0
## 10     1    10     0     1     0     0     0     1     0     0      0      0
## # ... with 365 more variables: sid_12 &lt;dbl&gt;, sid_14 &lt;dbl&gt;, sid_15 &lt;dbl&gt;,
## #   sid_16 &lt;dbl&gt;, sid_17 &lt;dbl&gt;, sid_18 &lt;dbl&gt;, sid_19 &lt;dbl&gt;, sid_20 &lt;dbl&gt;,
## #   sid_21 &lt;dbl&gt;, sid_22 &lt;dbl&gt;, sid_23 &lt;dbl&gt;, sid_24 &lt;dbl&gt;, sid_25 &lt;dbl&gt;,
## #   sid_26 &lt;dbl&gt;, sid_27 &lt;dbl&gt;, sid_28 &lt;dbl&gt;, sid_29 &lt;dbl&gt;, sid_30 &lt;dbl&gt;,
## #   sid_31 &lt;dbl&gt;, sid_32 &lt;dbl&gt;, sid_33 &lt;dbl&gt;, sid_34 &lt;dbl&gt;, sid_35 &lt;dbl&gt;,
## #   sid_36 &lt;dbl&gt;, sid_37 &lt;dbl&gt;, sid_38 &lt;dbl&gt;, sid_39 &lt;dbl&gt;, sid_40 &lt;dbl&gt;,
## #   sid_41 &lt;dbl&gt;, sid_43 &lt;dbl&gt;, sid_44 &lt;dbl&gt;, sid_45 &lt;dbl&gt;, sid_46 &lt;dbl&gt;,
## #   sid_47 &lt;dbl&gt;, sid_48 &lt;dbl&gt;, sid_49 &lt;dbl&gt;, sid_50 &lt;dbl&gt;, sid_51 &lt;dbl&gt;,
## #   sid_52 &lt;dbl&gt;, sid_53 &lt;dbl&gt;, sid_54 &lt;dbl&gt;, sid_55 &lt;dbl&gt;, sid_56 &lt;dbl&gt;,
## #   sid_57 &lt;dbl&gt;, sid_58 &lt;dbl&gt;, sid_59 &lt;dbl&gt;, sid_60 &lt;dbl&gt;, sid_61 &lt;dbl&gt;,
## #   sid_62 &lt;dbl&gt;, sid_63 &lt;dbl&gt;, sid_64 &lt;dbl&gt;, sid_65 &lt;dbl&gt;, sid_66 &lt;dbl&gt;,
## #   sid_67 &lt;dbl&gt;, sid_68 &lt;dbl&gt;, sid_69 &lt;dbl&gt;, sid_70 &lt;dbl&gt;, sid_71 &lt;dbl&gt;,
## #   sid_72 &lt;dbl&gt;, sid_73 &lt;dbl&gt;, sid_74 &lt;dbl&gt;, sid_75 &lt;dbl&gt;, sid_76 &lt;dbl&gt;,
## #   sid_77 &lt;dbl&gt;, sid_78 &lt;dbl&gt;, sid_79 &lt;dbl&gt;, sid_80 &lt;dbl&gt;, sid_81 &lt;dbl&gt;,
## #   sid_82 &lt;dbl&gt;, sid_83 &lt;dbl&gt;, sid_84 &lt;dbl&gt;, sid_85 &lt;dbl&gt;, sid_86 &lt;dbl&gt;,
## #   sid_87 &lt;dbl&gt;, sid_88 &lt;dbl&gt;, sid_89 &lt;dbl&gt;, sid_90 &lt;dbl&gt;, sid_91 &lt;dbl&gt;,
## #   sid_92 &lt;dbl&gt;, sid_93 &lt;dbl&gt;, sid_95 &lt;dbl&gt;, sid_96 &lt;dbl&gt;, sid_97 &lt;dbl&gt;,
## #   sid_98 &lt;dbl&gt;, sid_99 &lt;dbl&gt;, sid_100 &lt;dbl&gt;, sid_102 &lt;dbl&gt;, sid_103 &lt;dbl&gt;,
## #   sid_104 &lt;dbl&gt;, sid_105 &lt;dbl&gt;, sid_106 &lt;dbl&gt;, sid_107 &lt;dbl&gt;, sid_108 &lt;dbl&gt;,
## #   sid_109 &lt;dbl&gt;, sid_110 &lt;dbl&gt;, sid_111 &lt;dbl&gt;, sid_112 &lt;dbl&gt;, sid_113 &lt;dbl&gt;,
## #   sid_114 &lt;dbl&gt;, sid_115 &lt;dbl&gt;, ...</code></pre>
</div>
<div id="rev-compute" class="section level2">
<h2 class="hasAnchor">
<a href="#rev-compute" class="anchor"></a>REV Compute</h2>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="no">tb_rho_rev</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span>(<span class="no">ar_rho</span>,
                          <span class="no">fl_teacher_increase_number</span>,
                          <span class="kw">df_input_ib</span> <span class="kw">=</span> <span class="no">df_opt_caschool_input_ib</span>,
                          <span class="kw">df_queue_il_long_with_V</span> <span class="kw">=</span> <span class="no">df_queue_il_long</span>)</pre></body></html></div>
<pre><code>## Warning in min(df_queue_il_with_V %&gt;% filter(!!sym(svr_V_star_Q_il) &gt;=
## fl_util_alter_alloc) %&gt;% : no non-missing arguments to min; returning Inf

## Warning in min(df_queue_il_with_V %&gt;% filter(!!sym(svr_V_star_Q_il) &gt;=
## fl_util_alter_alloc) %&gt;% : no non-missing arguments to min; returning Inf</code></pre>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(rev)`</code></pre>
<div class="sourceCode" id="cb52"><html><body><pre class="r"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">tb_rho_rev</span>)</pre></body></html></div>
<pre><code>## # A tibble: 4 x 3
##     rho rho_val     REV
##   &lt;int&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1     1   0.99  -Inf   
## 2     2   0.785 -Inf   
## 3     3  -3.64     1.00
## 4     4 -99        1.00</code></pre>
</div>
<div id="optimal-allocation-among-subset-of-districts" class="section level2">
<h2 class="hasAnchor">
<a href="#optimal-allocation-among-subset-of-districts" class="anchor"></a>Optimal Allocation Among Subset of Districts</h2>
<div id="select-a-small-subset-of-districts" class="section level3">
<h3 class="hasAnchor">
<a href="#select-a-small-subset-of-districts" class="anchor"></a>Select a Small Subset of Districts</h3>
<p>To generate some graphs and more easily readable results, rather than using all school districts, select some random subset of school districts from the existing data frames.</p>
<ol style="list-style-type: decimal">
<li>Select a random subset of district IDs</li>
<li>New input df that only includes these IDs.</li>
</ol>
<div class="sourceCode" id="cb54"><html><body><pre class="r"><span class="co"># select four school districts</span>
<span class="co"># cas = california schools</span>
<span class="no">it_O</span> <span class="kw">&lt;-</span> <span class="fl">4</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)
<span class="no">df_cas_prep_sub_i</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_prep_i</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">teachers</span> <span class="kw">&lt;=</span> <span class="fl">100</span> <span class="kw">&amp;</span> <span class="no">teachers</span> <span class="kw">&gt;=</span> <span class="fl">50</span>)
<span class="no">df_cas_prep_sub_i</span> <span class="kw">&lt;-</span> <span class="no">df_cas_prep_sub_i</span>[<span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">df_cas_prep_sub_i</span>)[<span class="fl">1</span>], <span class="no">it_O</span>, <span class="kw">replace</span><span class="kw">=</span><span class="fl">FALSE</span>),]
<span class="no">ar_cas_id_selected</span> <span class="kw">&lt;-</span> <span class="no">df_cas_prep_sub_i</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(<span class="no">id_i</span>)

<span class="co"># Select from il and ib only ids that are randomly selected</span>
<span class="no">df_cas_input_sub_il</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_input_il</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">id_i</span> <span class="kw">%in%</span> <span class="no">ar_cas_id_selected</span>)
<span class="no">df_cas_input_sub_ib</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_input_ib</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">id_i</span> <span class="kw">%in%</span> <span class="no">ar_cas_id_selected</span>)

<span class="co"># Print</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_cas_prep_sub_i</span>)</pre></body></html></div>
<pre><code>##    id_i D_max_i D_o_i  Omega_i    theta_i      beta_i enrltot teachers   stravg
## 4    32      10     2 636.0332 -0.8699505 0.002380952    2102      100 21.02000
## 39  327       5     1 686.9896 -0.8699505 0.002380952     900       51 17.64706
## 1     3       8     2 657.0958 -0.8699505 0.002380952    1550       83 18.67470
## 34  286       6     1 671.6432 -0.8699505 0.002380952    1252       65 19.26154
##    distcod    county                    district grspan   avginc testscr
## 4    75440  Monterey             Soledad Unified  KK-08 12.40900  624.95
## 39   68007 San Diego          Cardiff Elementary  KK-06 21.96700  668.65
## 1    61549     Butte Thermalito Union Elementary  KK-08  8.97800  643.60
## 34   71035    Sonoma           Wright Elementary  KK-06 12.58425  663.85</code></pre>
<div class="sourceCode" id="cb56"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_cas_input_sub_ib</span>)</pre></body></html></div>
<pre><code>##   id_i   A_i_l0 alpha_o_i      beta_i
## 1    3 640.8497 0.3822603 0.002380952
## 2   32 617.7468 0.3585561 0.002380952
## 3  286 654.8866 0.2538877 0.002380952
## 4  327 671.6376 0.2952321 0.002380952</code></pre>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_cas_input_sub_il</span>)</pre></body></html></div>
<pre><code>## # A tibble: 29 x 7
##     id_i id_il D_max_i  D_il  A_il alpha_il  beta_i
##    &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1     3     3       8     1  641.    0.193 0.00238
##  2     3     4       8     2  641.    0.189 0.00238
##  3     3     5       8     3  641.    0.184 0.00238
##  4     3     6       8     4  641.    0.180 0.00238
##  5     3     7       8     5  642.    0.176 0.00238
##  6     3     8       8     6  642.    0.172 0.00238
##  7     3     9       8     7  642.    0.168 0.00238
##  8     3    10       8     8  642.    0.165 0.00238
##  9    32   205      10     1  618.    0.181 0.00238
## 10    32   206      10     2  618.    0.178 0.00238
## # ... with 19 more rows</code></pre>
<p>Now we also have a new total number of teacher increase, no longer based on all districts. The policy here is to potentially increase each school district by <em>fl_fi_max</em>, already coded into the <em>input_il</em> file, so that can not change. The total number of available new teachers is <em>fl_fa_max</em> times the existing number of teachers in the selected districts overall</p>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="no">fl_fa_max</span> <span class="kw">=</span> <span class="fl">0.20</span>
<span class="co"># What is the number of teachers we can increase by</span>
<span class="no">fl_teacher_increase_sub_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">df_cas_prep_sub_i</span>$<span class="no">teachers</span>)*<span class="no">fl_fa_max</span>
<span class="no">fl_teacher_increase_sub_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="no">fl_teacher_increase_sub_number</span>)</pre></body></html></div>
</div>
<div id="optimal-queue-allocations-and-rev" class="section level3">
<h3 class="hasAnchor">
<a href="#optimal-queue-allocations-and-rev" class="anchor"></a>Optimal Queue, Allocations and REV</h3>
<p>Use the discrete allocation function across preference <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis.html</a> function. This computes optimal allocation for multiple planner inequality aversion <span class="math inline">\(\lambda\)</span> parameters at the same time. Note that in the function <span class="math inline">\(\lambda=\rho\)</span>.</p>
<div class="sourceCode" id="cb61"><html><body><pre class="r"><span class="co"># Rho values to consider</span>
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - (<span class="fl">10</span>^(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">2</span>,<span class="fl">2</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">4</span>))))
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">ar_rho</span>)

<span class="co"># Optimal Allocation</span>
<span class="no">ls_df_sub_queue</span> <span class="kw">&lt;-</span> <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span>(<span class="no">ar_rho</span>, <span class="no">fl_teacher_increase_sub_number</span>,
                                           <span class="kw">df_input_il</span> <span class="kw">=</span> <span class="no">df_cas_input_sub_il</span>,
                                           <span class="kw">bl_df_alloc_il</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## Joining, by = "id_il"</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,
## max-inequality/min-gini=0.6

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,
## max-inequality/min-gini=0.6

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,
## max-inequality/min-gini=0.6

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,
## max-inequality/min-gini=0.6</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning in ff_dist_gini_vector_pos(.[[svr_EH_star_i]]): Data vector has only
## n=4, max-inequality/min-gini=0.6</code></pre>
<pre><code>## Warning in ff_dist_gini_vector_pos(.[[svr_EH_star_i]]): Data vector has only
## n=4, max-inequality/min-gini=0.6

## Warning in ff_dist_gini_vector_pos(.[[svr_EH_star_i]]): Data vector has only
## n=4, max-inequality/min-gini=0.6

## Warning in ff_dist_gini_vector_pos(.[[svr_EH_star_i]]): Data vector has only
## n=4, max-inequality/min-gini=0.6</code></pre>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(rev)`</code></pre>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(alloc_i_upto_Q)`</code></pre>
<div class="sourceCode" id="cb70"><html><body><pre class="r"><span class="no">df_queue_il_sub_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_sub_queue</span>$<span class="no">df_queue_il_long</span>
<span class="no">df_queue_il_sub_wide</span> <span class="kw">&lt;-</span> <span class="no">ls_df_sub_queue</span>$<span class="no">df_queue_il_wide</span>
<span class="no">df_alloc_i_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_sub_queue</span>$<span class="no">df_alloc_i_long</span>
<span class="no">df_rho_gini</span> <span class="kw">&lt;-</span> <span class="no">ls_df_sub_queue</span>$<span class="no">df_rho_gini</span>
<span class="no">df_alloc_il_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_sub_queue</span>$<span class="no">df_alloc_il_long</span>

<span class="co"># REV</span>
<span class="no">ar_util_rev_loop_func</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span>(<span class="no">ar_rho</span>,<span class="no">fl_teacher_increase_sub_number</span>,
                                                 <span class="kw">df_input_ib</span> <span class="kw">=</span> <span class="no">df_cas_input_sub_ib</span>,
                                                 <span class="kw">df_queue_il_long_with_V</span> <span class="kw">=</span> <span class="no">df_queue_il_sub_long</span>)</pre></body></html></div>
<pre><code>## Warning: `cols` is now required.
## Please use `cols = c(rev)`</code></pre>
<p>Show Results</p>
<div class="sourceCode" id="cb72"><html><body><pre class="r"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_queue_il_sub_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 116 x 9
##      rho rho_val  id_i id_il D_max_i  D_il  Q_il D_Wbin_il V_star_Q_il
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
##  1     1   0.99      3     3       8     1    12         1        5.88
##  2     2   0.785     3     3       8     1    12         1        1.72
##  3     3  -3.64      3     3       8     1    18         1     2318.  
##  4     4 -99         3     3       8     1    11         1      658.  
##  5     1   0.99      3     4       8     2    13         1        5.88
##  6     2   0.785     3     4       8     2    13         1        1.72
##  7     3  -3.64      3     4       8     2    20         1     2319.  
##  8     4 -99         3     4       8     2    12         1      658.  
##  9     1   0.99      3     5       8     3    14         1        5.88
## 10     2   0.785     3     5       8     3    14         1        1.72
## # ... with 106 more rows</code></pre>
<div class="sourceCode" id="cb74"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_alloc_i_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 16 x 7
## # Groups:   id_i [4]
##      rho rho_val  id_i D_max_i D_star_i F_star_i EH_star_i
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1     1   0.99      3       8        8        1      642.
##  2     2   0.785     3       8        8        1      642.
##  3     3  -3.64      3       8        8        1      642.
##  4     4 -99         3       8        8        1      642.
##  5     1   0.99     32      10       10        1      619.
##  6     2   0.785    32      10       10        1      619.
##  7     3  -3.64     32      10       10        1      619.
##  8     4 -99        32      10       10        1      619.
##  9     1   0.99    286       6        6        1      656.
## 10     2   0.785   286       6        6        1      656.
## 11     3  -3.64    286       6        6        1      656.
## 12     4 -99       286       6        6        1      656.
## 13     1   0.99    327       5        5        1      673.
## 14     2   0.785   327       5        5        1      673.
## 15     3  -3.64    327       5        5        1      673.
## 16     4 -99       327       5        5        1      673.</code></pre>
<div class="sourceCode" id="cb76"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_rho_gini</span>)</pre></body></html></div>
<pre><code>## # A tibble: 4 x 4
##     rho rho_val gini_D_star gini_EH_star
##   &lt;int&gt;   &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
## 1     1   0.99        0.117       0.0135
## 2     2   0.785       0.117       0.0135
## 3     3  -3.64        0.117       0.0135
## 4     4 -99           0.117       0.0135</code></pre>
<div class="sourceCode" id="cb78"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_alloc_il_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 116 x 6
##      rho  Q_il sid_3 sid_32 sid_286 sid_327
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1     1     1     0      0       0       1
##  2     1     2     0      0       0       2
##  3     1     3     0      0       0       3
##  4     1     4     0      0       0       4
##  5     1     5     0      0       0       5
##  6     1     6     0      0       1       5
##  7     1     7     0      0       2       5
##  8     1     8     0      0       3       5
##  9     1     9     0      0       4       5
## 10     1    10     0      0       5       5
## # ... with 106 more rows</code></pre>
<div class="sourceCode" id="cb80"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">ar_util_rev_loop_func</span>)</pre></body></html></div>
<pre><code>## # A tibble: 4 x 3
##     rho rho_val   REV
##   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1     1   0.99  0.915
## 2     2   0.785 0.915
## 3     3  -3.64  0.898
## 4     4 -99     0.949</code></pre>
<!-- ### Additional Statistics

1. Predicted Expected Outcomes for each i given allocations
2. Utility at each Queue rank point
3. Gini Statistics based on allocations

### Results Analysis

Core graphical/tabular illustration of results across Many Individuals

1. Mean and standard deviation of outcome, across $\lambda$, along with actual mean and standard deviation
2. Gini of Allocations and Outcomes, across $\lambda$, along with observed of intended Gini of Allocation or Outcomes
3. REV in percentages as well as in units of resources lost, across $\lambda$
4. Tabular results already exists for this. Rank Data/chart:
    - columns are $\lambda$ points
    - colors identify individuals, each color appears multiple times due to multiple allocations for each individual
    - show ranking changes as preference changes
    - highligh only subset (1) of individuals
    - Climbing chart? x axis is rank, y axis allocation for individual, but not sure why this would be useful. Perhaps useful for tabular outputs. Maybe only very small chart

How should illustrative graph be shown with only 2 individuals? -->
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://fanwangecon.github.io">Fan Wang</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
