<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Function Test Discrete Allocation with Linear Regression • Optimal Allocation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Function Test Discrete Allocation with Linear Regression">
<meta property="og:description" content="Test binary optimal allocation solution function from package.
Use the California student test score dataset, same as line by line.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Optimal Allocation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/PrjOptiAlloc.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue.pdf">Paper</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue_Present.pdf">Slides</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Sites
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://fanwangecon.github.io/REconTools/">R Tools for Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/R4Econ/">R Examples Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stat4Econ/">R Examples Introductory Statistics</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stata4Econ/">Stata Examples Regressions and Tables</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/M4Econ/">Matlab Examples Matrix and Graphs</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Math4Econ/">Matlab Introductory Math for Econ</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Tex4Econ/">Latex and Paper Generation Examples</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/pyfan/">Python Examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://fanwangecon.github.io/">Fan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fanwangecon/PrjOptiAlloc">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fanwangecon">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ffv_opt_sodis_rkone_casch_allfn_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Function Test Discrete Allocation with Linear Regression</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/master/vignettes/ffv_opt_sodis_rkone_casch_allfn.Rmd"><code>vignettes/ffv_opt_sodis_rkone_casch_allfn.Rmd</code></a></small>
      <div class="hidden name"><code>ffv_opt_sodis_rkone_casch_allfn.Rmd</code></div>

    </div>

    
    
<p>Test discrete optimal allocation solution line by line without function. Use the California student test score dataset. Regress student English and Math test scores on Student-Teacher-Ratio.</p>
<p>This function produces the same results as <a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_sodis_rkone_casch_allrw.html">DISCRETE–Discrete Optimal Allocation California Teacher Student Ratio (Line by Line)</a>. The differences are:</p>
<ol style="list-style-type: decimal">
<li>the program here uses the dataframes created by the line by line file as Inputs</li>
<li>the program here uses functions that are identical to the line by line function, but are saved in the R folder.</li>
</ol>
<p>This file, by invoking functions, is much shorter than the line by line program.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>(<span class="kw">all.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">knitr.duplicate.label</span> <span class="kw">=</span> <span class="st">'allow'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">broom</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">REconTools</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">PrjOptiAlloc</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">kableExtra</span>)</pre></body></html></div>
<div id="hand-input-data-example" class="section level2">
<h2 class="hasAnchor">
<a href="#hand-input-data-example" class="anchor"></a>Hand Input Data Example</h2>
<p>Set Preference Array:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - (<span class="fl">10</span>^(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">2</span>,<span class="fl">2</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">4</span>))))
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">ar_rho</span>)
<span class="no">it_w_agg</span> <span class="kw">&lt;-</span> <span class="fl">5</span></pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">id_i</span>    <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>)
<span class="no">id_il</span>   <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>)
<span class="no">D_max_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span>)
<span class="no">D_il</span>    <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>)

<span class="no">A_il_i1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span>)
<span class="no">A_il_i2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2.7</span>,<span class="fl">2.2</span>,<span class="fl">1.5</span>,<span class="fl">1.1</span>)
<span class="no">A_il_i3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.9</span>,<span class="fl">1.8</span>,<span class="fl">1.1</span>,<span class="fl">0.1</span>)
<span class="no">A_il</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">A_il_i1</span>[<span class="fl">2</span>:<span class="fl">4</span>], <span class="no">A_il_i2</span>[<span class="fl">2</span>:<span class="fl">4</span>], <span class="no">A_il_i3</span>[<span class="fl">2</span>:<span class="fl">4</span>])
<span class="no">alpha_il</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(-<span class="no">A_il_i1</span>), <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(-<span class="no">A_il_i2</span>), <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(-<span class="no">A_il_i3</span>))
<span class="no">beta_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>,<span class="fl">1</span>/<span class="fl">3</span>)

<span class="no">df_handinput_input_il</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">id_i</span>, <span class="no">id_il</span>, <span class="no">D_max_i</span>, <span class="no">D_il</span>, <span class="no">A_il</span>, <span class="no">alpha_il</span>, <span class="no">beta_i</span>))

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_handinput_input_il</span>)</pre></body></html></div>
<pre><code>## # A tibble: 9 x 7
##    id_i id_il D_max_i  D_il  A_il alpha_il beta_i
##   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1     1     1       3     1   3      1      0.333
## 2     1     2       3     2   2      1      0.333
## 3     1     3       3     3   1      1      0.333
## 4     2     4       3     1   2.2    0.5    0.333
## 5     2     5       3     2   1.5    0.7    0.333
## 6     2     6       3     3   1.1    0.400  0.333
## 7     3     7       3     1   1.8    0.100  0.333
## 8     3     8       3     2   1.1    0.7    0.333
## 9     3     9       3     3   0.1    1      0.333</code></pre>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">ls_df_queue_hand</span> <span class="kw">&lt;-</span> <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span>(<span class="no">ar_rho</span>, <span class="no">it_w_agg</span>,
                                            <span class="kw">bl_df_alloc_il</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                            <span class="kw">bl_return_V</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                            <span class="kw">bl_return_allQ_V</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                            <span class="kw">bl_return_inner_V</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                            <span class="kw">df_input_il</span> <span class="kw">=</span> <span class="no">df_handinput_input_il</span>)</pre></body></html></div>
<pre><code>## Joining, by = "id_il"</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,
## max-inequality/min-gini=0.5

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,
## max-inequality/min-gini=0.5

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,
## max-inequality/min-gini=0.5

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=3,
## max-inequality/min-gini=0.5</code></pre>
<pre><code>## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has
## only n=3, max-inequality/min-gini=0.5

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has
## only n=3, max-inequality/min-gini=0.5

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has
## only n=3, max-inequality/min-gini=0.5

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has
## only n=3, max-inequality/min-gini=0.5</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(rev)`</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(alloc_i_upto_Q)`</code></pre>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">df_queue_il_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue_hand</span>$<span class="no">df_queue_il_long</span>
<span class="no">df_queue_il_wide</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue_hand</span>$<span class="no">df_queue_il_wide</span>
<span class="no">df_alloc_i_long</span>  <span class="kw">&lt;-</span> <span class="no">ls_df_queue_hand</span>$<span class="no">df_alloc_i_long</span>
<span class="no">df_rho_gini</span>  <span class="kw">&lt;-</span> <span class="no">ls_df_queue_hand</span>$<span class="no">df_rho_gini</span>
<span class="no">df_alloc_il_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue_hand</span>$<span class="no">df_alloc_il_long</span></pre></body></html></div>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_queue_il_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 36 x 11
##      rho rho_val  id_i id_il D_max_i  D_il  Q_il D_Wbin_il  V_sum_l V_inner_Q_il
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;        &lt;dbl&gt;
##  1     1   0.99      1     1       3     1     4         1 1.31e+ 0     2.41e+ 0
##  2     2   0.785     1     1       3     1     4         1 9.89e- 1     1.97e+ 0
##  3     3  -3.64      1     1       3     1     9         0 2.14e- 3     4.33e- 2
##  4     4 -99         1     1       3     1     9         0 8.30e-61     8.44e-29
##  5     1   0.99      1     2       3     2     3         1 9.89e- 1     2.08e+ 0
##  6     2   0.785     1     2       3     2     3         1 7.89e- 1     1.77e+ 0
##  7     3  -3.64      1     2       3     2     6         0 6.10e- 3     6.42e- 2
##  8     4 -99         1     2       3     2     7         0 1.94e-48     8.44e-29
##  9     1   0.99      1     3       3     3     2         1 6.62e- 1     1.76e+ 0
## 10     2   0.785     1     3       3     3     2         1 5.74e- 1     1.55e+ 0
## # ... with 26 more rows, and 1 more variable: V_star_Q_il &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_queue_il_wide</span>)</pre></body></html></div>
<pre><code>## # A tibble: 9 x 14
##   id_il  A_il alpha_il beta_i rank_min rank_max avg_rank  id_i D_max_i  D_il
##   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1     1   3      1      0.333        9        4     6.5      1       3     1
## 2     2   2      1      0.333        7        3     4.75     1       3     2
## 3     3   1      1      0.333        2        2     2        1       3     3
## 4     4   2.2    0.5    0.333        8        7     7.25     2       3     1
## 5     5   1.5    0.7    0.333        6        5     5.5      2       3     2
## 6     6   1.1    0.400  0.333        8        4     6        2       3     3
## 7     7   1.8    0.100  0.333        9        6     8        3       3     1
## 8     8   1.1    0.7    0.333        5        3     4        3       3     2
## 9     9   0.1    1      0.333        1        1     1        3       3     3
## # ... with 4 more variables: rho_c1_rk &lt;int&gt;, rho_c2_rk &lt;int&gt;, rho_c3_rk &lt;int&gt;,
## #   rho_c4_rk &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_alloc_i_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 12 x 7
## # Groups:   id_i [3]
##      rho rho_val  id_i D_max_i D_star_i F_star_i EH_star_i
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1     1   0.99      1       3        3    1           2  
##  2     2   0.785     1       3        3    1           2  
##  3     3  -3.64      1       3        1    0.333       4  
##  4     4 -99         1       3        1    0.333       4  
##  5     1   0.99      2       3        0    0           2.2
##  6     2   0.785     2       3        0    0           2.2
##  7     3  -3.64      2       3        2    0.667       2.2
##  8     4 -99         2       3        2    0.667       2.2
##  9     1   0.99      3       3        2    0.667       1.8
## 10     2   0.785     3       3        2    0.667       1.8
## 11     3  -3.64      3       3        2    0.667       1.8
## 12     4 -99         3       3        2    0.667       1.8</code></pre>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_rho_gini</span>)</pre></body></html></div>
<pre><code>## # A tibble: 12 x 9
##      rho rho_val gini_D_star gini_EH_star atkinson_EH_star sd_D_star sd_EH_star
##    &lt;int&gt;   &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;            &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1     1   0.99        0.300       0.0333        0.0000334     1.53        0.2 
##  2     2   0.785       0.300       0.0333        0.0000334     1.53        0.2 
##  3     3  -3.64        0.100       0.137         0.0000334     0.577       1.17
##  4     4 -99           0.100       0.137         0.000720      0.577       1.17
##  5     5   0.99        0.300       0.0333        0.000720      1.53        0.2 
##  6     6   0.785       0.300       0.0333        0.000720      1.53        0.2 
##  7     7  -3.64        0.100       0.137         0.189         0.577       1.17
##  8     8 -99           0.100       0.137         0.189         0.577       1.17
##  9     9   0.99        0.300       0.0333        0.189         1.53        0.2 
## 10    10   0.785       0.300       0.0333        0.317         1.53        0.2 
## 11    11  -3.64        0.100       0.137         0.317         0.577       1.17
## 12    12 -99           0.100       0.137         0.317         0.577       1.17
## # ... with 2 more variables: mean_EH_star &lt;dbl&gt;, min_EH_star &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_alloc_il_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 36 x 5
##      rho  Q_il sid_1 sid_2 sid_3
##    &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1     0     0     1
##  2     1     2     1     0     1
##  3     1     3     2     0     1
##  4     1     4     3     0     1
##  5     1     5     3     0     2
##  6     1     6     3     1     2
##  7     1     7     3     2     2
##  8     1     8     3     3     2
##  9     1     9     3     3     3
## 10     2     1     0     0     1
## # ... with 26 more rows</code></pre>
</div>
<div id="load-pre-generated-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-pre-generated-data" class="anchor"></a>Load Pre-Generated Data</h2>
<p>These are data thata were generated in the <a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_sodis_rkone_casch_allrw.html">DISCRETE–Discrete Optimal Allocation California Teacher Student Ratio (Line by Line)</a> function.</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="co"># Load Data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">df_opt_caschool_prep_i</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">df_opt_caschool_input_il</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">df_opt_caschool_input_ib</span>)

<span class="co"># Show Variables</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_opt_caschool_prep_i</span>)</pre></body></html></div>
<pre><code>## 'data.frame':    420 obs. of  15 variables:
##  $ id_i    : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ D_max_i : num  11 11 83 14 72 6 10 42 19 108 ...
##  $ D_o_i   : num  2 2 17 3 14 1 2 8 4 22 ...
##  $ Omega_i : num  706 673 657 656 656 ...
##  $ theta_i : num  -0.87 -0.87 -0.87 -0.87 -0.87 ...
##  $ beta_i  : num  0.00238 0.00238 0.00238 0.00238 0.00238 ...
##  $ enrltot : num  195 240 1550 243 1335 ...
##  $ teachers: num  11 11 83 14 72 6 10 42 19 108 ...
##  $ stravg  : num  17.7 21.8 18.7 17.4 18.5 ...
##  $ distcod : int  75119 61499 61549 61457 61523 62042 68536 63834 62331 67306 ...
##  $ county  : Factor w/ 45 levels "Alameda","Butte",..: 1 2 2 2 2 6 29 11 6 25 ...
##  $ district: Factor w/ 409 levels "Ackerman Elementary",..: 362 214 367 134 270 53 152 383 263 93 ...
##  $ grspan  : Factor w/ 2 levels "KK-06","KK-08": 2 2 2 2 2 2 2 2 2 1 ...
##  $ avginc  : num  22.69 9.82 8.98 8.98 9.08 ...
##  $ testscr : num  691 661 644 648 641 ...</code></pre>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_opt_caschool_input_il</span>)</pre></body></html></div>
<pre><code>## tibble [54,204 x 7] (S3: tbl_df/tbl/data.frame)
##  $ id_i    : int [1:54204] 1 1 1 1 1 1 1 1 1 1 ...
##  $ id_il   : int [1:54204] 1 2 3 4 5 6 7 8 9 10 ...
##  $ D_max_i : num [1:54204] 11 11 11 11 11 11 11 11 11 11 ...
##  $ D_il    : int [1:54204] 1 2 3 4 5 6 7 8 9 10 ...
##  $ A_il    : num [1:54204] 691 692 693 694 695 ...
##  $ alpha_il: num [1:54204] 1.285 1.087 0.932 0.808 0.707 ...
##  $ beta_i  : num [1:54204] 0.00238 0.00238 0.00238 0.00238 0.00238 ...</code></pre>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_opt_caschool_input_ib</span>)</pre></body></html></div>
<pre><code>## 'data.frame':    420 obs. of  4 variables:
##  $ id_i     : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ A_i_l0   : num  691 654 641 641 639 ...
##  $ alpha_o_i: num  2.37 2.92 2.76 2.66 2.63 ...
##  $ beta_i   : num  0.00238 0.00238 0.00238 0.00238 0.00238 ...</code></pre>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="co"># Modifying Beta Value</span>
<span class="co"># When individuals have the same weights, beta values do not matter</span>
<span class="no">df_opt_caschool_input_il</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_input_il</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">beta_i</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="no">df_opt_caschool_input_ib</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_input_ib</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">beta_i</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
</div>
<div id="solve-all-districts-discrete-optimal-allocation-across-planner-preferences" class="section level2">
<h2 class="hasAnchor">
<a href="#solve-all-districts-discrete-optimal-allocation-across-planner-preferences" class="anchor"></a>Solve All Districts Discrete Optimal Allocation Across Planner Preferences</h2>
<div id="specify-policy-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#specify-policy-parameters" class="anchor"></a>Specify Policy Parameters</h3>
<p>Note that <em>input_il</em> function already is based on <em>fl_fi_max</em>.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="co"># 100 percent teacher at most per school, discretize floor as needed</span>
<span class="co"># This is not a parameter that matters here, already a part of the input_il function</span>
<span class="no">fl_fi_max</span> <span class="kw">=</span> <span class="fl">1.00</span>
<span class="co"># 20 percent total additional of all teachers</span>
<span class="no">fl_fa_max</span> <span class="kw">=</span> <span class="fl">0.20</span>
<span class="co"># What is the number of teachers we can increase by</span>
<span class="no">fl_teacher_increase_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">df_opt_caschool_prep_i</span>$<span class="no">teachers</span>)*<span class="no">fl_fa_max</span>
<span class="no">fl_teacher_increase_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="no">fl_teacher_increase_number</span>)

<span class="co"># Rho values to consider</span>
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - (<span class="fl">10</span>^(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">2</span>,<span class="fl">2</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">4</span>))))
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">ar_rho</span>)</pre></body></html></div>
</div>
</div>
<div id="optimal-queue-and-allocations" class="section level2">
<h2 class="hasAnchor">
<a href="#optimal-queue-and-allocations" class="anchor"></a>Optimal Queue and Allocations</h2>
<p>Use the discrete allocation function across preference <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis.html</a> function. This computes optimal allocation for multiple planner inequality aversion <span class="math inline">\(\lambda\)</span> parameters at the same time. Note that in the function <span class="math inline">\(\lambda=\rho\)</span>.</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="co"># Optimal Allocation</span>
<span class="no">ls_df_queue</span> <span class="kw">&lt;-</span> <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span>(<span class="no">ar_rho</span>,
                                       <span class="no">fl_teacher_increase_number</span>,
                                       <span class="kw">bl_df_alloc_il</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                       <span class="kw">df_input_il</span> <span class="kw">=</span> <span class="no">df_opt_caschool_input_il</span>,
                                       <span class="kw">svr_rho</span> <span class="kw">=</span> <span class="st">'rho'</span>,
                                       <span class="kw">svr_id_i</span> <span class="kw">=</span> <span class="st">'id_i'</span>, <span class="kw">svr_id_il</span> <span class="kw">=</span> <span class="st">'id_il'</span>,
                                       <span class="kw">svr_D_max_i</span> <span class="kw">=</span> <span class="st">'D_max_i'</span>, <span class="kw">svr_D_il</span> <span class="kw">=</span> <span class="st">'D_il'</span>,
                                       <span class="kw">svr_D_star_i</span> <span class="kw">=</span> <span class="st">'D_star_i'</span>, <span class="kw">svr_F_star_i</span> <span class="kw">=</span> <span class="st">'F_star_i'</span>,
                                       <span class="kw">svr_inpalc</span> <span class="kw">=</span> <span class="st">'Q_il'</span>, <span class="kw">svr_D_Wbin_il</span> <span class="kw">=</span> <span class="st">'D_Wbin_il'</span>,
                                       <span class="kw">svr_A_il</span> <span class="kw">=</span> <span class="st">'A_il'</span>, <span class="kw">svr_alpha_il</span> <span class="kw">=</span> <span class="st">'alpha_il'</span>, <span class="kw">svr_beta_i</span> <span class="kw">=</span> <span class="st">'beta_i'</span>,
                                       <span class="kw">svr_expout</span> <span class="kw">=</span> <span class="st">'opti_exp_outcome'</span>,
                                       <span class="kw">st_idcol_prefix</span> <span class="kw">=</span> <span class="st">'sid_'</span>)</pre></body></html></div>
<pre><code>## Joining, by = "id_il"</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(rev)`</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(alloc_i_upto_Q)`</code></pre>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">df_queue_il_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_queue_il_long</span>
<span class="no">df_queue_il_wide</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_queue_il_wide</span>
<span class="no">df_alloc_i_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_alloc_i_long</span>
<span class="no">df_rho_gini</span>  <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_rho_gini</span>
<span class="no">df_alloc_il_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_alloc_il_long</span></pre></body></html></div>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_queue_il_long</span>, <span class="fl">10</span>))</pre></body></html></div>
<pre><code>## # A tibble: 10 x 9
##      rho rho_val  id_i id_il D_max_i  D_il  Q_il D_Wbin_il V_star_Q_il
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;
##  1     1   0.99      1     1      11     1   138         1     292290.
##  2     2   0.785     1     1      11     1   140         1    1444269.
##  3     3  -3.64      1     1      11     1   244         1        125.
##  4     4 -99         1     1      11     1 36657         0         NA 
##  5     1   0.99      1     2      11     2   209         1     292379.
##  6     2   0.785     1     2      11     2   212         1    1444712.
##  7     3  -3.64      1     2      11     2   372         1        125.
##  8     4 -99         1     2      11     2 39093         0         NA 
##  9     1   0.99      1     3      11     3   297         1     292474.
## 10     2   0.785     1     3      11     3   305         1    1445198.</code></pre>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="co"># print(str(df_queue_il_long))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_queue_il_wide</span>, <span class="fl">10</span>))</pre></body></html></div>
<pre><code>## # A tibble: 10 x 14
##    id_il  A_il alpha_il beta_i rank_min rank_max avg_rank  id_i D_max_i  D_il
##    &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;int&gt;    &lt;int&gt;    &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt;
##  1     1  691.    1.29       1    36657      138    9295.     1      11     1
##  2     2  692.    1.09       1    39093      209    9972.     1      11     2
##  3     3  693.    0.932      1    41307      297   10604      1      11     3
##  4     4  694.    0.808      1    43280      404   11190.     1      11     4
##  5     5  695.    0.707      1    45090      522   11750.     1      11     5
##  6     6  696.    0.624      1    46600      658   12248.     1      11     6
##  7     7  696.    0.554      1    47875      813   12704.     1      11     7
##  8     8  697.    0.496      1    48958      978   13115      1      11     8
##  9     9  697.    0.446      1    49841     1165   13495      1      11     9
## 10    10  698.    0.404      1    50512     1357   13826.     1      11    10
## # ... with 4 more variables: rho_c1_rk &lt;int&gt;, rho_c2_rk &lt;int&gt;, rho_c3_rk &lt;int&gt;,
## #   rho_c4_rk &lt;int&gt;</code></pre>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="co"># print(str(df_queue_il_wide))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_alloc_i_long</span>, <span class="fl">10</span>))</pre></body></html></div>
<pre><code>## # A tibble: 10 x 7
## # Groups:   id_i [3]
##      rho rho_val  id_i D_max_i D_star_i F_star_i EH_star_i
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1     1   0.99      1      11       11    1          699.
##  2     2   0.785     1      11       11    1          699.
##  3     3  -3.64      1      11       11    1          699.
##  4     4 -99         1      11        0    0          691.
##  5     1   0.99      2      11       11    1          664.
##  6     2   0.785     2      11       11    1          664.
##  7     3  -3.64      2      11       11    1          664.
##  8     4 -99         2      11        6    0.545      661.
##  9     1   0.99      3      83       54    0.651      647.
## 10     2   0.785     3      83       54    0.651      647.</code></pre>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="co"># print(str(df_queue_il_wide))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_rho_gini</span>)</pre></body></html></div>
<pre><code>## # A tibble: 1,680 x 9
##      rho rho_val gini_D_star gini_EH_star atkinson_EH_star sd_D_star sd_EH_star
##    &lt;int&gt;   &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;            &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1     1   0.99        0.445       0.0154       0.00000362      20.1       17.8
##  2     2   0.785       0.445       0.0154       0.00000362      20.2       17.8
##  3     3  -3.64        0.445       0.0151       0.00000362      20.3       17.5
##  4     4 -99           0.821       0.0125       0.00000362      60.8       14.4
##  5     5   0.99        0.445       0.0154       0.00000362      20.1       17.8
##  6     6   0.785       0.445       0.0154       0.00000362      20.2       17.8
##  7     7  -3.64        0.445       0.0151       0.00000362      20.3       17.5
##  8     8 -99           0.821       0.0125       0.00000362      60.8       14.4
##  9     9   0.99        0.445       0.0154       0.00000362      20.1       17.8
## 10    10   0.785       0.445       0.0154       0.00000362      20.2       17.8
## # ... with 1,670 more rows, and 2 more variables: mean_EH_star &lt;dbl&gt;,
## #   min_EH_star &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="co"># print(str(df_alloc_i_long))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_alloc_il_long</span>, <span class="fl">10</span>))</pre></body></html></div>
<pre><code>## # A tibble: 10 x 422
##      rho  Q_il sid_1 sid_2 sid_3 sid_4 sid_5 sid_6 sid_7 sid_8 sid_9 sid_10
##    &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1     1     1     0     0     0     0     0     0     0     0     0      0
##  2     1     2     0     0     0     0     0     0     0     0     0      0
##  3     1     3     0     0     0     0     0     0     0     0     0      0
##  4     1     4     0     0     0     0     0     0     0     0     0      0
##  5     1     5     0     0     0     0     0     0     0     0     0      0
##  6     1     6     0     0     0     0     0     0     0     0     0      0
##  7     1     7     0     0     0     0     0     0     0     0     0      0
##  8     1     8     0     0     0     0     0     1     0     0     0      0
##  9     1     9     0     0     0     0     0     1     0     0     0      0
## 10     1    10     0     0     0     0     0     1     0     0     0      0
## # ... with 410 more variables: sid_11 &lt;dbl&gt;, sid_12 &lt;dbl&gt;, sid_13 &lt;dbl&gt;,
## #   sid_14 &lt;dbl&gt;, sid_15 &lt;dbl&gt;, sid_16 &lt;dbl&gt;, sid_17 &lt;dbl&gt;, sid_18 &lt;dbl&gt;,
## #   sid_19 &lt;dbl&gt;, sid_20 &lt;dbl&gt;, sid_21 &lt;dbl&gt;, sid_22 &lt;dbl&gt;, sid_23 &lt;dbl&gt;,
## #   sid_24 &lt;dbl&gt;, sid_25 &lt;dbl&gt;, sid_26 &lt;dbl&gt;, sid_27 &lt;dbl&gt;, sid_28 &lt;dbl&gt;,
## #   sid_29 &lt;dbl&gt;, sid_30 &lt;dbl&gt;, sid_31 &lt;dbl&gt;, sid_32 &lt;dbl&gt;, sid_33 &lt;dbl&gt;,
## #   sid_34 &lt;dbl&gt;, sid_35 &lt;dbl&gt;, sid_36 &lt;dbl&gt;, sid_37 &lt;dbl&gt;, sid_38 &lt;dbl&gt;,
## #   sid_39 &lt;dbl&gt;, sid_40 &lt;dbl&gt;, sid_41 &lt;dbl&gt;, sid_42 &lt;dbl&gt;, sid_43 &lt;dbl&gt;,
## #   sid_44 &lt;dbl&gt;, sid_45 &lt;dbl&gt;, sid_46 &lt;dbl&gt;, sid_47 &lt;dbl&gt;, sid_48 &lt;dbl&gt;,
## #   sid_49 &lt;dbl&gt;, sid_50 &lt;dbl&gt;, sid_51 &lt;dbl&gt;, sid_52 &lt;dbl&gt;, sid_53 &lt;dbl&gt;,
## #   sid_54 &lt;dbl&gt;, sid_55 &lt;dbl&gt;, sid_56 &lt;dbl&gt;, sid_57 &lt;dbl&gt;, sid_58 &lt;dbl&gt;,
## #   sid_59 &lt;dbl&gt;, sid_60 &lt;dbl&gt;, sid_61 &lt;dbl&gt;, sid_62 &lt;dbl&gt;, sid_63 &lt;dbl&gt;,
## #   sid_64 &lt;dbl&gt;, sid_65 &lt;dbl&gt;, sid_66 &lt;dbl&gt;, sid_67 &lt;dbl&gt;, sid_68 &lt;dbl&gt;,
## #   sid_69 &lt;dbl&gt;, sid_70 &lt;dbl&gt;, sid_71 &lt;dbl&gt;, sid_72 &lt;dbl&gt;, sid_73 &lt;dbl&gt;,
## #   sid_74 &lt;dbl&gt;, sid_75 &lt;dbl&gt;, sid_76 &lt;dbl&gt;, sid_77 &lt;dbl&gt;, sid_78 &lt;dbl&gt;,
## #   sid_79 &lt;dbl&gt;, sid_80 &lt;dbl&gt;, sid_81 &lt;dbl&gt;, sid_82 &lt;dbl&gt;, sid_83 &lt;dbl&gt;,
## #   sid_84 &lt;dbl&gt;, sid_85 &lt;dbl&gt;, sid_86 &lt;dbl&gt;, sid_87 &lt;dbl&gt;, sid_88 &lt;dbl&gt;,
## #   sid_89 &lt;dbl&gt;, sid_90 &lt;dbl&gt;, sid_91 &lt;dbl&gt;, sid_92 &lt;dbl&gt;, sid_93 &lt;dbl&gt;,
## #   sid_94 &lt;dbl&gt;, sid_95 &lt;dbl&gt;, sid_96 &lt;dbl&gt;, sid_97 &lt;dbl&gt;, sid_98 &lt;dbl&gt;,
## #   sid_99 &lt;dbl&gt;, sid_100 &lt;dbl&gt;, sid_101 &lt;dbl&gt;, sid_102 &lt;dbl&gt;, sid_103 &lt;dbl&gt;,
## #   sid_104 &lt;dbl&gt;, sid_105 &lt;dbl&gt;, sid_106 &lt;dbl&gt;, sid_107 &lt;dbl&gt;, sid_108 &lt;dbl&gt;,
## #   sid_109 &lt;dbl&gt;, sid_110 &lt;dbl&gt;, ...</code></pre>
</div>
<div id="rev-compute" class="section level2">
<h2 class="hasAnchor">
<a href="#rev-compute" class="anchor"></a>REV Compute</h2>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="no">tb_rho_rev</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span>(<span class="no">ar_rho</span>,
                          <span class="no">fl_teacher_increase_number</span>,
                          <span class="kw">df_input_ib</span> <span class="kw">=</span> <span class="no">df_opt_caschool_input_ib</span>,
                          <span class="kw">df_queue_il_long_with_V</span> <span class="kw">=</span> <span class="no">df_queue_il_long</span>)</pre></body></html></div>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(rev)`</code></pre>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">tb_rho_rev</span>)</pre></body></html></div>
<pre><code>## # A tibble: 4 x 3
##     rho rho_val   REV
##   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1     1   0.99  0.836
## 2     2   0.785 0.836
## 3     3  -3.64  0.831
## 4     4 -99     0.949</code></pre>
</div>
<div id="optimal-allocation-among-subset-of-districts" class="section level2">
<h2 class="hasAnchor">
<a href="#optimal-allocation-among-subset-of-districts" class="anchor"></a>Optimal Allocation Among Subset of Districts</h2>
<div id="select-a-small-subset-of-districts" class="section level3">
<h3 class="hasAnchor">
<a href="#select-a-small-subset-of-districts" class="anchor"></a>Select a Small Subset of Districts</h3>
<p>To generate some graphs and more easily readable results, rather than using all school districts, select some random subset of school districts from the existing data frames.</p>
<ol style="list-style-type: decimal">
<li>Select a random subset of district IDs</li>
<li>New input df that only includes these IDs.</li>
</ol>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="co"># select four school districts</span>
<span class="co"># cas = california schools</span>
<span class="no">it_O</span> <span class="kw">&lt;-</span> <span class="fl">4</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)
<span class="no">df_cas_prep_sub_i</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_prep_i</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">teachers</span> <span class="kw">&lt;=</span> <span class="fl">100</span> <span class="kw">&amp;</span> <span class="no">teachers</span> <span class="kw">&gt;=</span> <span class="fl">50</span>)
<span class="no">df_cas_prep_sub_i</span> <span class="kw">&lt;-</span> <span class="no">df_cas_prep_sub_i</span>[<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">df_cas_prep_sub_i</span>)[<span class="fl">1</span>], <span class="no">it_O</span>, <span class="kw">replace</span><span class="kw">=</span><span class="fl">FALSE</span>),]
<span class="no">ar_cas_id_selected</span> <span class="kw">&lt;-</span> <span class="no">df_cas_prep_sub_i</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(<span class="no">id_i</span>)

<span class="co"># Select from il and ib only ids that are randomly selected</span>
<span class="no">df_cas_input_sub_il</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_input_il</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">id_i</span> <span class="kw">%in%</span> <span class="no">ar_cas_id_selected</span>)
<span class="no">df_cas_input_sub_ib</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_input_ib</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">id_i</span> <span class="kw">%in%</span> <span class="no">ar_cas_id_selected</span>)

<span class="co"># Print</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_cas_prep_sub_i</span>)</pre></body></html></div>
<pre><code>##    id_i D_max_i D_o_i  Omega_i    theta_i      beta_i enrltot teachers   stravg
## 4    32     100    20 636.0332 -0.8699505 0.002380952    2102      100 21.02000
## 39  327      51    10 686.9896 -0.8699505 0.002380952     900       51 17.64706
## 1     3      83    17 657.0958 -0.8699505 0.002380952    1550       83 18.67470
## 34  286      65    13 671.6432 -0.8699505 0.002380952    1252       65 19.26154
##    distcod    county                    district grspan   avginc testscr
## 4    75440  Monterey             Soledad Unified  KK-08 12.40900  624.95
## 39   68007 San Diego          Cardiff Elementary  KK-06 21.96700  668.65
## 1    61549     Butte Thermalito Union Elementary  KK-08  8.97800  643.60
## 34   71035    Sonoma           Wright Elementary  KK-06 12.58425  663.85</code></pre>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_cas_input_sub_ib</span>)</pre></body></html></div>
<pre><code>##   id_i   A_i_l0 alpha_o_i beta_i
## 1    3 640.8497  2.761831      1
## 2   32 617.7468  3.047727      1
## 3  286 654.8866  2.792764      1
## 4  327 671.6376  2.516732      1</code></pre>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_cas_input_sub_il</span>)</pre></body></html></div>
<pre><code>## # A tibble: 299 x 7
##     id_i id_il D_max_i  D_il  A_il alpha_il beta_i
##    &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1     3    23      83     1  641.    0.193      1
##  2     3    24      83     2  641.    0.189      1
##  3     3    25      83     3  641.    0.184      1
##  4     3    26      83     4  641.    0.180      1
##  5     3    27      83     5  642.    0.176      1
##  6     3    28      83     6  642.    0.172      1
##  7     3    29      83     7  642.    0.168      1
##  8     3    30      83     8  642.    0.165      1
##  9     3    31      83     9  642.    0.161      1
## 10     3    32      83    10  642.    0.158      1
## # ... with 289 more rows</code></pre>
<p>Now we also have a new total number of teacher increase, no longer based on all districts. The policy here is to potentially increase each school district by <em>fl_fi_max</em>, already coded into the <em>input_il</em> file, so that can not change. The total number of available new teachers is <em>fl_fa_max</em> times the existing number of teachers in the selected districts overall</p>
<div class="sourceCode" id="cb59"><html><body><pre class="r"><span class="no">fl_fa_max</span> <span class="kw">=</span> <span class="fl">0.20</span>
<span class="co"># What is the number of teachers we can increase by</span>
<span class="no">fl_teacher_increase_sub_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">df_cas_prep_sub_i</span>$<span class="no">teachers</span>)*<span class="no">fl_fa_max</span>
<span class="no">fl_teacher_increase_sub_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="no">fl_teacher_increase_sub_number</span>)</pre></body></html></div>
</div>
<div id="optimal-queue-allocations-and-rev" class="section level3">
<h3 class="hasAnchor">
<a href="#optimal-queue-allocations-and-rev" class="anchor"></a>Optimal Queue, Allocations and REV</h3>
<p>Use the discrete allocation function across preference <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis.html</a> function. This computes optimal allocation for multiple planner inequality aversion <span class="math inline">\(\lambda\)</span> parameters at the same time. Note that in the function <span class="math inline">\(\lambda=\rho\)</span>.</p>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="co"># Rho values to consider</span>
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - (<span class="fl">10</span>^(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">2</span>,<span class="fl">2</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">4</span>))))
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">ar_rho</span>)

<span class="co"># Optimal Allocation</span>
<span class="no">ls_df_sub_queue</span> <span class="kw">&lt;-</span> <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span>(<span class="no">ar_rho</span>, <span class="no">fl_teacher_increase_sub_number</span>,
                                           <span class="kw">df_input_il</span> <span class="kw">=</span> <span class="no">df_cas_input_sub_il</span>,
                                           <span class="kw">bl_df_alloc_il</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## Joining, by = "id_il"</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,
## max-inequality/min-gini=0.6

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,
## max-inequality/min-gini=0.6

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,
## max-inequality/min-gini=0.6

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i]]): Data vector has only n=4,
## max-inequality/min-gini=0.6</code></pre>
<pre><code>## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has
## only n=4, max-inequality/min-gini=0.6

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has
## only n=4, max-inequality/min-gini=0.6

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has
## only n=4, max-inequality/min-gini=0.6

## Warning in ff_dist_gini_vector_pos(.[[svr_D_star_i_demean]]): Data vector has
## only n=4, max-inequality/min-gini=0.6</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(rev)`</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(alloc_i_upto_Q)`</code></pre>
<div class="sourceCode" id="cb68"><html><body><pre class="r"><span class="no">df_queue_il_sub_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_sub_queue</span>$<span class="no">df_queue_il_long</span>
<span class="no">df_queue_il_sub_wide</span> <span class="kw">&lt;-</span> <span class="no">ls_df_sub_queue</span>$<span class="no">df_queue_il_wide</span>
<span class="no">df_alloc_i_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_sub_queue</span>$<span class="no">df_alloc_i_long</span>
<span class="no">df_rho_gini</span> <span class="kw">&lt;-</span> <span class="no">ls_df_sub_queue</span>$<span class="no">df_rho_gini</span>
<span class="no">df_alloc_il_long</span> <span class="kw">&lt;-</span> <span class="no">ls_df_sub_queue</span>$<span class="no">df_alloc_il_long</span>

<span class="co"># REV</span>
<span class="no">ar_util_rev_loop_func</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span>(<span class="no">ar_rho</span>,<span class="no">fl_teacher_increase_sub_number</span>,
                                                 <span class="kw">df_input_ib</span> <span class="kw">=</span> <span class="no">df_cas_input_sub_ib</span>,
                                                 <span class="kw">df_queue_il_long_with_V</span> <span class="kw">=</span> <span class="no">df_queue_il_sub_long</span>)</pre></body></html></div>
<pre><code>## Warning in min(df_queue_il_with_V %&gt;% filter(!!sym(svr_V_star_Q_il) &gt;=
## fl_util_alter_alloc) %&gt;% : no non-missing arguments to min; returning Inf</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(rev)`</code></pre>
<p>Show Results</p>
<div class="sourceCode" id="cb71"><html><body><pre class="r"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_queue_il_sub_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 1,196 x 9
##      rho rho_val  id_i id_il D_max_i  D_il  Q_il D_Wbin_il V_star_Q_il
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;
##  1     1   0.99      3    23      83     1    24         1       2627.
##  2     2   0.785     3    23      83     1    23         1       3790.
##  3     3  -3.64      3    23      83     1    19         1        441.
##  4     4 -99         3    23      83     1   101         0         NA 
##  5     1   0.99      3    24      83     2    26         1       2628.
##  6     2   0.785     3    24      83     2    26         1       3791.
##  7     3  -3.64      3    24      83     2    22         1        441.
##  8     4 -99         3    24      83     2   102         0         NA 
##  9     1   0.99      3    25      83     3    29         1       2628.
## 10     2   0.785     3    25      83     3    29         1       3792.
## # ... with 1,186 more rows</code></pre>
<div class="sourceCode" id="cb73"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_alloc_i_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 16 x 7
## # Groups:   id_i [4]
##      rho rho_val  id_i D_max_i D_star_i F_star_i EH_star_i
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1     1   0.99      3      83       11    0.133      643.
##  2     2   0.785     3      83       11    0.133      643.
##  3     3  -3.64      3      83       12    0.145      643.
##  4     4 -99         3      83        0    0          641.
##  5     1   0.99     32     100        9    0.09       619.
##  6     2   0.785    32     100        9    0.09       619.
##  7     3  -3.64     32     100       19    0.19       621.
##  8     4 -99        32     100       59    0.59       625.
##  9     1   0.99    286      65       19    0.292      659.
## 10     2   0.785   286      65       19    0.292      659.
## 11     3  -3.64    286      65       15    0.231      658.
## 12     4 -99       286      65        0    0          655.
## 13     1   0.99    327      51       20    0.392      676.
## 14     2   0.785   327      51       20    0.392      676.
## 15     3  -3.64    327      51       13    0.255      675.
## 16     4 -99       327      51        0    0          672.</code></pre>
<div class="sourceCode" id="cb75"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_rho_gini</span>)</pre></body></html></div>
<pre><code>## # A tibble: 16 x 9
##      rho rho_val gini_D_star gini_EH_star atkinson_EH_star sd_D_star sd_EH_star
##    &lt;int&gt;   &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;            &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1     1   0.99       0.139        0.0143       0.00000519      5.56       24.1
##  2     2   0.785      0.139        0.0143       0.00000519      5.56       24.1
##  3     3  -3.64       0.0780       0.0137       0.00000519      3.10       23.0
##  4     4 -99          0.6          0.0120       0.00000519     29.5        20.1
##  5     5   0.99       0.139        0.0143       0.000112        5.56       24.1
##  6     6   0.785      0.139        0.0143       0.000112        5.56       24.1
##  7     7  -3.64       0.0780       0.0137       0.000112        3.10       23.0
##  8     8 -99          0.6          0.0120       0.000112       29.5        20.1
##  9     9   0.99       0.139        0.0143       0.00220         5.56       24.1
## 10    10   0.785      0.139        0.0143       0.00220         5.56       24.1
## 11    11  -3.64       0.0780       0.0137       0.00220         3.10       23.0
## 12    12 -99          0.6          0.0120       0.00220        29.5        20.1
## 13    13   0.99       0.139        0.0143       0.0234          5.56       24.1
## 14    14   0.785      0.139        0.0143       0.0234          5.56       24.1
## 15    15  -3.64       0.0780       0.0137       0.0234          3.10       23.0
## 16    16 -99          0.6          0.0120       0.0234         29.5        20.1
## # ... with 2 more variables: mean_EH_star &lt;dbl&gt;, min_EH_star &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb77"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">df_alloc_il_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 1,196 x 6
##      rho  Q_il sid_3 sid_32 sid_286 sid_327
##    &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1     1     1     0      0       0       1
##  2     1     2     0      0       0       2
##  3     1     3     0      0       0       3
##  4     1     4     0      0       0       4
##  5     1     5     0      0       0       5
##  6     1     6     0      0       1       5
##  7     1     7     0      0       2       5
##  8     1     8     0      0       2       6
##  9     1     9     0      0       3       6
## 10     1    10     0      0       3       7
## # ... with 1,186 more rows</code></pre>
<div class="sourceCode" id="cb79"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">ar_util_rev_loop_func</span>)</pre></body></html></div>
<pre><code>## # A tibble: 4 x 3
##     rho rho_val    REV
##   &lt;int&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1     1   0.99  0.0339
## 2     2   0.785 0.0339
## 3     3  -3.64  0     
## 4     4 -99     0.644</code></pre>
<!-- ### Additional Statistics

1. Predicted Expected Outcomes for each i given allocations
2. Utility at each Queue rank point
3. Gini Statistics based on allocations

### Results Analysis

Core graphical/tabular illustration of results across Many Individuals

1. Mean and standard deviation of outcome, across $\lambda$, along with actual mean and standard deviation
2. Gini of Allocations and Outcomes, across $\lambda$, along with observed of intended Gini of Allocation or Outcomes
3. REV in percentages as well as in units of resources lost, across $\lambda$
4. Tabular results already exists for this. Rank Data/chart:
    - columns are $\lambda$ points
    - colors identify individuals, each color appears multiple times due to multiple allocations for each individual
    - show ranking changes as preference changes
    - highligh only subset (1) of individuals
    - Climbing chart? x axis is rank, y axis allocation for individual, but not sure why this would be useful. Perhaps useful for tabular outputs. Maybe only very small chart

How should illustrative graph be shown with only 2 individuals? -->
</div>
</div>
<div id="differential-mass-optimal-allocation" class="section level2">
<h2 class="hasAnchor">
<a href="#differential-mass-optimal-allocation" class="anchor"></a>Differential Mass Optimal Allocation</h2>
<p>Consider the population of schools is measure one, there are <span class="math inline">\(N\)</span> distinct types of schools, and the mass of each unique type is different, but they sum up to 1. If each school can have 5 additional teachers, than the mass of teachers is measure 5.</p>
<p>Use the number of students per school as its mass, and introduce a new vector for the allocation function that is this mass. This is to illustrate ideas. The mass should not be the number of students, but the number of schools of the same type.</p>
<p>Note that under discrete allocation, there were 10840 available teachers to be allocated. But in the problem below, the idea is:</p>
<ol style="list-style-type: decimal">
<li>suppose there is some system that currently allocates teachers by school attributes</li>
<li>we know the number of teachers allocated to each type of school</li>
<li>we know the proportion of each type of school in the school population.</li>
<li>given a population measure of 1 as the sum of all schools, if on average 4 teachers are allocated to each school, the total of teachers allocated is measure 4. In discrete terms, that just means, if there are in total 1000 different schools (not different unique type, just different schools), and on average each school gets 4 teachers, we are allocating 4000 teachers.</li>
</ol>
<p>Several things to note:</p>
<ol style="list-style-type: decimal">
<li>Get the total measure of resources used by the alternative allocation, this is not summing up just the mass of all individuals, which sums to one, but sums the measure of resources allocated given individual mass, and how much is allocated to each individual</li>
<li>Allocation queue: sort by allocation queue, and cumulative sum over individual mass, repeatedly over each incremental allocation for each individual</li>
<li>Welfare calculation: the welfare/utility is not by cumulative mass, but by probability mass for each type, this does not vary depending on how much is allocated. Allocation changes alpha and A, not the mass in utility.</li>
</ol>
<div id="analyze-previous-level-allocation-with-measure-units" class="section level3">
<h3 class="hasAnchor">
<a href="#analyze-previous-level-allocation-with-measure-units" class="anchor"></a>Analyze Previous Level Allocation with Measure Units</h3>
<p>Analyze previous allocation not based on measure, do this only for one planner:</p>
<ol style="list-style-type: decimal">
<li>sort by queue</li>
<li>cumulative sum the mass variable: mass_cumu_queue, cumulative mass (resource allocated) by this queue point.</li>
</ol>
<p>Note that this is to be done inside the allocation function, after queue has been found, cumulative sum mass along the queue, and set cut-off at the total measure of resources available.</p>
<div class="sourceCode" id="cb81"><html><body><pre class="r"><span class="co"># Cumulative Mass</span>
<span class="no">df_queue_il_long_mass_cumu</span> <span class="kw">&lt;-</span> <span class="no">df_queue_il_long</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">rho_val</span> <span class="kw">==</span> <span class="no">ar_rho</span>[<span class="fl">1</span>]) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">rho</span>, -<span class="no">rho_val</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">df_opt_caschool_prep_i</span> <span class="kw">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">mass</span> <span class="kw">=</span> <span class="no">enrltot</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">enrltot</span>)) <span class="kw">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id_i</span>, <span class="no">mass</span>), <span class="kw">by</span><span class="kw">=</span><span class="st">'id_i'</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">Q_il</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">mass_cumu_queue</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(<span class="no">mass</span>))
<span class="co"># View Around the Teacher Available Cut-off mass</span>
<span class="no">df_queue_il_long_mass_cumu</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">Q_il</span> <span class="kw">&gt;=</span> <span class="no">fl_teacher_increase_number</span> - <span class="fl">5</span>
          <span class="kw">&amp;</span> <span class="no">Q_il</span> <span class="kw">&lt;=</span> <span class="no">fl_teacher_increase_number</span> + <span class="fl">5</span>)</pre></body></html></div>
<pre><code>## # A tibble: 11 x 9
##     id_i id_il D_max_i  D_il  Q_il D_Wbin_il V_star_Q_il    mass mass_cumu_queue
##    &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;           &lt;dbl&gt;
##  1    97 16260      95    55 10835         1     294663. 0.00167            14.4
##  2   339 47438     135    43 10836         1     294663. 0.00235            14.4
##  3   406 52898     132    37 10837         1     294663. 0.00212            14.4
##  4   282 40715      89    59 10838         1     294663. 0.00162            14.4
##  5    72 13654     141    50 10839         1     294663. 0.00271            14.4
##  6   412 53590      87    40 10840         1     294663. 0.00119            14.4
##  7    45  5664     221     7 10841         0         NA  0.00386            14.4
##  8   411 53444     139    33 10842         0         NA  0.00219            14.4
##  9   351 49277     127    49 10843         0         NA  0.00230            14.4
## 10   404 52726     112    42 10844         0         NA  0.00176            14.4
## 11   373 50222      80    59 10845         0         NA  0.00143            14.4</code></pre>
<div class="sourceCode" id="cb83"><html><body><pre class="r"><span class="co"># Summarize</span>
<span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_queue_il_long_mass_cumu</span>, <span class="kw">bl_statsasrows</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: `funs()` is deprecated as of dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Warning: `as.tibble()` is deprecated as of tibble 2.0.0.
## Please use `as_tibble()` instead.
## The signature and semantics have changed, see `?as_tibble`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 9 x 19
##   var       n unique NAobs ZEROobs    mean      sd      cv     min     p01
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 D.il  54204   1429     0       0 2.02e+2 2.25e+2 1.11    1.00e+0 2.00e+0
## 2 D.ma~ 54204    203     0       0 4.02e+2 3.33e+2 0.829   5.00e+0 1.20e+1
## 3 D.Wb~ 54204      2     0   43364 2.00e-1 4.00e-1 2.00    0.      0.     
## 4 id.i  54204    420     0       0 1.83e+2 1.16e+2 0.635   1.00e+0 1.60e+1
## 5 id.il 54204  54204     0       0 2.71e+4 1.56e+4 0.577   1.00e+0 5.43e+2
## 6 mass  54204    391     0       0 7.51e-3 6.21e-3 0.827   7.34e-5 2.02e-4
## 7 mass~ 54204  54204     0       0 1.22e+2 1.14e+2 0.931   1.17e-4 1.07e-1
## 8 Q.il  54204  54204     0       0 2.71e+4 1.56e+4 0.577   1.00e+0 5.43e+2
## 9 V.st~ 54204  10841 43364      NA 2.94e+5 6.07e+2 0.00206 2.92e+5 2.92e+5
## # ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,
## #   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
</div>
<div id="generate-the-mass-variable" class="section level3">
<h3 class="hasAnchor">
<a href="#generate-the-mass-variable" class="anchor"></a>Generate The mass Variable</h3>
<p>The mass variable is not contained in <em>df_opt_caschool_prep_i</em>, but is contained in <em>df_opt_caschool_prep_i</em>, merge together to get that number of students as mass. This variable does not need to sum to one. Reweighting to sum to one should not change results.</p>
<div class="sourceCode" id="cb88"><html><body><pre class="r"><span class="co"># Summarize</span>
<span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_opt_caschool_input_il</span>, <span class="kw">bl_statsasrows</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 7 x 19
##   var       n unique NAobs ZEROobs    mean      sd     cv     min     p01
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 A.il  54204  54204     0       0 6.56e+2 1.69e+1 0.0258 6.13e+2 6.24e+2
## 2 alph~ 54204  53590     0       0 6.62e-2 1.44e-1 2.17   2.90e-3 4.14e-3
## 3 beta~ 54204      1     0       0 1.00e+0 0.      0      1.00e+0 1.00e+0
## 4 D.il  54204   1429     0       0 2.02e+2 2.25e+2 1.11   1.00e+0 2.00e+0
## 5 D.ma~ 54204    203     0       0 4.02e+2 3.33e+2 0.829  5.00e+0 1.20e+1
## 6 id.i  54204    420     0       0 1.83e+2 1.16e+2 0.635  1.00e+0 1.60e+1
## 7 id.il 54204  54204     0       0 2.71e+4 1.56e+4 0.577  1.00e+0 5.43e+2
## # ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,
## #   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb91"><html><body><pre class="r"><span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_opt_caschool_input_ib</span>, <span class="kw">bl_statsasrows</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 4 x 19
##   var       n unique NAobs ZEROobs   mean      sd     cv    min    p01    p05
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 A.i.~   420    420     0       0 654.    17.2   0.0264 613.   618.   624.  
## 2 alph~   420    410     0       0   2.84   0.327 0.115    1.81   1.95   2.27
## 3 beta~   420      1     0       0   1      0     0        1      1      1   
## 4 id.i    420    420     0       0 210.   121.    0.577    1      5.19  22.0 
## # ... with 8 more variables: p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;, p75 &lt;dbl&gt;,
## #   p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb94"><html><body><pre class="r"><span class="co"># Mass of Students for IL file </span>
<span class="no">df_opt_caschool_input_mass_il</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_input_il</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">df_opt_caschool_prep_i</span> <span class="kw">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">mass_i</span> <span class="kw">=</span> <span class="no">enrltot</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">enrltot</span>)) <span class="kw">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id_i</span>, <span class="no">mass_i</span>)
            , <span class="kw">by</span><span class="kw">=</span><span class="st">'id_i'</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>()

<span class="co"># Mass of Students for IL file </span>
<span class="co"># IB file done with the Assumption that fl_fa_max additional teachers per school</span>
<span class="co"># Since mass per teacher/school same, total mass per school for ib allocation </span>
<span class="co"># is determined by mass_i still. Do not nuum to multiply mass by the number of teachers</span>
<span class="co"># assigned. </span>
<span class="no">df_opt_caschool_input_mass_ib</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_input_ib</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">df_opt_caschool_prep_i</span> <span class="kw">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">mass_i</span> <span class="kw">=</span> <span class="no">enrltot</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">enrltot</span>)) <span class="kw">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">cumu_sum_group_i</span> <span class="kw">=</span> <span class="no">mass_i</span>*<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">teachers</span>*<span class="no">fl_fa_max</span>)) <span class="kw">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id_i</span>, <span class="no">mass_i</span>, <span class="no">cumu_sum_group_i</span>, <span class="no">teachers</span>)
            , <span class="kw">by</span><span class="kw">=</span><span class="st">'id_i'</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>()

<span class="co"># Total mass</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">df_opt_caschool_input_mass_il</span>$<span class="no">mass_i</span>)</pre></body></html></div>
<pre><code>## [1] 407.3127</code></pre>
<div class="sourceCode" id="cb96"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">df_opt_caschool_input_mass_ib</span>$<span class="no">cumu_sum_group_i</span>)</pre></body></html></div>
<pre><code>## [1] 81.46857</code></pre>
<div class="sourceCode" id="cb98"><html><body><pre class="r"><span class="co"># Alternative Allocation and Mass for Alternative Allocations</span>
<span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_opt_caschool_input_mass_il</span>, <span class="kw">bl_statsasrows</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 8 x 19
##   var       n unique NAobs ZEROobs    mean      sd     cv     min     p01
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 A.il  54204  54204     0       0 6.56e+2 1.69e+1 0.0258 6.13e+2 6.24e+2
## 2 alph~ 54204  53590     0       0 6.62e-2 1.44e-1 2.17   2.90e-3 4.14e-3
## 3 beta~ 54204      1     0       0 1.00e+0 0.      0      1.00e+0 1.00e+0
## 4 D.il  54204   1429     0       0 2.02e+2 2.25e+2 1.11   1.00e+0 2.00e+0
## 5 D.ma~ 54204    203     0       0 4.02e+2 3.33e+2 0.829  5.00e+0 1.20e+1
## 6 id.i  54204    420     0       0 1.83e+2 1.16e+2 0.635  1.00e+0 1.60e+1
## 7 id.il 54204  54204     0       0 2.71e+4 1.56e+4 0.577  1.00e+0 5.43e+2
## 8 mass~ 54204    391     0       0 7.51e-3 6.21e-3 0.827  7.34e-5 2.02e-4
## # ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,
## #   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb101"><html><body><pre class="r"><span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_opt_caschool_input_mass_ib</span>, <span class="kw">bl_statsasrows</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 7 x 19
##   var       n unique NAobs ZEROobs    mean      sd     cv     min     p01
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 A.i.~   420    420     0       0 6.54e+2 1.72e+1 0.0264 6.13e+2 6.18e+2
## 2 alph~   420    410     0       0 2.84e+0 3.27e-1 0.115  1.81e+0 1.95e+0
## 3 beta~   420      1     0       0 1.00e+0 0.      0      1.00e+0 1.00e+0
## 4 cumu~   420    398     0       0 1.94e-1 6.28e-1 3.24   7.34e-5 9.33e-5
## 5 id.i    420    420     0       0 2.10e+2 1.21e+2 0.577  1.00e+0 5.19e+0
## 6 mass~   420    391     0       0 2.38e-3 3.54e-3 1.49   7.34e-5 9.33e-5
## 7 teac~   420    203     0       0 1.29e+2 1.88e+2 1.46   5.00e+0 5.00e+0
## # ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,
## #   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
<p>Within Group Cumulative Mass Sum with Allocations:</p>
<div class="sourceCode" id="cb104"><html><body><pre class="r"><span class="co"># Within Group Cumulative Sum of Mass</span>
<span class="co"># For the Value Calculation, the A and alpha are updated to be given allocation up to that point</span>
<span class="co"># that means the mass calculation is not mass at a particular unit of allocation, but mass</span>
<span class="co"># for that individual group/type, up to the point. This is a within group cumulative sum, </span>
<span class="co"># Note that so for welfare and for allocation queue, in the welfare case, we need cumulative within</span>
<span class="co"># individual group mass, and in the allocation queue, need point mass</span>

<span class="no">df_opt_caschool_input_mass_il</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">id_i</span>, <span class="no">D_il</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">id_i</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">D_il</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">cumu_sum_group_i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(<span class="no">mass_i</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">id_i</span>, <span class="no">D_il</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>()</pre></body></html></div>
<pre><code>## # A tibble: 54,204 x 9
##     id_i id_il D_max_i  D_il  A_il alpha_il beta_i   mass_i cumu_sum_group_i
##    &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;            &lt;dbl&gt;
##  1     1     1      11     1  691.    1.29       1 0.000177         0.000177
##  2     1     2      11     2  692.    1.09       1 0.000177         0.000353
##  3     1     3      11     3  693.    0.932      1 0.000177         0.000530
##  4     1     4      11     4  694.    0.808      1 0.000177         0.000706
##  5     1     5      11     5  695.    0.707      1 0.000177         0.000883
##  6     1     6      11     6  696.    0.624      1 0.000177         0.00106 
##  7     1     7      11     7  696.    0.554      1 0.000177         0.00124 
##  8     1     8      11     8  697.    0.496      1 0.000177         0.00141 
##  9     1     9      11     9  697.    0.446      1 0.000177         0.00159 
## 10     1    10      11    10  698.    0.404      1 0.000177         0.00177 
## # ... with 54,194 more rows</code></pre>
</div>
<div id="select-subset-of-individuals-for-allocaitons" class="section level3">
<h3 class="hasAnchor">
<a href="#select-subset-of-individuals-for-allocaitons" class="anchor"></a>Select Subset of Individuals For Allocaitons</h3>
<p>If want to analyze more closely what is happening in a subset of cases, use the subsetting option:</p>
<div class="sourceCode" id="cb106"><html><body><pre class="r"><span class="no">it_O</span> <span class="kw">&lt;-</span> <span class="fl">2</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)
<span class="no">df_cas_prep_sub_i</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_prep_i</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">teachers</span> <span class="kw">&lt;=</span> <span class="fl">100</span> <span class="kw">&amp;</span> <span class="no">teachers</span> <span class="kw">&gt;=</span> <span class="fl">50</span>)
<span class="no">df_cas_prep_sub_i</span> <span class="kw">&lt;-</span> <span class="no">df_cas_prep_sub_i</span>[<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">df_cas_prep_sub_i</span>)[<span class="fl">1</span>], <span class="no">it_O</span>, <span class="kw">replace</span><span class="kw">=</span><span class="fl">FALSE</span>),]
<span class="no">ar_cas_id_selected</span> <span class="kw">&lt;-</span> <span class="no">df_cas_prep_sub_i</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(<span class="no">id_i</span>)

<span class="co"># Select from il and ib only ids that are randomly selected</span>
<span class="no">bl_subsetting</span> <span class="kw">&lt;-</span> <span class="fl">FALSE</span>
<span class="kw">if</span> (<span class="no">bl_subsetting</span>) {
  <span class="no">df_opt_caschool_input_mass_il</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_input_mass_il</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">id_i</span> <span class="kw">%in%</span> <span class="no">ar_cas_id_selected</span>)
  <span class="no">df_opt_caschool_input_mass_ib</span> <span class="kw">&lt;-</span> <span class="no">df_opt_caschool_input_mass_ib</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">id_i</span> <span class="kw">%in%</span> <span class="no">ar_cas_id_selected</span>)
}

<span class="co"># Summarize</span>
<span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_opt_caschool_input_mass_il</span>, <span class="kw">bl_statsasrows</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 8 x 19
##   var       n unique NAobs ZEROobs    mean      sd     cv     min     p01
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 A.il  54204  54204     0       0 6.56e+2 1.69e+1 0.0258 6.13e+2 6.24e+2
## 2 alph~ 54204  53590     0       0 6.62e-2 1.44e-1 2.17   2.90e-3 4.14e-3
## 3 beta~ 54204      1     0       0 1.00e+0 0.      0      1.00e+0 1.00e+0
## 4 D.il  54204   1429     0       0 2.02e+2 2.25e+2 1.11   1.00e+0 2.00e+0
## 5 D.ma~ 54204    203     0       0 4.02e+2 3.33e+2 0.829  5.00e+0 1.20e+1
## 6 id.i  54204    420     0       0 1.83e+2 1.16e+2 0.635  1.00e+0 1.60e+1
## 7 id.il 54204  54204     0       0 2.71e+4 1.56e+4 0.577  1.00e+0 5.43e+2
## 8 mass~ 54204    391     0       0 7.51e-3 6.21e-3 0.827  7.34e-5 2.02e-4
## # ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,
## #   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb109"><html><body><pre class="r"><span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_opt_caschool_input_mass_ib</span>, <span class="kw">bl_statsasrows</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 7 x 19
##   var       n unique NAobs ZEROobs    mean      sd     cv     min     p01
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 A.i.~   420    420     0       0 6.54e+2 1.72e+1 0.0264 6.13e+2 6.18e+2
## 2 alph~   420    410     0       0 2.84e+0 3.27e-1 0.115  1.81e+0 1.95e+0
## 3 beta~   420      1     0       0 1.00e+0 0.      0      1.00e+0 1.00e+0
## 4 cumu~   420    398     0       0 1.94e-1 6.28e-1 3.24   7.34e-5 9.33e-5
## 5 id.i    420    420     0       0 2.10e+2 1.21e+2 0.577  1.00e+0 5.19e+0
## 6 mass~   420    391     0       0 2.38e-3 3.54e-3 1.49   7.34e-5 9.33e-5
## 7 teac~   420    203     0       0 1.29e+2 1.88e+2 1.46   5.00e+0 5.00e+0
## # ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,
## #   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
</div>
<div id="optimal-allocations" class="section level3">
<h3 class="hasAnchor">
<a href="#optimal-allocations" class="anchor"></a>Optimal Allocations</h3>
<div id="optimal-allocation-with-number-of-teachers-as-before" class="section level4">
<h4 class="hasAnchor">
<a href="#optimal-allocation-with-number-of-teachers-as-before" class="anchor"></a>Optimal Allocation with Number of Teachers as before</h4>
<p>Copying the code from prior, use <em>fl_teacher_increase_sub_number</em> and <em>df_opt_caschool_input_mass_il</em> without the mass column <em>mass_i</em> specified.</p>
<div class="sourceCode" id="cb112"><html><body><pre class="r"><span class="co"># Measure of Available Teachers</span>
<span class="no">fl_teacher_increase_sub_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">df_opt_caschool_input_mass_ib</span>$<span class="no">teachers</span>)*<span class="no">fl_fa_max</span>
<span class="no">fl_teacher_increase_sub_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span>(<span class="no">fl_teacher_increase_sub_number</span>)
<span class="co"># Allocate Based on the Measure of Available Teachers</span>
<span class="no">ls_df_queue</span> <span class="kw">&lt;-</span> <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span>(
  <span class="no">ar_rho</span>,
  <span class="no">fl_teacher_increase_sub_number</span>,
  <span class="kw">bl_df_alloc_il</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">df_input_il</span> <span class="kw">=</span> <span class="no">df_opt_caschool_input_mass_il</span>,
  <span class="kw">svr_rho</span> <span class="kw">=</span> <span class="st">'rho'</span>,
  <span class="kw">svr_id_i</span> <span class="kw">=</span> <span class="st">'id_i'</span>, <span class="kw">svr_id_il</span> <span class="kw">=</span> <span class="st">'id_il'</span>,
  <span class="kw">svr_D_max_i</span> <span class="kw">=</span> <span class="st">'D_max_i'</span>, <span class="kw">svr_D_il</span> <span class="kw">=</span> <span class="st">'D_il'</span>,
  <span class="kw">svr_D_star_i</span> <span class="kw">=</span> <span class="st">'D_star_i'</span>, <span class="kw">svr_F_star_i</span> <span class="kw">=</span> <span class="st">'F_star_i'</span>,
  <span class="kw">svr_inpalc</span> <span class="kw">=</span> <span class="st">'Q_il'</span>, <span class="kw">svr_D_Wbin_il</span> <span class="kw">=</span> <span class="st">'D_Wbin_il'</span>,
  <span class="kw">svr_A_il</span> <span class="kw">=</span> <span class="st">'A_il'</span>, <span class="kw">svr_alpha_il</span> <span class="kw">=</span> <span class="st">'alpha_il'</span>,
  <span class="kw">svr_beta_i</span> <span class="kw">=</span> <span class="st">'beta_i'</span>,
  <span class="kw">svr_expout</span> <span class="kw">=</span> <span class="st">'opti_exp_outcome'</span>,
  <span class="kw">st_idcol_prefix</span> <span class="kw">=</span> <span class="st">'sid_'</span>)</pre></body></html></div>
<pre><code>## Joining, by = "id_il"</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(rev)`</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(alloc_i_upto_Q)`</code></pre>
<div class="sourceCode" id="cb117"><html><body><pre class="r"><span class="no">df_queue_il_long_count</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_queue_il_long</span>
<span class="no">df_queue_il_wide_count</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_queue_il_wide</span>
<span class="no">df_alloc_i_long_count</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_alloc_i_long</span>
<span class="no">df_rho_gini_count</span>  <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_rho_gini</span>
<span class="no">df_alloc_il_long_count</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_alloc_il_long</span></pre></body></html></div>
<div id="analyze-measure-at-count-allocation" class="section level5">
<h5 class="hasAnchor">
<a href="#analyze-measure-at-count-allocation" class="anchor"></a>Analyze Measure at Count Allocation</h5>
<p>Analyze results using the total measure threshold from the measure allocation</p>
<div class="sourceCode" id="cb118"><html><body><pre class="r"><span class="co"># Cumulative Mass</span>
<span class="no">df_queue_il_long_mass_cntcumu</span> <span class="kw">&lt;-</span> <span class="no">df_queue_il_long_count</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">rho_val</span> <span class="kw">==</span> <span class="no">ar_rho</span>[<span class="fl">1</span>]) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">rho</span>, -<span class="no">rho_val</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">df_opt_caschool_prep_i</span> <span class="kw">%&gt;%</span>
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">mass_i</span> <span class="kw">=</span> <span class="no">enrltot</span>/<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">enrltot</span>)) <span class="kw">%&gt;%</span>
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id_i</span>, <span class="no">mass_i</span>), <span class="kw">by</span><span class="kw">=</span><span class="st">'id_i'</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">Q_il</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">mass_cumu_il</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span>(<span class="no">mass_i</span>))
<span class="co"># View Around the Teacher Available Cut-off mass</span>
<span class="no">df_queue_il_long_mass_cntcumu</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">Q_il</span> <span class="kw">&gt;=</span> <span class="no">fl_teacher_increase_sub_number</span> - <span class="fl">4</span>
          <span class="kw">&amp;</span> <span class="no">Q_il</span> <span class="kw">&lt;=</span> <span class="no">fl_teacher_increase_sub_number</span> + <span class="fl">4</span>)</pre></body></html></div>
<pre><code>## # A tibble: 9 x 9
##    id_i id_il D_max_i  D_il  Q_il D_Wbin_il V_star_Q_il  mass_i mass_cumu_il
##   &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;
## 1   339 47438     135    43 10836         1     294663. 0.00235         14.4
## 2   406 52898     132    37 10837         1     294663. 0.00212         14.4
## 3   282 40715      89    59 10838         1     294663. 0.00162         14.4
## 4    72 13654     141    50 10839         1     294663. 0.00271         14.4
## 5   412 53590      87    40 10840         1     294663. 0.00119         14.4
## 6    45  5664     221     7 10841         0         NA  0.00386         14.4
## 7   411 53444     139    33 10842         0         NA  0.00219         14.4
## 8   351 49277     127    49 10843         0         NA  0.00230         14.4
## 9   404 52726     112    42 10844         0         NA  0.00176         14.4</code></pre>
<div class="sourceCode" id="cb120"><html><body><pre class="r"><span class="co"># Summarize</span>
<span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_queue_il_long_mass_cntcumu</span>, <span class="kw">bl_statsasrows</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 9 x 19
##   var       n unique NAobs ZEROobs    mean      sd      cv     min     p01
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 D.il  54204   1429     0       0 2.02e+2 2.25e+2 1.11    1.00e+0 2.00e+0
## 2 D.ma~ 54204    203     0       0 4.02e+2 3.33e+2 0.829   5.00e+0 1.20e+1
## 3 D.Wb~ 54204      2     0   43364 2.00e-1 4.00e-1 2.00    0.      0.     
## 4 id.i  54204    420     0       0 1.83e+2 1.16e+2 0.635   1.00e+0 1.60e+1
## 5 id.il 54204  54204     0       0 2.71e+4 1.56e+4 0.577   1.00e+0 5.43e+2
## 6 mass~ 54204  54204     0       0 1.22e+2 1.14e+2 0.931   1.17e-4 1.07e-1
## 7 mass~ 54204    391     0       0 7.51e-3 6.21e-3 0.827   7.34e-5 2.02e-4
## 8 Q.il  54204  54204     0       0 2.71e+4 1.56e+4 0.577   1.00e+0 5.43e+2
## 9 V.st~ 54204  10841 43364      NA 2.94e+5 6.07e+2 0.00206 2.92e+5 2.92e+5
## # ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,
## #   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="optimal-allocation-with-mass" class="section level4">
<h4 class="hasAnchor">
<a href="#optimal-allocation-with-mass" class="anchor"></a>Optimal Allocation with Mass</h4>
<p>Same as before, but now include the mass column:</p>
<div class="sourceCode" id="cb123"><html><body><pre class="r"><span class="co"># Measure of Available Teachers</span>
<span class="no">fl_measure_teacher_increase_number</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">df_opt_caschool_input_mass_ib</span>$<span class="no">cumu_sum_group_i</span>)
<span class="co"># Allocate Based on the Measure of Available Teachers</span>
<span class="no">ls_df_queue</span> <span class="kw">&lt;-</span> <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_dis.html">ffp_opt_anlyz_rhgin_dis</a></span>(
  <span class="no">ar_rho</span>,
  <span class="no">fl_measure_teacher_increase_number</span>,
  <span class="kw">bl_df_alloc_il</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">df_input_il</span> <span class="kw">=</span> <span class="no">df_opt_caschool_input_mass_il</span>,
  <span class="kw">svr_rho</span> <span class="kw">=</span> <span class="st">'rho'</span>,
  <span class="kw">svr_id_i</span> <span class="kw">=</span> <span class="st">'id_i'</span>, <span class="kw">svr_id_il</span> <span class="kw">=</span> <span class="st">'id_il'</span>,
  <span class="kw">svr_D_max_i</span> <span class="kw">=</span> <span class="st">'D_max_i'</span>, <span class="kw">svr_D_il</span> <span class="kw">=</span> <span class="st">'D_il'</span>,
  <span class="kw">svr_D_star_i</span> <span class="kw">=</span> <span class="st">'D_star_i'</span>, <span class="kw">svr_F_star_i</span> <span class="kw">=</span> <span class="st">'F_star_i'</span>,
  <span class="kw">svr_inpalc</span> <span class="kw">=</span> <span class="st">'Q_il'</span>, <span class="kw">svr_D_Wbin_il</span> <span class="kw">=</span> <span class="st">'D_Wbin_il'</span>,
  <span class="kw">svr_A_il</span> <span class="kw">=</span> <span class="st">'A_il'</span>, <span class="kw">svr_alpha_il</span> <span class="kw">=</span> <span class="st">'alpha_il'</span>,
  <span class="kw">svr_beta_i</span> <span class="kw">=</span> <span class="st">'beta_i'</span>,
  <span class="kw">svr_measure_i</span> <span class="kw">=</span> <span class="st">'mass_i'</span>,
  <span class="kw">svr_expout</span> <span class="kw">=</span> <span class="st">'opti_exp_outcome'</span>,
  <span class="kw">st_idcol_prefix</span> <span class="kw">=</span> <span class="st">'sid_'</span>)</pre></body></html></div>
<pre><code>## Joining, by = "id_il"</code></pre>
<pre><code>## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`
## Adding missing grouping variables: `id_i`</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(rev)`</code></pre>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(alloc_i_upto_Q)`</code></pre>
<div class="sourceCode" id="cb128"><html><body><pre class="r"><span class="no">df_queue_il_long_mass</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_queue_il_long</span>
<span class="no">df_queue_il_wide_mass</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_queue_il_wide</span>
<span class="no">df_alloc_i_long_mass</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_alloc_i_long</span>
<span class="no">df_rho_gini_mass</span>  <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_rho_gini</span>
<span class="no">df_alloc_il_long_mass</span> <span class="kw">&lt;-</span> <span class="no">ls_df_queue</span>$<span class="no">df_alloc_il_long</span></pre></body></html></div>
<div id="analyze-measure-at-mass-allocation" class="section level5">
<h5 class="hasAnchor">
<a href="#analyze-measure-at-mass-allocation" class="anchor"></a>Analyze Measure at Mass Allocation</h5>
<p>Analyze the Allocation Results based on measure:</p>
<div class="sourceCode" id="cb129"><html><body><pre class="r"><span class="no">df_queue_il_long_mass</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">rho_val</span> <span class="kw">==</span> <span class="no">ar_rho</span>[<span class="fl">3</span>]) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">rho</span>, -<span class="no">rho_val</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="no">Q_il</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">mass_cumu_il</span> <span class="kw">&gt;=</span> <span class="no">fl_measure_teacher_increase_number</span> - <span class="fl">0.01</span>
          <span class="kw">&amp;</span> <span class="no">mass_cumu_il</span> <span class="kw">&lt;=</span> <span class="no">fl_measure_teacher_increase_number</span> + <span class="fl">0.01</span>)</pre></body></html></div>
<pre><code>## # A tibble: 3 x 8
##    id_i id_il D_max_i  D_il  Q_il D_Wbin_il mass_cumu_il V_star_Q_il
##   &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
## 1   264 38122     550    33 25779         1         81.5        654.
## 2   220 32688     408    79 25780         0         81.5         NA 
## 3   105 17069     228   154 25781         0         81.5         NA</code></pre>
<div class="sourceCode" id="cb131"><html><body><pre class="r"><span class="co"># Summarize</span>
<span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_queue_il_long_mass_cumu</span>, <span class="kw">bl_statsasrows</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 9 x 19
##   var       n unique NAobs ZEROobs    mean      sd      cv     min     p01
##   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1 D.il  54204   1429     0       0 2.02e+2 2.25e+2 1.11    1.00e+0 2.00e+0
## 2 D.ma~ 54204    203     0       0 4.02e+2 3.33e+2 0.829   5.00e+0 1.20e+1
## 3 D.Wb~ 54204      2     0   43364 2.00e-1 4.00e-1 2.00    0.      0.     
## 4 id.i  54204    420     0       0 1.83e+2 1.16e+2 0.635   1.00e+0 1.60e+1
## 5 id.il 54204  54204     0       0 2.71e+4 1.56e+4 0.577   1.00e+0 5.43e+2
## 6 mass  54204    391     0       0 7.51e-3 6.21e-3 0.827   7.34e-5 2.02e-4
## 7 mass~ 54204  54204     0       0 1.22e+2 1.14e+2 0.931   1.17e-4 1.07e-1
## 8 Q.il  54204  54204     0       0 2.71e+4 1.56e+4 0.577   1.00e+0 5.43e+2
## 9 V.st~ 54204  10841 43364      NA 2.94e+5 6.07e+2 0.00206 2.92e+5 2.92e+5
## # ... with 9 more variables: p05 &lt;dbl&gt;, p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;,
## #   p75 &lt;dbl&gt;, p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="compare-measure-and-count-allocation-results" class="section level4">
<h4 class="hasAnchor">
<a href="#compare-measure-and-count-allocation-results" class="anchor"></a>Compare Measure and Count Allocation Results</h4>
<p>Under the Utilitarian <em>filter(rho_val == ar_rho[1])</em>:</p>
<p>Based on count, there were 30 teacher spots to allocate, and we move up to queue position 30 for allocation. Based on relative measure/weight, because the schools with more teacher spots assigned under alternative allocation also had higher weight, so we end up with a measure such that the 10 + 20 teachers assigned to each type of school, when looked at on the queue, sorted by queue position, and cumulatively summed with the weight of school school type, ends up giving us enough to go to the 38th queue position. So ignoring the weight of the schools, we would have allocated incorrectly, because we thought there were only 30 slots to be allocated, but given weights, there are actually up to the 38th spot on the queue.</p>
<p>Under <em>filter(rho_val == ar_rho[2], [3], [4])</em>:</p>
<p>Under alternative planners, importantly, the queue is different, hence cumulative weight up the queue is different, so the number of “spots” that could be allocated is different. There are 37, 31, 24 spots that are allocated under increasing Rawlsian preferences. This reflects the fact that under more Rawlsian preferences, the districts more more students are ranked higher on the queue, and they take up more mass. At the extreme, given N=2, all the mass from the smaller mass type go to the larger mass type, so the queue goes up to how many spots the larger school districts were assigned uniformly, and additional spot for the larger school if the school smallers’ additional teachers are equally assigned to larger schools given relative mass of smaller and larger schools.</p>
</div>
</div>
<div id="rev-compute-1" class="section level3">
<h3 class="hasAnchor">
<a href="#rev-compute-1" class="anchor"></a>REV Compute</h3>
<div id="rev-compute-with-count" class="section level4">
<h4 class="hasAnchor">
<a href="#rev-compute-with-count" class="anchor"></a>REV Compute with Count</h4>
<div class="sourceCode" id="cb134"><html><body><pre class="r"><span class="no">tb_rho_rev_count</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span>(<span class="no">ar_rho</span>,
                          <span class="no">fl_teacher_increase_sub_number</span>,
                          <span class="kw">df_input_ib</span> <span class="kw">=</span> <span class="no">df_opt_caschool_input_mass_ib</span>,
                          <span class="kw">df_queue_il_long_with_V</span> <span class="kw">=</span> <span class="no">df_queue_il_long_count</span>,
                          <span class="kw">svr_beta_i</span> <span class="kw">=</span> <span class="st">'beta_i'</span>)</pre></body></html></div>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(rev)`</code></pre>
<div class="sourceCode" id="cb136"><html><body><pre class="r"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">tb_rho_rev_count</span>)</pre></body></html></div>
<pre><code>## # A tibble: 4 x 3
##     rho rho_val   REV
##   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1     1   0.99  0.836
## 2     2   0.785 0.836
## 3     3  -3.64  0.831
## 4     4 -99     0.949</code></pre>
</div>
<div id="rev-compute-with-mass" class="section level4">
<h4 class="hasAnchor">
<a href="#rev-compute-with-mass" class="anchor"></a>REV Compute with Mass</h4>
<div class="sourceCode" id="cb138"><html><body><pre class="r"><span class="no">tb_rho_rev_mass</span> <span class="kw">&lt;-</span>
  <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_anlyz_sodis_rev.html">ffp_opt_anlyz_sodis_rev</a></span>(<span class="no">ar_rho</span>,
                          <span class="no">fl_measure_teacher_increase_number</span>,
                          <span class="kw">df_input_ib</span> <span class="kw">=</span> <span class="no">df_opt_caschool_input_mass_ib</span>,
                          <span class="kw">df_queue_il_long_with_V</span> <span class="kw">=</span> <span class="no">df_queue_il_long_mass</span>,
                          <span class="kw">svr_beta_i</span> <span class="kw">=</span> <span class="st">'beta_i'</span>, <span class="kw">svr_measure_i</span> <span class="kw">=</span> <span class="st">'mass_i'</span>)</pre></body></html></div>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(rev)`</code></pre>
<div class="sourceCode" id="cb140"><html><body><pre class="r"><span class="co"># Display Results</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">tb_rho_rev_mass</span>)</pre></body></html></div>
<pre><code>## # A tibble: 4 x 3
##     rho rho_val   REV
##   &lt;int&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1     1   0.99  0.607
## 2     2   0.785 0.606
## 3     3  -3.64  0.583
## 4     4 -99     0.911</code></pre>
</div>
<div id="rev-results-analysis" class="section level4">
<h4 class="hasAnchor">
<a href="#rev-results-analysis" class="anchor"></a>REV results Analysis</h4>
<p>Since we are comparing against uniform allocation, the REV difference is the smallest when we consider close to cobb-douglas preferences. The Utilitarian as well as the Rawlsian planner are both interested in allocating in an unequal way. The Utilitarian wants to allocate more to for higher alpha, the Rawlsian wants to allocate more to lower A. The Cobb Douglas planner seeks a balance between the two alternatives.</p>
<p>Depending on the Alternative allocation, the REV results might be decreasing, increasing, or have different patterns.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://fanwangecon.github.io">Fan Wang</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
