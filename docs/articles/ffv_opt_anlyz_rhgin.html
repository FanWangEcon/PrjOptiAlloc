<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Allocation Test Bounded-Continuous Function with Height Nutrition Data â€¢ Optimal Allocation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Allocation Test Bounded-Continuous Function with Height Nutrition Data">
<meta property="og:description" content="Given allocation space parameters (A, alpha), test the lower-bounded continuous optimal allocation function.
Compare inequality measures given optimal allocations across planner preferences.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Optimal Allocation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/PrjOptiAlloc.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue.pdf">Paper</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue_Present.pdf">Slides</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Sites
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://fanwangecon.github.io/REconTools/">R Tools for Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/R4Econ/">R Examples Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stat4Econ/">R Examples Introductory Statistics</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stata4Econ/">Stata Examples Regressions and Tables</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/M4Econ/">Matlab Examples Matrix and Graphs</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Math4Econ/">Matlab Introductory Math for Econ</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Tex4Econ/">Latex and Paper Generation Examples</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/pyfan/">Python Examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://fanwangecon.github.io/">Fan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fanwangecon/PrjOptiAlloc">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fanwangecon">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ffv_opt_anlyz_rhgin_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Allocation Test Bounded-Continuous Function with Height Nutrition Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/master/vignettes/ffv_opt_anlyz_rhgin.Rmd"><code>vignettes/ffv_opt_anlyz_rhgin.Rmd</code></a></small>
      <div class="hidden name"><code>ffv_opt_anlyz_rhgin.Rmd</code></div>

    </div>

    
    
<p>Given allocation space parameters (A, alpha), test lower-bounded continuous optimal allocation solution.Compare inequality measures given optimal allocations across planner preferences. This function tests out the procedure to solve for optimal allocations over various rhos, and computes gini each time.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>(<span class="kw">all.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">knitr.duplicate.label</span> <span class="kw">=</span> <span class="st">'allow'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">REconTools</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">PrjOptiAlloc</span>)

<span class="no">bl_save_rda</span> <span class="kw">=</span> <span class="fl">FALSE</span></pre></body></html></div>
<div id="get-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-data" class="anchor"></a>Get Data</h2>
<p>Load data that is generated by regression <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/ffy_opt_dtgch_cbem4.html">ffy_opt_dtgch_cbem4</a> (<a href="https://fanwangecon.github.io/PrjOptiAlloc/articles/ffv_opt_dtgch_cbem4.html">vignette</a>).</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Load Library</span>
<span class="no">ls_opti_alpha_A</span> <span class="kw">&lt;-</span> <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffy_opt_dtgch_cbem4.html">ffy_opt_dtgch_cbem4</a></span>()</pre></body></html></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">df_raw</span> <span class="kw">&lt;-</span> <span class="no">ls_opti_alpha_A</span>$<span class="no">df_raw</span>
<span class="no">df_hw_cebu_m24</span> <span class="kw">&lt;-</span> <span class="no">df_raw</span>
<span class="no">df_esti</span> <span class="kw">&lt;-</span> <span class="no">ls_opti_alpha_A</span>$<span class="no">df_esti</span>

<span class="co"># Review dataframes</span>
<span class="co"># raw file</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_raw</span>, <span class="fl">10</span>)</pre></body></html></div>
<pre><code>## # A tibble: 10 x 17
##    S.country vil.id indi.id sex   svymthRound momEdu wealthIdx   hgt    wgt
##    &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1 Cebu           1       2 Fema~          24    7.1       7.3  79.2 10776.
##  2 Cebu           1       3 Fema~          24    9.4      10.3  76.7 10296.
##  3 Cebu           1       4 Fema~          24   13.9      13.3  78.1  7604.
##  4 Cebu           1       5 Male           24   11.3       9.3  84.1 11787.
##  5 Cebu           1       6 Fema~          24    7.3       7.3  76.9  7991.
##  6 Cebu           1       7 Male           24   10.4       8.3  79.6 12583.
##  7 Cebu           1       8 Fema~          24   13.5       9.3  81.5  8358.
##  8 Cebu           1       9 Fema~          24   10.4      17.3  74.7  8195.
##  9 Cebu           1      10 Male           24   10.5       6.3  77.1  9442.
## 10 Cebu           1      11 Male           24    1.9       6.3  72.1  6627.
## # ... with 8 more variables: hgt0 &lt;dbl&gt;, wgt0 &lt;dbl&gt;, prot &lt;dbl&gt;, cal &lt;dbl&gt;,
## #   p.A.prot &lt;dbl&gt;, p.A.nProt &lt;dbl&gt;, momEduRound &lt;fct&gt;, hgt0med &lt;fct&gt;</code></pre>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_esti</span>, <span class="fl">10</span>)</pre></body></html></div>
<pre><code>## # A tibble: 10 x 9
##    S.country vil.id indi.id svymthRound alpha_lin alpha_log A_lin A_log     beta
##    &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1 Cebu           1       2          24    0.0101   0.00669  78.4  4.34 0.000959
##  2 Cebu           1       3          24    0.0323   0.00925  79.9  4.36 0.000959
##  3 Cebu           1       4          24    0.0323   0.00925  78.9  4.35 0.000959
##  4 Cebu           1       5          24    0.0662   0.0139   80.6  4.37 0.000959
##  5 Cebu           1       6          24    0.0101   0.00669  77.8  4.34 0.000959
##  6 Cebu           1       7          24    0.0662   0.0139   79.6  4.36 0.000959
##  7 Cebu           1       8          24    0.0101   0.00669  77.8  4.34 0.000959
##  8 Cebu           1       9          24    0.0101   0.00669  78.0  4.34 0.000959
##  9 Cebu           1      10          24    0.0662   0.0139   80.0  4.36 0.000959
## 10 Cebu           1      11          24    0.0602   0.0121   77.7  4.33 0.000959</code></pre>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">ar_prot_data</span> <span class="kw">=</span> <span class="no">df_hw_cebu_m24</span>$<span class="no">prot</span>
<span class="no">fl_N_agg</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">ar_prot_data</span>)

<span class="co"># Attach</span>
<span class="fu"><a href="https://rdrr.io/r/base/attach.html">attach</a></span>(<span class="no">df_raw</span>)</pre></body></html></div>
<pre><code>## The following objects are masked from df_hw:
## 
##     cal, hgt, hgt0, hgt0med, indi.id, momEdu, momEduRound, p.A.nProt,
##     p.A.prot, prot, S.country, sex, svymthRound, vil.id, wealthIdx,
##     wgt, wgt0</code></pre>
</div>
<div id="solve" class="section level2">
<h2 class="hasAnchor">
<a href="#solve" class="anchor"></a>Solve</h2>
<p>I would like to be able to directly call the dataset generated here in various functions. Save the datafile we just created in the project folder.</p>
<div id="prep-inputs" class="section level3">
<h3 class="hasAnchor">
<a href="#prep-inputs" class="anchor"></a>Prep Inputs</h3>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="no">df_opt_dtgch_cbem4</span>
<span class="no">svr_id_i</span> <span class="kw">&lt;-</span> <span class="st">'indi.id'</span>
<span class="no">svr_A_i</span> <span class="kw">&lt;-</span> <span class="st">'A_lin'</span>
<span class="no">svr_alpha_i</span> <span class="kw">&lt;-</span> <span class="st">'alpha_lin'</span>
<span class="no">svr_beta_i</span> <span class="kw">&lt;-</span> <span class="st">'beta'</span>
<span class="no">fl_N_agg</span> <span class="kw">&lt;-</span> <span class="fl">10000</span>
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">50</span>, -<span class="fl">10</span>, -<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>)
<span class="no">svr_inpalc</span> <span class="kw">&lt;-</span> <span class="st">'optiallocate'</span>
<span class="no">svr_expout</span> <span class="kw">&lt;-</span> <span class="st">'optiexpoutcm'</span></pre></body></html></div>
</div>
<div id="solve-relative-allocation-problem-looping-over-planner-elasticities" class="section level3">
<h3 class="hasAnchor">
<a href="#solve-relative-allocation-problem-looping-over-planner-elasticities" class="anchor"></a>Solve Relative Allocation Problem Looping over Planner Elasticities</h3>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">df_opti_alloc_all_rho</span> <span class="kw">&lt;-</span> <span class="no">df</span>
<span class="no">it_indi_count</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">df</span>)[<span class="fl">1</span>]

<span class="co"># A. First Loop over Planner Preference ----</span>
<span class="co"># Generate Rank Order</span>
<span class="kw">for</span> (<span class="no">it_rho_ctr</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">ar_rho</span>))) {
  <span class="no">fl_rho</span> <span class="kw">=</span> <span class="no">ar_rho</span>[<span class="no">it_rho_ctr</span>]

  <span class="co"># B. Invoke optimal linear (crs) solution problem ----</span>
  <span class="co"># ar_opti is the array of optimal choices, it is in df_opti as well.</span>
  <span class="co"># use df_opti for merging, because that contains the individual keys.</span>
  <span class="co"># actually file here should contain unique keys, unique key ID as required input. should return?</span>
  <span class="co"># actually it is fine, the function here needs the key, not solin_flinr</span>
  <span class="no">ls_lin_solu</span> <span class="kw">&lt;-</span> <span class="kw pkg">PrjOptiAlloc</span><span class="kw ns">::</span><span class="fu"><a href="../reference/ffp_opt_solin_relow.html">ffp_opt_solin_relow</a></span>(
    <span class="no">df</span>, <span class="no">svr_A_i</span>, <span class="no">svr_alpha_i</span>, <span class="no">svr_beta_i</span>, <span class="no">fl_N_agg</span>, <span class="no">fl_rho</span>,
    <span class="no">svr_inpalc</span>, <span class="no">svr_expout</span>)

  <span class="co"># C. Keep for df collection individual key + optimal allocation ----</span>
  <span class="co"># _on stands for optimal nutritional choices</span>
  <span class="co"># _eh stands for expected height</span>
  <span class="no">tb_opti_allocate_wth_key</span> <span class="kw">&lt;-</span> <span class="no">ls_lin_solu</span>$<span class="no">df_opti</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">one_of</a></span>(<span class="no">svr_id_i</span>, <span class="no">svr_inpalc</span>, <span class="no">svr_expout</span>)) <span class="kw">%&gt;%</span>
                                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(!!<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'rho_c'</span>, <span class="no">it_rho_ctr</span>, <span class="st">'_'</span>, <span class="no">svr_inpalc</span>) <span class="kw">:=</span> !!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span>(<span class="no">svr_inpalc</span>),
                                        !!<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'rho_c'</span>, <span class="no">it_rho_ctr</span>, <span class="st">'_'</span>, <span class="no">svr_expout</span>) <span class="kw">:=</span> !!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span>(<span class="no">svr_expout</span>))

  <span class="co"># D. merge optimal allocaiton results from different planner preference ----</span>
  <span class="no">df_opti_alloc_all_rho</span> <span class="kw">&lt;-</span> <span class="no">df_opti_alloc_all_rho</span> <span class="kw">%&gt;%</span>
                            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">tb_opti_allocate_wth_key</span>, <span class="kw">by</span><span class="kw">=</span><span class="no">svr_id_i</span>)

}

<span class="co"># Print</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_opti_alloc_all_rho</span>, <span class="fl">10</span>)</pre></body></html></div>
<pre><code>## # A tibble: 10 x 21
##    S.country vil.id indi.id svymthRound alpha_lin alpha_log A_lin A_log    beta
##    &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1 Cebu           1       2          24    0.0101   0.00669  78.4  4.34 9.59e-4
##  2 Cebu           1       3          24    0.0323   0.00925  79.9  4.36 9.59e-4
##  3 Cebu           1       4          24    0.0323   0.00925  78.9  4.35 9.59e-4
##  4 Cebu           1       5          24    0.0662   0.0139   80.6  4.37 9.59e-4
##  5 Cebu           1       6          24    0.0101   0.00669  77.8  4.34 9.59e-4
##  6 Cebu           1       7          24    0.0662   0.0139   79.6  4.36 9.59e-4
##  7 Cebu           1       8          24    0.0101   0.00669  77.8  4.34 9.59e-4
##  8 Cebu           1       9          24    0.0101   0.00669  78.0  4.34 9.59e-4
##  9 Cebu           1      10          24    0.0662   0.0139   80.0  4.36 9.59e-4
## 10 Cebu           1      11          24    0.0602   0.0121   77.7  4.33 9.59e-4
## # ... with 12 more variables: rho_c1_optiallocate &lt;dbl&gt;,
## #   rho_c1_optiexpoutcm &lt;dbl&gt;, rho_c2_optiallocate &lt;dbl&gt;,
## #   rho_c2_optiexpoutcm &lt;dbl&gt;, rho_c3_optiallocate &lt;dbl&gt;,
## #   rho_c3_optiexpoutcm &lt;dbl&gt;, rho_c4_optiallocate &lt;dbl&gt;,
## #   rho_c4_optiexpoutcm &lt;dbl&gt;, rho_c5_optiallocate &lt;dbl&gt;,
## #   rho_c5_optiexpoutcm &lt;dbl&gt;, rho_c6_optiallocate &lt;dbl&gt;,
## #   rho_c6_optiexpoutcm &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">df_opti_alloc_all_rho</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">'rho'</span>)), <span class="fl">20</span>)</pre></body></html></div>
<pre><code>## # A tibble: 20 x 12
##    rho_c1_optiallo~ rho_c1_optiexpo~ rho_c2_optiallo~ rho_c2_optiexpo~
##               &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1             0                78.4             0                78.4
##  2             0                79.9             0                79.9
##  3             0                78.9             0                78.9
##  4             0                80.6             0                80.6
##  5             0                77.8             0                77.8
##  6             0                79.6             7.17             80.0
##  7             0                77.8             0                77.8
##  8             0                78.0             0                78.0
##  9             0                80.0             1.17             80.0
## 10            25.8              79.3            27.0              79.4
## 11            26.6              79.3            27.7              79.4
## 12             0                78.9             0                78.9
## 13             8.82             79.3            10.0              79.4
## 14             0                81.1             0                81.1
## 15             0                78.8             0                78.8
## 16             0                77.1             0                77.1
## 17             0                78.3             0                78.3
## 18             0                79.1             0                79.1
## 19             0                78.7             0                78.7
## 20             0                79.1             0                79.1
## # ... with 8 more variables: rho_c3_optiallocate &lt;dbl&gt;,
## #   rho_c3_optiexpoutcm &lt;dbl&gt;, rho_c4_optiallocate &lt;dbl&gt;,
## #   rho_c4_optiexpoutcm &lt;dbl&gt;, rho_c5_optiallocate &lt;dbl&gt;,
## #   rho_c5_optiexpoutcm &lt;dbl&gt;, rho_c6_optiallocate &lt;dbl&gt;,
## #   rho_c6_optiexpoutcm &lt;dbl&gt;</code></pre>
</div>
<div id="extract-optimal-allocations-and-expected-outcomes" class="section level3">
<h3 class="hasAnchor">
<a href="#extract-optimal-allocations-and-expected-outcomes" class="anchor"></a>Extract Optimal Allocations and Expected Outcomes</h3>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="co"># E. Extract from All results Optimal Allocation and Expected Outcomes ----</span>
<span class="no">mt_opti_alloc_all_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span>(<span class="no">df_opti_alloc_all_rho</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">ends_with</a></span>(<span class="no">svr_inpalc</span>)))
<span class="no">mt_expc_outcm_all_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span>(<span class="no">df_opti_alloc_all_rho</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">ends_with</a></span>(<span class="no">svr_expout</span>)))

<span class="co"># Print</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mt_opti_alloc_all_rho</span>)</pre></body></html></div>
<pre><code>##  rho_c1_optiallocate rho_c2_optiallocate rho_c3_optiallocate
##  Min.   :  0.000     Min.   : 0.000      Min.   : 0.000     
##  1st Qu.:  0.000     1st Qu.: 0.000      1st Qu.: 0.000     
##  Median :  0.000     Median : 0.000      Median : 0.000     
##  Mean   :  9.588     Mean   : 9.588      Mean   : 9.588     
##  3rd Qu.: 15.122     3rd Qu.:17.191      3rd Qu.: 0.000     
##  Max.   :216.490     Max.   :94.000      Max.   :63.897     
##  rho_c4_optiallocate rho_c5_optiallocate rho_c6_optiallocate
##  Min.   : 0.000      Min.   : 0.000      Min.   : 0.000     
##  1st Qu.: 0.000      1st Qu.: 0.000      1st Qu.: 0.000     
##  Median : 0.000      Median : 0.000      Median : 0.000     
##  Mean   : 9.588      Mean   : 9.588      Mean   : 9.588     
##  3rd Qu.: 0.000      3rd Qu.: 0.000      3rd Qu.: 0.000     
##  Max.   :64.217      Max.   :64.252      Max.   :64.252</code></pre>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">mt_expc_outcm_all_rho</span>)</pre></body></html></div>
<pre><code>##  rho_c1_optiexpoutcm rho_c2_optiexpoutcm rho_c3_optiexpoutcm
##  Min.   :76.56       Min.   :74.37       Min.   :74.37      
##  1st Qu.:78.35       1st Qu.:78.35       1st Qu.:77.73      
##  Median :79.28       Median :79.35       Median :78.46      
##  Mean   :78.96       Mean   :79.05       Mean   :79.10      
##  3rd Qu.:79.43       3rd Qu.:79.87       3rd Qu.:79.87      
##  Max.   :84.61       Max.   :84.61       Max.   :84.61      
##  rho_c4_optiexpoutcm rho_c5_optiexpoutcm rho_c6_optiexpoutcm
##  Min.   :74.19       Min.   :73.70       Min.   :73.70      
##  1st Qu.:77.73       1st Qu.:77.73       1st Qu.:77.73      
##  Median :78.46       Median :78.46       Median :78.46      
##  Mean   :79.10       Mean   :79.10       Mean   :79.10      
##  3rd Qu.:79.87       3rd Qu.:79.87       3rd Qu.:79.87      
##  Max.   :84.61       Max.   :84.61       Max.   :84.61</code></pre>
</div>
<div id="calculate-gini-for-each-vector" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-gini-for-each-vector" class="anchor"></a>Calculate GINI for each vector</h3>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co"># F. Compute gini for each rho ----</span>
<span class="co"># ff_dist_gini_vector_pos() is from REconTools</span>
<span class="no">ar_opti_alloc_gini</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">mt_opti_alloc_all_rho</span>), <span class="fl">1</span>,
                                             <span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="no"><a href="https://fanwangecon.github.io/REconTools/reference/ff_dist_gini_vector_pos.html">ff_dist_gini_vector_pos</a></span>))
<span class="no">ar_expc_outcm_gini</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">mt_expc_outcm_all_rho</span>), <span class="fl">1</span>,
                                             <span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="no"><a href="https://fanwangecon.github.io/REconTools/reference/ff_dist_gini_vector_pos.html">ff_dist_gini_vector_pos</a></span>))

<span class="co"># Print</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">ar_opti_alloc_gini</span>)</pre></body></html></div>
<pre><code>## rho_c1_optiallocate rho_c2_optiallocate rho_c3_optiallocate rho_c4_optiallocate 
##           0.7496377           0.6902218           0.8089562           0.8105391 
## rho_c5_optiallocate rho_c6_optiallocate 
##           0.8107186           0.8107186</code></pre>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">ar_expc_outcm_gini</span>)</pre></body></html></div>
<pre><code>## rho_c1_optiexpoutcm rho_c2_optiexpoutcm rho_c3_optiexpoutcm rho_c4_optiexpoutcm 
##         0.006735065         0.007619387         0.013797035         0.013896702 
## rho_c5_optiexpoutcm rho_c6_optiexpoutcm 
##         0.013907624         0.013907624</code></pre>
</div>
<div id="gini-results-reshaping-for-easier-outputs" class="section level3">
<h3 class="hasAnchor">
<a href="#gini-results-reshaping-for-easier-outputs" class="anchor"></a>Gini Results Reshaping for Easier outputs</h3>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="co"># G. Wide to Long to Wide Gini ----</span>
<span class="co"># column names look like: rho_c1_on rho_c2_on rho_c3_on rho_c1_eh rho_c2_eh rho_c3_eh</span>
<span class="no">tb_gini_onerow_wide</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">ar_opti_alloc_gini</span>)), <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="no">ar_expc_outcm_gini</span>)))
<span class="no">tb_gini_long</span> <span class="kw">&lt;-</span> <span class="no">tb_gini_onerow_wide</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span>(
    <span class="kw">cols</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"rho"</span>),
    <span class="kw">names_to</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"it_rho_ctr"</span>, <span class="st">"oneh"</span>),
    <span class="kw">names_pattern</span> <span class="kw">=</span> <span class="st">"rho_c(.*)_(.*)"</span>,
    <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">"gini"</span>
  )
<span class="no">tb_gini_wide2</span> <span class="kw">&lt;-</span> <span class="no">tb_gini_long</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span>(
    <span class="kw">id_cols</span> <span class="kw">=</span> <span class="no">it_rho_ctr</span>,
    <span class="kw">names_from</span> <span class="kw">=</span> <span class="no">oneh</span>,
    <span class="kw">values_from</span> <span class="kw">=</span> <span class="no">gini</span>
  )
<span class="no">planner_elas</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span>(<span class="fl">1</span>/(<span class="fl">1</span>-<span class="no">ar_rho</span>)+<span class="fl">2</span>)
<span class="no">mt_gini</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.matrix.html">data.matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">tb_gini_wide2</span>, <span class="no">planner_elas</span>))

<span class="co"># Print</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">tb_gini_onerow_wide</span>)</pre></body></html></div>
<pre><code>##   rho_c1_optiallocate rho_c2_optiallocate rho_c3_optiallocate
## 1           0.7496377           0.6902218           0.8089562
##   rho_c4_optiallocate rho_c5_optiallocate rho_c6_optiallocate
## 1           0.8105391           0.8107186           0.8107186
##   rho_c1_optiexpoutcm rho_c2_optiexpoutcm rho_c3_optiexpoutcm
## 1         0.006735065         0.007619387          0.01379703
##   rho_c4_optiexpoutcm rho_c5_optiexpoutcm rho_c6_optiexpoutcm
## 1           0.0138967          0.01390762          0.01390762</code></pre>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">tb_gini_long</span>)</pre></body></html></div>
<pre><code>## # A tibble: 12 x 3
##    it_rho_ctr oneh            gini
##    &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 1          optiallocate 0.750  
##  2 2          optiallocate 0.690  
##  3 3          optiallocate 0.809  
##  4 4          optiallocate 0.811  
##  5 5          optiallocate 0.811  
##  6 6          optiallocate 0.811  
##  7 1          optiexpoutcm 0.00674
##  8 2          optiexpoutcm 0.00762
##  9 3          optiexpoutcm 0.0138 
## 10 4          optiexpoutcm 0.0139 
## 11 5          optiexpoutcm 0.0139 
## 12 6          optiexpoutcm 0.0139</code></pre>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">tb_gini_wide2</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 3
##   it_rho_ctr optiallocate optiexpoutcm
##   &lt;chr&gt;             &lt;dbl&gt;        &lt;dbl&gt;
## 1 1                 0.750      0.00674
## 2 2                 0.690      0.00762
## 3 3                 0.809      0.0138 
## 4 4                 0.811      0.0139 
## 5 5                 0.811      0.0139 
## 6 6                 0.811      0.0139</code></pre>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">mt_gini</span>)</pre></body></html></div>
<pre><code>##      it_rho_ctr optiallocate optiexpoutcm planner_elas
## [1,]          1    0.7496377  0.006735065    0.7029034
## [2,]          2    0.6902218  0.007619387    0.7375989
## [3,]          3    0.8089562  0.013797035    1.0678406
## [4,]          4    0.8105391  0.013896702    1.1349799
## [5,]          5    0.8107186  0.013907624    1.3862944
## [6,]          6    0.8107186  0.013907624    1.6739764</code></pre>
</div>
</div>
<div id="save-outputs" class="section level2">
<h2 class="hasAnchor">
<a href="#save-outputs" class="anchor"></a>Save Outputs</h2>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="co"># df_opt_dtgch_ropti: dataframe, opt project, data guat cebu height, cebu edu mother, results relative linear optimal</span>
<span class="no">df_opt_dtgch_cbem4_rrlop_allrh</span> <span class="kw">&lt;-</span> <span class="no">df_opti_alloc_all_rho</span>
<span class="no">df_opt_dtgch_cbem4_rrlop_argin</span> <span class="kw">&lt;-</span> <span class="no">mt_gini</span>
<span class="kw">if</span> (<span class="no">bl_save_rda</span>) {
  <span class="kw pkg">usethis</span><span class="kw ns">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span>(<span class="no">df_opt_dtgch_cbem4_rrlop_allrh</span>, <span class="no">df_opt_dtgch_cbem4_rrlop_allrh</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
  <span class="kw pkg">usethis</span><span class="kw ns">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span>(<span class="no">df_opt_dtgch_cbem4_rrlop_argin</span>, <span class="no">df_opt_dtgch_cbem4_rrlop_argin</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
}</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://fanwangecon.github.io">Fan Wang</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
