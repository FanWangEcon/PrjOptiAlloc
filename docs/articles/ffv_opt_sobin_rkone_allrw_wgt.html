<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Function Test Binary Allocation with Linear Regression • Optimal Allocation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Function Test Binary Allocation with Linear Regression">
<meta property="og:description" content="Test binary optimal allocation solution function from package. 
Use the the birthwt testing dataset. Regression birth weight on smoking status.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Optimal Allocation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/PrjOptiAlloc.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue.pdf">Paper</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue_Present.pdf">Slides</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Sites
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://fanwangecon.github.io/REconTools/">R Tools for Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/R4Econ/">R Examples Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stat4Econ/">R Examples Introductory Statistics</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stata4Econ/">Stata Examples Regressions and Tables</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/M4Econ/">Matlab Examples Matrix and Graphs</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Math4Econ/">Matlab Introductory Math for Econ</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Tex4Econ/">Latex and Paper Generation Examples</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/pyfan/">Python Examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://fanwangecon.github.io/">Fan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fanwangecon/PrjOptiAlloc">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fanwangecon">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ffv_opt_sobin_rkone_allrw_wgt_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Function Test Binary Allocation with Linear Regression</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/master/vignettes/ffv_opt_sobin_rkone_allrw_wgt.Rmd"><code>vignettes/ffv_opt_sobin_rkone_allrw_wgt.Rmd</code></a></small>
      <div class="hidden name"><code>ffv_opt_sobin_rkone_allrw_wgt.Rmd</code></div>

    </div>

    
    
<p>The effects of mother’s smoking status on birth weight. If we aim to improve health outcomes, what is the priority sequence of mothers whom we would want to discourage from smoking.</p>
<div id="load-packages-and-data" class="section level2">
<h2 class="hasAnchor">
<a href="#load-packages-and-data" class="anchor"></a>Load Packages and Data</h2>
<div id="load-dependencies" class="section level3">
<h3 class="hasAnchor">
<a href="#load-dependencies" class="anchor"></a>Load Dependencies</h3>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>(<span class="kw">all.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">knitr.duplicate.label</span> <span class="kw">=</span> <span class="st">'allow'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">broom</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">forcats</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">REconTools</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">PrjOptiAlloc</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">kableExtra</span>)</pre></body></html></div>
</div>
<div id="load-data" class="section level3">
<h3 class="hasAnchor">
<a href="#load-data" class="anchor"></a>Load Data</h3>
<p>Generate four categories by initial height and mother’s education levels combinations.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Load Data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">df_opt_birthwt</span>)

<span class="co"># Summarize</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">df_opt_birthwt</span>)</pre></body></html></div>
<pre><code>## 'data.frame':    189 obs. of  11 variables:
##  $ Index: int  85 86 87 88 89 91 92 93 94 95 ...
##  $ low  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ age  : int  19 33 20 21 18 21 22 17 29 26 ...
##  $ lwt  : int  182 155 105 108 107 124 118 103 123 113 ...
##  $ race : int  2 3 1 1 1 3 1 3 1 1 ...
##  $ smoke: int  0 0 1 1 1 0 0 0 1 1 ...
##  $ ptl  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ ht   : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ ui   : int  1 0 0 1 1 0 0 0 0 0 ...
##  $ ftv  : int  0 3 1 2 0 0 1 1 1 0 ...
##  $ bwt  : int  2523 2551 2557 2594 2600 2622 2637 2637 2663 2665 ...</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">df_opt_birthwt</span>)</pre></body></html></div>
<pre><code>##      Index            low              age             lwt       
##  Min.   :  4.0   Min.   :0.0000   Min.   :14.00   Min.   : 80.0  
##  1st Qu.: 68.0   1st Qu.:0.0000   1st Qu.:19.00   1st Qu.:110.0  
##  Median :123.0   Median :0.0000   Median :23.00   Median :121.0  
##  Mean   :121.1   Mean   :0.3122   Mean   :23.24   Mean   :129.8  
##  3rd Qu.:176.0   3rd Qu.:1.0000   3rd Qu.:26.00   3rd Qu.:140.0  
##  Max.   :226.0   Max.   :1.0000   Max.   :45.00   Max.   :250.0  
##       race           smoke             ptl               ht         
##  Min.   :1.000   Min.   :0.0000   Min.   :0.0000   Min.   :0.00000  
##  1st Qu.:1.000   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.00000  
##  Median :1.000   Median :0.0000   Median :0.0000   Median :0.00000  
##  Mean   :1.847   Mean   :0.3915   Mean   :0.1958   Mean   :0.06349  
##  3rd Qu.:3.000   3rd Qu.:1.0000   3rd Qu.:0.0000   3rd Qu.:0.00000  
##  Max.   :3.000   Max.   :1.0000   Max.   :3.0000   Max.   :1.00000  
##        ui              ftv              bwt      
##  Min.   :0.0000   Min.   :0.0000   Min.   : 709  
##  1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:2414  
##  Median :0.0000   Median :0.0000   Median :2977  
##  Mean   :0.1481   Mean   :0.7937   Mean   :2945  
##  3rd Qu.:0.0000   3rd Qu.:1.0000   3rd Qu.:3487  
##  Max.   :1.0000   Max.   :6.0000   Max.   :4990</code></pre>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Generate Discrete Version of continuous variables</span>
<span class="no">df_opt_birthwt</span> <span class="kw">&lt;-</span> <span class="no">df_opt_birthwt</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">momwgtLowHigh</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="no">lwt</span>,
                               <span class="kw">breaks</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">Inf</span>, <span class="fl">129</span>, <span class="fl">Inf</span>),
                               <span class="kw">labels</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"LW"</span>,<span class="st">"HW"</span>))) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">mombirthage</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="no">age</span>,
                               <span class="kw">breaks</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">Inf</span>, <span class="fl">24</span>, <span class="fl">Inf</span>),
                               <span class="kw">labels</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"young"</span>,<span class="st">"older"</span>))) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">ftvm3</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="no">ftv</span>,
                               <span class="kw">breaks</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">Inf</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">Inf</span>),
                               <span class="kw">labels</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"novisit"</span>,<span class="st">"1visit"</span>,<span class="st">"morevisit"</span>))) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">ftvm3</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span>(<span class="no">ftv</span>,
                               <span class="kw">breaks</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">Inf</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">Inf</span>),
                               <span class="kw">labels</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"novisit"</span>,<span class="st">"1visit"</span>,<span class="st">"morevisit"</span>)))

<span class="co"># Generate Not Smoke Variable</span>
<span class="no">not_smoke_levels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1"</span> <span class="kw">=</span> <span class="st">"0"</span>, <span class="st">"0"</span> <span class="kw">=</span> <span class="st">"1"</span>)
<span class="no">df_opt_birthwt</span> <span class="kw">&lt;-</span> <span class="no">df_opt_birthwt</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">notsmoke</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">smoke</span> <span class="kw">==</span> <span class="fl">0</span> ~ <span class="fl">1</span>, <span class="fl">TRUE</span> ~ <span class="fl">0</span>))

<span class="fu"><a href="https://rdrr.io/r/base/attach.html">attach</a></span>(<span class="no">df_opt_birthwt</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">df_opt_birthwt</span>)</pre></body></html></div>
<pre><code>##      Index            low              age             lwt       
##  Min.   :  4.0   Min.   :0.0000   Min.   :14.00   Min.   : 80.0  
##  1st Qu.: 68.0   1st Qu.:0.0000   1st Qu.:19.00   1st Qu.:110.0  
##  Median :123.0   Median :0.0000   Median :23.00   Median :121.0  
##  Mean   :121.1   Mean   :0.3122   Mean   :23.24   Mean   :129.8  
##  3rd Qu.:176.0   3rd Qu.:1.0000   3rd Qu.:26.00   3rd Qu.:140.0  
##  Max.   :226.0   Max.   :1.0000   Max.   :45.00   Max.   :250.0  
##       race           smoke             ptl               ht         
##  Min.   :1.000   Min.   :0.0000   Min.   :0.0000   Min.   :0.00000  
##  1st Qu.:1.000   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.00000  
##  Median :1.000   Median :0.0000   Median :0.0000   Median :0.00000  
##  Mean   :1.847   Mean   :0.3915   Mean   :0.1958   Mean   :0.06349  
##  3rd Qu.:3.000   3rd Qu.:1.0000   3rd Qu.:0.0000   3rd Qu.:0.00000  
##  Max.   :3.000   Max.   :1.0000   Max.   :3.0000   Max.   :1.00000  
##        ui              ftv              bwt       momwgtLowHigh mombirthage
##  Min.   :0.0000   Min.   :0.0000   Min.   : 709   LW:110        young:120  
##  1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:2414   HW: 79        older: 69  
##  Median :0.0000   Median :0.0000   Median :2977                            
##  Mean   :0.1481   Mean   :0.7937   Mean   :2945                            
##  3rd Qu.:0.0000   3rd Qu.:1.0000   3rd Qu.:3487                            
##  Max.   :1.0000   Max.   :6.0000   Max.   :4990                            
##        ftvm3        notsmoke     
##  novisit  :147   Min.   :0.0000  
##  1visit   : 30   1st Qu.:0.0000  
##  morevisit: 12   Median :1.0000  
##                  Mean   :0.6085  
##                  3rd Qu.:1.0000  
##                  Max.   :1.0000</code></pre>
</div>
</div>
<div id="exploration" class="section level2">
<h2 class="hasAnchor">
<a href="#exploration" class="anchor"></a>Exploration</h2>
<div id="tabulation" class="section level3">
<h3 class="hasAnchor">
<a href="#tabulation" class="anchor"></a>Tabulation</h3>
<p>Tabulate:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># tabulate</span>
<span class="no">df_opt_birthwt</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">race</span>, <span class="no">smoke</span>, <span class="no">ftv</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="kw">freq</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span>()) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span>(<span class="kw">names_from</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">values_from</span> <span class="kw">=</span> <span class="no">freq</span>)</pre></body></html></div>
<pre><code>## `summarise()` regrouping output by 'race', 'smoke' (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 11 x 5
## # Groups:   smoke [2]
##    smoke   ftv   `1`   `2`   `3`
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1     0     0    13     8    34
##  2     0     1    20     4    11
##  3     0     2     9     3     7
##  4     0     3     1    NA     2
##  5     0     4     1     1     1
##  6     1     0    30     6     9
##  7     1     1     9     2     1
##  8     1     2     9     1     1
##  9     1     3     3     1    NA
## 10     1     4     1    NA    NA
## 11     1     6    NA    NA     1</code></pre>
<p>Summarize all, conditional on smoking or not:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># summarize all</span>
<span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_opt_birthwt</span>, <span class="kw">bl_statsasrows</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: `funs()` is deprecated as of dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Warning: `as.tibble()` is deprecated as of tibble 2.0.0.
## Please use `as_tibble()` instead.
## The signature and semantics have changed, see `?as_tibble`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 12 x 19
##    var       n unique NAobs ZEROobs    mean      sd    cv   min    p01    p05
##    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 age     189     24     0       0 2.32e+1   5.30  0.228    14   14     16  
##  2 bwt     189    131     0       0 2.94e+3 729.    0.248   709 1121.  1801. 
##  3 ftv     189      6     0     100 7.94e-1   1.06  1.33      0    0      0  
##  4 ht      189      2     0     177 6.35e-2   0.244 3.85      0    0      0  
##  5 Index   189    189     0       0 1.21e+2  63.3   0.523     4   10.9   20.8
##  6 low     189      2     0     130 3.12e-1   0.465 1.49      0    0      0  
##  7 lwt     189     75     0       0 1.30e+2  30.6   0.236    80   85     94.4
##  8 nots~   189      2     0      74 6.08e-1   0.489 0.804     0    0      0  
##  9 ptl     189      4     0     159 1.96e-1   0.493 2.52      0    0      0  
## 10 race    189      3     0       0 1.85e+0   0.918 0.497     1    1      1  
## 11 smoke   189      2     0     115 3.92e-1   0.489 1.25      0    0      0  
## 12 ui      189      2     0     161 1.48e-1   0.356 2.40      0    0      0  
## # ... with 8 more variables: p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;, p75 &lt;dbl&gt;,
## #   p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co"># summarize smoking only</span>
<span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_opt_birthwt</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">smoke</span> <span class="kw">==</span> <span class="fl">0</span>), <span class="kw">bl_statsasrows</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 12 x 19
##    var       n unique NAobs ZEROobs    mean      sd      cv   min    p01    p05
##    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 age     115     23     0       0 2.34e+1   5.47    0.233    14   14.1   16  
##  2 bwt     115     87     0       0 3.06e+3 753.      0.246  1021 1350.  1721. 
##  3 ftv     115      5     0      55 8.17e-1   0.979   1.20      0    0      0  
##  4 ht      115      2     0     108 6.09e-2   0.240   3.95      0    0      0  
##  5 Index   115    115     0       0 1.31e+2  64.8     0.496    10   13.3   18.7
##  6 low     115      2     0      86 2.52e-1   0.436   1.73      0    0      0  
##  7 lwt     115     58     0       0 1.31e+2  28.4     0.217    85   89.8   96.7
##  8 nots~   115      1     0       0 1.00e+0   0       0         1    1      1  
##  9 ptl     115      3     0     103 1.22e-1   0.378   3.11      0    0      0  
## 10 race    115      3     0       0 2.10e+0   0.927   0.442     1    1      1  
## 11 smoke   115      1     0     115 0.        0     NaN         0    0      0  
## 12 ui      115      2     0     100 1.30e-1   0.338   2.59      0    0      0  
## # ... with 8 more variables: p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;, p75 &lt;dbl&gt;,
## #   p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co"># summarize non-smoking only, 74 smokers</span>
<span class="kw pkg">REconTools</span><span class="kw ns">::</span><span class="fu"><a href="https://fanwangecon.github.io/REconTools/reference/ff_summ_percentiles.html">ff_summ_percentiles</a></span>(<span class="no">df_opt_birthwt</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">smoke</span> <span class="kw">==</span> <span class="fl">1</span>), <span class="kw">bl_statsasrows</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped</code></pre>
<pre><code>## # A tibble: 12 x 19
##    var       n unique NAobs ZEROobs    mean      sd      cv   min    p01    p05
##    &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 age      74     21     0       0 2.29e+1   5.05    0.220    14 1.55e1   17  
##  2 bwt      74     61     0       0 2.77e+3 660.      0.238   709 1.02e3 1862. 
##  3 ftv      74      6     0      45 7.57e-1   1.18    1.56      0 0.        0  
##  4 ht       74      2     0      69 6.76e-2   0.253   3.74      0 0.        0  
##  5 Index    74     74     0       0 1.06e+2  58.1     0.548     4 9.11e0   22.6
##  6 low      74      2     0      44 4.05e-1   0.494   1.22      0 0.        0  
##  7 lwt      74     45     0       0 1.28e+2  33.8     0.264    80 8.36e1   90  
##  8 nots~    74      1     0      74 0.        0     NaN         0 0.        0  
##  9 ptl      74      4     0      56 3.11e-1   0.618   1.99      0 0.        0  
## 10 race     74      3     0       0 1.46e+0   0.762   0.522     1 1.00e0    1  
## 11 smoke    74      1     0       0 1.00e+0   0       0         1 1.00e0    1  
## 12 ui       74      2     0      61 1.76e-1   0.383   2.18      0 0.        0  
## # ... with 8 more variables: p10 &lt;dbl&gt;, p25 &lt;dbl&gt;, p50 &lt;dbl&gt;, p75 &lt;dbl&gt;,
## #   p90 &lt;dbl&gt;, p95 &lt;dbl&gt;, p99 &lt;dbl&gt;, max &lt;dbl&gt;</code></pre>
</div>
<div id="explorational-regressions" class="section level3">
<h3 class="hasAnchor">
<a href="#explorational-regressions" class="anchor"></a>Explorational Regressions</h3>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="co"># birth weight on mother age, race, ht and ui</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">bwt</span> ~ <span class="no">lwt</span> + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">mombirthage</span>) + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>) + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">ht</span>) + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">ui</span>)))</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = bwt ~ lwt + factor(mombirthage) + factor(race) + 
##     factor(ht) + factor(ui))
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1594.45  -453.35    40.06   468.89  1891.04 
## 
## Coefficients:
##                          Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)              2572.173    237.094  10.849  &lt; 2e-16 ***
## lwt                         5.216      1.735   3.006  0.00302 ** 
## factor(mombirthage)older -114.841    102.918  -1.116  0.26596    
## factor(race)2            -453.756    150.971  -3.006  0.00302 ** 
## factor(race)3            -216.550    108.069  -2.004  0.04657 *  
## factor(ht)1              -633.028    205.271  -3.084  0.00236 ** 
## factor(ui)1              -563.302    138.153  -4.077  6.8e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 664.4 on 182 degrees of freedom
## Multiple R-squared:  0.1964, Adjusted R-squared:  0.1699 
## F-statistic: 7.412 on 6 and 182 DF,  p-value: 4.131e-07</code></pre>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="co"># # summary(lm(bwt ~ factor(ftv) - 1))</span>
<span class="co"># summary(lm(bwt ~ factor(ftv) + factor(ht) + factor(ui) + factor(ptl) - 1))</span>

<span class="co"># Birth wegith on mother's weight last menstral cycle, and mother age, race and smoking interaction</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">bwt</span> ~ <span class="no">lwt</span> + <span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>) + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>):<span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">notsmoke</span>) - <span class="fl">1</span>))</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = bwt ~ lwt + age + factor(race) + factor(race):factor(notsmoke) - 
##     1)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2360.77  -434.48    42.18   469.28  1710.36 
## 
## Coefficients:
##                                 Estimate Std. Error t value Pr(&gt;|t|)    
## lwt                                3.711      1.739   2.134 0.034154 *  
## age                               -4.760     10.054  -0.473 0.636500    
## factor(race)1                   2466.776    304.057   8.113 7.29e-14 ***
## factor(race)2                   2089.529    381.625   5.475 1.44e-07 ***
## factor(race)3                   2404.104    345.416   6.960 6.04e-11 ***
## factor(race)1:factor(notsmoke)1  570.605    143.546   3.975 0.000102 ***
## factor(race)2:factor(notsmoke)1  305.314    277.419   1.101 0.272553    
## factor(race)3:factor(notsmoke)1   75.981    216.468   0.351 0.725994    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 678.9 on 181 degrees of freedom
## Multiple R-squared:  0.952,  Adjusted R-squared:  0.9499 
## F-statistic: 448.9 on 8 and 181 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb27"><html><body><pre class="r"># summary(lm(bwt ~ lwt + factor(race) + (ftv) - 1))</pre></body></html></div>
</div>
</div>
<div id="regression-with-data-and-construct-input-arrays" class="section level2">
<h2 class="hasAnchor">
<a href="#regression-with-data-and-construct-input-arrays" class="anchor"></a>Regression with Data and Construct Input Arrays</h2>
<div id="binary-problem-regress-birth-weight-on-mothers-smoking-status" class="section level3">
<h3 class="hasAnchor">
<a href="#binary-problem-regress-birth-weight-on-mothers-smoking-status" class="anchor"></a>Binary Problem Regress Birth Weight on Mother’s Smoking Status</h3>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="co"># A. Regress child birth weight on mother's age, race and mother's weight</span>
<span class="co"># print(summary(lm(bwt ~ lwt + factor(mombirthage) + factor(race))))</span>
<span class="co"># print(summary(lm(bwt ~ lwt + factor(mombirthage) + factor(race) + factor(ht) + factor(ui))))</span>
<span class="co"># print(summary(lm(bwt ~ lwt + age + factor(race) + factor(ht) + factor(ui) + factor(ptl))))</span>
<span class="co"># </span>
<span class="co"># print(summary(lm(bwt ~ lwt + age + factor(race) + factor(smoke))))</span>
<span class="co"># print(summary(lm(bwt ~ lwt + age + factor(race) + factor(ht) + factor(ui) +  factor(smoke))))</span>
<span class="co"># </span>
<span class="co"># print(summary(lm(bwt ~ lwt + age + factor(momwgtLowHigh):factor(smoke) - 1)))</span>
<span class="co"># print(summary(lm(bwt ~ lwt + age + factor(ht) + factor(ui) + factor(race) + factor(race):factor(smoke))))</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">bwt</span> ~ <span class="no">lwt</span> + <span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>) + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>):<span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">smoke</span>) - <span class="fl">1</span>)))</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = bwt ~ lwt + age + factor(race) + factor(race):factor(smoke) - 
##     1)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2360.77  -434.48    42.18   469.28  1710.36 
## 
## Coefficients:
##                              Estimate Std. Error t value Pr(&gt;|t|)    
## lwt                             3.711      1.739   2.134 0.034154 *  
## age                            -4.760     10.054  -0.473 0.636500    
## factor(race)1                3037.381    339.863   8.937 4.55e-16 ***
## factor(race)2                2394.843    344.390   6.954 6.25e-11 ***
## factor(race)3                2480.085    293.002   8.464 8.57e-15 ***
## factor(race)1:factor(smoke)1 -570.605    143.546  -3.975 0.000102 ***
## factor(race)2:factor(smoke)1 -305.314    277.419  -1.101 0.272553    
## factor(race)3:factor(smoke)1  -75.981    216.468  -0.351 0.725994    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 678.9 on 181 degrees of freedom
## Multiple R-squared:  0.952,  Adjusted R-squared:  0.9499 
## F-statistic: 448.9 on 8 and 181 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="co"># Preferred way of appearing, in the following regression we can se:</span>
<span class="co"># 1. more more power less MPG, Straight engine slightly higher MPG</span>
<span class="co"># 2. V-shape engine car, going from auto to manual trans gain 4.1 MPG</span>
<span class="co"># 2. straight shape engine, going from auto to manual trans gain 6.67 MPG</span>

<span class="co"># Store Regression Results</span>
<span class="no">mt_model</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(~ <span class="no">lwt</span> + <span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>) + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">notsmoke</span>):<span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>))
<span class="no">rs_wgt_on_smke</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">bwt</span> ~ <span class="no">mt_model</span> - <span class="fl">1</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">rs_wgt_on_smke</span>))</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = bwt ~ mt_model - 1)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2360.77  -434.48    42.18   469.28  1710.36 
## 
## Coefficients:
##                                         Estimate Std. Error t value Pr(&gt;|t|)
## mt_model(Intercept)                     2466.776    304.057   8.113 7.29e-14
## mt_modellwt                                3.711      1.739   2.134 0.034154
## mt_modelage                               -4.760     10.054  -0.473 0.636500
## mt_modelfactor(race)2                   -377.246    236.212  -1.597 0.111995
## mt_modelfactor(race)3                    -62.672    217.474  -0.288 0.773538
## mt_modelfactor(race)1:factor(notsmoke)1  570.605    143.546   3.975 0.000102
## mt_modelfactor(race)2:factor(notsmoke)1  305.314    277.419   1.101 0.272553
## mt_modelfactor(race)3:factor(notsmoke)1   75.981    216.468   0.351 0.725994
##                                            
## mt_model(Intercept)                     ***
## mt_modellwt                             *  
## mt_modelage                                
## mt_modelfactor(race)2                      
## mt_modelfactor(race)3                      
## mt_modelfactor(race)1:factor(notsmoke)1 ***
## mt_modelfactor(race)2:factor(notsmoke)1    
## mt_modelfactor(race)3:factor(notsmoke)1    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 678.9 on 181 degrees of freedom
## Multiple R-squared:  0.952,  Adjusted R-squared:  0.9499 
## F-statistic: 448.9 on 8 and 181 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">rs_wgt_on_smke_tidy</span> <span class="kw">=</span> <span class="fu"><a href="https://broom.tidymodels.org/reference/reexports.html">tidy</a></span>(<span class="no">rs_wgt_on_smke</span>)
<span class="no">rs_wgt_on_smke_tidy</span></pre></body></html></div>
<pre><code>## # A tibble: 8 x 5
##   term                                    estimate std.error statistic  p.value
##   &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 mt_model(Intercept)                      2467.      304.       8.11  7.29e-14
## 2 mt_modellwt                                 3.71      1.74     2.13  3.42e- 2
## 3 mt_modelage                                -4.76     10.1     -0.473 6.36e- 1
## 4 mt_modelfactor(race)2                    -377.      236.      -1.60  1.12e- 1
## 5 mt_modelfactor(race)3                     -62.7     217.      -0.288 7.74e- 1
## 6 mt_modelfactor(race)1:factor(notsmoke)1   571.      144.       3.98  1.02e- 4
## 7 mt_modelfactor(race)2:factor(notsmoke)1   305.      277.       1.10  2.73e- 1
## 8 mt_modelfactor(race)3:factor(notsmoke)1    76.0     216.       0.351 7.26e- 1</code></pre>
</div>
<div id="construct-input-arrays-a_i-and-alpha_i" class="section level3">
<h3 class="hasAnchor">
<a href="#construct-input-arrays-a_i-and-alpha_i" class="anchor"></a>Construct Input Arrays <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span>
</h3>
<p>Multiply coefficient vector by covariate matrix to generate <em>A</em> vector that is child/individual specific.</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="co"># Estimates Table</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">rs_wgt_on_smke_tidy</span>, <span class="fl">6</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 5
##   term                                    estimate std.error statistic  p.value
##   &lt;chr&gt;                                      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 mt_model(Intercept)                      2467.      304.       8.11  7.29e-14
## 2 mt_modellwt                                 3.71      1.74     2.13  3.42e- 2
## 3 mt_modelage                                -4.76     10.1     -0.473 6.36e- 1
## 4 mt_modelfactor(race)2                    -377.      236.      -1.60  1.12e- 1
## 5 mt_modelfactor(race)3                     -62.7     217.      -0.288 7.74e- 1
## 6 mt_modelfactor(race)1:factor(notsmoke)1   571.      144.       3.98  1.02e- 4</code></pre>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="co"># Covariates</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">mt_model</span>, <span class="fl">5</span>)</pre></body></html></div>
<pre><code>##   (Intercept) lwt age factor(race)2 factor(race)3
## 1           1 182  19             1             0
## 2           1 155  33             0             1
## 3           1 105  20             0             0
## 4           1 108  21             0             0
## 5           1 107  18             0             0
##   factor(race)1:factor(notsmoke)1 factor(race)2:factor(notsmoke)1
## 1                               0                               1
## 2                               0                               0
## 3                               0                               0
## 4                               0                               0
## 5                               0                               0
##   factor(race)3:factor(notsmoke)1
## 1                               0
## 2                               1
## 3                               0
## 4                               0
## 5                               0</code></pre>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="co"># Covariates coefficients from regression (including constant)</span>
<span class="no">ar_fl_cova_esti</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">rs_wgt_on_smke_tidy</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(!<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span>(<span class="no">term</span>, <span class="st">'notsmoke'</span>)) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">estimate</span>))
<span class="no">ar_fl_main_esti</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">rs_wgt_on_smke_tidy</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span>(<span class="no">term</span>, <span class="st">'notsmoke'</span>)) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">estimate</span>))
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ar_fl_cova_esti</span>, <span class="fl">5</span>)</pre></body></html></div>
<pre><code>##         estimate
## [1,] 2466.775608
## [2,]    3.710935
## [3,]   -4.759693
## [4,] -377.246401
## [5,]  -62.671843</code></pre>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ar_fl_main_esti</span>, <span class="fl">5</span>)</pre></body></html></div>
<pre><code>##       estimate
## [1,] 570.60493
## [2,] 305.31426
## [3,]  75.98101</code></pre>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="co"># Select Matrix subcomponents</span>
<span class="no">mt_cova</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="no">mt_model</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"notsmoke"</span>)))
<span class="no">mt_intr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(~ <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">race</span>) - <span class="fl">1</span>)

<span class="co"># Generate A_i, use mt_cova_wth_const</span>
<span class="no">ar_A_m</span> <span class="kw">&lt;-</span> <span class="no">mt_cova</span> <span class="kw">%*%</span> <span class="no">ar_fl_cova_esti</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ar_A_m</span>, <span class="fl">5</span>)</pre></body></html></div>
<pre><code>##      estimate
## [1,] 2674.485
## [2,] 2822.229
## [3,] 2761.230
## [4,] 2767.603
## [5,] 2778.171</code></pre>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="co"># Generate alpha_i</span>
<span class="no">ar_alpha_m</span> <span class="kw">&lt;-</span> <span class="no">mt_intr</span> <span class="kw">%*%</span> <span class="no">ar_fl_main_esti</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">ar_alpha_m</span>, <span class="fl">5</span>)</pre></body></html></div>
<pre><code>##    estimate
## 1 305.31426
## 2  75.98101
## 3 570.60493
## 4 570.60493
## 5 570.60493</code></pre>
</div>
<div id="individual-weight" class="section level3">
<h3 class="hasAnchor">
<a href="#individual-weight" class="anchor"></a>Individual Weight</h3>
<div class="sourceCode" id="cb46"><html><body><pre class="r"><span class="co"># Child Weight</span>
<span class="no">ar_beta_m</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>/<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">ar_A_m</span>), <span class="kw">times</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">ar_A_m</span>))</pre></body></html></div>
</div>
<div id="matrix-with-required-inputs-for-allocation" class="section level3">
<h3 class="hasAnchor">
<a href="#matrix-with-required-inputs-for-allocation" class="anchor"></a>Matrix with Required Inputs for Allocation</h3>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="co"># Initate Dataframe that will store all estimates and optimal allocation relevant information</span>
<span class="co"># combine identifying key information along with estimation A, alpha results</span>
<span class="co"># note that we only need indi.id as key</span>
<span class="no">mt_opti</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">ar_alpha_m</span>*<span class="fl">0.01</span>, <span class="no">ar_A_m</span>*<span class="fl">0.01</span>, <span class="no">ar_beta_m</span>)
<span class="no">ar_st_varnames</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'alpha'</span>, <span class="st">'A'</span>, <span class="st">'beta'</span>)
<span class="no">df_esti_alpha_A_beta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">as_tibble</a></span>(<span class="no">mt_opti</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">rename_all</a></span>(~<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">ar_st_varnames</span>))</pre></body></html></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="no">tb_key_alpha_A_beta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="no">df_opt_birthwt</span>, <span class="no">df_esti_alpha_A_beta</span>) <span class="kw">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">one_of</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Index'</span>, <span class="st">'age'</span>, <span class="st">'lwt'</span>, <span class="st">'race'</span>, <span class="st">'notsmoke'</span>, <span class="st">'ptl'</span>, <span class="st">'ht'</span>, <span class="st">'ui'</span>, <span class="no">ar_st_varnames</span>)))

<span class="co"># Need to only include the smokers here</span>
<span class="no">tb_key_alpha_A_beta</span> <span class="kw">&lt;-</span> <span class="no">tb_key_alpha_A_beta</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">smoke</span> <span class="kw">==</span> <span class="fl">1</span>)

<span class="co"># Randomly select 15 smokers for easier visualization.</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">999</span>)
<span class="no">it_include</span> <span class="kw">&lt;-</span> <span class="fl">15</span>
<span class="no">tb_key_alpha_A_beta</span> <span class="kw">&lt;-</span> <span class="no">tb_key_alpha_A_beta</span>[<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">tb_key_alpha_A_beta</span>)[<span class="fl">1</span>], <span class="no">it_include</span>, <span class="kw">replace</span><span class="kw">=</span><span class="fl">FALSE</span>),]

<span class="co"># Unique beta, A, and alpha check</span>
<span class="no">tb_opti_unique</span> <span class="kw">&lt;-</span> <span class="no">tb_key_alpha_A_beta</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(!!!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">syms</a></span>(<span class="no">ar_st_varnames</span>)) <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(!!!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">syms</a></span>(<span class="no">ar_st_varnames</span>)) <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="kw">n_obs_group</span><span class="kw">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span>())</pre></body></html></div>
<pre><code>## `summarise()` regrouping output by 'alpha', 'A' (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="co"># Show cars</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">tb_key_alpha_A_beta</span>, <span class="fl">32</span>)</pre></body></html></div>
<pre><code>##    Index age lwt race notsmoke ptl ht ui     alpha        A        beta
## 27   159  28 250    3        0   0  0  0 0.7598101 31.98566 0.005291005
## 68    68  17 120    1        0   0  0  0 5.7060493 28.31173 0.005291005
## 61    51  20 121    1        0   1  0  1 5.7060493 28.20605 0.005291005
## 71    78  14 101    3        0   1  0  0 0.7598101 27.12273 0.005291005
## 14   123  29 140    1        0   0  0  0 5.7060493 28.48275 0.005291005
## 65    61  24 105    2        0   0  0  0 3.0531426 23.64945 0.005291005
## 58    44  20  80    3        0   0  0  1 0.7598101 26.05785 0.005291005
## 10   113  17 122    1        0   0  0  0 5.7060493 28.38595 0.005291005
## 22   137  22  85    3        0   0  0  0 0.7598101 26.14820 0.005291005
## 35   187  19 235    1        0   0  1  0 5.7060493 32.48411 0.005291005
## 23   140  22 130    1        0   0  0  0 5.7060493 28.44484 0.005291005
## 56    40  20 120    2        0   0  0  0 3.0531426 24.39648 0.005291005
## 15   124  19 138    1        0   0  0  0 5.7060493 28.88451 0.005291005
## 5     95  26 113    1        0   0  0  0 5.7060493 27.62359 0.005291005
## 7    101  18 100    1        0   0  0  0 5.7060493 27.52195 0.005291005</code></pre>
</div>
</div>
<div id="optimal-linear-allocations" class="section level2">
<h2 class="hasAnchor">
<a href="#optimal-linear-allocations" class="anchor"></a>Optimal Linear Allocations</h2>
<div id="parameters-for-optimal-allocation" class="section level3">
<h3 class="hasAnchor">
<a href="#parameters-for-optimal-allocation" class="anchor"></a>Parameters for Optimal Allocation</h3>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="co"># Child Count</span>
<span class="no">it_obs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">tb_opti_unique</span>)[<span class="fl">1</span>]

<span class="co"># Vector of Planner Preference</span>
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - (<span class="fl">10</span>^(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">2</span>, <span class="fl">2</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">30</span>))))
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">ar_rho</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">ar_rho</span>)</pre></body></html></div>
<pre><code>##  [1]   0.9900000   0.9862618   0.9811261   0.9740706   0.9643775   0.9510610
##  [7]   0.9327664   0.9076329   0.8731039   0.8256671   0.7604973   0.6709655
## [13]   0.5479646   0.3789831   0.1468321  -0.1721023  -0.6102620  -1.2122163
## [19]  -2.0391954  -3.1753189  -4.7361525  -6.8804628  -9.8263673 -13.8735211
## [25] -19.4335972 -27.0721620 -37.5662042 -51.9831691 -71.7895384 -99.0000000</code></pre>
</div>
<div id="optimal-binary-allocation" class="section level3">
<h3 class="hasAnchor">
<a href="#optimal-binary-allocation" class="anchor"></a>Optimal binary Allocation</h3>
<p>This also works with any CRS CES.</p>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="co"># Optimal Linear Equation</span>
<span class="no">svr_inpalc</span> <span class="kw">&lt;-</span> <span class="st">'rank'</span>

<span class="co"># Solve with Function</span>
<span class="no">ls_bin_solu_all_rhos</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_bin.html">ffp_opt_anlyz_rhgin_bin</a></span>(<span class="no">tb_key_alpha_A_beta</span>, <span class="kw">svr_id_i</span> <span class="kw">=</span> <span class="st">'Index'</span>,
                          <span class="kw">svr_A_i</span> <span class="kw">=</span> <span class="st">'A'</span>, <span class="kw">svr_alpha_i</span> <span class="kw">=</span> <span class="st">'alpha'</span>, <span class="kw">svr_beta_i</span> <span class="kw">=</span> <span class="st">'beta'</span>,
                          <span class="kw">ar_rho</span> <span class="kw">=</span> <span class="no">ar_rho</span>,
                          <span class="kw">svr_inpalc</span> <span class="kw">=</span> <span class="no">svr_inpalc</span>,
                          <span class="kw">svr_expout</span> <span class="kw">=</span> <span class="st">'opti_exp_outcome'</span>)</pre></body></html></div>
<pre><code>## Joining, by = "Index"</code></pre>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="no">tb_opti_alloc_all_rho</span> <span class="kw">&lt;-</span> <span class="no">ls_bin_solu_all_rhos</span>$<span class="no">df_all_rho</span>
<span class="no">tb_opti_alloc_all_rho_long</span> <span class="kw">&lt;-</span> <span class="no">ls_bin_solu_all_rhos</span>$<span class="no">df_all_rho_long</span>

<span class="co"># Converge rho to numeric so the graph below sorts along x-axis properly </span>
<span class="no">tb_opti_alloc_all_rho_long</span> <span class="kw">&lt;-</span> <span class="no">tb_opti_alloc_all_rho_long</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rho_num</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">rho</span>))

<span class="co"># Merge to get Race Data</span>
<span class="no">tb_opti_alloc_all_rho_long</span> <span class="kw">&lt;-</span> <span class="no">tb_opti_alloc_all_rho_long</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">tb_key_alpha_A_beta</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">Index</span>, <span class="no">race</span>), <span class="kw">by</span><span class="kw">=</span><span class="st">'Index'</span>)</pre></body></html></div>
</div>
<div id="bump-plot-for-optimal-binary-allocations" class="section level3">
<h3 class="hasAnchor">
<a href="#bump-plot-for-optimal-binary-allocations" class="anchor"></a>Bump Plot for Optimal Binary Allocations</h3>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="no">st_title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Binary Deallocation Rank, Birth Weight and Mother Smoking"</span>)
<span class="no">st_subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Which individual to encourage to stop smoking first\n"</span>,
                     <span class="st">"The expected outcome of interest is child birth weight\n"</span>,
                     <span class="st">"Deallocate smoking among 15 randomly selected smokers\n"</span>,
                     <span class="st">"Rank = 1, encourage this woman to stop smoking first"</span>)
<span class="no">st_caption</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Linear regression of birth weight on smoking. Data from Hosmer et. al. (1998)"</span>)
<span class="no">st_x_lab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Efficiency (Utilitarian) --&gt; Cobb-Douglas --&gt; Equity (Rawlsian)"</span>)
<span class="no">st_y_lab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Rank Along Binary Allocation Queue ( 1 = highest ranked)"</span>)

<span class="no">tb_opti_alloc_all_rho_long</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">rho_num</span>, <span class="kw">y</span> <span class="kw">=</span> !!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span>(<span class="no">svr_inpalc</span>), <span class="kw">group</span> <span class="kw">=</span> <span class="no">Index</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">1</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">race</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">1</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">4</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_x_discrete</a></span>(<span class="kw">expand</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.85</span>,<span class="fl">0</span>))+
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_reverse</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">tb_opti_alloc_all_rho_long</span>))+
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"none"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">st_x_lab</span>,
         <span class="kw">y</span> <span class="kw">=</span> <span class="no">st_y_lab</span>,
         <span class="kw">title</span> <span class="kw">=</span> <span class="no">st_title</span>,
         <span class="kw">subtitle</span> <span class="kw">=</span> <span class="no">st_subtitle</span>,
         <span class="kw">caption</span> <span class="kw">=</span> <span class="no">st_caption</span>) +
    <span class="fu"><a href="../reference/ffy_opt_ghthm_dk.html">ffy_opt_ghthm_dk</a></span>() +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="kw">data</span> <span class="kw">=</span><span class="no">tb_opti_alloc_all_rho</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">rho_c1_rk</span>,<span class="kw">x</span><span class="kw">=</span><span class="fl">0.6</span>,<span class="kw">label</span><span class="kw">=</span><span class="no">Index</span>),<span class="kw">hjust</span><span class="kw">=</span><span class="st">"right"</span>)</pre></body></html></div>
<p><img src="ffv_opt_sobin_rkone_allrw_wgt_files/figure-html/binary%20allocation%20bump%20plot-1.png" width="960" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://fanwangecon.github.io">Fan Wang</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
