<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BINARY--NSW Training EMPLOYMENT as Outcome Optimal Allocation Solution • PrjOptiAlloc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="BINARY--NSW Training EMPLOYMENT as Outcome Optimal Allocation Solution">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PrjOptiAlloc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ffv_opt_anlyz_rhgin.html">ANALYSIS--Optimal Allocations Planner Elasticity Vector and Ginis</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_dtgch_cbem4.html">DATA--Generate Data Cebu Four Category Test Regression Results</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sobin_rev.html">BINARY--REV Test One Resource Equivalent Variation Computation (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sobin_rev_two.html">BINARY--REV Test Two Resource Equivalent Variation Computation (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sobin_rkone_allfc_training_logit.html">BINARY--NSW Training EMPLOYMENT as Outcome Optimal Allocation Solution</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sobin_rkone_allrw_car.html">BINARY--MPG and Shift Optimal Allocation Solution (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sobin_rkone_allrw_training.html">BINARY--NSW Training WAGE and EMPLOYMENT Optimal Allocation Analysis</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sobin_rkone_allrw_training_wage.html">BINARY--NSW Training WAGE Optimal Allocation Solution</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sobin_rkone_allrw_wgt.html">BINARY--Birth Weight and Doctors Visit Optimal Allocation Solution (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sodis_rkone_casch_allfn.html">DISCRETE--Discrete Optimal Allocation California Teacher Student Ratio (Function)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_sodis_rkone_casch_allrw.html">DISCRETE--Discrete Optimal Allocation California Teacher Student Ratio (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solin_relow.html">LINEAR--Optimal Linear Allocation based On Relative Allocation to Lowest</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solin_relow_allfn.html">LINEAR--CRS (Linear) Optimal Allocation Solution (Function)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solin_relow_allrw.html">LINEAR--CRS (Linear) Optimal Allocation Solution (Line by Line)</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solog_asame_allrw.html">LOG-LINEAR--DRS (Log-Linear) Optimal Allocation Analytical Common Alpha</a>
    </li>
    <li>
      <a href="../articles/ffv_opt_solog_bisec_allrw.html">LOG-LINEAR--DRS (Log-Linear) Optimal Allocation Implicit Bisection Solution (Line by Line)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>BINARY–NSW Training EMPLOYMENT as Outcome Optimal Allocation Solution</h1>
            
      
      
      <div class="hidden name"><code>ffv_opt_sobin_rkone_allfc_training_logit.Rmd</code></div>

    </div>

    
    
<p>Back to <strong><a href="https://fanwangecon.github.io/">Fan</a></strong>’s Optimal Allocation Homepage <strong><a href="https://fanwangecon.github.io/PrjOptiAlloc/">Table of Content</a></strong></p>
<div id="objective" class="section level1">
<h1 class="hasAnchor">
<a href="#objective" class="anchor"></a>Objective</h1>
<p>Test binary allocation queue with Lalonde training dataset. There are 722 observations, 297 in the treatment group, 425 in the control group.</p>
<p><strong>Objective One</strong>:</p>
<p>estimate a logit regression using the <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/df_opt_lalonde_training.html">Lalonde (1986)</a> dataset. Include age, education, and race as controls.</p>
<p><strong>Generate and Analyze <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span></strong></p>
<ol style="list-style-type: decimal">
<li>Generate and show how to generate <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span> in the binary allocation Space</li>
<li>What is the correlation between <span class="math inline">\(A\)</span> and <span class="math inline">\(\alpha\)</span>
</li>
<li>What is the relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(A\)</span> and <span class="math inline">\(\alpha\)</span>, when there is one x covariate, when there are multiple?</li>
</ol>
<p><strong>Solve for Optimal Allocations</strong></p>
<p>Uses the binary allocation function as well as the planner iterator to solve for optimal binary targeting queue. These queue tell the planner, given the planner’s preferences, who should optimally receive allocations.</p>
<div id="set-up" class="section level2">
<h2 class="hasAnchor">
<a href="#set-up" class="anchor"></a>Set Up</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># dev.off(dev.list()["RStudioGD"])</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="dt">list =</span> <span class="kw"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>(<span class="dt">all.names =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="dt">knitr.duplicate.label =</span> <span class="st">'allow'</span>)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(forcats)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(knitr)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(kableExtra)</a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(REconTools)</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(PrjOptiAlloc)</a></code></pre></div>
</div>
<div id="get-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-data" class="anchor"></a>Get Data</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(df_opt_lalonde_training)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co"># dft stands for dataframe training</span></a>
<a class="sourceLine" id="cb3-3" title="3">dft &lt;-<span class="st"> </span>df_opt_lalonde_training <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">id =</span> X) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="st">           </span><span class="kw">select</span>(<span class="op">-</span>X) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="st">           </span><span class="kw">select</span>(id, <span class="kw">everything</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="st">           </span><span class="kw">mutate</span>(<span class="dt">emp78 =</span></a>
<a class="sourceLine" id="cb3-7" title="7">                    <span class="kw">case_when</span>(re78 <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-8" title="8">                              <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="st">           </span><span class="kw">mutate</span>(<span class="dt">emp75 =</span></a>
<a class="sourceLine" id="cb3-10" title="10">                    <span class="kw">case_when</span>(re75 <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-11" title="11">                              <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb3-12" title="12"></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co"># Generate combine black + hispanic status</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="co"># 0 = white, 1 = black, 2 = hispanics</span></a>
<a class="sourceLine" id="cb3-15" title="15">dft &lt;-<span class="st"> </span>dft <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">race =</span></a>
<a class="sourceLine" id="cb3-17" title="17">             <span class="kw">case_when</span>(black <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-18" title="18">                       hisp <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb3-19" title="19">                       <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb3-20" title="20"></a>
<a class="sourceLine" id="cb3-21" title="21">dft &lt;-<span class="st"> </span>dft <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-22" title="22"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">age_m2 =</span></a>
<a class="sourceLine" id="cb3-23" title="23">             <span class="kw">case_when</span>(age <span class="op">&lt;=</span><span class="st"> </span><span class="dv">23</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-24" title="24">                       age <span class="op">&gt;</span><span class="st">  </span><span class="dv">23</span><span class="op">~</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-25" title="25"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">age_m3 =</span></a>
<a class="sourceLine" id="cb3-26" title="26">             <span class="kw">case_when</span>(age <span class="op">&lt;=</span><span class="st"> </span><span class="dv">20</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-27" title="27">                       age <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span> <span class="op">&amp;</span><span class="st"> </span>age <span class="op">&lt;=</span><span class="st"> </span><span class="dv">26</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb3-28" title="28">                       age <span class="op">&gt;</span><span class="st"> </span><span class="dv">26</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>))</a>
<a class="sourceLine" id="cb3-29" title="29"></a>
<a class="sourceLine" id="cb3-30" title="30"></a>
<a class="sourceLine" id="cb3-31" title="31"></a>
<a class="sourceLine" id="cb3-32" title="32">dft<span class="op">$</span>trt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(dft<span class="op">$</span>trt, <span class="dt">levels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ntran"</span>, <span class="st">"train"</span>))</a>
<a class="sourceLine" id="cb3-33" title="33"></a>
<a class="sourceLine" id="cb3-34" title="34"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(dft)</a></code></pre></div>
<pre><code>##        id            trt           age             educ           black       
##  Min.   :   1.0   ntran:425   Min.   :17.00   Min.   : 3.00   Min.   :0.0000  
##  1st Qu.: 181.2   train:297   1st Qu.:19.00   1st Qu.: 9.00   1st Qu.:1.0000  
##  Median : 361.5               Median :23.00   Median :10.00   Median :1.0000  
##  Mean   : 854.4               Mean   :24.52   Mean   :10.27   Mean   :0.8006  
##  3rd Qu.:1458.5               3rd Qu.:27.00   3rd Qu.:11.00   3rd Qu.:1.0000  
##  Max.   :4110.0               Max.   :55.00   Max.   :16.00   Max.   :1.0000  
##                                                                               
##       hisp             marr           nodeg             re74        
##  Min.   :0.0000   Min.   :0.000   Min.   :0.0000   Min.   :    0.0  
##  1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:1.0000   1st Qu.:    0.0  
##  Median :0.0000   Median :0.000   Median :1.0000   Median :    0.0  
##  Mean   :0.1053   Mean   :0.162   Mean   :0.7798   Mean   : 2102.3  
##  3rd Qu.:0.0000   3rd Qu.:0.000   3rd Qu.:1.0000   3rd Qu.:  824.4  
##  Max.   :1.0000   Max.   :1.000   Max.   :1.0000   Max.   :39570.7  
##                                                    NA's   :277      
##       re75              re78           emp78            emp75       
##  Min.   :    0.0   Min.   :    0   Min.   :0.0000   Min.   :0.0000  
##  1st Qu.:    0.0   1st Qu.:    0   1st Qu.:0.0000   1st Qu.:0.0000  
##  Median :  936.3   Median : 3952   Median :1.0000   Median :1.0000  
##  Mean   : 3042.9   Mean   : 5455   Mean   :0.7285   Mean   :0.5997  
##  3rd Qu.: 3993.2   3rd Qu.: 8772   3rd Qu.:1.0000   3rd Qu.:1.0000  
##  Max.   :37431.7   Max.   :60308   Max.   :1.0000   Max.   :1.0000  
##                                                                     
##       race           age_m2          age_m3     
##  Min.   :0.000   Min.   :1.000   Min.   :1.000  
##  1st Qu.:1.000   1st Qu.:1.000   1st Qu.:1.000  
##  Median :1.000   Median :1.000   Median :2.000  
##  Mean   :1.011   Mean   :1.486   Mean   :1.965  
##  3rd Qu.:1.000   3rd Qu.:2.000   3rd Qu.:3.000  
##  Max.   :2.000   Max.   :2.000   Max.   :3.000  
## </code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># X-variables to use on RHS</span></a>
<a class="sourceLine" id="cb5-2" title="2">ls_st_xs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'age'</span>, <span class="st">'educ'</span>,</a>
<a class="sourceLine" id="cb5-3" title="3">              <span class="st">'black'</span>,<span class="st">'hisp'</span>,<span class="st">'marr'</span>, <span class="st">'nodeg'</span>)</a>
<a class="sourceLine" id="cb5-4" title="4">svr_binary &lt;-<span class="st"> 'trt'</span></a>
<a class="sourceLine" id="cb5-5" title="5">svr_binary_lb0 &lt;-<span class="st"> 'ntran'</span></a>
<a class="sourceLine" id="cb5-6" title="6">svr_binary_lb1 &lt;-<span class="st"> 'train'</span></a>
<a class="sourceLine" id="cb5-7" title="7">svr_outcome &lt;-<span class="st"> 'emp78'</span></a>
<a class="sourceLine" id="cb5-8" title="8">sdt_name &lt;-<span class="st"> 'NSW Lalonde Training'</span></a></code></pre></div>
</div>
</div>
<div id="logit-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#logit-regression" class="anchor"></a>Logit Regression</h1>
<div id="prediction-with-observed-binary-input" class="section level2">
<h2 class="hasAnchor">
<a href="#prediction-with-observed-binary-input" class="anchor"></a>Prediction with Observed Binary Input</h2>
<p>Logit regression with a continuous variable and a binary variable. Predict outcome with observed continuous variable as well as observed binary input variable.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># Regress No bivariate</span></a>
<a class="sourceLine" id="cb6-2" title="2">rs_logit &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(svr_outcome,</a>
<a class="sourceLine" id="cb6-3" title="3">                                 <span class="st">"~"</span>, <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(ls_st_xs, <span class="dt">collapse=</span><span class="st">"+"</span>)))</a>
<a class="sourceLine" id="cb6-4" title="4">                ,<span class="dt">data =</span> dft, <span class="dt">family =</span> <span class="st">"binomial"</span>)</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(rs_logit)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = as.formula(paste(svr_outcome, "~", paste(ls_st_xs, 
##     collapse = "+"))), family = "binomial", data = dft)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.2075  -1.4253   0.7851   0.8571   1.1189  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  2.90493    0.99594   2.917  0.00354 **
## age         -0.01870    0.01295  -1.445  0.14855   
## educ        -0.02754    0.06653  -0.414  0.67896   
## black       -1.16273    0.38941  -2.986  0.00283 **
## hisp        -0.12130    0.51185  -0.237  0.81267   
## marr         0.30300    0.24551   1.234  0.21714   
## nodeg       -0.29036    0.27833  -1.043  0.29684   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 844.33  on 721  degrees of freedom
## Residual deviance: 818.46  on 715  degrees of freedom
## AIC: 832.46
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">dft<span class="op">$</span>p_mpg &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(rs_logit, <span class="dt">newdata =</span> dft, <span class="dt">type =</span> <span class="st">"response"</span>)</a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co"># Regress with bivariate</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co"># rs_logit_bi &lt;- glm(as.formula(paste(svr_outcome,</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="co">#                                     "~ factor(", svr_binary,") + ",</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co">#                                     paste(ls_st_xs, collapse="+")))</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="co">#                    , data = dft, family = "binomial")</span></a>
<a class="sourceLine" id="cb8-8" title="8">rs_logit_bi &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(emp78 <span class="op">~</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="st">                     </span>age <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(age<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(age_m2)</a>
<a class="sourceLine" id="cb8-10" title="10">                   <span class="op">+</span><span class="st"> </span>educ <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(educ<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="st">                   </span><span class="op">+</span><span class="st"> </span>educ <span class="op">+</span><span class="st"> </span>black <span class="op">+</span><span class="st"> </span>hisp <span class="op">+</span><span class="st"> </span>marr <span class="op">+</span><span class="st"> </span>nodeg</a>
<a class="sourceLine" id="cb8-12" title="12">                   <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(trt)</a>
<a class="sourceLine" id="cb8-13" title="13">                   <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(age_m2)<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(trt)</a>
<a class="sourceLine" id="cb8-14" title="14">                   , <span class="dt">data =</span> dft, <span class="dt">family =</span> <span class="st">"binomial"</span>)</a>
<a class="sourceLine" id="cb8-15" title="15"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(rs_logit_bi)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = emp78 ~ age + I(age^2) + factor(age_m2) + educ + 
##     I(educ^2) + +educ + black + hisp + marr + nodeg + factor(trt) + 
##     factor(age_m2) * factor(trt), family = "binomial", data = dft)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.2947  -1.3211   0.7022   0.8742   1.0683  
## 
## Coefficients:
##                                   Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)                       5.136672   2.466613   2.082  0.03730 * 
## age                              -0.097673   0.121445  -0.804  0.42125   
## I(age^2)                          0.001530   0.001835   0.834  0.40451   
## factor(age_m2)2                  -0.212544   0.378581  -0.561  0.57451   
## educ                             -0.407808   0.424696  -0.960  0.33694   
## I(educ^2)                         0.022208   0.023172   0.958  0.33787   
## black                            -1.175989   0.391371  -3.005  0.00266 **
## hisp                             -0.138633   0.514469  -0.269  0.78757   
## marr                              0.370870   0.249077   1.489  0.13649   
## nodeg                            -0.061847   0.349242  -0.177  0.85944   
## factor(trt)train                  0.446774   0.261424   1.709  0.08745 . 
## factor(age_m2)2:factor(trt)train -0.113232   0.357889  -0.316  0.75171   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 844.33  on 721  degrees of freedom
## Residual deviance: 808.43  on 710  degrees of freedom
## AIC: 832.43
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># Predcit Using Regresion Data</span></a>
<a class="sourceLine" id="cb10-2" title="2">dft<span class="op">$</span>p_mpg_hp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(rs_logit_bi, <span class="dt">newdata =</span> dft, <span class="dt">type =</span> <span class="st">"response"</span>)</a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co"># Predicted Probabilities am on mgp with or without hp binary</span></a>
<a class="sourceLine" id="cb10-5" title="5">scatter &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dft, <span class="kw">aes</span>(<span class="dt">x=</span>p_mpg_hp, <span class="dt">y=</span>p_mpg)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="st">      </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="st">      </span><span class="co"># geom_smooth(method=lm) + # Trend line</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="st">      </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 45 degree line</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Predicted Probabilities '</span>, svr_outcome, <span class="st">' on '</span>, ls_st_xs, <span class="st">' with or without hp binary'</span>),</a>
<a class="sourceLine" id="cb10-10" title="10">           <span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'prediction with '</span>, ls_st_xs, <span class="st">' and binary '</span>, svr_binary, <span class="st">' indicator, 1 is high'</span>),</a>
<a class="sourceLine" id="cb10-11" title="11">           <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'prediction with only '</span>, ls_st_xs),</a>
<a class="sourceLine" id="cb10-12" title="12">           <span class="dt">caption =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(sdt_name, <span class="st">' simulated prediction'</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="st">      </span><span class="kw">theme_bw</span>()</a>
<a class="sourceLine" id="cb10-14" title="14"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(scatter)</a></code></pre></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20with%20binary%20and%20continuous%20RHS-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="prediction-with-binary-set-to-0-and-1" class="section level2">
<h2 class="hasAnchor">
<a href="#prediction-with-binary-set-to-0-and-1" class="anchor"></a>Prediction with Binary set to 0 and 1</h2>
<p>Now generate two predictions. One set where binary input is equal to 0, and another where the binary inputs are equal to 1. Ignore whether in data binary input is equal to 0 or 1. Use the same regression results as what was just derived.</p>
<p>Note that given the example here, the probability changes a lot when we</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># Previous regression results</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(rs_logit_bi)</a></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = emp78 ~ age + I(age^2) + factor(age_m2) + educ + 
##     I(educ^2) + +educ + black + hisp + marr + nodeg + factor(trt) + 
##     factor(age_m2) * factor(trt), family = "binomial", data = dft)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.2947  -1.3211   0.7022   0.8742   1.0683  
## 
## Coefficients:
##                                   Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)                       5.136672   2.466613   2.082  0.03730 * 
## age                              -0.097673   0.121445  -0.804  0.42125   
## I(age^2)                          0.001530   0.001835   0.834  0.40451   
## factor(age_m2)2                  -0.212544   0.378581  -0.561  0.57451   
## educ                             -0.407808   0.424696  -0.960  0.33694   
## I(educ^2)                         0.022208   0.023172   0.958  0.33787   
## black                            -1.175989   0.391371  -3.005  0.00266 **
## hisp                             -0.138633   0.514469  -0.269  0.78757   
## marr                              0.370870   0.249077   1.489  0.13649   
## nodeg                            -0.061847   0.349242  -0.177  0.85944   
## factor(trt)train                  0.446774   0.261424   1.709  0.08745 . 
## factor(age_m2)2:factor(trt)train -0.113232   0.357889  -0.316  0.75171   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 844.33  on 721  degrees of freedom
## Residual deviance: 808.43  on 710  degrees of freedom
## AIC: 832.43
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># Two different dataframes, mutate the binary regressor</span></a>
<a class="sourceLine" id="cb13-2" title="2">dft_bi0 &lt;-<span class="st"> </span>dft <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_binary) <span class="op">:</span><span class="er">=</span><span class="st"> </span>svr_binary_lb0)</a>
<a class="sourceLine" id="cb13-3" title="3">dft_bi1 &lt;-<span class="st"> </span>dft <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="op">!!</span><span class="kw">sym</span>(svr_binary) <span class="op">:</span><span class="er">=</span><span class="st"> </span>svr_binary_lb1)</a>
<a class="sourceLine" id="cb13-4" title="4"></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co"># Predcit Using Regresion Data</span></a>
<a class="sourceLine" id="cb13-6" title="6">dft<span class="op">$</span>p_mpg_hp_bi0 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(rs_logit_bi, <span class="dt">newdata =</span> dft_bi0, <span class="dt">type =</span> <span class="st">"response"</span>)</a>
<a class="sourceLine" id="cb13-7" title="7">dft<span class="op">$</span>p_mpg_hp_bi1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(rs_logit_bi, <span class="dt">newdata =</span> dft_bi1, <span class="dt">type =</span> <span class="st">"response"</span>)</a>
<a class="sourceLine" id="cb13-8" title="8"></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co"># Predicted Probabilities and Binary Input</span></a>
<a class="sourceLine" id="cb13-10" title="10">scatter &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dft, <span class="kw">aes</span>(<span class="dt">x=</span>p_mpg_hp_bi0)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="st">      </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span>p_mpg_hp), <span class="dt">size=</span><span class="dv">4</span>, <span class="dt">shape=</span><span class="dv">4</span>, <span class="dt">color=</span><span class="st">"red"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="st">      </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span>p_mpg_hp_bi1), <span class="dt">size=</span><span class="dv">2</span>, <span class="dt">shape=</span><span class="dv">8</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="st">      </span><span class="co"># geom_smooth(method=lm) + # Trend line</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="st">      </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 45 degree line</span></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Predicted Probabilities and Binary Input'</span>,</a>
<a class="sourceLine" id="cb13-16" title="16">                          <span class="st">'</span><span class="ch">\n</span><span class="st">cross(shape=4)/red is predict actual binary data'</span>,</a>
<a class="sourceLine" id="cb13-17" title="17">                          <span class="st">'</span><span class="ch">\n</span><span class="st">star(shape=8)/black is predict set binary = 1 for all'</span>),</a>
<a class="sourceLine" id="cb13-18" title="18">           <span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'prediction with '</span>, ls_st_xs, <span class="st">' and binary '</span>, svr_binary, <span class="st">' = 0 for all'</span>),</a>
<a class="sourceLine" id="cb13-19" title="19">           <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'prediction with '</span>, ls_st_xs, <span class="st">' and binary '</span>, svr_binary, <span class="st">' = 1'</span>),</a>
<a class="sourceLine" id="cb13-20" title="20">           <span class="dt">caption =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(sdt_name, <span class="st">' simulated prediction'</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-21" title="21"><span class="st">      </span><span class="kw">theme_bw</span>()</a>
<a class="sourceLine" id="cb13-22" title="22"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(scatter)</a></code></pre></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%200%20vs%201-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="generate-and-analyze-a-and-alpha" class="section level1">
<h1 class="hasAnchor">
<a href="#generate-and-analyze-a-and-alpha" class="anchor"></a>Generate and Analyze A and alpha</h1>
<div id="prediction-with-binary-set-to-0-and-1-difference" class="section level2">
<h2 class="hasAnchor">
<a href="#prediction-with-binary-set-to-0-and-1-difference" class="anchor"></a>Prediction with Binary set to 0 and 1 Difference</h2>
<p>What is the difference in probability between binary = 0 vs binary = 1. How does that relate to the probability of outcome of interest when binary = 0 for all.</p>
<p>In the binary logit case, the relationship will be hump–shaped by construction between <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span>. In the exponential wage cases, the relationship is convex upwards.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># Generate Gap Variable</span></a>
<a class="sourceLine" id="cb14-2" title="2">dft &lt;-<span class="st"> </span>dft <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">alpha_i =</span> p_mpg_hp_bi1 <span class="op">-</span><span class="st"> </span>p_mpg_hp_bi0) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">A_i =</span> p_mpg_hp_bi0)</a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5">dft_graph &lt;-<span class="st"> </span>dft</a>
<a class="sourceLine" id="cb14-6" title="6">dft_graph<span class="op">$</span>age_m2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(dft_graph<span class="op">$</span>age_m2, <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Age &lt;= 23'</span>, <span class="st">'Age &gt; 23'</span>))</a>
<a class="sourceLine" id="cb14-7" title="7"></a>
<a class="sourceLine" id="cb14-8" title="8"><span class="co"># Titling</span></a>
<a class="sourceLine" id="cb14-9" title="9">title_line1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Employment A_i and alpha_i (Logit), NSW Training Lalonda (AER, 1986)"</span>)</a>
<a class="sourceLine" id="cb14-10" title="10">title_line2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Individual Specific alpha_i from Nonlinearity"</span>)</a>
<a class="sourceLine" id="cb14-11" title="11"></a>
<a class="sourceLine" id="cb14-12" title="12"><span class="co"># Binary Marginal Effects and Prediction without Binary</span></a>
<a class="sourceLine" id="cb14-13" title="13">scatter &lt;-<span class="st"> </span>dft_graph <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>A_i)) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-14" title="14"><span class="st">      </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span>alpha_i, <span class="dt">color=</span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(age_m2)), <span class="dt">size=</span><span class="dv">4</span>, <span class="dt">shape=</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-15" title="15"><span class="st">      </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 45 degree line</span></a>
<a class="sourceLine" id="cb14-16" title="16"><span class="st">      </span><span class="kw">scale_colour_manual</span>(<span class="dt">values=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#69b3a2"</span>, <span class="st">"#404080"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb14-17" title="17"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(title_line1, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, title_line2),</a>
<a class="sourceLine" id="cb14-18" title="18">           <span class="dt">x =</span> <span class="st">'A_i = Prob of Employment no Training)'</span>,</a>
<a class="sourceLine" id="cb14-19" title="19">           <span class="dt">y =</span> <span class="st">'alpha_i = P(train=1) - P(train=0)'</span>,</a>
<a class="sourceLine" id="cb14-20" title="20">           <span class="dt">caption =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Logit Employment on training. Control for age, educ, race. Age &lt;= 23 or &gt; 23 interaction.'</span>))</a>
<a class="sourceLine" id="cb14-21" title="21"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(scatter)</a></code></pre></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="x-variables-and-a-and-alpha" class="section level2">
<h2 class="hasAnchor">
<a href="#x-variables-and-a-and-alpha" class="anchor"></a>X variables and A and alpha</h2>
<p>Given the x-variables included in the logit regression, how do they relate to A_i and alpha_i</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co"># Generate Gap Variable</span></a>
<a class="sourceLine" id="cb15-2" title="2">dft &lt;-<span class="st"> </span>dft <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">alpha_i =</span> p_mpg_hp_bi1 <span class="op">-</span><span class="st"> </span>p_mpg_hp_bi0) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="st">                </span><span class="kw">mutate</span>(<span class="dt">A_i =</span> p_mpg_hp_bi0)</a>
<a class="sourceLine" id="cb15-4" title="4"></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="co"># Binary Marginal Effects and Prediction without Binary</span></a>
<a class="sourceLine" id="cb15-6" title="6">ggplot.A.alpha.x &lt;-<span class="st"> </span><span class="cf">function</span>(svr_x, df,</a>
<a class="sourceLine" id="cb15-7" title="7">                             <span class="dt">svr_alpha =</span> <span class="st">'alpha_i'</span>, <span class="dt">svr_A =</span> <span class="st">"A_i"</span>){</a>
<a class="sourceLine" id="cb15-8" title="8"></a>
<a class="sourceLine" id="cb15-9" title="9">  scatter &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span><span class="op">!!</span><span class="kw">sym</span>(svr_x))) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="st">        </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span>alpha_i), <span class="dt">size=</span><span class="dv">4</span>, <span class="dt">shape=</span><span class="dv">4</span>, <span class="dt">color=</span><span class="st">"red"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="st">        </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span>A_i), <span class="dt">size=</span><span class="dv">2</span>, <span class="dt">shape=</span><span class="dv">8</span>, <span class="dt">color=</span><span class="st">"blue"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="st">        </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 45 degree line</span></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="st">        </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'A (blue) and alpha (red) vs x variables='</span>, svr_x),</a>
<a class="sourceLine" id="cb15-14" title="14">             <span class="dt">x =</span> svr_x,</a>
<a class="sourceLine" id="cb15-15" title="15">             <span class="dt">y =</span> <span class="st">'Probabilities'</span>,</a>
<a class="sourceLine" id="cb15-16" title="16">             <span class="dt">caption =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(sdt_name, <span class="st">' simulated prediction'</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-17" title="17"><span class="st">        </span><span class="kw">theme_bw</span>()</a>
<a class="sourceLine" id="cb15-18" title="18"></a>
<a class="sourceLine" id="cb15-19" title="19"><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(scatter)</a>
<a class="sourceLine" id="cb15-20" title="20">}</a>
<a class="sourceLine" id="cb15-21" title="21"></a>
<a class="sourceLine" id="cb15-22" title="22"><span class="co"># Plot over multiple</span></a>
<a class="sourceLine" id="cb15-23" title="23"><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(ls_st_xs,</a>
<a class="sourceLine" id="cb15-24" title="24">       ggplot.A.alpha.x,</a>
<a class="sourceLine" id="cb15-25" title="25">       <span class="dt">df =</span> dft)</a></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-1.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-2.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-3.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-4.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-5.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-6.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="optimal-binary-allocation" class="section level1">
<h1 class="hasAnchor">
<a href="#optimal-binary-allocation" class="anchor"></a>Optimal Binary Allocation</h1>
<div id="solve-for-optimal-allocaions-across-preference-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#solve-for-optimal-allocaions-across-preference-parameters" class="anchor"></a>Solve for Optimal Allocaions Across Preference Parameters</h2>
<p>Invoke the binary optimal allocation function <em>ffp_opt_anlyz_rhgin_bin</em> that loops over rhos.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">svr_inpalc &lt;-<span class="st"> 'rank'</span></a>
<a class="sourceLine" id="cb22-2" title="2"></a>
<a class="sourceLine" id="cb22-3" title="3">beta_i &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">/</span><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(dft)[<span class="dv">1</span>], <span class="dt">times=</span><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(dft)[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb22-4" title="4">dft &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(dft, beta_i)</a>
<a class="sourceLine" id="cb22-5" title="5">ar_rho =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">100</span>, <span class="fl">-0.001</span>,  <span class="fl">0.95</span>)</a>
<a class="sourceLine" id="cb22-6" title="6">ar_rho &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">10</span><span class="op">^</span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">2</span>,<span class="dv">2</span>, <span class="dt">length.out=</span><span class="dv">30</span>))))</a>
<a class="sourceLine" id="cb22-7" title="7">ar_rho &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(ar_rho)</a>
<a class="sourceLine" id="cb22-8" title="8"></a>
<a class="sourceLine" id="cb22-9" title="9">svr_rho_val &lt;-<span class="st"> 'rho_val'</span></a>
<a class="sourceLine" id="cb22-10" title="10">ls_bin_solu_all_rhos &lt;-</a>
<a class="sourceLine" id="cb22-11" title="11"><span class="st">  </span><span class="kw"><a href="../reference/ffp_opt_anlyz_rhgin_bin.html">ffp_opt_anlyz_rhgin_bin</a></span>(dft, <span class="dt">svr_id_i =</span> <span class="st">'id'</span>,</a>
<a class="sourceLine" id="cb22-12" title="12">                          <span class="dt">svr_A_i =</span> <span class="st">'A_i'</span>, <span class="dt">svr_alpha_i =</span> <span class="st">'alpha_i'</span>, <span class="dt">svr_beta_i =</span> <span class="st">'beta_i'</span>,</a>
<a class="sourceLine" id="cb22-13" title="13">                          <span class="dt">ar_rho =</span> ar_rho,</a>
<a class="sourceLine" id="cb22-14" title="14">                          <span class="dt">svr_rho =</span> <span class="st">'rho'</span>, <span class="dt">svr_rho_val =</span> svr_rho_val,</a>
<a class="sourceLine" id="cb22-15" title="15">                          <span class="dt">svr_inpalc =</span> svr_inpalc,</a>
<a class="sourceLine" id="cb22-16" title="16">                          <span class="dt">svr_expout =</span> <span class="st">'opti_exp_outcome'</span>,</a>
<a class="sourceLine" id="cb22-17" title="17">                          <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## 'data.frame':    722 obs. of  53 variables:
##  $ id          : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ trt         : Factor w/ 2 levels "ntran","train": 1 1 1 1 1 1 1 1 1 1 ...
##  $ age         : int  23 26 22 34 18 45 18 27 24 34 ...
##  $ educ        : int  10 12 9 9 9 11 9 12 8 11 ...
##  $ black       : int  1 0 1 1 1 1 1 1 0 1 ...
##  $ hisp        : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ marr        : int  0 0 0 0 0 0 0 0 0 1 ...
##  $ nodeg       : int  1 0 1 1 1 1 1 0 1 1 ...
##  $ re74        : num  0 0 0 NA 0 0 0 NA 0 0 ...
##  $ re75        : num  0 0 0 4368 0 ...
##  $ re78        : num  0 12384 0 14051 10740 ...
##  $ emp78       : num  0 1 0 1 1 1 1 1 1 1 ...
##  $ emp75       : num  0 0 0 1 0 0 0 1 0 0 ...
##  $ race        : num  1 0 1 1 1 1 1 1 0 1 ...
##  $ age_m2      : num  1 2 1 2 1 2 1 2 2 2 ...
##  $ age_m3      : num  2 2 2 3 1 3 1 3 2 3 ...
##  $ p_mpg       : num  0.678 0.89 0.688 0.638 0.704 ...
##  $ p_mpg_hp    : num  0.647 0.849 0.65 0.565 0.682 ...
##  $ p_mpg_hp_bi0: num  0.647 0.849 0.65 0.565 0.682 ...
##  $ p_mpg_hp_bi1: num  0.741 0.887 0.744 0.645 0.771 ...
##  $ alpha_i     : num  0.0943 0.0381 0.0938 0.0795 0.0882 ...
##  $ A_i         : num  0.647 0.849 0.65 0.565 0.682 ...
##  $ beta_i      : num  0.00139 0.00139 0.00139 0.00139 0.00139 ...
##  $ rho_c1_rk   : int  2 682 9 260 114 462 114 431 646 503 ...
##  $ rho_c2_rk   : int  2 682 9 260 114 462 114 431 646 503 ...
##  $ rho_c3_rk   : int  2 682 9 260 114 462 114 431 646 503 ...
##  $ rho_c4_rk   : int  2 682 9 260 114 462 114 431 646 503 ...
##  $ rho_c5_rk   : int  2 682 9 256 114 462 114 431 646 503 ...
##  $ rho_c6_rk   : int  2 682 9 256 114 462 114 427 646 503 ...
##  $ rho_c7_rk   : int  2 682 9 256 114 462 114 427 646 503 ...
##  $ rho_c8_rk   : int  2 682 9 256 114 462 114 427 646 501 ...
##  $ rho_c9_rk   : int  2 681 9 245 114 462 114 427 646 501 ...
##  $ rho_c10_rk  : int  2 681 9 243 114 461 114 425 646 501 ...
##  $ rho_c11_rk  : int  2 681 9 233 114 457 114 425 646 501 ...
##  $ rho_c12_rk  : int  2 680 9 226 114 455 114 422 646 500 ...
##  $ rho_c13_rk  : int  2 679 9 173 114 455 114 417 644 500 ...
##  $ rho_c14_rk  : int  2 679 9 100 132 451 132 408 641 499 ...
##  $ rho_c15_rk  : int  2 677 9 54 203 442 203 396 636 494 ...
##  $ rho_c16_rk  : int  2 675 12 11 239 427 239 384 632 490 ...
##  $ rho_c17_rk  : int  46 673 77 3 253 414 253 325 624 484 ...
##  $ rho_c18_rk  : int  113 670 122 3 273 366 273 252 616 476 ...
##  $ rho_c19_rk  : int  136 667 144 3 300 298 300 216 613 458 ...
##  $ rho_c20_rk  : int  141 664 152 3 301 256 301 183 604 438 ...
##  $ rho_c21_rk  : int  156 661 168 3 315 226 315 163 600 393 ...
##  $ rho_c22_rk  : int  167 649 177 3 333 207 333 155 599 353 ...
##  $ rho_c23_rk  : int  179 640 186 3 355 200 355 155 597 320 ...
##  $ rho_c24_rk  : int  179 632 195 3 362 193 362 155 597 309 ...
##  $ rho_c25_rk  : int  188 629 195 3 367 186 367 155 597 296 ...
##  $ rho_c26_rk  : int  188 620 195 3 367 186 367 155 597 294 ...
##  $ rho_c27_rk  : int  188 620 195 3 367 186 367 155 597 294 ...
##  $ rho_c28_rk  : int  188 620 195 3 367 185 367 155 597 294 ...
##  $ rho_c29_rk  : int  188 620 195 3 367 185 367 155 597 294 ...
##  $ rho_c30_rk  : int  188 620 195 3 367 185 367 155 597 294 ...</code></pre>
<pre><code>## Joining, by = "id"</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">df_all_rho &lt;-<span class="st"> </span>ls_bin_solu_all_rhos<span class="op">$</span>df_all_rho</a>
<a class="sourceLine" id="cb25-2" title="2">df_all_rho_long &lt;-<span class="st"> </span>ls_bin_solu_all_rhos<span class="op">$</span>df_all_rho_long</a>
<a class="sourceLine" id="cb25-3" title="3"></a>
<a class="sourceLine" id="cb25-4" title="4"><span class="co"># How many people have different ranks across rhos</span></a>
<a class="sourceLine" id="cb25-5" title="5">it_how_many_vary_rank &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(df_all_rho<span class="op">$</span>rank_max <span class="op">-</span><span class="st"> </span>df_all_rho<span class="op">$</span>rank_min)</a>
<a class="sourceLine" id="cb25-6" title="6">it_how_many_vary_rank</a></code></pre></div>
<pre><code>## [1] -136966</code></pre>
</div>
<div id="change-in-rank-along-rho" class="section level2">
<h2 class="hasAnchor">
<a href="#change-in-rank-along-rho" class="anchor"></a>Change in Rank along rho</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="co"># get rank when wage rho = 1</span></a>
<a class="sourceLine" id="cb27-2" title="2">df_all_rho_rho_c1 &lt;-<span class="st"> </span>df_all_rho <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(id, rho_c1_rk)</a>
<a class="sourceLine" id="cb27-3" title="3"><span class="co"># Merge</span></a>
<a class="sourceLine" id="cb27-4" title="4">df_all_rho_long &lt;-<span class="st"> </span>df_all_rho_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">rho =</span> <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(rho)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-5" title="5"><span class="st">                      </span><span class="kw">left_join</span>(df_all_rho_rho_c1, <span class="dt">by=</span><span class="st">'id'</span>)</a>
<a class="sourceLine" id="cb27-6" title="6"><span class="co"># Select subset to graph</span></a>
<a class="sourceLine" id="cb27-7" title="7">df_rank_graph &lt;-<span class="st"> </span>df_all_rho_long <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-8" title="8"><span class="st">                    </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(id)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-9" title="9"><span class="st">                    </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>((id <span class="op">==</span><span class="st"> </span><span class="dv">2221</span>) <span class="op">|</span><span class="st">  </span><span class="co"># utilitarian rank = 1</span></a>
<a class="sourceLine" id="cb27-10" title="10"><span class="st">                           </span>(id <span class="op">==</span><span class="st"> </span><span class="dv">58</span>) <span class="op">|</span><span class="st">  </span><span class="co"># utilitarian rank = 101</span></a>
<a class="sourceLine" id="cb27-11" title="11"><span class="st">                           </span>(id <span class="op">==</span><span class="st"> </span><span class="dv">710</span>)  <span class="op">|</span><span class="st">  </span><span class="co"># utilitarian rank = 201</span></a>
<a class="sourceLine" id="cb27-12" title="12"><span class="st">                           </span>(id <span class="op">==</span><span class="st"> </span><span class="dv">57</span>) <span class="op">|</span><span class="st">  </span><span class="co"># utilitarian rank = 301</span></a>
<a class="sourceLine" id="cb27-13" title="13"><span class="st">                           </span>(id <span class="op">==</span><span class="st"> </span><span class="dv">74</span>)<span class="op">|</span><span class="st">  </span><span class="co"># utilitarian rank = 401</span></a>
<a class="sourceLine" id="cb27-14" title="14"><span class="st">                           </span>(id <span class="op">==</span><span class="st"> </span><span class="dv">248</span>) <span class="op">|</span><span class="st">  </span><span class="co"># utilitarian rank = 501</span></a>
<a class="sourceLine" id="cb27-15" title="15"><span class="st">                           </span>(id <span class="op">==</span><span class="st"> </span><span class="dv">206</span>) <span class="op">|</span><span class="st">  </span><span class="co"># utilitarian rank = 601</span></a>
<a class="sourceLine" id="cb27-16" title="16"><span class="st">                           </span>(id <span class="op">==</span><span class="st"> </span><span class="dv">272</span>)   <span class="co"># utilitarian rank = 701</span></a>
<a class="sourceLine" id="cb27-17" title="17">                             ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-18" title="18"><span class="st">                    </span><span class="kw">mutate</span>(<span class="dt">one_minus_rho =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="op">!!</span><span class="kw">sym</span>(svr_rho_val)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-19" title="19"><span class="st">                    </span><span class="kw">mutate</span>(<span class="dt">rho_c1_rk =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(rho_c1_rk))</a>
<a class="sourceLine" id="cb27-20" title="20"></a>
<a class="sourceLine" id="cb27-21" title="21">df_rank_graph<span class="op">$</span>rho_c1_rk</a></code></pre></div>
<pre><code>##   [1] 298 298 298 298 298 298 298 298 298 298 298 298 298 298 298 298 298 298
##  [19] 298 298 298 298 298 298 298 298 298 298 298 298 101 101 101 101 101 101
##  [37] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
##  [55] 101 101 101 101 101 101 396 396 396 396 396 396 396 396 396 396 396 396
##  [73] 396 396 396 396 396 396 396 396 396 396 396 396 396 396 396 396 396 396
##  [91] 599 599 599 599 599 599 599 599 599 599 599 599 599 599 599 599 599 599
## [109] 599 599 599 599 599 599 599 599 599 599 599 599 500 500 500 500 500 500
## [127] 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500
## [145] 500 500 500 500 500 500 701 701 701 701 701 701 701 701 701 701 701 701
## [163] 701 701 701 701 701 701 701 701 701 701 701 701 701 701 701 701 701 701
## [181] 197 197 197 197 197 197 197 197 197 197 197 197 197 197 197 197 197 197
## [199] 197 197 197 197 197 197 197 197 197 197 197 197 1   1   1   1   1   1  
## [217] 1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1  
## [235] 1   1   1   1   1   1  
## Levels: 1 101 197 298 396 500 599 701</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">df_rank_graph<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(df_rank_graph<span class="op">$</span>rho_c1_rk,</a>
<a class="sourceLine" id="cb29-2" title="2">                           <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Rank= 1 when λ=0.99'</span>, <span class="co">#200</span></a>
<a class="sourceLine" id="cb29-3" title="3">                                      <span class="st">'Rank= 101 when λ=0.99'</span>, <span class="co">#110</span></a>
<a class="sourceLine" id="cb29-4" title="4">                                      <span class="st">'Rank= 201 when λ=0.99'</span>, <span class="co">#95</span></a>
<a class="sourceLine" id="cb29-5" title="5">                                      <span class="st">'Rank= 301 when λ=0.99'</span>, <span class="co">#217</span></a>
<a class="sourceLine" id="cb29-6" title="6">                                      <span class="st">'Rank= 401 when λ=0.99'</span>, <span class="co">#274</span></a>
<a class="sourceLine" id="cb29-7" title="7">                                      <span class="st">'Rank= 501 when λ=0.99'</span>, <span class="co">#101</span></a>
<a class="sourceLine" id="cb29-8" title="8">                                      <span class="st">'Rank= 601 when λ=0.99'</span>, <span class="co">#131</span></a>
<a class="sourceLine" id="cb29-9" title="9">                                      <span class="st">'Rank= 701 when λ=0.99'</span> <span class="co">#3610</span></a>
<a class="sourceLine" id="cb29-10" title="10">                                       ))</a>
<a class="sourceLine" id="cb29-11" title="11"></a>
<a class="sourceLine" id="cb29-12" title="12"><span class="co"># x-labels</span></a>
<a class="sourceLine" id="cb29-13" title="13">x.labels &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'λ=0.99'</span>, <span class="st">'λ=0.90'</span>, <span class="st">'λ=0'</span>, <span class="st">'λ=-10'</span>, <span class="st">'λ=-100'</span>)</a>
<a class="sourceLine" id="cb29-14" title="14">x.breaks &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.01</span>, <span class="fl">0.10</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb29-15" title="15"></a>
<a class="sourceLine" id="cb29-16" title="16"><span class="co"># title line 2</span></a>
<a class="sourceLine" id="cb29-17" title="17">title_line1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"EMPLOY LOGIT: Optimal Tageting Queue, NSW Lalonda (AER, 1986)"</span>)</a>
<a class="sourceLine" id="cb29-18" title="18">title_line2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"How Do Allocation Rankings (Targeting Queue) Shift with λ?"</span>)</a>
<a class="sourceLine" id="cb29-19" title="19"></a>
<a class="sourceLine" id="cb29-20" title="20"><span class="co"># Graph Results--Draw</span></a>
<a class="sourceLine" id="cb29-21" title="21">line.plot &lt;-<span class="st"> </span>df_rank_graph <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb29-22" title="22"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>one_minus_rho, <span class="dt">y=</span><span class="op">!!</span><span class="kw">sym</span>(svr_inpalc),</a>
<a class="sourceLine" id="cb29-23" title="23">             <span class="dt">group=</span><span class="kw">fct_rev</span>(id),</a>
<a class="sourceLine" id="cb29-24" title="24">             <span class="dt">colour=</span><span class="kw">fct_rev</span>(id), <span class="dt">size=</span><span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-25" title="25"><span class="st">  </span><span class="co"># geom_line(aes(linetype =fct_rev(id)), size=0.75) +</span></a>
<a class="sourceLine" id="cb29-26" title="26"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="fl">0.75</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-27" title="27"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>), <span class="dt">linetype=</span><span class="st">"dotted"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-28" title="28"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(title_line1, <span class="st">'</span><span class="ch">\n</span><span class="st">'</span>, title_line2),</a>
<a class="sourceLine" id="cb29-29" title="29">       <span class="dt">x =</span> <span class="st">'log10 Rescale of λ, Log10(λ)</span><span class="ch">\n</span><span class="st">λ=1 Utilitarian, λ=-infty Rawlsian'</span>,</a>
<a class="sourceLine" id="cb29-30" title="30">       <span class="dt">y =</span> <span class="st">'Optimal Targeting Queue Rank (1=highest)'</span>,</a>
<a class="sourceLine" id="cb29-31" title="31">       <span class="dt">caption =</span> <span class="st">'Training RCT with 297 treated, 425 untreated. Optimal Binary Targeting Queue.'</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-32" title="32"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">trans=</span><span class="st">'log10'</span>, <span class="dt">labels =</span> x.labels, <span class="dt">breaks =</span> x.breaks) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-33" title="33"><span class="st">  </span><span class="kw">theme_bw</span>()</a>
<a class="sourceLine" id="cb29-34" title="34"></a>
<a class="sourceLine" id="cb29-35" title="35"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(line.plot)</a></code></pre></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/graph%20of%20rank%20change-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="save-results" class="section level2">
<h2 class="hasAnchor">
<a href="#save-results" class="anchor"></a>Save Results</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1"><span class="co"># Change Variable names so that this can becombined with logit file later</span></a>
<a class="sourceLine" id="cb30-2" title="2">df_all_rho &lt;-<span class="st"> </span>df_all_rho <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename_at</span>(<span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">"rho_"</span>)), <span class="kw">funs</span>(<span class="kw">str_replace</span>(., <span class="st">"rk"</span>, <span class="st">"rk_employ"</span>)))</a></code></pre></div>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once per session.</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">df_all_rho &lt;-<span class="st"> </span>df_all_rho <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-2" title="2"><span class="st">        </span><span class="kw">rename</span>(<span class="dt">A_i_employ =</span> A_i, <span class="dt">alpha_i_employ =</span> alpha_i, <span class="dt">beta_i_employ =</span> beta_i,</a>
<a class="sourceLine" id="cb32-3" title="3">               <span class="dt">rank_min_employ =</span> rank_min, <span class="dt">rank_max_employ =</span> rank_max, <span class="dt">avg_rank_employ =</span> avg_rank)</a>
<a class="sourceLine" id="cb32-4" title="4"></a>
<a class="sourceLine" id="cb32-5" title="5"><span class="co"># Save File</span></a>
<a class="sourceLine" id="cb32-6" title="6">df_opt_lalonde_training_employ &lt;-<span class="st"> </span>df_all_rho</a>
<a class="sourceLine" id="cb32-7" title="7">usethis<span class="op">::</span><span class="kw"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span>(df_opt_lalonde_training_employ, df_opt_lalonde_training_employ, <span class="dt">overwrite =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## &lt;U+2714&gt; Setting active project to 'C:/Users/fan/PrjOptiAlloc'</code></pre>
<pre><code>## Warning: Saving duplicates only once: 'df_opt_lalonde_training_employ'</code></pre>
<pre><code>## &lt;U+2714&gt; Saving 'df_opt_lalonde_training_employ' to 'data/df_opt_lalonde_training_employ.rda'</code></pre>
</div>
<div id="binary-marginal-effects-and-prediction-without-binary" class="section level2">
<h2 class="hasAnchor">
<a href="#binary-marginal-effects-and-prediction-without-binary" class="anchor"></a>Binary Marginal Effects and Prediction without Binary</h2>
<p>What is the relationship between ranking,</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="co"># ggplot.A.alpha.x &lt;- function(svr_x, df,</span></a>
<a class="sourceLine" id="cb36-2" title="2"><span class="co">#                              svr_alpha = 'alpha_i', svr_A = "A_i"){</span></a>
<a class="sourceLine" id="cb36-3" title="3"><span class="co">#</span></a>
<a class="sourceLine" id="cb36-4" title="4"><span class="co">#   scatter &lt;- ggplot(df, aes(x=!!sym(svr_x))) +</span></a>
<a class="sourceLine" id="cb36-5" title="5"><span class="co">#         geom_point(aes(y=alpha_i), size=4, shape=4, color="red") +</span></a>
<a class="sourceLine" id="cb36-6" title="6"><span class="co">#         geom_point(aes(y=A_i), size=2, shape=8, color="blue") +</span></a>
<a class="sourceLine" id="cb36-7" title="7"><span class="co">#         geom_abline(intercept = 0, slope = 1) + # 45 degree line</span></a>
<a class="sourceLine" id="cb36-8" title="8"><span class="co">#         labs(title = paste0('A (blue) and alpha (red) vs x variables=', svr_x),</span></a>
<a class="sourceLine" id="cb36-9" title="9"><span class="co">#              x = svr_x,</span></a>
<a class="sourceLine" id="cb36-10" title="10"><span class="co">#              y = 'Probabilities',</span></a>
<a class="sourceLine" id="cb36-11" title="11"><span class="co">#              caption = paste0(sdt_name, ' simulated prediction')) +</span></a>
<a class="sourceLine" id="cb36-12" title="12"><span class="co">#         theme_bw()</span></a>
<a class="sourceLine" id="cb36-13" title="13"><span class="co">#</span></a>
<a class="sourceLine" id="cb36-14" title="14"><span class="co"># return(scatter)</span></a>
<a class="sourceLine" id="cb36-15" title="15"><span class="co"># }</span></a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#objective">Objective</a><ul class="nav nav-pills nav-stacked">
<li><a href="#set-up">Set Up</a></li>
      <li><a href="#get-data">Get Data</a></li>
      </ul>
</li>
      <li>
<a href="#logit-regression">Logit Regression</a><ul class="nav nav-pills nav-stacked">
<li><a href="#prediction-with-observed-binary-input">Prediction with Observed Binary Input</a></li>
      <li><a href="#prediction-with-binary-set-to-0-and-1">Prediction with Binary set to 0 and 1</a></li>
      </ul>
</li>
      <li>
<a href="#generate-and-analyze-a-and-alpha">Generate and Analyze A and alpha</a><ul class="nav nav-pills nav-stacked">
<li><a href="#prediction-with-binary-set-to-0-and-1-difference">Prediction with Binary set to 0 and 1 Difference</a></li>
      <li><a href="#x-variables-and-a-and-alpha">X variables and A and alpha</a></li>
      </ul>
</li>
      <li>
<a href="#optimal-binary-allocation">Optimal Binary Allocation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#solve-for-optimal-allocaions-across-preference-parameters">Solve for Optimal Allocaions Across Preference Parameters</a></li>
      <li><a href="#change-in-rank-along-rho">Change in Rank along rho</a></li>
      <li><a href="#save-results">Save Results</a></li>
      <li><a href="#binary-marginal-effects-and-prediction-without-binary">Binary Marginal Effects and Prediction without Binary</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Fan Wang.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
