<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Logit Employment Binary Allocation Lalonde Training Example • Optimal Allocation</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Logit Employment Binary Allocation Lalonde Training Example">
<meta property="og:description" content="Logit employment regression estimation of A and alpha from the Lalonde Training Dataset (722 Observations).
Solve for optimal binary allocation queues.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92953468-10"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-92953468-10');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Optimal Allocation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/PrjOptiAlloc.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Tutorials</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue.pdf">Paper</a>
</li>
<li>
  <a href="https://fanwangecon.github.io/assets/FanWang_OptimalTargetingQueue_Present.pdf">Slides</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Sites
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://fanwangecon.github.io/REconTools/">R Tools for Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/R4Econ/">R Examples Data and Optimization</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stat4Econ/">R Examples Introductory Statistics</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Stata4Econ/">Stata Examples Regressions and Tables</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/M4Econ/">Matlab Examples Matrix and Graphs</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Math4Econ/">Matlab Introductory Math for Econ</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/Tex4Econ/">Latex and Paper Generation Examples</a>
    </li>
    <li>
      <a href="https://fanwangecon.github.io/pyfan/">Python Examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://fanwangecon.github.io/">Fan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fanwangecon/PrjOptiAlloc">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/fanwangecon">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ffv_opt_sobin_rkone_allfc_training_logit_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Logit Employment Binary Allocation Lalonde Training Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/FanWangEcon/PrjOptiAlloc/blob/master/vignettes/ffv_opt_sobin_rkone_allfc_training_logit.Rmd"><code>vignettes/ffv_opt_sobin_rkone_allfc_training_logit.Rmd</code></a></small>
      <div class="hidden name"><code>ffv_opt_sobin_rkone_allfc_training_logit.Rmd</code></div>

    </div>

    
    
<p>Example using the Lalonde Training Dataset. Estimate A and alpha from logit regression. Solve for optimal binary allocation queues. There are 722 observations, 297 in the treatment group, 425 in the control group.</p>
<p><strong>Objective One</strong>:</p>
<p>estimate a logit regression using the <a href="https://fanwangecon.github.io/PrjOptiAlloc/reference/df_opt_lalonde_training.html">Lalonde (1986)</a> dataset. Include age, education, and race as controls.</p>
<p><strong>Generate and Analyze <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span></strong></p>
<ol style="list-style-type: decimal">
<li>Generate and show how to generate <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span> in the binary allocation Space</li>
<li>What is the correlation between <span class="math inline">\(A\)</span> and <span class="math inline">\(\alpha\)</span>
</li>
<li>What is the relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(A\)</span> and <span class="math inline">\(\alpha\)</span>, when there is one x covariate, when there are multiple?</li>
</ol>
<p><strong>Solve for Optimal Allocations</strong></p>
<p>Uses the binary allocation function as well as the planner iterator to solve for optimal binary targeting queue. These queue tell the planner, given the planner’s preferences, who should optimally receive allocations.</p>
<div id="set-up" class="section level2">
<h2 class="hasAnchor">
<a href="#set-up" class="anchor"></a>Set Up</h2>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># dev.off(dev.list()["RStudioGD"])</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="kw">list</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span>(<span class="kw">all.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>))
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span>(<span class="kw">knitr.duplicate.label</span> <span class="kw">=</span> <span class="st">'allow'</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">forcats</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">stringr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">broom</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">REconTools</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">PrjOptiAlloc</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">knitr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">kableExtra</span>)

<span class="no">bl_save_rda</span> <span class="kw">=</span> <span class="fl">FALSE</span>
<span class="no">bl_save_img</span> <span class="kw">=</span> <span class="fl">FALSE</span></pre></body></html></div>
</div>
<div id="get-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-data" class="anchor"></a>Get Data</h2>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">spt_img_save</span> <span class="kw">&lt;-</span> <span class="st">'../_img/'</span>
<span class="no">spt_img_save_draft</span> <span class="kw">&lt;-</span> <span class="st">'C:/Users/fan/Documents/Dropbox (UH-ECON)/repos/HgtOptiAlloDraft/_img/'</span></pre></body></html></div>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Dataset</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">df_opt_lalonde_training</span>)

<span class="co"># Add a binary variable for if there are wage in year 1975</span>
<span class="no">dft</span> <span class="kw">&lt;-</span> <span class="no">df_opt_lalonde_training</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">re75_zero</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">re75</span> <span class="kw">==</span> <span class="fl">0</span> ~ <span class="fl">1</span>, <span class="no">re75</span> <span class="kw">!=</span> <span class="fl">0</span> ~ <span class="fl">0</span>))

<span class="co"># dft stands for dataframe training</span>
<span class="no">dft</span> <span class="kw">&lt;-</span> <span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="no">X</span>) <span class="kw">%&gt;%</span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">X</span>) <span class="kw">%&gt;%</span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">everything</a></span>()) <span class="kw">%&gt;%</span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">emp78</span> <span class="kw">=</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">re78</span> <span class="kw">&lt;=</span> <span class="fl">0</span> ~ <span class="fl">0</span>,
                              <span class="fl">TRUE</span> ~ <span class="fl">1</span>)) <span class="kw">%&gt;%</span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">emp75</span> <span class="kw">=</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">re75</span> <span class="kw">&lt;=</span> <span class="fl">0</span> ~ <span class="fl">0</span>,
                              <span class="fl">TRUE</span> ~ <span class="fl">1</span>))

<span class="co"># Generate combine black + hispanic status</span>
<span class="co"># 0 = white, 1 = black, 2 = hispanics</span>
<span class="no">dft</span> <span class="kw">&lt;-</span> <span class="no">dft</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">race</span> <span class="kw">=</span>
             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">black</span> <span class="kw">==</span> <span class="fl">1</span> ~ <span class="fl">1</span>,
                       <span class="no">hisp</span> <span class="kw">==</span> <span class="fl">1</span> ~ <span class="fl">2</span>,
                       <span class="fl">TRUE</span> ~ <span class="fl">0</span>))

<span class="no">dft</span> <span class="kw">&lt;-</span> <span class="no">dft</span> <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">age_m2</span> <span class="kw">=</span>
             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">age</span> <span class="kw">&lt;=</span> <span class="fl">23</span> ~ <span class="fl">1</span>,
                       <span class="no">age</span> <span class="kw">&gt;</span>  <span class="fl">23</span>~ <span class="fl">2</span>)) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">age_m3</span> <span class="kw">=</span>
             <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(<span class="no">age</span> <span class="kw">&lt;=</span> <span class="fl">20</span> ~ <span class="fl">1</span>,
                       <span class="no">age</span> <span class="kw">&gt;</span> <span class="fl">20</span> <span class="kw">&amp;</span> <span class="no">age</span> <span class="kw">&lt;=</span> <span class="fl">26</span> ~ <span class="fl">2</span>,
                       <span class="no">age</span> <span class="kw">&gt;</span> <span class="fl">26</span> ~ <span class="fl">3</span>))

<span class="no">dft</span>$<span class="no">trt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">dft</span>$<span class="no">trt</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>,<span class="fl">1</span>), <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ntran"</span>, <span class="st">"train"</span>))

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">dft</span>)</pre></body></html></div>
<pre><code>##        id            trt           age             educ           black       
##  Min.   :   1.0   ntran:425   Min.   :17.00   Min.   : 3.00   Min.   :0.0000  
##  1st Qu.: 181.2   train:297   1st Qu.:19.00   1st Qu.: 9.00   1st Qu.:1.0000  
##  Median : 361.5               Median :23.00   Median :10.00   Median :1.0000  
##  Mean   : 854.4               Mean   :24.52   Mean   :10.27   Mean   :0.8006  
##  3rd Qu.:1458.5               3rd Qu.:27.00   3rd Qu.:11.00   3rd Qu.:1.0000  
##  Max.   :4110.0               Max.   :55.00   Max.   :16.00   Max.   :1.0000  
##                                                                               
##       hisp             marr           nodeg             re74        
##  Min.   :0.0000   Min.   :0.000   Min.   :0.0000   Min.   :    0.0  
##  1st Qu.:0.0000   1st Qu.:0.000   1st Qu.:1.0000   1st Qu.:    0.0  
##  Median :0.0000   Median :0.000   Median :1.0000   Median :    0.0  
##  Mean   :0.1053   Mean   :0.162   Mean   :0.7798   Mean   : 2102.3  
##  3rd Qu.:0.0000   3rd Qu.:0.000   3rd Qu.:1.0000   3rd Qu.:  824.4  
##  Max.   :1.0000   Max.   :1.000   Max.   :1.0000   Max.   :39570.7  
##                                                    NA's   :277      
##       re75              re78         re75_zero          emp78       
##  Min.   :    0.0   Min.   :    0   Min.   :0.0000   Min.   :0.0000  
##  1st Qu.:    0.0   1st Qu.:    0   1st Qu.:0.0000   1st Qu.:0.0000  
##  Median :  936.3   Median : 3952   Median :0.0000   Median :1.0000  
##  Mean   : 3042.9   Mean   : 5455   Mean   :0.4003   Mean   :0.7285  
##  3rd Qu.: 3993.2   3rd Qu.: 8772   3rd Qu.:1.0000   3rd Qu.:1.0000  
##  Max.   :37431.7   Max.   :60308   Max.   :1.0000   Max.   :1.0000  
##                                                                     
##      emp75             race           age_m2          age_m3     
##  Min.   :0.0000   Min.   :0.000   Min.   :1.000   Min.   :1.000  
##  1st Qu.:0.0000   1st Qu.:1.000   1st Qu.:1.000   1st Qu.:1.000  
##  Median :1.0000   Median :1.000   Median :1.000   Median :2.000  
##  Mean   :0.5997   Mean   :1.011   Mean   :1.486   Mean   :1.965  
##  3rd Qu.:1.0000   3rd Qu.:1.000   3rd Qu.:2.000   3rd Qu.:3.000  
##  Max.   :1.0000   Max.   :2.000   Max.   :2.000   Max.   :3.000  
## </code></pre>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># X-variables to use on RHS</span>
<span class="no">ls_st_xs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'age'</span>, <span class="st">'educ'</span>,
              <span class="st">'black'</span>,<span class="st">'hisp'</span>,<span class="st">'marr'</span>, <span class="st">'nodeg'</span>)
<span class="no">svr_binary</span> <span class="kw">&lt;-</span> <span class="st">'trt'</span>
<span class="no">svr_binary_lb0</span> <span class="kw">&lt;-</span> <span class="st">'ntran'</span>
<span class="no">svr_binary_lb1</span> <span class="kw">&lt;-</span> <span class="st">'train'</span>
<span class="no">svr_outcome</span> <span class="kw">&lt;-</span> <span class="st">'emp78'</span>
<span class="no">sdt_name</span> <span class="kw">&lt;-</span> <span class="st">'NSW Lalonde Training'</span></pre></body></html></div>
</div>
<div id="logit-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#logit-regression" class="anchor"></a>Logit Regression</h2>
<div id="prediction-with-observed-binary-input" class="section level3">
<h3 class="hasAnchor">
<a href="#prediction-with-observed-binary-input" class="anchor"></a>Prediction with Observed Binary Input</h3>
<p>Logit regression with a continuous variable and a binary variable. Predict outcome with observed continuous variable as well as observed binary input variable.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Regress No bivariate</span>
<span class="no">rs_logit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">svr_outcome</span>,
                                 <span class="st">"~"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">ls_st_xs</span>, <span class="kw">collapse</span><span class="kw">=</span><span class="st">"+"</span>)))
                ,<span class="kw">data</span> <span class="kw">=</span> <span class="no">dft</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="st">"binomial"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">rs_logit</span>)</pre></body></html></div>
<pre><code>## 
## Call:
## glm(formula = as.formula(paste(svr_outcome, "~", paste(ls_st_xs, 
##     collapse = "+"))), family = "binomial", data = dft)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.2075  -1.4253   0.7851   0.8571   1.1189  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)  2.90493    0.99594   2.917  0.00354 **
## age         -0.01870    0.01295  -1.445  0.14855   
## educ        -0.02754    0.06653  -0.414  0.67896   
## black       -1.16273    0.38941  -2.986  0.00283 **
## hisp        -0.12130    0.51185  -0.237  0.81267   
## marr         0.30300    0.24551   1.234  0.21714   
## nodeg       -0.29036    0.27833  -1.043  0.29684   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 844.33  on 721  degrees of freedom
## Residual deviance: 818.46  on 715  degrees of freedom
## AIC: 832.46
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">dft</span>$<span class="no">p_mpg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">rs_logit</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">dft</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"response"</span>)

<span class="co"># Regress with bivariate</span>
<span class="co"># rs_logit_bi &lt;- glm(as.formula(paste(svr_outcome,</span>
<span class="co">#                                     "~ factor(", svr_binary,") + ",</span>
<span class="co">#                                     paste(ls_st_xs, collapse="+")))</span>
<span class="co">#                    , data = dft, family = "binomial")</span>
<span class="no">rs_logit_bi</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(<span class="no">emp78</span> ~
                     <span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">age</span>^<span class="fl">2</span>) + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">age_m2</span>)
                   + <span class="no">educ</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">educ</span>^<span class="fl">2</span>) +
                   + <span class="no">educ</span> + <span class="no">black</span> + <span class="no">hisp</span> + <span class="no">marr</span> + <span class="no">nodeg</span>
                   + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">re75_zero</span>) +
                   + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">trt</span>)
                   + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">age_m2</span>)*<span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">trt</span>)
                   , <span class="kw">data</span> <span class="kw">=</span> <span class="no">dft</span>, <span class="kw">family</span> <span class="kw">=</span> <span class="st">"binomial"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">rs_logit_bi</span>)</pre></body></html></div>
<pre><code>## 
## Call:
## glm(formula = emp78 ~ age + I(age^2) + factor(age_m2) + educ + 
##     I(educ^2) + +educ + black + hisp + marr + nodeg + factor(re75_zero) + 
##     +factor(trt) + factor(age_m2) * factor(trt), family = "binomial", 
##     data = dft)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.3314  -1.2633   0.6740   0.8411   1.1460  
## 
## Coefficients:
##                                   Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)                       5.751196   2.506147   2.295  0.02174 * 
## age                              -0.112096   0.122321  -0.916  0.35945   
## I(age^2)                          0.001796   0.001853   0.969  0.33246   
## factor(age_m2)2                  -0.171237   0.379441  -0.451  0.65178   
## educ                             -0.464884   0.427172  -1.088  0.27647   
## I(educ^2)                         0.024604   0.023252   1.058  0.29000   
## black                            -1.129512   0.392581  -2.877  0.00401 **
## hisp                             -0.115414   0.515851  -0.224  0.82296   
## marr                              0.333527   0.250470   1.332  0.18299   
## nodeg                            -0.050435   0.350041  -0.144  0.88543   
## factor(re75_zero)1               -0.387920   0.177229  -2.189  0.02861 * 
## factor(trt)train                  0.413494   0.262722   1.574  0.11551   
## factor(age_m2)2:factor(trt)train -0.074633   0.359556  -0.208  0.83557   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 844.33  on 721  degrees of freedom
## Residual deviance: 803.66  on 709  degrees of freedom
## AIC: 829.66
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="co"># Predcit Using Regresion Data</span>
<span class="no">dft</span>$<span class="no">p_mpg_hp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">rs_logit_bi</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">dft</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"response"</span>)

<span class="co"># Predicted Probabilities am on mgp with or without hp binary</span>
<span class="no">scatter</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">dft</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">p_mpg_hp</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">p_mpg</span>)) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">1</span>) +
      <span class="co"># geom_smooth(method=lm) + # Trend line</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">intercept</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">slope</span> <span class="kw">=</span> <span class="fl">1</span>) + <span class="co"># 45 degree line</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Predicted Probabilities '</span>, <span class="no">svr_outcome</span>, <span class="st">' on '</span>, <span class="no">ls_st_xs</span>, <span class="st">' with or without hp binary'</span>),
           <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'prediction with '</span>, <span class="no">ls_st_xs</span>, <span class="st">' and binary '</span>, <span class="no">svr_binary</span>, <span class="st">' indicator, 1 is high'</span>),
           <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'prediction with only '</span>, <span class="no">ls_st_xs</span>),
           <span class="kw">caption</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">sdt_name</span>, <span class="st">' simulated prediction'</span>)) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">scatter</span>)</pre></body></html></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20with%20binary%20and%20continuous%20RHS-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="prediction-with-binary-set-to-0-and-1" class="section level3">
<h3 class="hasAnchor">
<a href="#prediction-with-binary-set-to-0-and-1" class="anchor"></a>Prediction with Binary set to 0 and 1</h3>
<p>Now generate two predictions. One set where binary input is equal to 0, and another where the binary inputs are equal to 1. Ignore whether in data binary input is equal to 0 or 1. Use the same regression results as what was just derived.</p>
<p>Note that given the example here, the probability changes a lot when we</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="co"># Previous regression results</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">rs_logit_bi</span>)</pre></body></html></div>
<pre><code>## 
## Call:
## glm(formula = emp78 ~ age + I(age^2) + factor(age_m2) + educ + 
##     I(educ^2) + +educ + black + hisp + marr + nodeg + factor(re75_zero) + 
##     +factor(trt) + factor(age_m2) * factor(trt), family = "binomial", 
##     data = dft)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.3314  -1.2633   0.6740   0.8411   1.1460  
## 
## Coefficients:
##                                   Estimate Std. Error z value Pr(&gt;|z|)   
## (Intercept)                       5.751196   2.506147   2.295  0.02174 * 
## age                              -0.112096   0.122321  -0.916  0.35945   
## I(age^2)                          0.001796   0.001853   0.969  0.33246   
## factor(age_m2)2                  -0.171237   0.379441  -0.451  0.65178   
## educ                             -0.464884   0.427172  -1.088  0.27647   
## I(educ^2)                         0.024604   0.023252   1.058  0.29000   
## black                            -1.129512   0.392581  -2.877  0.00401 **
## hisp                             -0.115414   0.515851  -0.224  0.82296   
## marr                              0.333527   0.250470   1.332  0.18299   
## nodeg                            -0.050435   0.350041  -0.144  0.88543   
## factor(re75_zero)1               -0.387920   0.177229  -2.189  0.02861 * 
## factor(trt)train                  0.413494   0.262722   1.574  0.11551   
## factor(age_m2)2:factor(trt)train -0.074633   0.359556  -0.208  0.83557   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 844.33  on 721  degrees of freedom
## Residual deviance: 803.66  on 709  degrees of freedom
## AIC: 829.66
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co"># Two different dataframes, mutate the binary regressor</span>
<span class="no">dft_bi0</span> <span class="kw">&lt;-</span> <span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(!!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span>(<span class="no">svr_binary</span>) <span class="kw">:=</span> <span class="no">svr_binary_lb0</span>)
<span class="no">dft_bi1</span> <span class="kw">&lt;-</span> <span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(!!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span>(<span class="no">svr_binary</span>) <span class="kw">:=</span> <span class="no">svr_binary_lb1</span>)

<span class="co"># Predcit Using Regresion Data</span>
<span class="no">dft</span>$<span class="no">p_mpg_hp_bi0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">rs_logit_bi</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">dft_bi0</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"response"</span>)
<span class="no">dft</span>$<span class="no">p_mpg_hp_bi1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">rs_logit_bi</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">dft_bi1</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"response"</span>)

<span class="co"># Predicted Probabilities and Binary Input</span>
<span class="no">scatter</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">dft</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">p_mpg_hp_bi0</span>)) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">p_mpg_hp</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">shape</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">color</span><span class="kw">=</span><span class="st">"red"</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">p_mpg_hp_bi1</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">shape</span><span class="kw">=</span><span class="fl">8</span>) +
      <span class="co"># geom_smooth(method=lm) + # Trend line</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">intercept</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">slope</span> <span class="kw">=</span> <span class="fl">1</span>) + <span class="co"># 45 degree line</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Predicted Probabilities and Binary Input'</span>,
                          <span class="st">'\ncross(shape=4)/red is predict actual binary data'</span>,
                          <span class="st">'\nstar(shape=8)/black is predict set binary = 1 for all'</span>),
           <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'prediction with '</span>, <span class="no">ls_st_xs</span>, <span class="st">' and binary '</span>, <span class="no">svr_binary</span>, <span class="st">' = 0 for all'</span>),
           <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'prediction with '</span>, <span class="no">ls_st_xs</span>, <span class="st">' and binary '</span>, <span class="no">svr_binary</span>, <span class="st">' = 1'</span>),
           <span class="kw">caption</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">sdt_name</span>, <span class="st">' simulated prediction'</span>)) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">scatter</span>)</pre></body></html></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%200%20vs%201-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="generate-and-analyze-a-and-alpha" class="section level2">
<h2 class="hasAnchor">
<a href="#generate-and-analyze-a-and-alpha" class="anchor"></a>Generate and Analyze A and alpha</h2>
<div id="prediction-with-binary-set-to-0-and-1-difference" class="section level3">
<h3 class="hasAnchor">
<a href="#prediction-with-binary-set-to-0-and-1-difference" class="anchor"></a>Prediction with Binary set to 0 and 1 Difference</h3>
<p>What is the difference in probability between binary = 0 vs binary = 1. How does that relate to the probability of outcome of interest when binary = 0 for all.</p>
<p>In the binary logit case, the relationship will be hump–shaped by construction between <span class="math inline">\(A_i\)</span> and <span class="math inline">\(\alpha_i\)</span>. In the exponential wage cases, the relationship is convex upwards.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co"># Generate Gap Variable</span>
<span class="no">dft</span> <span class="kw">&lt;-</span> <span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">alpha_i</span> <span class="kw">=</span> <span class="no">p_mpg_hp_bi1</span> - <span class="no">p_mpg_hp_bi0</span>) <span class="kw">%&gt;%</span>
                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">A_i</span> <span class="kw">=</span> <span class="no">p_mpg_hp_bi0</span>)

<span class="no">dft_graph</span> <span class="kw">&lt;-</span> <span class="no">dft</span>
<span class="no">dft_graph</span>$<span class="no">age_m2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">dft_graph</span>$<span class="no">age_m2</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Age &lt;= 23'</span>, <span class="st">'Age &gt; 23'</span>))

<span class="co"># Titling</span>
<span class="no">st_title</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Expected Outcomes without Allocations and Marginal Effects of Allocations"</span>)
<span class="no">title_line1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Each circle (cross) represents an individual &lt;= age 23 (&gt; age 23)"</span>)
<span class="no">title_line2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Heterogeneous expected outcome (employment probability) with and without training"</span>)
<span class="no">title_line3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Heterogeneity from logistic regression nonlinearity and heterogeneous age group effects"</span>)
<span class="no">title</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="st">'The joint distribution of'</span>~<span class="no">A</span>[<span class="no">i</span>]~<span class="st">'and'</span>~<span class="no">alpha</span>[<span class="no">i</span>]~<span class="st">','</span>~<span class="st">'Logistic Regression, Lalonde (AER, 1986)'</span>)
<span class="no">caption</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'Based on a logistic regression of the employment effects of a training RCT. Data: Lalonde (AER, 1986).'</span>)
<span class="co"># Labels</span>
<span class="no">st_x_label</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">Probability</span>~<span class="no">of</span>~<span class="no">Employment</span>~<span class="no">without</span>~<span class="no">Training</span>~<span class="st">','</span>~<span class="no">A</span>[<span class="no">i</span>]~<span class="st">'= P(train=0)'</span>)
<span class="no">st_y_label</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">Marginal</span>~<span class="no">Effects</span>~<span class="no">of</span>~<span class="no">Training</span>~<span class="st">','</span>~<span class="no">alpha</span>[<span class="no">i</span>]~<span class="st">'= P(train=1) - P(train=0)'</span>)

<span class="co"># Binary Marginal Effects and Prediction without Binary</span>
<span class="no">plt_A_alpha</span> <span class="kw">&lt;-</span> <span class="no">dft_graph</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">A_i</span>)) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">alpha_i</span>,
                     <span class="kw">color</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">age_m2</span>),
                     <span class="kw">shape</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">age_m2</span>)), <span class="kw">size</span><span class="kw">=</span><span class="fl">4</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">intercept</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">slope</span> <span class="kw">=</span> <span class="fl">1</span>) + <span class="co"># 45 degree line</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#69b3a2"</span>, <span class="st">"#404080"</span>)) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="no">st_title</span>,
           <span class="kw">subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">title_line1</span>, <span class="st">'\n'</span>, <span class="no">title_line2</span>, <span class="st">'\n'</span>, <span class="no">title_line3</span>),
           <span class="kw">x</span> <span class="kw">=</span> <span class="no">st_x_label</span>,
           <span class="kw">y</span> <span class="kw">=</span> <span class="no">st_y_label</span>,
           <span class="kw">caption</span> <span class="kw">=</span> <span class="no">caption</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>(<span class="kw">base_size</span><span class="kw">=</span><span class="fl">8</span>) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span>(<span class="kw">values</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">4</span>)) +
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="kw">color</span><span class="kw">=</span><span class="fl">FALSE</span>)

<span class="co"># Labeling</span>
<span class="no">plt_A_alpha</span>$<span class="no">labels</span>$<span class="no">shape</span> <span class="kw">&lt;-</span> <span class="st">"Age Subgroups"</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">plt_A_alpha</span>)</pre></body></html></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="kw">if</span> (<span class="no">bl_save_img</span>) {
  <span class="no">snm_cnts</span> <span class="kw">&lt;-</span> <span class="st">'Lalonde_employ_A_alpha.png'</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">spt_img_save</span>, <span class="no">snm_cnts</span>),
        <span class="kw">width</span> <span class="kw">=</span> <span class="fl">135</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">96</span>, <span class="kw">units</span><span class="kw">=</span><span class="st">'mm'</span>, <span class="kw">res</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">pointsize</span><span class="kw">=</span><span class="fl">7</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">plt_A_alpha</span>)
  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()
  <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">spt_img_save_draft</span>, <span class="no">snm_cnts</span>),
        <span class="kw">width</span> <span class="kw">=</span> <span class="fl">135</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">96</span>, <span class="kw">units</span><span class="kw">=</span><span class="st">'mm'</span>, <span class="kw">res</span> <span class="kw">=</span> <span class="fl">300</span>,
      <span class="kw">pointsize</span><span class="kw">=</span><span class="fl">5</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">plt_A_alpha</span>)
  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()
}</pre></body></html></div>
</div>
<div id="x-variables-and-a-and-alpha" class="section level3">
<h3 class="hasAnchor">
<a href="#x-variables-and-a-and-alpha" class="anchor"></a>X variables and A and alpha</h3>
<p>Given the x-variables included in the logit regression, how do they relate to A_i and alpha_i</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="co"># Generate Gap Variable</span>
<span class="no">dft</span> <span class="kw">&lt;-</span> <span class="no">dft</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">alpha_i</span> <span class="kw">=</span> <span class="no">p_mpg_hp_bi1</span> - <span class="no">p_mpg_hp_bi0</span>) <span class="kw">%&gt;%</span>
                <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">A_i</span> <span class="kw">=</span> <span class="no">p_mpg_hp_bi0</span>)

<span class="co"># Binary Marginal Effects and Prediction without Binary</span>
<span class="no">ggplot.A.alpha.x</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">svr_x</span>, <span class="no">df</span>,
                             <span class="no">svr_alpha</span> <span class="kw">=</span> <span class="st">'alpha_i'</span>, <span class="no">svr_A</span> <span class="kw">=</span> <span class="st">"A_i"</span>){

  <span class="no">scatter</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span>!!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span>(<span class="no">svr_x</span>))) +
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">alpha_i</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">shape</span><span class="kw">=</span><span class="fl">4</span>, <span class="kw">color</span><span class="kw">=</span><span class="st">"red"</span>) +
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">y</span><span class="kw">=</span><span class="no">A_i</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">shape</span><span class="kw">=</span><span class="fl">8</span>, <span class="kw">color</span><span class="kw">=</span><span class="st">"blue"</span>) +
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">intercept</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">slope</span> <span class="kw">=</span> <span class="fl">1</span>) + <span class="co"># 45 degree line</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">'A (blue) and alpha (red) vs x variables='</span>, <span class="no">svr_x</span>),
             <span class="kw">x</span> <span class="kw">=</span> <span class="no">svr_x</span>,
             <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Probabilities'</span>,
             <span class="kw">caption</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">sdt_name</span>, <span class="st">' simulated prediction'</span>)) +
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()

<span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">scatter</span>)
}

<span class="co"># Plot over multiple</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">ls_st_xs</span>,
       <span class="no">ggplot.A.alpha.x</span>,
       <span class="kw">df</span> <span class="kw">=</span> <span class="no">dft</span>)</pre></body></html></div>
<pre><code>## [[1]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-1.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-2.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-3.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-4.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-5.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/logit%20prediction%20marginal%20vs%20base%20along%20covariate%20x-6.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="optimal-binary-allocation" class="section level2">
<h2 class="hasAnchor">
<a href="#optimal-binary-allocation" class="anchor"></a>Optimal Binary Allocation</h2>
<div id="solve-for-optimal-allocations-across-preference-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#solve-for-optimal-allocations-across-preference-parameters" class="anchor"></a>Solve for Optimal Allocations Across Preference Parameters</h3>
<p>Invoke the binary optimal allocation function <em>ffp_opt_anlyz_rhgin_bin</em> that loops over rhos.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">svr_inpalc</span> <span class="kw">&lt;-</span> <span class="st">'rank'</span>

<span class="no">beta_i</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>/<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">dft</span>)[<span class="fl">1</span>], <span class="kw">times</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">dft</span>)[<span class="fl">1</span>])
<span class="no">dft</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">dft</span>, <span class="no">beta_i</span>)
<span class="no">ar_rho</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">100</span>, -<span class="fl">0.001</span>,  <span class="fl">0.95</span>)
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fl">1</span> - (<span class="fl">10</span>^(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">2</span>,<span class="fl">2</span>, <span class="kw">length.out</span><span class="kw">=</span><span class="fl">30</span>))))
<span class="no">ar_rho</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span>(<span class="no">ar_rho</span>)

<span class="no">svr_rho_val</span> <span class="kw">&lt;-</span> <span class="st">'rho_val'</span>
<span class="no">ls_bin_solu_all_rhos</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/ffp_opt_anlyz_rhgin_bin.html">ffp_opt_anlyz_rhgin_bin</a></span>(<span class="no">dft</span>, <span class="kw">svr_id_i</span> <span class="kw">=</span> <span class="st">'id'</span>,
                          <span class="kw">svr_A_i</span> <span class="kw">=</span> <span class="st">'A_i'</span>, <span class="kw">svr_alpha_i</span> <span class="kw">=</span> <span class="st">'alpha_i'</span>, <span class="kw">svr_beta_i</span> <span class="kw">=</span> <span class="st">'beta_i'</span>,
                          <span class="kw">ar_rho</span> <span class="kw">=</span> <span class="no">ar_rho</span>,
                          <span class="kw">svr_rho</span> <span class="kw">=</span> <span class="st">'rho'</span>, <span class="kw">svr_rho_val</span> <span class="kw">=</span> <span class="no">svr_rho_val</span>,
                          <span class="kw">svr_inpalc</span> <span class="kw">=</span> <span class="no">svr_inpalc</span>,
                          <span class="kw">svr_expout</span> <span class="kw">=</span> <span class="st">'opti_exp_outcome'</span>,
                          <span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## 'data.frame':    722 obs. of  54 variables:
##  $ id          : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ trt         : Factor w/ 2 levels "ntran","train": 1 1 1 1 1 1 1 1 1 1 ...
##  $ age         : int  23 26 22 34 18 45 18 27 24 34 ...
##  $ educ        : int  10 12 9 9 9 11 9 12 8 11 ...
##  $ black       : int  1 0 1 1 1 1 1 1 0 1 ...
##  $ hisp        : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ marr        : int  0 0 0 0 0 0 0 0 0 1 ...
##  $ nodeg       : int  1 0 1 1 1 1 1 0 1 1 ...
##  $ re74        : num  0 0 0 NA 0 0 0 NA 0 0 ...
##  $ re75        : num  0 0 0 4368 0 ...
##  $ re78        : num  0 12384 0 14051 10740 ...
##  $ re75_zero   : num  1 1 1 0 1 1 1 0 1 1 ...
##  $ emp78       : num  0 1 0 1 1 1 1 1 1 1 ...
##  $ emp75       : num  0 0 0 1 0 0 0 1 0 0 ...
##  $ race        : num  1 0 1 1 1 1 1 1 0 1 ...
##  $ age_m2      : num  1 2 1 2 1 2 1 2 2 2 ...
##  $ age_m3      : num  2 2 2 3 1 3 1 3 2 3 ...
##  $ p_mpg       : num  0.678 0.89 0.688 0.638 0.704 ...
##  $ p_mpg_hp    : num  0.591 0.811 0.598 0.616 0.636 ...
##  $ p_mpg_hp_bi0: num  0.591 0.811 0.598 0.616 0.636 ...
##  $ p_mpg_hp_bi1: num  0.686 0.858 0.692 0.693 0.725 ...
##  $ alpha_i     : num  0.0951 0.0466 0.0943 0.0764 0.0895 ...
##  $ A_i         : num  0.591 0.811 0.598 0.616 0.636 ...
##  $ beta_i      : num  0.00139 0.00139 0.00139 0.00139 0.00139 ...
##  $ rho_c1_rk   : int  1 605 6 294 36 286 36 463 591 295 ...
##  $ rho_c2_rk   : int  1 605 6 294 36 286 36 463 591 295 ...
##  $ rho_c3_rk   : int  1 605 6 294 36 274 36 463 591 295 ...
##  $ rho_c4_rk   : int  1 605 6 294 36 274 36 463 591 295 ...
##  $ rho_c5_rk   : int  1 605 6 282 36 274 36 463 591 283 ...
##  $ rho_c6_rk   : int  1 605 6 282 36 273 36 454 591 283 ...
##  $ rho_c7_rk   : int  1 605 6 273 36 260 36 454 591 274 ...
##  $ rho_c8_rk   : int  1 605 6 268 36 260 36 454 591 269 ...
##  $ rho_c9_rk   : int  1 605 6 268 36 260 36 450 591 269 ...
##  $ rho_c10_rk  : int  1 604 6 268 36 256 36 447 591 269 ...
##  $ rho_c11_rk  : int  1 604 6 253 36 241 36 447 590 254 ...
##  $ rho_c12_rk  : int  1 604 6 246 36 230 36 444 589 247 ...
##  $ rho_c13_rk  : int  1 604 6 233 53 225 53 435 587 234 ...
##  $ rho_c14_rk  : int  1 604 6 217 90 209 90 416 587 218 ...
##  $ rho_c15_rk  : int  1 604 6 212 103 204 103 397 587 213 ...
##  $ rho_c16_rk  : int  12 604 33 211 113 203 113 375 586 212 ...
##  $ rho_c17_rk  : int  45 601 67 207 122 198 122 349 584 208 ...
##  $ rho_c18_rk  : int  64 597 73 199 124 191 124 330 584 200 ...
##  $ rho_c19_rk  : int  68 597 79 177 133 169 133 314 582 178 ...
##  $ rho_c20_rk  : int  75 593 83 155 157 147 157 307 581 156 ...
##  $ rho_c21_rk  : int  78 593 86 155 172 147 172 297 581 156 ...
##  $ rho_c22_rk  : int  81 591 92 147 181 139 181 293 579 148 ...
##  $ rho_c23_rk  : int  87 590 94 147 197 139 197 293 579 148 ...
##  $ rho_c24_rk  : int  87 589 94 147 198 138 198 292 578 148 ...
##  $ rho_c25_rk  : int  87 588 94 146 202 138 202 292 578 147 ...
##  $ rho_c26_rk  : int  87 588 94 146 206 136 206 292 578 147 ...
##  $ rho_c27_rk  : int  88 588 94 146 210 133 210 290 578 147 ...
##  $ rho_c28_rk  : int  88 588 94 146 210 133 210 290 578 147 ...
##  $ rho_c29_rk  : int  88 588 94 146 210 133 210 290 578 147 ...
##  $ rho_c30_rk  : int  88 587 94 146 210 133 210 290 578 147 ...</code></pre>
<pre><code>## Joining, by = "id"</code></pre>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">df_all_rho</span> <span class="kw">&lt;-</span> <span class="no">ls_bin_solu_all_rhos</span>$<span class="no">df_all_rho</span>
<span class="no">df_all_rho_long</span> <span class="kw">&lt;-</span> <span class="no">ls_bin_solu_all_rhos</span>$<span class="no">df_all_rho_long</span>

<span class="co"># How many people have different ranks across rhos</span>
<span class="no">it_how_many_vary_rank</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">df_all_rho</span>$<span class="no">rank_max</span> - <span class="no">df_all_rho</span>$<span class="no">rank_min</span>)
<span class="no">it_how_many_vary_rank</span></pre></body></html></div>
<pre><code>## [1] -76274</code></pre>
</div>
<div id="change-in-rank-along-rho" class="section level3">
<h3 class="hasAnchor">
<a href="#change-in-rank-along-rho" class="anchor"></a>Change in Rank along rho</h3>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="co"># get rank when wage rho = 1</span>
<span class="no">df_all_rho_rho_c1</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">id</span>, <span class="no">rho_c1_rk</span>)
<span class="co"># Merge</span>
<span class="no">df_all_rho_long_more</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho_long</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rho</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">rho</span>)) <span class="kw">%&gt;%</span>
                      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">df_all_rho_rho_c1</span>, <span class="kw">by</span><span class="kw">=</span><span class="st">'id'</span>)
<span class="co"># Select subset to graph</span>
<span class="no">df_rank_graph</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho_long_more</span> <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">id</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">id</span>)) <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>((<span class="no">id</span> <span class="kw">==</span> <span class="fl">1</span>) <span class="kw">|</span>  <span class="co"># utilitarian rank = 1</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">711</span>) <span class="kw">|</span>  <span class="co"># utilitarian rank = 101</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">731</span>)  <span class="kw">|</span>  <span class="co"># utilitarian rank = 207</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">50</span>) <span class="kw">|</span>  <span class="co"># utilitarian rank = 300</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">1571</span>)<span class="kw">|</span>  <span class="co"># utilitarian rank = 402</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">22</span>) <span class="kw">|</span>  <span class="co"># utilitarian rank = 500</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">164</span>) <span class="kw">|</span>  <span class="co"># utilitarian rank = 600</span>
                           (<span class="no">id</span> <span class="kw">==</span> <span class="fl">296</span>)   <span class="co"># utilitarian rank = 701</span>
                             ) <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">one_minus_rho</span> <span class="kw">=</span> <span class="fl">1</span> - !!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span>(<span class="no">svr_rho_val</span>)) <span class="kw">%&gt;%</span>
                    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">rho_c1_rk</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">rho_c1_rk</span>))

<span class="no">df_rank_graph</span>$<span class="no">rho_c1_rk</span></pre></body></html></div>
<pre><code>##   [1] 1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1  
##  [19] 1   1   1   1   1   1   1   1   1   1   1   1   500 500 500 500 500 500
##  [37] 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500 500
##  [55] 500 500 500 500 500 500 300 300 300 300 300 300 300 300 300 300 300 300
##  [73] 300 300 300 300 300 300 300 300 300 300 300 300 300 300 300 300 300 300
##  [91] 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600 600
## [109] 600 600 600 600 600 600 600 600 600 600 600 600 700 700 700 700 700 700
## [127] 700 700 700 700 700 700 700 700 700 700 700 700 700 700 700 700 700 700
## [145] 700 700 700 700 700 700 101 101 101 101 101 101 101 101 101 101 101 101
## [163] 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101 101
## [181] 207 207 207 207 207 207 207 207 207 207 207 207 207 207 207 207 207 207
## [199] 207 207 207 207 207 207 207 207 207 207 207 207 402 402 402 402 402 402
## [217] 402 402 402 402 402 402 402 402 402 402 402 402 402 402 402 402 402 402
## [235] 402 402 402 402 402 402
## Levels: 1 101 207 300 402 500 600 700</code></pre>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">df_rank_graph</span>$<span class="no">id</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">df_rank_graph</span>$<span class="no">rho_c1_rk</span>,
                           <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Rank= 1  '</span>, <span class="co">#200</span>
                                      <span class="st">'Rank= 101'</span>, <span class="co">#110</span>
                                      <span class="st">'Rank= 201'</span>, <span class="co">#95</span>
                                      <span class="st">'Rank= 301'</span>, <span class="co">#217</span>
                                      <span class="st">'Rank= 401'</span>, <span class="co">#274</span>
                                      <span class="st">'Rank= 501'</span>, <span class="co">#101</span>
                                      <span class="st">'Rank= 601'</span>, <span class="co">#131</span>
                                      <span class="st">'Rank= 701'</span> <span class="co">#3610</span>
                                       ))

<span class="co"># x-labels</span>
<span class="no">x.labels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'&lt;U+03BB&gt;=0.99'</span>, <span class="st">'&lt;U+03BB&gt;=0.90'</span>, <span class="st">'&lt;U+03BB&gt;=0'</span>, <span class="st">'&lt;U+03BB&gt;=-10'</span>, <span class="st">'&lt;U+03BB&gt;=-100'</span>)
<span class="no">x.breaks</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.01</span>, <span class="fl">0.10</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">100</span>)

<span class="co"># title line 2</span>
<span class="no">st_title</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Positions on the Optimal (Binary) Allocation Queue at Varying &lt;U+03BB&gt; Levels"</span>)
<span class="no">title_line2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Colored lines = different individuals from the NSW training dataset"</span>)
<span class="no">title_line3</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"Track ranking changes for eight individuals ranked 1, 101, ..., 701 at &lt;U+03BB&gt;=0.99"</span>)

<span class="co"># Graph Results--Draw</span>
<span class="no">line.plot</span> <span class="kw">&lt;-</span> <span class="no">df_rank_graph</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">one_minus_rho</span>, <span class="kw">y</span><span class="kw">=</span>!!<span class="fu"><a href="https://dplyr.tidyverse.org/reference/tidyeval-compat.html">sym</a></span>(<span class="no">svr_inpalc</span>),
             <span class="kw">group</span><span class="kw">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span>(<span class="no">id</span>),
             <span class="kw">colour</span><span class="kw">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span>(<span class="no">id</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">2</span>)) +
  <span class="co"># geom_line(aes(linetype =fct_rev(id)), size=0.75) +</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">0.5</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="kw">xintercept</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>), <span class="kw">linetype</span><span class="kw">=</span><span class="st">"dotted"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="no">st_title</span>, <span class="kw">subtitle</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">title_line2</span>, <span class="st">'\n'</span>, <span class="no">title_line3</span>),
       <span class="kw">x</span> <span class="kw">=</span> <span class="st">'log10 Rescale of &lt;U+03BB&gt;, Log10(1-&lt;U+03BB&gt;)\n&lt;U+03BB&gt;=1 Utilitarian (Maximize Average), &lt;U+03BB&gt;=-infty Rawlsian (Maximize Minimum)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Optimal Allocation Queue Rank (1=highest)'</span>,
       <span class="kw">caption</span> <span class="kw">=</span> <span class="st">'Based on a logistic regression of the employment effects of a training RCT. Data: Lalonde (AER, 1986).'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">trans</span><span class="kw">=</span><span class="st">'log10'</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="no">x.labels</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="no">x.breaks</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>(<span class="kw">base_size</span><span class="kw">=</span><span class="fl">8</span>)

<span class="co"># Labeling</span>
<span class="no">line.plot</span>$<span class="no">labels</span>$<span class="no">colour</span> <span class="kw">&lt;-</span> <span class="st">"At &lt;U+03BB&gt;=0.99, i's"</span>

<span class="co"># Print</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">line.plot</span>)</pre></body></html></div>
<p><img src="ffv_opt_sobin_rkone_allfc_training_logit_files/figure-html/graph%20of%20rank%20change-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="kw">if</span> (<span class="no">bl_save_img</span>) {
  <span class="no">snm_cnts</span> <span class="kw">&lt;-</span> <span class="st">'Lalonde_employ_rank.png'</span>
  <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">spt_img_save</span>, <span class="no">snm_cnts</span>),
        <span class="kw">width</span> <span class="kw">=</span> <span class="fl">135</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">96</span>, <span class="kw">units</span><span class="kw">=</span><span class="st">'mm'</span>, <span class="kw">res</span> <span class="kw">=</span> <span class="fl">300</span>, <span class="kw">pointsize</span><span class="kw">=</span><span class="fl">7</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">line.plot</span>)
  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()
  <span class="fu"><a href="https://rdrr.io/r/grDevices/png.html">png</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">spt_img_save_draft</span>, <span class="no">snm_cnts</span>),
        <span class="kw">width</span> <span class="kw">=</span> <span class="fl">135</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">96</span>, <span class="kw">units</span><span class="kw">=</span><span class="st">'mm'</span>, <span class="kw">res</span> <span class="kw">=</span> <span class="fl">300</span>,
      <span class="kw">pointsize</span><span class="kw">=</span><span class="fl">5</span>)
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">line.plot</span>)
  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()
}</pre></body></html></div>
</div>
<div id="save-results" class="section level3">
<h3 class="hasAnchor">
<a href="#save-results" class="anchor"></a>Save Results</h3>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="co"># Change Variable names so that this can becombined with logit file later</span>
<span class="no">df_all_rho</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select_all.html">rename_at</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html">vars</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/reexports.html">starts_with</a></span>(<span class="st">"rho_"</span>)), <span class="fu"><a href="https://dplyr.tidyverse.org/reference/funs.html">funs</a></span>(<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span>(<span class="no">.</span>, <span class="st">"rk"</span>, <span class="st">"rk_employ"</span>)))</pre></body></html></div>
<pre><code>## Warning: `funs()` is deprecated as of dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">df_all_rho</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho</span> <span class="kw">%&gt;%</span>
        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(<span class="kw">A_i_employ</span> <span class="kw">=</span> <span class="no">A_i</span>, <span class="kw">alpha_i_employ</span> <span class="kw">=</span> <span class="no">alpha_i</span>, <span class="kw">beta_i_employ</span> <span class="kw">=</span> <span class="no">beta_i</span>,
               <span class="kw">rank_min_employ</span> <span class="kw">=</span> <span class="no">rank_min</span>, <span class="kw">rank_max_employ</span> <span class="kw">=</span> <span class="no">rank_max</span>, <span class="kw">avg_rank_employ</span> <span class="kw">=</span> <span class="no">avg_rank</span>)

<span class="co"># Save File</span>
<span class="kw">if</span> (<span class="no">bl_save_rda</span>) {
  <span class="no">df_opt_lalonde_training_employ</span> <span class="kw">&lt;-</span> <span class="no">df_all_rho</span>
  <span class="kw pkg">usethis</span><span class="kw ns">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span>(<span class="no">df_opt_lalonde_training_employ</span>, <span class="no">df_opt_lalonde_training_employ</span>, <span class="kw">overwrite</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
}</pre></body></html></div>
</div>
<div id="binary-marginal-effects-and-prediction-without-binary" class="section level3">
<h3 class="hasAnchor">
<a href="#binary-marginal-effects-and-prediction-without-binary" class="anchor"></a>Binary Marginal Effects and Prediction without Binary</h3>
<p>What is the relationship between ranking,</p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"># ggplot.A.alpha.x &lt;- function(svr_x, df,
#                              svr_alpha = 'alpha_i', svr_A = "A_i"){
#
#   scatter &lt;- ggplot(df, aes(x=!!sym(svr_x))) +
#         geom_point(aes(y=alpha_i), size=4, shape=4, color="red") +
#         geom_point(aes(y=A_i), size=2, shape=8, color="blue") +
#         geom_abline(intercept = 0, slope = 1) + # 45 degree line
#         labs(title = paste0('A (blue) and alpha (red) vs x variables=', svr_x),
#              x = svr_x,
#              y = 'Probabilities',
#              caption = paste0(sdt_name, ' simulated prediction')) +
#         theme_bw()
#
# return(scatter)
# }</pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://fanwangecon.github.io">Fan Wang</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
